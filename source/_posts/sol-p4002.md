---
title: P4002 ç”Ÿæˆæ ‘è®¡æ•°
tags: solutions
category: é¢˜è§£
date: 2022-01-17 20:23:11
---

## P4002 ç”Ÿæˆæ ‘è®¡æ•°

~~é»‘ï¼ŒçœŸ$^{\text{TM}}$çš„é»‘å•Šï¼ˆæŒ‡é¢˜ç›®çš„é¢œè‰²ï¼‰~~

<!-- more -->

### é¢˜é¢

[é¢˜ç›®é“¾æ¥](https://www.luogu.com.cn/problem/P4002)

### å‰ç½®çŸ¥è¯†ï¼šæ±‚æ•°åˆ—å¹‚å’Œ

ç»™å®šåºåˆ—${a_n}$ï¼Œå¯¹äº$0\le t \le k$ï¼Œæ±‚$\sum\limits_{i=1}^n a_i^t$ã€‚

å…ˆå†™å‡ºå¹‚æ¬¡å’Œæ‰€æ±‚å€¼ä¹‹é—´çš„ç”Ÿæˆå‡½æ•°ï¼š

$$
\begin{aligned}
F(x) =& \sum_{t=0}{\sum_{i=1}^{n}{a_i^t x^t}} \\
=& \sum_{i=1}^{n}{\frac{1}{1-a_ix}}
\end{aligned}
$$

ä¸å¦¨è®¾$G(x)=\sum\limits_{i=1}^{n}(\ln'(1-a_ix))$ï¼Œåˆ™æœ‰

$$
\begin{aligned}
G(x) =& \sum_{i=1}^n(\ln'(1-a_ix)) \\
=& -\sum_{i=1}^n\frac{a_i}{1-a_ix}
\end{aligned}
$$

äºæ˜¯æ±‚å‡º$G(x)$åå¯ä»¥å¾ˆå®¹æ˜“åœ°æ±‚å‡º$F(x)$ã€‚æ€è€ƒå¦‚ä½•æ±‚$G(x)$ï¼š

$$
\begin{aligned}
G(x) =& \sum_{i=1}^n(\ln'(1-a_ix)) \\
=& \left(\sum_{i=1}^n\ln(1-a_ix)\right)' \\
=& \left(\ln(\prod_{i=1}^n(1-a_ix))\right)'
\end{aligned}
$$

ä½¿ç”¨åˆ†æ²»FFTæ±‚å‡º$\prod\limits_{i=1}^n(1-a_ix)$ï¼Œå†$\ln$å’Œæ±‚å¯¼ï¼Œæ±‚å‡º$G(x)$å’Œ$F(x)$ï¼Œæ—¶é—´å¤æ‚åº¦$O(n \log^2 n)$ã€‚

### å¤šé¡¹å¼$\ln \mid \exp$

è§{% post_link 'sol-p4725' %}å’Œ{% post_link 'sol-p4726' %}ã€‚

### è§£æ³•

é¦–å…ˆï¼Œä½ éœ€è¦æƒ³åˆ°ä½¿ç”¨[pruferåºåˆ—](https://oi-wiki.org/graph/prufer/)æ¥è¿›è¡Œæ ‘å½¢æ€çš„æšä¸¾å¹¶è®¡ç®—è´¡çŒ®ã€‚

æ ¹æ®pruferåºåˆ—çš„å®šä¹‰ï¼Œä¸€æ£µ$n$ä¸ªèŠ‚ç‚¹çš„æ ‘å…±æœ‰$n^{n-2}$ç§ä¸åŒçš„å½¢æ€ã€‚

æˆ‘ä»¬è®¡ç®—ç­”æ¡ˆæ—¶éœ€è¦çš„æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„åº¦$deg_u$ã€‚

ä¸ºäº†æ–¹ä¾¿è®¾$d_u=deg_u-1$ï¼Œ$d_u$çš„å®é™…æ„ä¹‰æ˜¯$u$åœ¨pruferåºåˆ—ä¸­çš„å‡ºç°æ¬¡æ•°ã€‚

æ‰€ä»¥æšä¸¾$\sum d_i=n-2$ï¼Œç„¶åpruferåºåˆ—çš„$n-2$ä¸ªæ•°å­—æ’åˆ—å…±$(n-2)!$ç§æƒ…å†µã€‚äºæ˜¯ä¹

$$
\begin{aligned}
ans =& \sum_T val(T) \\
=& \sum_T \left(\prod_{i=1}^ndeg_i^m\right) \left(\sum_{i=1}^ndeg_i^m\right) \\
=& \sum_{\sum d_i=n-2}(n-2)!\left(\prod_{i=1}^n(d_i+1)^m\right) \left(\sum_{i=1}^n(d_i+1)^m\right) \left(\prod_{i=1}^n\frac{a_i^{d_i+1}}{d_i!}\right) \\
=& (n-2)! \prod_{i=1}^na_i \sum_{\sum d_i=n-2} \left(\prod_{i=1}^n\frac{a_i^{d_i}}{d_i!}(d_i+1)^m\right) \left(\sum_{i=1}^n(d_i+1)^m\right)
\end{aligned}
$$

å·¦è¾¹ä¸¤é¡¹å®šå€¼å…ˆä¸ç®¡ï¼Œå³è¾¹å‡ é¡¹å¦‚ä¸‹ï¼š

$$
\sum_{\sum d_i=n-2} \sum_{i=1}^{n}{\frac{a_i^{d_i}}{d_i!}(d_i+1)^{2m} \prod_{j \neq i}{\frac{a_j^{d_j}}{d_j!}(d_j+1)^m}}
$$

æ„é€ ä¸¤ä¸ªå¤šé¡¹å¼$A(x)$å’Œ$B(x)$ï¼š

$$
\begin{aligned}
A(x)=\sum_i\frac{(i+1)^{2m}x^i}{i!} \\
B(x)=\sum_i\frac{(i+1)^mx^i}{i!}
\end{aligned}
$$

åˆ™æœ‰

$$
\begin{aligned}
F(x) =& \sum_{i=1}^{n}{A(a_ix) \prod_{j\neq i}B(a_jx)} \\
=& \sum_{i=1}^{n}{\frac{A(a_ix)}{B(a_ix)} \prod_{j=1}^{n}B(a_jx)} \\
=& \sum_{i=1}^{n}{\frac{A(a_ix)}{B(a_ix)} \exp\left(\sum_{j=1}^{n}\ln(B(a_jx))\right)}
\end{aligned}
$$

~~å·²ç»çœ‹æ™•äº†ï¼Ÿä¸è¦ç´§ï¼Œæˆ‘ä¹Ÿå†™æ™•äº†ï¼ˆbushi~~

### ACä»£ç 

```cpp
ğŸ¦ğŸ¦ğŸ¦ğŸ¦ğŸ¦ğŸ¦ğŸ¦
```