<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>å…³äºæˆ‘</title>
    <url>/2021/11/20/about-me/</url>
    <content><![CDATA[<p><img src="https://api.xecades.xyz/api?bg=255%2C255%2C255%2C1&amp;date=2022-04-10&amp;str=NOI2022%E7%9C%81%E9%80%89%E6%9C%80%E5%A4%9A&amp;quote=%E6%98%AF%E6%97%B6%E5%80%99%E5%BC%80%E5%A7%8B%E5%8A%AA%E5%8A%9B%E4%BA%86%F0%9F%92%AA&amp;img=1&amp;codeforces=yaoxi&amp;luogu=yaoxi&amp;github=yaoxi-std&amp;email=yaoxi20061225%40126.com&amp;site=yaoxi-std.github.io" alt=""></p>
<p><a href="https://www.luogu.com.cn/user/141573"><img src="https://luogu-card-qinyihao.vercel.app/about?id=141573&amp;card_width=800" alt="luogu-info"></a></p>
<p><a href="https://www.luogu.com.cn/user/141573"><img src="https://statcard.vercel.app/practice?id=141573&amp;card_width=800" alt="luogu-solved"></a></p>
<p><a href="https://www.luogu.com.cn/user/141573"><img src="https://statcard.vercel.app/shield?id=141573" alt="luogu"></a></p>
<p><a href="https://atcoder.jp/users/yaoxi_std"><img src="https://atcoder.swift-zym.workers.dev/yaoxi_std" alt="atcoder"></a></p>
<p><a href="https://codeforces.com/profile/yaoxi"><img src="https://codeforces-status.yaoxi-std.workers.dev/shields?handle=yaoxi" alt="codeforces"></a></p>
]]></content>
  </entry>
  <entry>
    <title>ä»»åŠ¡è®¡åˆ’</title>
    <url>/2021/11/20/missions/</url>
    <content><![CDATA[<h3 id="2021-11-20-Sat"><a href="#2021-11-20-Sat" class="headerlink" title="2021.11.20 (Sat)"></a>2021.11.20 (Sat)</h3><p><del><a href="/2021/11/25/sol-p3715/" title="P3715">P3715</a></del></p>
<p><del><a href="/2021/11/22/sol-cf702f/" title="CF702F">CF702F</a></del> <del><a href="/2021/11/22/sol-cf710f/" title="CF710F">CF710F</a></del></p>
<p><del><a href="/2021/11/22/sol-p4632/" title="P4632">P4632</a></del></p>
<p><del><a href="/2021/11/23/sol-p6144/" title="P6144">P6144</a></del></p>
<p><del><a href="/2021/11/24/sol-cf575a/" title="CF575A">CF575A</a></del></p>
<p><del><a href="/2021/11/25/sol-p7154/" title="P7154">P7154</a></del> <del><a href="/2021/11/26/sol-p7155/" title="P7155">P7155</a></del></p>
<p><del><a href="/2021/11/26/sol-bzoj2720/" title="BZOJ2720">BZOJ2720</a></del></p>
<h3 id="2021-11-27-Sat"><a href="#2021-11-27-Sat" class="headerlink" title="2021.11.27 (Sat)"></a>2021.11.27 (Sat)</h3><p><del><a href="/2021/11/27/sol-p2495/" title="P2495">P2495</a></del> <del><a href="/2021/11/27/sol-p3233/" title="P3233">P3233</a></del></p>
<p><del><a href="/2021/11/28/sol-p3803/" title="P3803">P3803</a></del></p>
<p><del><a href="/2021/11/29/sol-p4606/" title="P4606">P4606</a></del></p>
<p><del><a href="/2021/12/05/sol-p4238/" title="P4238">P4238</a></del></p>
<p><del><a href="/2021/12/01/sol-cf1320e/" title="CF1320E">CF1320E</a></del></p>
<p><del><a href="/2021/12/03/sol-cf639f/" title="CF639F">CF639F</a></del></p>
<p>LOJ6184</p>
<h3 id="2021-12-4-Sat"><a href="#2021-12-4-Sat" class="headerlink" title="2021.12.4 (Sat)"></a>2021.12.4 (Sat)</h3><p><del><a href="/2021/12/04/sol-cf526g/" title="CF526G">CF526G</a></del> <del><a href="/2021/11/28/sol-p3803/" title="P3803">P3803</a></del></p>
<p><del><a href="/2021/12/05/sol-p4721/" title="P4721">P4721</a></del> <del><a href="/2021/12/05/sol-cf632e/" title="CF632E">CF632E</a></del> <del><a href="/2021/12/05/sol-p4245/" title="P4245">P4245</a></del></p>
<p><del><a href="/2021/12/06/sol-at2064/" title="AT2064">AT2064</a></del></p>
<p><del><a href="/2021/12/08/sol-cf1096g/" title="CF1096G">CF1096G</a></del></p>
<p><del><a href="/2021/12/10/sol-p2664/" title="P2664">P2664</a></del> <del><a href="/2021/12/10/sol-p6329/" title="P6329">P6329</a></del></p>
<h3 id="2021-12-15-Wed"><a href="#2021-12-15-Wed" class="headerlink" title="2021.12.15 (Wed)"></a>2021.12.15 (Wed)</h3><p>å› ä¸ºæœˆè€ƒæ‰€ä»¥ğŸ¦ğŸ¦ğŸ¦äº†å‡ å¤©ï¼Œä½†æœˆè€ƒè€ƒçš„å¾ˆçƒ‚</p>
<p><del><a href="/2021/12/15/sol-p2056/" title="P2056">P2056</a></del></p>
<p><del><a href="/2021/12/16/sol-p3809/" title="P3809">P3809</a></del></p>
<p><del><a href="/2021/12/17/sol-p2408/" title="P2408">P2408</a></del> <del><a href="/2021/12/17/sol-p4051/" title="P4051">P4051</a></del> <del><a href="/2021/12/17/sol-p4248/" title="P4248">P4248</a></del></p>
<h3 id="2021-12-19-Sun"><a href="#2021-12-19-Sun" class="headerlink" title="2021.12.19 (Sun)"></a>2021.12.19 (Sun)</h3><p><del><a href="/2021/12/19/sol-p3181/" title="P3181">P3181</a></del></p>
<p><del><a href="/2021/12/20/sol-p2756/" title="P2756">P2756</a></del> <del><a href="/2021/12/20/sol-p2761/" title="P2761">P2761</a></del></p>
<p><del><a href="/2021/12/21/sol-p4011/" title="P4011">P4011</a></del> <del><a href="/2021/12/21/sol-p4016/" title="P4016">P4016</a></del></p>
<p><del><a href="/2021/12/22/sol-p1251/" title="P1251">P1251</a></del> <del><a href="/2021/12/22/sol-p2754/" title="P2754">P2754</a></del> <del><a href="/2021/12/22/sol-p2762/" title="P2762">P2762</a></del></p>
<p><del><a href="/2021/12/23/sol-p2763/" title="P2763">P2763</a></del></p>
<p><del><a href="/2021/12/24/sol-p2764/" title="P2764">P2764</a></del> <del><a href="/2021/12/24/sol-p2765/" title="P2765">P2765</a></del> <del><a href="/2021/12/24/sol-p2766/" title="P2766">P2766</a></del> <del><a href="/2021/12/24/sol-p2770/" title="P2770">P2770</a></del></p>
<p><del><a href="/2021/12/25/sol-p4716/" title="P4716">P4716</a></del> <del><a href="/2021/12/25/sol-p2774/" title="P2774">P2774</a></del> <del><a href="/2021/12/25/sol-p3254/" title="P3254">P3254</a></del> <del><a href="/2021/12/25/sol-p3355/" title="P3355">P3355</a></del></p>
<h3 id="2021-12-26-Sun"><a href="#2021-12-26-Sun" class="headerlink" title="2021.12.26 (Sun)"></a>2021.12.26 (Sun)</h3><p><del><a href="/2021/12/27/sol-p3356/" title="P3356">P3356</a></del> <del><a href="/2021/12/27/sol-p3357/" title="P3357">P3357</a></del> <del><a href="/2021/12/27/sol-p3358/" title="P3358">P3358</a></del></p>
<p><del><a href="/2021/12/30/sol-p4012/" title="P4012">P4012</a></del> <del><a href="/2021/12/30/sol-p4013/" title="P4013">P4013</a></del> <del><a href="/2021/12/30/sol-p4014/" title="P4014">P4014</a></del> <del><a href="/2021/12/30/sol-p4015/" title="P4015">P4015</a></del></p>
<p><del><a href="/2021/12/31/sol-p4009/" title="P4009">P4009</a></del></p>
<h3 id="2022-1-1-Sat"><a href="#2022-1-1-Sat" class="headerlink" title="2022.1.1 (Sat)"></a>2022.1.1 (Sat)</h3><p><del><a href="/2022/01/02/sol-cf986d/" title="CF986D">CF986D</a></del></p>
<p><del><a href="/2022/01/03/sol-cf1613f/" title="CF1613F">CF1613F</a></del></p>
<p><del><a href="/2022/01/03/sol-cf755g/" title="CF755G">CF755G</a></del></p>
<p><del><a href="/2022/01/05/sol-cf623e/" title="CF623E">CF623E</a></del></p>
<p><del><a href="/2022/01/07/sol-cf773f/" title="CF773F">CF773F</a></del></p>
<h3 id="2022-1-9-Sun"><a href="#2022-1-9-Sun" class="headerlink" title="2022.1.9 (Sun)"></a>2022.1.9 (Sun)</h3><p><del><a href="/2022/01/09/sol-cf553e/" title="CF553E">CF553E</a></del></p>
<h3 id="å¾…å†™çš„é¢˜è§£"><a href="#å¾…å†™çš„é¢˜è§£" class="headerlink" title="å¾…å†™çš„é¢˜è§£"></a>å¾…å†™çš„é¢˜è§£</h3>]]></content>
      <tags>
        <tag>schedules</tag>
      </tags>
  </entry>
  <entry>
    <title>SBé”™è¯¯</title>
    <url>/2021/11/20/sb-mistakes/</url>
    <content><![CDATA[<blockquote>
<p>æ•°ç»„å¼€å¤ªå°ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>å†…å­˜å¼€å¤ªå¤§ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>å¤šæµ‹ä¸æ¸…ç©ºï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p><code>cin</code> å…³åŒæ­¥ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>ç‰¹åˆ¤ä¸å–æ¨¡ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>å·ç§¯ä¸æ¸…ç©ºï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>æ–œç‡é™¤ä»¥é›¶ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>æµ®ç‚¹ä¸¢ç²¾åº¦ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
</blockquote>
<span id="more"></span>
<h2 id="ä¸€äº›sbçš„é”™è¯¯æ±‡æ€»"><a href="#ä¸€äº›sbçš„é”™è¯¯æ±‡æ€»" class="headerlink" title="ä¸€äº›sbçš„é”™è¯¯æ±‡æ€»"></a>ä¸€äº›sbçš„é”™è¯¯æ±‡æ€»</h2><ul>
<li>ACè‡ªåŠ¨æœºåœ¨åšå¤šæ¨¡å¼åŒ¹é…çš„æ—¶å€™<strong>ä¸€å®šè¦è·³failæŒ‡é’ˆ</strong>ä¸ç„¶ä¼š<strong>æ¼éå†å¾ˆå¤šä¸œè¥¿</strong>ï¼ˆACè‡ªåŠ¨æœºç™½å­¦äº†ï¼‰ï¼ï¼ï¼(2021.11.20, P3715)</li>
<li>å†™çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–dpï¼ˆå°¤å…¶æ˜¯dp[i]ä¾èµ–äºdp[i-2]è¿™ç§ï¼‰çš„æ—¶å€™ä¸€å®šè¦ç®—å¥½ï¼Œä¸èƒ½é‡å¤åŠ äº†(2021.11.20, P3715)</li>
<li>å–æ¨¡çš„é¢˜ç›®é‡åˆ°<strong>ç‰¹åˆ¤</strong>ä¸€å®šè®°å¾—è¾“å‡º<strong>å–æ¨¡</strong>ï¼Œä¸ç„¶ç­‰ç€è¢«hackå§ã€‚ã€‚ã€‚(2021.11.24, CF575A)</li>
<li>æ¢æ ¹$dp$ä¸è¦åœ¨ç»Ÿè®¡$pre$å’Œ$nxt$æ•°ç»„æ—¶å°±å†™$dfs$!!!æ•°ç»„æ•´ä¸ªæ”¹å˜!!!ä¸ç„¶ä¼šæ­»å¾—å¾ˆæƒ¨ï¼ˆæŒ‡å¯¹ç€n=1000,m=100çš„å¤§æ ·ä¾‹è°ƒ1hï¼‰(2021.11.27, P3233)</li>
<li>å¤šæµ‹ä¸æ¸…ç©ºï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª/kk å¤šæµ‹<code>dfn</code>æ•°ç»„è®°å¾—æ¸…ç©ºå•Š (2021.11.29, P4606)</li>
<li><code>(0 - 1) / x + 1 == 1</code>ï¼Œè¦ç‰¹åˆ¤æˆ–è€…å†™æˆ<code>(? + x - 1) / x</code> (2021.12.1 CF1320E)</li>
<li><code>priority_queue&lt;_Tp&gt;</code>é»˜è®¤æ˜¯<code>less&lt;_Tp&gt;</code>ï¼Œè‡ªå®šä¹‰ç±»å‹è¦ä¹ˆæŒ‰ç…§$\gt$çš„é€»è¾‘é‡è½½<code>operator&lt;()</code>ï¼Œè¦ä¹ˆæŒ‰ç…§$\gt$çš„é€»è¾‘é‡è½½<code>operator&gt;()</code>å¹¶ä¸”ä¿®æ”¹é»˜è®¤å‚æ•°ï¼ˆè¿™ä¸ªå¥½åƒé”™äº†ä¸æ­¢ä¸€æ¬¡äº†ï¼‰(2021.12.1 CF1320E)</li>
<li>å¼€<code>vector</code>å½“åŠ¨æ€å¼€ç‚¹æ ‘çŠ¶æ•°ç»„<code>resize</code>æ—¶æ²¡æœ‰$+1$ (2021.12.10, P6329)</li>
<li>è´¹ç”¨æµéœ€è¦æ³¨æ„çš„åœ°æ–¹è§<a href="/2021/12/17/top-networkflow/" title="è¿™é‡Œ">è¿™é‡Œ</a> (2021.12.21, P4016)</li>
<li>è´¹ç”¨æµä¸èƒ½åœ¨æ®‹ä½™ç½‘ç»œä¸ŠåŠ è¾¹é‡æ–°è·‘ï¼Œå¦åˆ™æ— æ³•ä¿è¯æœ€å¤§/æœ€å°è´¹ç”¨ (2021.12.30, P4013)</li>
<li>FFTä¸ä»…è¦å¼€<strong>ä¸¤å€</strong>é•¿æ•°ç»„ï¼ŒåŸå‡½æ•°åŒºé—´$[n,2n)$å†…çš„ç³»æ•°è¿˜è¦<strong>æ¸…ç©º</strong>ï¼Œä¸è¦ä»¥ä¸º$\ge n$æˆ–è€…$\ge 2n$çš„ç³»æ•°ä¼šè¢«å¿½ç•¥ï¼Œå®ƒä»¬ä¼šè¢«è®¡ç®—åˆ°DFTçš„ç‚¹å€¼è¡¨è¾¾å¼ä¸­å»ï¼Œå¹¶ä¸”åœ¨IDFTæ—¶è¢«é”™è¯¯åœ°ç®—å›$\lt n$æˆ–è€…$\lt 2n$ç³»æ•°çš„è´¡çŒ®ä¸­ (2022.1.8, CF773F)</li>
</ul>
]]></content>
      <tags>
        <tag>important</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€äº›tips</title>
    <url>/2021/11/20/some-tips/</url>
    <content><![CDATA[<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><span id="more"></span>
<ul>
<li>ACè‡ªåŠ¨æœºbuildä»¥åå¯ä»¥å…ˆæŠŠcntæ•°ç»„é¢„å¤„ç†å‡ºæ¥ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡éƒ½è·³failæŒ‡é’ˆäº†ï¼ˆä¹Ÿä¸çŸ¥é“ç®—å¡å¸¸è¿˜æ˜¯è¯´ä¸é¢„å¤„ç†å¤æ‚åº¦å°±ä¸å¯¹ï¼Œåæ­£æˆ‘çš„<a href="/2021/11/22/sol-cf710f/" title="CF710F">CF710F</a>å°±æ˜¯åŠ äº†è¿™ä¸ªä¼˜åŒ–æ‰è¿‡äº†çš„ï¼‰(2021.11.22, CF710F)</li>
<li>è®¡ç®—æ ‘ä¸Šæœ€é•¿è·¯å¾„å’Œå¯ä»¥ç”¨<strong><a href="/2021/12/04/sol-cf526g/" title="é•¿é“¾å‰–åˆ†çš„å¥‡å¦™æ€§è´¨">é•¿é“¾å‰–åˆ†çš„å¥‡å¦™æ€§è´¨</a></strong>æ¥ç»´æŠ¤ (2021.12.4, CF526G)</li>
<li><strong>ä¸è¦</strong>ç”¨å˜é‡<code>M_PI</code>!!! <strong>è¦</strong>ç”¨<code>acos(-1)</code>!!! (2021.12.5, P4245)</li>
<li><code>scanf(&quot;%[^\n]&quot;, buf)</code>å¯ä»¥è¯»å…¥æ•´è¡Œï¼Œå…¶ä¸­<code>buf</code>æ˜¯<code>char</code>æ•°ç»„ã€‚ (2021.12.22, P2762)</li>
</ul>
]]></content>
      <tags>
        <tag>important</tag>
      </tags>
  </entry>
  <entry>
    <title>NOIç³»åˆ—æ¯”èµ›è·å¥–è®°å½•</title>
    <url>/2021/11/20/noi-records/</url>
    <content><![CDATA[<h2 id="è·å¥–è®°å½•"><a href="#è·å¥–è®°å½•" class="headerlink" title="è·å¥–è®°å½•"></a>è·å¥–è®°å½•</h2><span id="more"></span>
<p><del>åˆä¸‰æ‰æ‹¿TG1=çš„å±‘</del></p>
]]></content>
      <tags>
        <tag>records</tag>
      </tags>
  </entry>
  <entry>
    <title>Important dates</title>
    <url>/2021/11/20/date-records/</url>
    <content><![CDATA[<h2 id="ä¸€äº›åœ¨OIä¸­å¯¹æˆ‘æ¥è¯´æ¯”è¾ƒé‡è¦çš„æ—¶åˆ»"><a href="#ä¸€äº›åœ¨OIä¸­å¯¹æˆ‘æ¥è¯´æ¯”è¾ƒé‡è¦çš„æ—¶åˆ»" class="headerlink" title="ä¸€äº›åœ¨OIä¸­å¯¹æˆ‘æ¥è¯´æ¯”è¾ƒé‡è¦çš„æ—¶åˆ»"></a>ä¸€äº›åœ¨OIä¸­å¯¹æˆ‘æ¥è¯´æ¯”è¾ƒé‡è¦çš„æ—¶åˆ»</h2><span id="more"></span>
]]></content>
      <tags>
        <tag>records</tag>
      </tags>
  </entry>
  <entry>
    <title>æ ¡å†…è®­ç»ƒ</title>
    <url>/2021/11/21/school-contests/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">
  <script id="hbeData" type="hbeData" data-hmacdigest="5c21383fe24452d67265464fc0bdb41993ba1f1a00c402095516cf4d51cf76a5">67362a200d4bb0b1cd1ef5f7bb774ffb58a2089a15905f15111606287b2ae8c1fda5908825b78d3bd9f0460dd575aac087b0d3ae30eb047be42cd4b539c67f53c4b0f1311d9282a9c8b625c10d8f227bb3e45c44d3465d3d9ccdb76fbaf5e7da61e6ccede5c1bb855f6e2762bdfca6feb6e75183f2cffc09751eb47da6c6b50245203ea78cdff71016778372e2d02893ce3e664baf7d6d4fafab9e7e9c3196f94ab5d902ab2b40a06a1bdf81c8ebdf26891ac81f45595baacbea038af62bf743</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>school</tag>
      </tags>
  </entry>
  <entry>
    <title>AtCoder æ¯”èµ›è®°å½•</title>
    <url>/2021/11/20/atcoder-records/</url>
    <content><![CDATA[<p><a href="https://atcoder.jp/users/yaoxi_std"><img src="https://atcoder.swift-zym.workers.dev/yaoxi_std" alt="atcoder"></a></p>
<span id="more"></span>
<h2 id="AtCoder-ä¸Šçš„æ¯”èµ›è®°å½•"><a href="#AtCoder-ä¸Šçš„æ¯”èµ›è®°å½•" class="headerlink" title="AtCoder ä¸Šçš„æ¯”èµ›è®°å½•"></a>AtCoder ä¸Šçš„æ¯”èµ›è®°å½•</h2><h3 id="2021-11-21-ARC129"><a href="#2021-11-21-ARC129" class="headerlink" title="2021.11.21 ARC129"></a>2021.11.21 ARC129</h3><p>è¢«ä¹‹å‰ä¸¤é“DSé¢˜æå¾—æœ‰ç‚¹å¤´æ™•ï¼Œçœ‹äº†ä¸‹é¢˜æ„Ÿè§‰<del>åªä¼šåšA</del>æŒºæ€ç»´çš„ï¼Œäºæ˜¯åˆ‡äº†ä¸‹Aé¢˜å°±å»ç»§ç»­åš<a href="/2021/11/20/missions/" title="ä»»åŠ¡è®¡åˆ’">ä»»åŠ¡è®¡åˆ’</a>äº†ã€‚<br>update 2021.11.22 ï¼ˆæœ¬ä»¥ä¸ºè‚¯å®šè¦æ‰å¥½å¤šåˆ†ï¼Œç»“æœåˆ†æ•°<del>ä¸å‡åå¢</del>ï¼‰</p>
]]></content>
      <tags>
        <tag>records</tag>
      </tags>
  </entry>
  <entry>
    <title>Codeforces æ¯”èµ›è®°å½•</title>
    <url>/2021/11/20/codeforces-records/</url>
    <content><![CDATA[<style type="text/css">
.rated-user {
    font-family: helvetica neue,Helvetica,Arial,sans-serif;
    text-decoration: none!important;
    font-weight: 700;
    display: inline-block;
}
.legendary-user-first-letter {
    color: #000!important
}
.user-legendary {
    color: red!important
}
.user-red {
    color: red!important
}
.user-orange {
    color: #ff8c00!important
}
.user-violet {
    color: #a0a!important
}
.user-blue {
    color: blue!important
}
.user-cyan {
    color: #03a89e!important
}
.user-green {
    color: green!important
}
.user-gray {
    color: gray!important
}
</style>

<p><a href="https://codeforces.com/profile/yaoxi"><img src="https://codeforces-status.yaoxi-std.workers.dev/shields?handle=yaoxi" alt="codeforces"></a></p>
<span id="more"></span>
<h2 id="CodeForces-ä¸Šçš„æ¯”èµ›è®°å½•"><a href="#CodeForces-ä¸Šçš„æ¯”èµ›è®°å½•" class="headerlink" title="CodeForces ä¸Šçš„æ¯”èµ›è®°å½•"></a>CodeForces ä¸Šçš„æ¯”èµ›è®°å½•</h2><h3 id="2021-11-22-CF1612"><a href="#2021-11-22-CF1612" class="headerlink" title="2021.11.22 CF1612"></a>2021.11.22 CF1612</h3><p>æ²¡ç®—å¥½æ°é¥­çš„æ—¶é—´ï¼Œ<del>ä»¥åä¸æ‰“ä¸‹åˆ5ç‚¹çš„CFäº†</del></p>
<p>ä¸€æ ·æ˜¯åˆ‡äº†ABCDï¼Œçœ‹äº†çœ¼EFGèµ°äºº<del>ï¼ˆå¤ªä¸ä¸“å¿ƒäº†ï¼Œä¹Ÿä¸çŸ¥é“æ‰å¤šå°‘åˆ†ï¼‰</del><br><del>éš¾é“å­¦æ ¡ä»Šå¤©å¼€å®¶é•¿ä¼šå°±æ˜¯ä¸ºäº†è®©æˆ‘ä»¬æ‰“ä¸‹åˆçš„Codeforcesçš„ã€‚ã€‚ã€‚</del></p>
<h3 id="2022-1-3-CF1621"><a href="#2022-1-3-CF1621" class="headerlink" title="2022.1.3 CF1621"></a>2022.1.3 CF1621</h3><font class="rated-user user-blue">yaoxi</font>
$\to$
<font class="rated-user user-violet">yaoxi</font>

<p>æ—¶éš”å¤š<del>å¹´</del>æ—¥å†æ¬¡æ¡èµ·Codeforces</p>
<p>æ²¡æƒ³åˆ°Dé¢˜æ­£è§£ç«Ÿå¦‚æ­¤ç¦»è°±ï¼Œç›´æ¥å–$8$ä¸ªç‚¹çš„$\min$å°±Aäº†ã€‚</p>
]]></content>
      <tags>
        <tag>records</tag>
      </tags>
  </entry>
  <entry>
    <title>Live2D æ­å»º</title>
    <url>/2022/01/15/extra-blog-live2d/</url>
    <content><![CDATA[<h2 id="Live2D-æ­å»º"><a href="#Live2D-æ­å»º" class="headerlink" title="Live2D æ­å»º"></a>Live2D æ­å»º</h2><p>ä¸€æ—¥é—²æ¥æ— äº‹ï¼Œå¿½è§‰Live2Dã€‚ç½‘ä¸Šæ‰¾æ•™ç¨‹ï¼Œå´å«Œä¸å¤Ÿè¯¦ç»†ã€‚å¥ˆä½•ï¼Ÿå¥ˆä½•ï¼Ÿåªå¾—è‡ªå·±æ‘¸ç´¢ã€‚</p>
<span id="more"></span>
<p><del>å†™çš„ä»€ä¹ˆçƒ‚è¯—</del></p>
<hr>
<h3 id="åˆçº§"><a href="#åˆçº§" class="headerlink" title="åˆçº§"></a>åˆçº§</h3><h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>è¿™æ˜¯æœ€åŸºç¡€çš„Live2Dï¼Œå®Œæˆååªæœ‰ä¸€ä¸ªäººç‰©åœ¨ç½‘é¡µä¸Šï¼Œæ²¡æœ‰å¯¹è¯åŠŸèƒ½ã€‚</p>
<p>ä¸”<strong>åˆçº§ä¸ä¸­çº§ã€é«˜çº§ä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»</strong>ï¼Œå¦‚æœæƒ³è¦æ›´å¥½çš„æ•ˆæœï¼Œè¯·<strong>è·³è¿‡åˆçº§æ•™ç¨‹</strong>ã€‚</p>
<h4 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h4><p>å…ˆå®‰è£…<code>hexo-helper-live2d</code>æ’ä»¶ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install --save hexo-helper-live2d</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ°<a href="https://github.com/xiazeyu/live2d-widget-models">è¿™é‡Œ</a>æ‰¾ä¸€ä¸ªä½ å–œæ¬¢çš„Live2Dæ¨¡å‹è¿›è¡Œå®‰è£…ã€‚å¦‚é€‰æ‹©äº†<code>live2d-widget-model-wanko</code>ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install live2d-widget-model-wanko <span class="comment"># æ²¡æœ‰ --save</span></span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ°<strong>æ ¹ç›®å½•</strong>çš„<code>_config.yml</code>ä¸­æ·»åŠ é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Live2D</span></span><br><span class="line"><span class="comment">## https://github.com/EYHN/hexo-helper-live2d</span></span><br><span class="line"><span class="comment">## https://l2dwidget.js.org/docs/class/src/index.js~L2Dwidget.html#instance-method-init</span></span><br><span class="line"><span class="attr">live2d:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#enable: false</span></span><br><span class="line">  <span class="attr">scriptFrom:</span> <span class="string">local</span> <span class="comment"># é»˜è®¤</span></span><br><span class="line">  <span class="attr">pluginRootPath:</span> <span class="string">live2dw/</span> <span class="comment"># æ’ä»¶åœ¨ç«™ç‚¹ä¸Šçš„æ ¹ç›®å½•(ç›¸å¯¹è·¯å¾„)</span></span><br><span class="line">  <span class="attr">pluginJsPath:</span> <span class="string">lib/</span> <span class="comment"># è„šæœ¬æ–‡ä»¶ç›¸å¯¹ä¸æ’ä»¶æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">  <span class="attr">pluginModelPath:</span> <span class="string">assets/</span> <span class="comment"># æ¨¡å‹æ–‡ä»¶ç›¸å¯¹ä¸æ’ä»¶æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">  <span class="comment"># scriptFrom: jsdelivr # jsdelivr CDN</span></span><br><span class="line">  <span class="comment"># scriptFrom: unpkg # unpkg CDN</span></span><br><span class="line">  <span class="comment"># scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # ä½ çš„è‡ªå®šä¹‰ url</span></span><br><span class="line">  <span class="attr">tagMode:</span> <span class="literal">false</span> <span class="comment"># æ ‡ç­¾æ¨¡å¼, æ˜¯å¦ä»…æ›¿æ¢ live2d tagæ ‡ç­¾è€Œéæ’å…¥åˆ°æ‰€æœ‰é¡µé¢ä¸­</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">false</span> <span class="comment"># è°ƒè¯•, æ˜¯å¦åœ¨æ§åˆ¶å°è¾“å‡ºæ—¥å¿—</span></span><br><span class="line">  <span class="string">model</span></span><br><span class="line">    <span class="attr">use:</span> <span class="string">live2d-widget-model-wanko</span> <span class="comment"># æ›¿æ¢æˆä½ çš„æ¨¡å‹å</span></span><br><span class="line">    <span class="comment"># use: live2d-widget-model-wanko # npm-module package name</span></span><br><span class="line">    <span class="comment"># use: wanko # åšå®¢æ ¹ç›®å½•/live2d_models/ ä¸‹çš„ç›®å½•å</span></span><br><span class="line">    <span class="comment"># use: ./wives/wanko # ç›¸å¯¹äºåšå®¢æ ¹ç›®å½•çš„è·¯å¾„</span></span><br><span class="line">    <span class="comment"># use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # ä½ çš„è‡ªå®šä¹‰ url</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">position:</span> <span class="string">right</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">145</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">315</span></span><br><span class="line">  <span class="attr">mobile:</span></span><br><span class="line">    <span class="attr">show:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤º</span></span><br><span class="line">    <span class="attr">scale:</span> <span class="number">0.5</span> <span class="comment"># ç§»åŠ¨è®¾å¤‡ä¸Šçš„ç¼©æ”¾       </span></span><br><span class="line">  <span class="attr">react:</span></span><br><span class="line">    <span class="attr">opacityDefault:</span> <span class="number">0.7</span></span><br><span class="line">    <span class="attr">opacityOnHover:</span> <span class="number">0.8</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ<code>hexo c &amp;&amp; hexo g &amp;&amp; hexo s</code>ï¼Œå°±å¯ä»¥åœ¨æœ¬åœ°çœ‹åˆ°Live2Dæ¨¡å‹äº†ã€‚</p>
<hr>
<h3 id="ä¸­çº§"><a href="#ä¸­çº§" class="headerlink" title="ä¸­çº§"></a>ä¸­çº§</h3><h4 id="è¯´æ˜-1"><a href="#è¯´æ˜-1" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>é˜…è¯»é«˜çº§æ•™ç¨‹ä¹‹å‰ï¼Œè¯·å…ˆé˜…è¯»ä¸­çº§æ•™ç¨‹ã€‚</p>
<h4 id="æ“ä½œ-1"><a href="#æ“ä½œ-1" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h4><p>å…ˆå…³é—­<code>hexo-helper-live2d</code>ï¼ˆå¦‚æœå·²ç»æŒ‰ç…§åˆçº§æ•™ç¨‹å¼€å¯è¿‡çš„è¯ï¼‰ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm uninstall hexo-helper-live2d</span><br><span class="line">npm uninstall live2d-widget-model-wanko <span class="comment"># æ›¿æ¢æˆä½ çš„æ¨¡å‹å</span></span><br></pre></td></tr></table></figure>
<p>å…‹éš†<a href="https://github.com/stevenjoezhang/live2d-widget">live2d-widget</a>åˆ°æœ¬åœ°<code>themes/next/live2d-widget</code>ï¼ˆæˆ‘è¿™é‡Œæ˜¯<code>next</code>ä¸»é¢˜ï¼‰ä¸­ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> themes/next</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/stevenjoezhang/live2d-widget.git</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>next</code>ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼š</p>
<p>æ‰“å¼€<code>themes/next/layout/_layout.swig</code>ï¼Œåœ¨<code>&lt;footer&gt;</code>æ ‡ç­¾ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Live2D --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/live2d-widget/autoload.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¹¶åœ¨æ–‡ä»¶çš„<code>&lt;head&gt;</code>æ ‡ç­¾ä¸­æ·»åŠ </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åé‡æ–°ç”Ÿæˆå¹¶è¿è¡Œã€‚</p>
<hr>
<h3 id="é«˜çº§"><a href="#é«˜çº§" class="headerlink" title="é«˜çº§"></a>é«˜çº§</h3><h3 id="è¯´æ˜-2"><a href="#è¯´æ˜-2" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>ç›¸æ¯”ä¸­çº§ï¼Œå¢åŠ äº†æ¢è£…åŠŸèƒ½ã€‚</p>
<h3 id="æ“ä½œ-2"><a href="#æ“ä½œ-2" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h3><p><strong>å…ˆæŒ‰ç…§ä¸­çº§å®Œæˆæ“ä½œ</strong></p>
<p>æ‰“å¼€<code>themes/next/layout/_layout.swig</code>ï¼Œåœ¨<code>&lt;footer&gt;</code>æ ‡ç­¾ä¸­çš„<code>&lt;script src=&quot;/live2d-widget/autoload.js&gt;</code>ä¹‹å‰çš„éƒ¨åˆ†æ·»åŠ <code>jquery</code>å’Œ<code>jquery-ui</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.12.1/jquery-ui.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>themes/next/live2d-widget/autoload.js</code>ï¼Œåˆ æ‰åŸæœ‰å†…å®¹æ›¿æ¢å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ è½½ CSS</span></span><br><span class="line">$(<span class="string">&quot;&lt;link&gt;&quot;</span>).attr(&#123;<span class="attr">href</span>: <span class="string">&quot;/live2d-widget/waifu.css&quot;</span>, <span class="attr">rel</span>: <span class="string">&quot;stylesheet&quot;</span>, <span class="attr">type</span>: <span class="string">&quot;text/css&quot;</span>&#125;).appendTo(<span class="string">&#x27;head&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥ DIV</span></span><br><span class="line">$(<span class="string">&#x27;body&#x27;</span>).append(<span class="string">&#x27;&lt;div class=&quot;waifu&quot;&gt;&lt;div class=&quot;waifu-tips&quot;&gt;&lt;/div&gt;&lt;canvas id=&quot;live2d&quot; class=&quot;live2d&quot;&gt;&lt;/canvas&gt;&lt;div class=&quot;waifu-tool&quot;&gt;&lt;span class=&quot;fui-home&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-chat&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-eye&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-user&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-photo&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-info-circle&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-cross&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ è½½ JS</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">	<span class="attr">url</span>: <span class="string">&#x27;/live2d-widget/waifu-tips.js&#x27;</span>,</span><br><span class="line">	<span class="attr">dataType</span>:<span class="string">&quot;script&quot;</span>,</span><br><span class="line">	<span class="attr">cache</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">async</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">	<span class="attr">url</span>: <span class="string">&#x27;/live2d-widget/live2d.min.js&#x27;</span>,</span><br><span class="line">	<span class="attr">dataType</span>:<span class="string">&quot;script&quot;</span>,</span><br><span class="line">	<span class="attr">cache</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">async</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–çœ‹æ¿å¨˜ï¼ŒåŠ è½½ waifu-tips.json</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¯ç›´æ¥ä¿®æ”¹éƒ¨åˆ†å‚æ•° */</span></span><br><span class="line">live2d_settings[<span class="string">&#x27;modelId&#x27;</span>] = <span class="number">1</span>;                  <span class="comment">// é»˜è®¤æ¨¡å‹ ID</span></span><br><span class="line">live2d_settings[<span class="string">&#x27;modelTexturesId&#x27;</span>] = <span class="number">88</span>;          <span class="comment">// é»˜è®¤æè´¨ ID</span></span><br><span class="line"><span class="comment">/* åœ¨ initModel å‰æ·»åŠ  */</span></span><br><span class="line">initModel(<span class="string">&#x27;/live2d-widget/waifu-tips.json&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>themes/next/live2d-widget/waifu-tips.js</code>ï¼Œåˆ æ‰åŸæœ‰å†…å®¹æ›¿æ¢å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.live2d_settings = <span class="built_in">Array</span>(); <span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        ã__,.ãƒ˜ãƒ½.ã€€ã€€ã€€ã€€/ã€€,ãƒ¼ï½¤ ã€‰</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ï¼¼ &#x27;, !-â”€â€-iã€€/ã€€/Â´</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ ã€€ ï¼ï½€ï½°&#x27;ã€€ã€€ã€€ L/ï¼ï½€ãƒ½ï½¤            Live2D çœ‹æ¿å¨˜ å‚æ•°è®¾ç½®</span></span><br><span class="line"><span class="comment">        ã€€ã€€ ã€€ /ã€€ ï¼,ã€€ /|ã€€ ,ã€€ ,ã€€ã€€ã€€ &#x27;,          Version 1.4.2</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ï½² ã€€/ /-â€/ã€€ï½‰ã€€L_ ï¾Š ãƒ½!ã€€ i             Update 2018.11.12</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ ï¾š ï¾ 7ï½²ï½€ï¾„ã€€ ï¾š&#x27;ï½§-ï¾„ï½¤!ãƒ|ã€€ |  </span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ !,/7 &#x27;0&#x27;ã€€ã€€ Â´0iã‚½| ã€€ |ã€€ã€€ã€€</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ |.ä»&quot;ã€€ã€€_ã€€ã€€ ,,,, / |./ ã€€ |    ç½‘é¡µæ·»åŠ  Live2D çœ‹æ¿å¨˜</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ ï¾š&#x27;| iï¼.ï½¤,,__ã€€_,.ã‚¤ / ã€€.i ã€€|       https://yaoxi-std.github.io/2022/01/15/extra-blog-live2d/</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ ï¾š&#x27;| | / k_ï¼—_/ï¾š&#x27;ãƒ½,ã€€ï¾Š.ã€€|           </span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ã€€ | |/i ã€ˆ|/ã€€ iã€€,.ï¾ |ã€€iã€€|    Thanks</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ã€€.|/ /ã€€ï½‰ï¼š ã€€ ï¾!ã€€ã€€ï¼¼ã€€|          journey-ad / https://github.com/journey-ad/live2d_src</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ ã€€ ã€€ kãƒ½&gt;ï½¤ï¾Š ã€€ _,.ï¾ï½¤ ã€€ /ï½¤!            xiazeyu / https://github.com/xiazeyu/live2d-widget.js</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ã€€ !&#x27;ã€ˆ//ï½€ï¼´Â´&#x27;, ï¼¼ ï½€&#x27;7&#x27;ï½°r&#x27;         Live2d Cubism SDK WebGL 2.1 Projrct &amp; All model authors.</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ã€€ ï¾š&#x27;ãƒ½L__|___i,___,ãƒ³ï¾š|ãƒ           fghrsh / https://github.com/fghrsh/live2d_api</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ ã€€ã€€ã€€ï¾„-,/ã€€|___./</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ ã€€ã€€ã€€&#x27;ï½°&#x27;ã€€ã€€!_,.:*********************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åç«¯æ¥å£</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelAPI&quot;</span>] = <span class="string">&quot;//live2d.fghrsh.net/api/&quot;</span>; <span class="comment">// è‡ªå»º API ä¿®æ”¹è¿™é‡Œ</span></span><br><span class="line">live2d_settings[<span class="string">&quot;tipsMessage&quot;</span>] = <span class="string">&quot;waifu-tips.json&quot;</span>; <span class="comment">// åŒç›®å½•ä¸‹å¯çœç•¥è·¯å¾„</span></span><br><span class="line">live2d_settings[<span class="string">&quot;hitokotoAPI&quot;</span>] = <span class="string">&quot;hitokoto.cn&quot;</span>; <span class="comment">// ä¸€è¨€ APIï¼Œå¯é€‰ &#x27;lwl12.com&#x27;, &#x27;hitokoto.cn&#x27;, &#x27;jinrishici.com&#x27;(å¤è¯—è¯)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤æ¨¡å‹</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelId&quot;</span>] = <span class="number">1</span>; <span class="comment">// é»˜è®¤æ¨¡å‹ IDï¼Œå¯åœ¨ F12 æ§åˆ¶å°æ‰¾åˆ°</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelTexturesId&quot;</span>] = <span class="number">88</span>; <span class="comment">// é»˜è®¤æè´¨ IDï¼Œå¯åœ¨ F12 æ§åˆ¶å°æ‰¾åˆ°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å…·æ è®¾ç½®</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showToolMenu&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º å·¥å…·æ           ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canCloseLive2d&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º å…³é—­çœ‹æ¿å¨˜  æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canSwitchModel&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º æ¨¡å‹åˆ‡æ¢    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canSwitchTextures&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º æè´¨åˆ‡æ¢    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canSwitchHitokoto&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º ä¸€è¨€åˆ‡æ¢    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canTakeScreenshot&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º çœ‹æ¿å¨˜æˆªå›¾  æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canTurnToHomePage&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º è¿”å›é¦–é¡µ    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canTurnToAboutPage&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º è·³è½¬å…³äºé¡µ  æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å‹åˆ‡æ¢æ¨¡å¼</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelStorage&quot;</span>] = <span class="literal">true</span>; <span class="comment">// è®°å½• ID (åˆ·æ–°åæ¢å¤)ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelRandMode&quot;</span>] = <span class="string">&quot;switch&quot;</span>; <span class="comment">// æ¨¡å‹åˆ‡æ¢ï¼Œå¯é€‰ &#x27;rand&#x27;(éšæœº), &#x27;switch&#x27;(é¡ºåº)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelTexturesRandMode&quot;</span>] = <span class="string">&quot;rand&quot;</span>; <span class="comment">// æè´¨åˆ‡æ¢ï¼Œå¯é€‰ &#x27;rand&#x27;(éšæœº), &#x27;switch&#x27;(é¡ºåº)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æç¤ºæ¶ˆæ¯é€‰é¡¹</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showHitokoto&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤ºä¸€è¨€</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showF12Status&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤ºåŠ è½½çŠ¶æ€</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showF12Message&quot;</span>] = <span class="literal">false</span>; <span class="comment">// æ˜¾ç¤ºçœ‹æ¿å¨˜æ¶ˆæ¯</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showF12OpenMsg&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤ºæ§åˆ¶å°æ‰“å¼€æç¤º</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showCopyMessage&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º å¤åˆ¶å†…å®¹ æç¤º</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showWelcomeMessage&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤ºè¿›å…¥é¢é¡µæ¬¢è¿è¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//çœ‹æ¿å¨˜æ ·å¼è®¾ç½®</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuSize&quot;</span>] = <span class="string">&quot;800x800&quot;</span>; <span class="comment">// çœ‹æ¿å¨˜å¤§å°ï¼Œä¾‹å¦‚ &#x27;280x250&#x27;, &#x27;600x535&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuTipsSize&quot;</span>] = <span class="string">&quot;250x70&quot;</span>; <span class="comment">// æç¤ºæ¡†å¤§å°ï¼Œä¾‹å¦‚ &#x27;250x70&#x27;, &#x27;570x150&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuFontSize&quot;</span>] = <span class="string">&quot;14px&quot;</span>; <span class="comment">// æç¤ºæ¡†å­—ä½“ï¼Œä¾‹å¦‚ &#x27;12px&#x27;, &#x27;30px&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuToolFont&quot;</span>] = <span class="string">&quot;14px&quot;</span>; <span class="comment">// å·¥å…·æ å­—ä½“ï¼Œä¾‹å¦‚ &#x27;14px&#x27;, &#x27;36px&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuToolLine&quot;</span>] = <span class="string">&quot;20px&quot;</span>; <span class="comment">// å·¥å…·æ è¡Œé«˜ï¼Œä¾‹å¦‚ &#x27;20px&#x27;, &#x27;36px&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuToolTop&quot;</span>] = <span class="string">&quot;0px&quot;</span>; <span class="comment">// å·¥å…·æ é¡¶éƒ¨è¾¹è·ï¼Œä¾‹å¦‚ &#x27;0px&#x27;, &#x27;-60px&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuMinWidth&quot;</span>] = <span class="string">&quot;768px&quot;</span>; <span class="comment">// é¢é¡µå°äº æŒ‡å®šå®½åº¦ éšè—çœ‹æ¿å¨˜ï¼Œä¾‹å¦‚ &#x27;disable&#x27;(ç¦ç”¨), &#x27;768px&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuEdgeSide&quot;</span>] = <span class="string">&quot;left:0&quot;</span>; <span class="comment">// çœ‹æ¿å¨˜è´´è¾¹æ–¹å‘ï¼Œä¾‹å¦‚ &#x27;left:0&#x27;(é å·¦ 0px), &#x27;right:30&#x27;(é å³ 30px)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuDraggable&quot;</span>] = <span class="string">&quot;disable&quot;</span>; <span class="comment">// æ‹–æ‹½æ ·å¼ï¼Œä¾‹å¦‚ &#x27;disable&#x27;(ç¦ç”¨), &#x27;axis-x&#x27;(åªèƒ½æ°´å¹³æ‹–æ‹½), &#x27;unlimited&#x27;(è‡ªç”±æ‹–æ‹½)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuDraggableRevert&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ¾å¼€é¼ æ ‡è¿˜åŸæ‹–æ‹½ä½ç½®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä»–æ‚é¡¹è®¾ç½®</span></span><br><span class="line">live2d_settings[<span class="string">&quot;l2dVersion&quot;</span>] = <span class="string">&quot;1.4.2&quot;</span>; <span class="comment">// å½“å‰ç‰ˆæœ¬</span></span><br><span class="line">live2d_settings[<span class="string">&quot;l2dVerDate&quot;</span>] = <span class="string">&quot;2018.11.12&quot;</span>; <span class="comment">// ç‰ˆæœ¬æ›´æ–°æ—¥æœŸ</span></span><br><span class="line">live2d_settings[<span class="string">&quot;homePageUrl&quot;</span>] = <span class="string">&quot;auto&quot;</span>; <span class="comment">// ä¸»é¡µåœ°å€ï¼Œå¯é€‰ &#x27;auto&#x27;(è‡ªåŠ¨), &#x27;&#123;URL ç½‘å€&#125;&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;aboutPageUrl&quot;</span>] =</span><br><span class="line">    <span class="string">&quot;https://yaoxi-std.github.io/2022/01/15/extra-blog-live2d/&quot;</span>; <span class="comment">// å…³äºé¡µåœ°å€, &#x27;&#123;URL ç½‘å€&#125;&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;screenshotCaptureName&quot;</span>] = <span class="string">&quot;live2d.png&quot;</span>; <span class="comment">// çœ‹æ¿å¨˜æˆªå›¾æ–‡ä»¶åï¼Œä¾‹å¦‚ &#x27;live2d.png&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span>.prototype.render = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tokenReg = <span class="regexp">/(\\)?\&#123;([^\&#123;\&#125;\\]+)(\\)?\&#125;/g</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.replace(tokenReg, <span class="function"><span class="keyword">function</span> (<span class="params">word, slash1, token, slash2</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (slash1 || slash2) &#123;</span><br><span class="line">            <span class="keyword">return</span> word.replace(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> variables = token.replace(<span class="regexp">/\s/g</span>, <span class="string">&quot;&quot;</span>).split(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> currentObject = context;</span><br><span class="line">        <span class="keyword">var</span> i, length, variable;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>, length = variables.length; i &lt; length; ++i) &#123;</span><br><span class="line">            variable = variables[i];</span><br><span class="line">            currentObject = currentObject[variable];</span><br><span class="line">            <span class="keyword">if</span> (currentObject === <span class="literal">undefined</span> || currentObject === <span class="literal">null</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> currentObject;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> re = <span class="regexp">/x/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(re);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">empty</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> obj == <span class="string">&quot;undefined&quot;</span> || obj == <span class="literal">null</span> || obj == <span class="string">&quot;&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandText</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>.isArray(text)</span><br><span class="line">        ? text[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * text.length + <span class="number">1</span>) - <span class="number">1</span>]</span><br><span class="line">        : text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMessage</span>(<span class="params">text, timeout, flag</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        flag ||</span><br><span class="line">        sessionStorage.getItem(<span class="string">&quot;waifu-text&quot;</span>) === <span class="string">&quot;&quot;</span> ||</span><br><span class="line">        sessionStorage.getItem(<span class="string">&quot;waifu-text&quot;</span>) === <span class="literal">null</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(text))</span><br><span class="line">            text = text[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * text.length + <span class="number">1</span>) - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (live2d_settings.showF12Message)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;[Message]&quot;</span>, text.replace(<span class="regexp">/&lt;[^&lt;&gt;]+&gt;/g</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (flag) sessionStorage.setItem(<span class="string">&quot;waifu-text&quot;</span>, text);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&quot;.waifu-tips&quot;</span>).stop();</span><br><span class="line">        $(<span class="string">&quot;.waifu-tips&quot;</span>).html(text).fadeTo(<span class="number">200</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (timeout === <span class="literal">undefined</span>) timeout = <span class="number">5000</span>;</span><br><span class="line">        hideMessage(timeout);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hideMessage</span>(<span class="params">timeout</span>) </span>&#123;</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).stop().css(<span class="string">&quot;opacity&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (timeout === <span class="literal">undefined</span>) timeout = <span class="number">5000</span>;</span><br><span class="line">    <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        sessionStorage.removeItem(<span class="string">&quot;waifu-text&quot;</span>);</span><br><span class="line">    &#125;, timeout);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).delay(timeout).fadeTo(<span class="number">200</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initModel</span>(<span class="params">waifuPath, type</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* console welcome message */</span></span><br><span class="line">    <span class="built_in">eval</span>(</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params">p, a, c, k, e, r</span>) </span>&#123;</span><br><span class="line">            e = <span class="function"><span class="keyword">function</span> (<span class="params">c</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> (</span><br><span class="line">                    (c &lt; a ? <span class="string">&quot;&quot;</span> : e(<span class="built_in">parseInt</span>(c / a))) +</span><br><span class="line">                    ((c = c % a) &gt; <span class="number">35</span> ? <span class="built_in">String</span>.fromCharCode(c + <span class="number">29</span>) : c.toString(<span class="number">36</span>))</span><br><span class="line">                );</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.replace(<span class="regexp">/^/</span>, <span class="built_in">String</span>)) &#123;</span><br><span class="line">                <span class="keyword">while</span> (c--) r[e(c)] = k[c] || e(c);</span><br><span class="line">                k = [</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> r[e];</span><br><span class="line">                    &#125;,</span><br><span class="line">                ];</span><br><span class="line">                e = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;\\w+&quot;</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                c = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (c--)</span><br><span class="line">                <span class="keyword">if</span> (k[c]) p = p.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&quot;\\b&quot;</span> + e(c) + <span class="string">&quot;\\b&quot;</span>, <span class="string">&quot;g&quot;</span>), k[c]);</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        &#125;)(</span><br><span class="line">            <span class="string">&quot;8.d(\&quot; \&quot;);8.d(\&quot;\\U,.\\y\\5.\\1\\1\\1\\1/\\1,\\u\\2 \\H\\n\\1\\1\\1\\1\\1\\b &#x27;, !-\\r\\j-i\\1/\\1/\\g\\n\\1\\1\\1 \\1 \\a\\4\\f&#x27;\\1\\1\\1 L/\\a\\4\\5\\2\\n\\1\\1 \\1 /\\1 \\a,\\1 /|\\1 ,\\1 ,\\1\\1\\1 &#x27;,\\n\\1\\1\\1\\q \\1/ /-\\j/\\1\\h\\E \\9 \\5!\\1 i\\n\\1\\1\\1 \\3 \\6 7\\q\\4\\c\\1 \\3&#x27;\\s-\\c\\2!\\t|\\1 |\\n\\1\\1\\1\\1 !,/7 &#x27;0&#x27;\\1\\1 \\X\\w| \\1 |\\1\\1\\1\\n\\1\\1\\1\\1 |.\\x\\\&quot;\\1\\l\\1\\1 ,,,, / |./ \\1 |\\n\\1\\1\\1\\1 \\3&#x27;| i\\z.\\2,,A\\l,.\\B / \\1.i \\1|\\n\\1\\1\\1\\1\\1 \\3&#x27;| | / C\\D/\\3&#x27;\\5,\\1\\9.\\1|\\n\\1\\1\\1\\1\\1\\1 | |/i \\m|/\\1 i\\1,.\\6 |\\F\\1|\\n\\1\\1\\1\\1\\1\\1.|/ /\\1\\h\\G \\1 \\6!\\1\\1\\b\\1|\\n\\1\\1\\1 \\1 \\1 k\\5&gt;\\2\\9 \\1 o,.\\6\\2 \\1 /\\2!\\n\\1\\1\\1\\1\\1\\1 !&#x27;\\m//\\4\\I\\g&#x27;, \\b \\4&#x27;7&#x27;\\J&#x27;\\n\\1\\1\\1\\1\\1\\1 \\3&#x27;\\K|M,p,\\O\\3|\\P\\n\\1\\1\\1\\1\\1 \\1\\1\\1\\c-,/\\1|p./\\n\\1\\1\\1\\1\\1 \\1\\1\\1&#x27;\\f&#x27;\\1\\1!o,.:\\Q \\R\\S\\T v\&quot;+e.V+\&quot; / W \&quot;+e.N);8.d(\&quot; \&quot;);&quot;</span>,</span><br><span class="line">            <span class="number">60</span>,</span><br><span class="line">            <span class="number">60</span>,</span><br><span class="line">            <span class="string">&quot;|u3000|uff64|uff9a|uff40|u30fd|uff8d||console|uff8a|uff0f|uff3c|uff84|log|live2d_settings|uff70|u00b4|uff49||u2010||u3000_|u3008||_|___|uff72|u2500|uff67|u30cf|u30fc||u30bd|u4ece|u30d8|uff1e|__|u30a4|k_|uff17_|u3000L_|u3000i|uff1a|u3009|uff34|uff70r|u30fdL__||___i|l2dVerDate|u30f3|u30ce|nLive2D|u770b|u677f|u5a18|u304f__|l2dVersion|FGHRSH|u00b40i&quot;</span>.split(</span><br><span class="line">                <span class="string">&quot;|&quot;</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            &#123;&#125;</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* åˆ¤æ–­ JQuery */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> $.ajax != <span class="string">&quot;function&quot;</span>)</span><br><span class="line">        <span class="keyword">typeof</span> jQuery.ajax == <span class="string">&quot;function&quot;</span></span><br><span class="line">            ? (<span class="built_in">window</span>.$ = jQuery)</span><br><span class="line">            : <span class="built_in">console</span>.log(<span class="string">&quot;[Error] JQuery is not defined.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* åŠ è½½çœ‹æ¿å¨˜æ ·å¼ */</span></span><br><span class="line">    live2d_settings.waifuSize = live2d_settings.waifuSize.split(<span class="string">&quot;x&quot;</span>);</span><br><span class="line">    live2d_settings.waifuTipsSize = live2d_settings.waifuTipsSize.split(<span class="string">&quot;x&quot;</span>);</span><br><span class="line">    live2d_settings.waifuEdgeSide = live2d_settings.waifuEdgeSide.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#live2d&quot;</span>).attr(<span class="string">&quot;width&quot;</span>, live2d_settings.waifuSize[<span class="number">0</span>]);</span><br><span class="line">    $(<span class="string">&quot;#live2d&quot;</span>).attr(<span class="string">&quot;height&quot;</span>, live2d_settings.waifuSize[<span class="number">1</span>]);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).width(live2d_settings.waifuTipsSize[<span class="number">0</span>]);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).height(live2d_settings.waifuTipsSize[<span class="number">1</span>]);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).css(<span class="string">&quot;top&quot;</span>, live2d_settings.waifuToolTop);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).css(<span class="string">&quot;font-size&quot;</span>, live2d_settings.waifuFontSize);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tool&quot;</span>).css(<span class="string">&quot;font-size&quot;</span>, live2d_settings.waifuToolFont);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tool span&quot;</span>).css(<span class="string">&quot;line-height&quot;</span>, live2d_settings.waifuToolLine);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.waifuEdgeSide[<span class="number">0</span>] == <span class="string">&quot;left&quot;</span>)</span><br><span class="line">        $(<span class="string">&quot;.waifu&quot;</span>).css(<span class="string">&quot;left&quot;</span>, live2d_settings.waifuEdgeSide[<span class="number">1</span>] + <span class="string">&quot;px&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (live2d_settings.waifuEdgeSide[<span class="number">0</span>] == <span class="string">&quot;right&quot;</span>)</span><br><span class="line">        $(<span class="string">&quot;.waifu&quot;</span>).css(<span class="string">&quot;right&quot;</span>, live2d_settings.waifuEdgeSide[<span class="number">1</span>] + <span class="string">&quot;px&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.waifuResize = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="built_in">window</span>).width() &lt;= <span class="built_in">Number</span>(live2d_settings.waifuMinWidth.replace(<span class="string">&quot;px&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">            ? $(<span class="string">&quot;.waifu&quot;</span>).hide()</span><br><span class="line">            : $(<span class="string">&quot;.waifu&quot;</span>).show();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.waifuMinWidth != <span class="string">&quot;disable&quot;</span>) &#123;</span><br><span class="line">        waifuResize();</span><br><span class="line">        $(<span class="built_in">window</span>).resize(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            waifuResize();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (live2d_settings.waifuDraggable == <span class="string">&quot;axis-x&quot;</span>)</span><br><span class="line">            $(<span class="string">&quot;.waifu&quot;</span>).draggable(&#123;</span><br><span class="line">                <span class="attr">axis</span>: <span class="string">&quot;x&quot;</span>,</span><br><span class="line">                <span class="attr">revert</span>: live2d_settings.waifuDraggableRevert,</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (live2d_settings.waifuDraggable == <span class="string">&quot;unlimited&quot;</span>)</span><br><span class="line">            $(<span class="string">&quot;.waifu&quot;</span>).draggable(&#123; <span class="attr">revert</span>: live2d_settings.waifuDraggableRevert &#125;);</span><br><span class="line">        <span class="keyword">else</span> $(<span class="string">&quot;.waifu&quot;</span>).css(<span class="string">&quot;transition&quot;</span>, <span class="string">&quot;all .3s ease-in-out&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[Error] JQuery UI is not defined.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    live2d_settings.homePageUrl =</span><br><span class="line">        live2d_settings.homePageUrl == <span class="string">&quot;auto&quot;</span></span><br><span class="line">            ? <span class="built_in">window</span>.location.protocol + <span class="string">&quot;//&quot;</span> + <span class="built_in">window</span>.location.hostname + (<span class="built_in">window</span>.location.port ? <span class="string">&#x27;:&#x27;</span> + <span class="built_in">window</span>.location.port : <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;/&quot;</span></span><br><span class="line">            : live2d_settings.homePageUrl;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        <span class="built_in">window</span>.location.protocol == <span class="string">&quot;file:&quot;</span> &amp;&amp;</span><br><span class="line">        live2d_settings.modelAPI.substr(<span class="number">0</span>, <span class="number">2</span>) == <span class="string">&quot;//&quot;</span></span><br><span class="line">    )</span><br><span class="line">        live2d_settings.modelAPI = <span class="string">&quot;http:&quot;</span> + live2d_settings.modelAPI;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-home&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//window.location = &#x27;https://www.fghrsh.net/&#x27;;</span></span><br><span class="line">        <span class="built_in">window</span>.location = live2d_settings.homePageUrl;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-info-circle&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//window.open(&#x27;https://imjad.cn/archives/lab/add-dynamic-poster-girl-with-live2d-to-your-blog-02&#x27;);</span></span><br><span class="line">        <span class="built_in">window</span>.open(live2d_settings.aboutPageUrl);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> waifuPath == <span class="string">&quot;object&quot;</span>) loadTipsMessage(waifuPath);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            <span class="attr">cache</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">url</span>:</span><br><span class="line">                waifuPath == <span class="string">&quot;&quot;</span></span><br><span class="line">                    ? live2d_settings.tipsMessage</span><br><span class="line">                    : waifuPath.substr(waifuPath.length - <span class="number">15</span>) == <span class="string">&quot;waifu-tips.json&quot;</span></span><br><span class="line">                    ? waifuPath</span><br><span class="line">                    : waifuPath + <span class="string">&quot;waifu-tips.json&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                loadTipsMessage(result);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.showToolMenu) $(<span class="string">&quot;.waifu-tool&quot;</span>).hide();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.canCloseLive2d) $(<span class="string">&quot;.waifu-tool .fui-cross&quot;</span>).hide();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.canSwitchModel) $(<span class="string">&quot;.waifu-tool .fui-eye&quot;</span>).hide();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.canSwitchTextures) $(<span class="string">&quot;.waifu-tool .fui-user&quot;</span>).hide();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.canSwitchHitokoto) $(<span class="string">&quot;.waifu-tool .fui-chat&quot;</span>).hide();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.canTakeScreenshot) $(<span class="string">&quot;.waifu-tool .fui-photo&quot;</span>).hide();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.canTurnToHomePage) $(<span class="string">&quot;.waifu-tool .fui-home&quot;</span>).hide();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.canTurnToAboutPage)</span><br><span class="line">        $(<span class="string">&quot;.waifu-tool .fui-info-circle&quot;</span>).hide();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (waifuPath === <span class="literal">undefined</span>) waifuPath = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> modelId = sessionStorage.getItem(<span class="string">&quot;modelId&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> modelTexturesId = sessionStorage.getItem(<span class="string">&quot;modelTexturesId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.modelStorage || modelId == <span class="literal">null</span>) &#123;</span><br><span class="line">        modelId = live2d_settings.modelId;</span><br><span class="line">        modelTexturesId = live2d_settings.modelTexturesId;</span><br><span class="line">    &#125;</span><br><span class="line">    loadModel(modelId, modelTexturesId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadModel</span>(<span class="params">modelId, modelTexturesId = <span class="number">0</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.modelStorage) &#123;</span><br><span class="line">        sessionStorage.setItem(<span class="string">&quot;modelId&quot;</span>, modelId);</span><br><span class="line">        sessionStorage.setItem(<span class="string">&quot;modelTexturesId&quot;</span>, modelTexturesId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        live2d_settings[<span class="string">&quot;modelId&quot;</span>] = modelId;</span><br><span class="line">        live2d_settings[<span class="string">&quot;modelTexturesId&quot;</span>] = modelTexturesId;</span><br><span class="line">    &#125;</span><br><span class="line">    loadlive2d(</span><br><span class="line">        <span class="string">&quot;live2d&quot;</span>,</span><br><span class="line">        live2d_settings.modelAPI + <span class="string">&quot;get/?id=&quot;</span> + modelId + <span class="string">&quot;-&quot;</span> + modelTexturesId,</span><br><span class="line">        live2d_settings.showF12Status</span><br><span class="line">            ? <span class="built_in">console</span>.log(</span><br><span class="line">                    <span class="string">&quot;[Status]&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;live2d&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;æ¨¡å‹&quot;</span>,</span><br><span class="line">                    modelId + <span class="string">&quot;-&quot;</span> + modelTexturesId,</span><br><span class="line">                    <span class="string">&quot;åŠ è½½å®Œæˆ&quot;</span></span><br><span class="line">                )</span><br><span class="line">            : <span class="literal">null</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadTipsMessage</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.waifu_tips = result;</span><br><span class="line"></span><br><span class="line">    $.each(result.mouseover, <span class="function"><span class="keyword">function</span> (<span class="params">index, tips</span>) </span>&#123;</span><br><span class="line">        $(<span class="built_in">document</span>).on(<span class="string">&quot;mouseover&quot;</span>, tips.selector, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> text = getRandText(tips.text);</span><br><span class="line">            text = text.render(&#123; <span class="attr">text</span>: $(<span class="built_in">this</span>).text() &#125;);</span><br><span class="line">            showMessage(text, <span class="number">3000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    $.each(result.click, <span class="function"><span class="keyword">function</span> (<span class="params">index, tips</span>) </span>&#123;</span><br><span class="line">        $(<span class="built_in">document</span>).on(<span class="string">&quot;click&quot;</span>, tips.selector, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> text = getRandText(tips.text);</span><br><span class="line">            text = text.render(&#123; <span class="attr">text</span>: $(<span class="built_in">this</span>).text() &#125;);</span><br><span class="line">            showMessage(text, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    $.each(result.seasons, <span class="function"><span class="keyword">function</span> (<span class="params">index, tips</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">var</span> after = tips.date.split(<span class="string">&quot;-&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">var</span> before = tips.date.split(<span class="string">&quot;-&quot;</span>)[<span class="number">1</span>] || after;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            after.split(<span class="string">&quot;/&quot;</span>)[<span class="number">0</span>] &lt;= now.getMonth() + <span class="number">1</span> &amp;&amp;</span><br><span class="line">            now.getMonth() + <span class="number">1</span> &lt;= before.split(<span class="string">&quot;/&quot;</span>)[<span class="number">0</span>] &amp;&amp;</span><br><span class="line">            after.split(<span class="string">&quot;/&quot;</span>)[<span class="number">1</span>] &lt;= now.getDate() &amp;&amp;</span><br><span class="line">            now.getDate() &lt;= before.split(<span class="string">&quot;/&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="keyword">var</span> text = getRandText(tips.text);</span><br><span class="line">            text = text.render(&#123; <span class="attr">year</span>: now.getFullYear() &#125;);</span><br><span class="line">            showMessage(text, <span class="number">6000</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.showF12OpenMsg) &#123;</span><br><span class="line">        re.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            showMessage(getRandText(result.waifu.console_open_msg), <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.showCopyMessage) &#123;</span><br><span class="line">        $(<span class="built_in">document</span>).on(<span class="string">&quot;copy&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            showMessage(getRandText(result.waifu.copy_message), <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-photo&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        showMessage(getRandText(result.waifu.screenshot_message), <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">window</span>.Live2D.captureName = live2d_settings.screenshotCaptureName;</span><br><span class="line">        <span class="built_in">window</span>.Live2D.captureFrame = <span class="literal">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-cross&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        sessionStorage.setItem(<span class="string">&quot;waifu-dsiplay&quot;</span>, <span class="string">&quot;none&quot;</span>);</span><br><span class="line">        showMessage(getRandText(result.waifu.hidden_message), <span class="number">1300</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            $(<span class="string">&quot;.waifu&quot;</span>).hide();</span><br><span class="line">        &#125;, <span class="number">1300</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.showWelcomeMessage = <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> text;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>.location.href == live2d_settings.homePageUrl) &#123;</span><br><span class="line">            <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getHours();</span><br><span class="line">            <span class="keyword">if</span> (now &gt; <span class="number">23</span> || now &lt;= <span class="number">5</span>)</span><br><span class="line">                text = getRandText(result.waifu.hour_tips.t23 - <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">5</span> &amp;&amp; now &lt;= <span class="number">7</span>)</span><br><span class="line">                text = getRandText(result.waifu.hour_tips.t5 - <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">7</span> &amp;&amp; now &lt;= <span class="number">11</span>)</span><br><span class="line">                text = getRandText(result.waifu.hour_tips.t7 - <span class="number">11</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">11</span> &amp;&amp; now &lt;= <span class="number">14</span>)</span><br><span class="line">                text = getRandText(result.waifu.hour_tips.t11 - <span class="number">14</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">14</span> &amp;&amp; now &lt;= <span class="number">17</span>)</span><br><span class="line">                text = getRandText(result.waifu.hour_tips.t14 - <span class="number">17</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">17</span> &amp;&amp; now &lt;= <span class="number">19</span>)</span><br><span class="line">                text = getRandText(result.waifu.hour_tips.t17 - <span class="number">19</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">19</span> &amp;&amp; now &lt;= <span class="number">21</span>)</span><br><span class="line">                text = getRandText(result.waifu.hour_tips.t19 - <span class="number">21</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">21</span> &amp;&amp; now &lt;= <span class="number">23</span>)</span><br><span class="line">                text = getRandText(result.waifu.hour_tips.t21 - <span class="number">23</span>);</span><br><span class="line">            <span class="keyword">else</span> text = getRandText(result.waifu.hour_tips.default);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> referrer_message = result.waifu.referrer_message;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">document</span>.referrer !== <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> referrer = <span class="built_in">document</span>.createElement(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                referrer.href = <span class="built_in">document</span>.referrer;</span><br><span class="line">                <span class="keyword">var</span> domain = referrer.hostname.split(<span class="string">&quot;.&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">window</span>.location.hostname == referrer.hostname)</span><br><span class="line">                    text =</span><br><span class="line">                        referrer_message.localhost[<span class="number">0</span>] +</span><br><span class="line">                        <span class="built_in">document</span>.title.split(referrer_message.localhost[<span class="number">2</span>])[<span class="number">0</span>] +</span><br><span class="line">                        referrer_message.localhost[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (domain == <span class="string">&quot;baidu&quot;</span>)</span><br><span class="line">                    text =</span><br><span class="line">                        referrer_message.baidu[<span class="number">0</span>] +</span><br><span class="line">                        referrer.search.split(<span class="string">&quot;&amp;wd=&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;&amp;&quot;</span>)[<span class="number">0</span>] +</span><br><span class="line">                        referrer_message.baidu[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (domain == <span class="string">&quot;so&quot;</span>)</span><br><span class="line">                    text =</span><br><span class="line">                        referrer_message.so[<span class="number">0</span>] +</span><br><span class="line">                        referrer.search.split(<span class="string">&quot;&amp;q=&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;&amp;&quot;</span>)[<span class="number">0</span>] +</span><br><span class="line">                        referrer_message.so[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (domain == <span class="string">&quot;google&quot;</span>)</span><br><span class="line">                    text =</span><br><span class="line">                        referrer_message.google[<span class="number">0</span>] +</span><br><span class="line">                        <span class="built_in">document</span>.title.split(referrer_message.google[<span class="number">2</span>])[<span class="number">0</span>] +</span><br><span class="line">                        referrer_message.google[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    $.each(result.waifu.referrer_hostname, <span class="function"><span class="keyword">function</span> (<span class="params">i, val</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (i == referrer.hostname) referrer.hostname = getRandText(val);</span><br><span class="line">                    &#125;);</span><br><span class="line">                    text =</span><br><span class="line">                        referrer_message.default[<span class="number">0</span>] +</span><br><span class="line">                        referrer.hostname +</span><br><span class="line">                        referrer_message.default[<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">                text =</span><br><span class="line">                    referrer_message.none[<span class="number">0</span>] +</span><br><span class="line">                    <span class="built_in">document</span>.title.split(referrer_message.none[<span class="number">2</span>])[<span class="number">0</span>] +</span><br><span class="line">                    referrer_message.none[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        showMessage(text, <span class="number">6000</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.showWelcomeMessage) showWelcomeMessage(result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> waifu_tips = result.waifu;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">loadOtherModel</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> modelId = modelStorageGetItem(<span class="string">&quot;modelId&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> modelRandMode = live2d_settings.modelRandMode;</span><br><span class="line"></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            <span class="attr">cache</span>: modelRandMode == <span class="string">&quot;switch&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">url</span>: live2d_settings.modelAPI + modelRandMode + <span class="string">&quot;/?id=&quot;</span> + modelId,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                loadModel(result.model[<span class="string">&quot;id&quot;</span>]);</span><br><span class="line">                <span class="keyword">var</span> message = result.model[<span class="string">&quot;message&quot;</span>];</span><br><span class="line">                $.each(waifu_tips.model_message, <span class="function"><span class="keyword">function</span> (<span class="params">i, val</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (i == result.model[<span class="string">&quot;id&quot;</span>]) message = getRandText(val);</span><br><span class="line">                &#125;);</span><br><span class="line">                showMessage(message, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">loadRandTextures</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> modelId = modelStorageGetItem(<span class="string">&quot;modelId&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> modelTexturesId = modelStorageGetItem(<span class="string">&quot;modelTexturesId&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> modelTexturesRandMode = live2d_settings.modelTexturesRandMode;</span><br><span class="line"></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            <span class="attr">cache</span>: modelTexturesRandMode == <span class="string">&quot;switch&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">url</span>:</span><br><span class="line">                live2d_settings.modelAPI +</span><br><span class="line">                modelTexturesRandMode +</span><br><span class="line">                <span class="string">&quot;_textures/?id=&quot;</span> +</span><br><span class="line">                modelId +</span><br><span class="line">                <span class="string">&quot;-&quot;</span> +</span><br><span class="line">                modelTexturesId,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (</span><br><span class="line">                    result.textures[<span class="string">&quot;id&quot;</span>] == <span class="number">1</span> &amp;&amp;</span><br><span class="line">                    (modelTexturesId == <span class="number">1</span> || modelTexturesId == <span class="number">0</span>)</span><br><span class="line">                )</span><br><span class="line">                    showMessage(waifu_tips.load_rand_textures[<span class="number">0</span>], <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">else</span> showMessage(waifu_tips.load_rand_textures[<span class="number">1</span>], <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">                loadModel(modelId, result.textures[<span class="string">&quot;id&quot;</span>]);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">modelStorageGetItem</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> live2d_settings.modelStorage</span><br><span class="line">            ? sessionStorage.getItem(key)</span><br><span class="line">            : live2d_settings[key];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ£€æµ‹ç”¨æˆ·æ´»åŠ¨çŠ¶æ€ï¼Œå¹¶åœ¨ç©ºé—²æ—¶æ˜¾ç¤ºä¸€è¨€ */</span></span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.showHitokoto) &#123;</span><br><span class="line">        <span class="built_in">window</span>.getActed = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">window</span>.hitokotoTimer = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">window</span>.hitokotoInterval = <span class="literal">false</span>;</span><br><span class="line">        $(<span class="built_in">document</span>)</span><br><span class="line">            .mousemove(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">                getActed = <span class="literal">true</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            .keydown(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                getActed = <span class="literal">true</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!getActed) ifActed();</span><br><span class="line">            <span class="keyword">else</span> elseActed();</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ifActed</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!hitokotoInterval) &#123;</span><br><span class="line">            hitokotoInterval = <span class="literal">true</span>;</span><br><span class="line">            hitokotoTimer = <span class="built_in">window</span>.setInterval(showHitokotoActed, <span class="number">30000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">elseActed</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        getActed = hitokotoInterval = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">window</span>.clearInterval(hitokotoTimer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showHitokotoActed</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($(<span class="built_in">document</span>)[<span class="number">0</span>].visibilityState == <span class="string">&quot;visible&quot;</span>) showHitokoto();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showHitokoto</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (live2d_settings.hitokotoAPI) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;lwl12.com&quot;</span>:</span><br><span class="line">                $.getJSON(</span><br><span class="line">                    <span class="string">&quot;https://api.lwl12.com/hitokoto/v1?encode=realjson&quot;</span>,</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (!empty(result.source)) &#123;</span><br><span class="line">                            <span class="keyword">var</span> text = waifu_tips.hitokoto_api_message[<span class="string">&quot;lwl12.com&quot;</span>][<span class="number">0</span>];</span><br><span class="line">                            <span class="keyword">if</span> (!empty(result.author))</span><br><span class="line">                                text += waifu_tips.hitokoto_api_message[<span class="string">&quot;lwl12.com&quot;</span>][<span class="number">1</span>];</span><br><span class="line">                            text = text.render(&#123;</span><br><span class="line">                                <span class="attr">source</span>: result.source,</span><br><span class="line">                                <span class="attr">creator</span>: result.author,</span><br><span class="line">                            &#125;);</span><br><span class="line">                            <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                                showMessage(</span><br><span class="line">                                    text + waifu_tips.hitokoto_api_message[<span class="string">&quot;lwl12.com&quot;</span>][<span class="number">2</span>],</span><br><span class="line">                                    <span class="number">3000</span>,</span><br><span class="line">                                    <span class="literal">true</span></span><br><span class="line">                                );</span><br><span class="line">                            &#125;, <span class="number">5000</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        showMessage(result.text, <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;fghrsh.net&quot;</span>:</span><br><span class="line">                $.getJSON(</span><br><span class="line">                    <span class="string">&quot;https://api.fghrsh.net/hitokoto/rand/?encode=jsc&amp;uid=3335&quot;</span>,</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (!empty(result.source)) &#123;</span><br><span class="line">                            <span class="keyword">var</span> text = waifu_tips.hitokoto_api_message[<span class="string">&quot;fghrsh.net&quot;</span>][<span class="number">0</span>];</span><br><span class="line">                            text = text.render(&#123; <span class="attr">source</span>: result.source, <span class="attr">date</span>: result.date &#125;);</span><br><span class="line">                            <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                                showMessage(text, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">                            &#125;, <span class="number">5000</span>);</span><br><span class="line">                            showMessage(result.hitokoto, <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;jinrishici.com&quot;</span>:</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">&quot;https://v2.jinrishici.com/one.json&quot;</span>,</span><br><span class="line">                    <span class="attr">xhrFields</span>: &#123; <span class="attr">withCredentials</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">                    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">result, status</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (!empty(result.data.origin.title)) &#123;</span><br><span class="line">                            <span class="keyword">var</span> text = waifu_tips.hitokoto_api_message[<span class="string">&quot;jinrishici.com&quot;</span>][<span class="number">0</span>];</span><br><span class="line">                            text = text.render(&#123;</span><br><span class="line">                                <span class="attr">title</span>: result.data.origin.title,</span><br><span class="line">                                <span class="attr">dynasty</span>: result.data.origin.dynasty,</span><br><span class="line">                                <span class="attr">author</span>: result.data.origin.author,</span><br><span class="line">                            &#125;);</span><br><span class="line">                            <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                                showMessage(text, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">                            &#125;, <span class="number">5000</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        showMessage(result.data.content, <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                $.getJSON(<span class="string">&quot;https://v1.hitokoto.cn&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (!empty(result.from)) &#123;</span><br><span class="line">                        <span class="keyword">var</span> text = waifu_tips.hitokoto_api_message[<span class="string">&quot;hitokoto.cn&quot;</span>][<span class="number">0</span>];</span><br><span class="line">                        text = text.render(&#123;</span><br><span class="line">                            <span class="attr">source</span>: result.from,</span><br><span class="line">                            <span class="attr">creator</span>: result.creator,</span><br><span class="line">                        &#125;);</span><br><span class="line">                        <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                            showMessage(text, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">                        &#125;, <span class="number">5000</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    showMessage(result.hitokoto, <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-eye&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        loadOtherModel();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-user&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        loadRandTextures();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-chat&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        showHitokoto();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>themes/next/live2d-widget/waifu-tips.json</code>ï¼Œåˆ æ‰åŸæœ‰å†…å®¹æ›¿æ¢å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;waifu&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;console_open_msg&quot;</span>: [<span class="string">&quot;å“ˆå“ˆï¼Œä½ æ‰“å¼€äº†æ§åˆ¶å°ï¼Œæ˜¯æƒ³è¦çœ‹çœ‹æˆ‘çš„ç§˜å¯†å—ï¼Ÿ&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;copy_message&quot;</span>: [<span class="string">&quot;ä½ éƒ½å¤åˆ¶äº†äº›ä»€ä¹ˆå‘€ï¼Œè½¬è½½è¦è®°å¾—åŠ ä¸Šå‡ºå¤„å“¦&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;screenshot_message&quot;</span>: [<span class="string">&quot;ç…§å¥½äº†å˜›ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¯çˆ±å‘¢ï¼Ÿ&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;hidden_message&quot;</span>: [<span class="string">&quot;æˆ‘ä»¬è¿˜èƒ½å†è§é¢çš„å§â€¦&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;load_rand_textures&quot;</span>: [<span class="string">&quot;æˆ‘è¿˜æ²¡æœ‰å…¶ä»–è¡£æœå‘¢&quot;</span>, <span class="string">&quot;æˆ‘çš„æ–°è¡£æœå¥½çœ‹å˜›&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;hour_tips&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;t5-7&quot;</span>: [<span class="string">&quot;æ—©ä¸Šå¥½ï¼ä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨ï¼Œç¾å¥½çš„ä¸€å¤©å°±è¦å¼€å§‹äº†&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;t7-11&quot;</span>: [<span class="string">&quot;ä¸Šåˆå¥½ï¼å·¥ä½œé¡ºåˆ©å˜›ï¼Œä¸è¦ä¹…åï¼Œå¤šèµ·æ¥èµ°åŠ¨èµ°åŠ¨å“¦ï¼&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;t11-14&quot;</span>: [<span class="string">&quot;ä¸­åˆäº†ï¼Œå·¥ä½œäº†ä¸€ä¸ªä¸Šåˆï¼Œç°åœ¨æ˜¯åˆé¤æ—¶é—´ï¼&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;t14-17&quot;</span>: [<span class="string">&quot;åˆåå¾ˆå®¹æ˜“çŠ¯å›°å‘¢ï¼Œä»Šå¤©çš„è¿åŠ¨ç›®æ ‡å®Œæˆäº†å—ï¼Ÿ&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;t17-19&quot;</span>: [<span class="string">&quot;å‚æ™šäº†ï¼çª—å¤–å¤•é˜³çš„æ™¯è‰²å¾ˆç¾ä¸½å‘¢ï¼Œæœ€ç¾ä¸è¿‡å¤•é˜³çº¢~&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;t19-21&quot;</span>: [<span class="string">&quot;æ™šä¸Šå¥½ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;t21-23&quot;</span>: [<span class="string">&quot;å·²ç»è¿™ä¹ˆæ™šäº†å‘€ï¼Œæ—©ç‚¹ä¼‘æ¯å§ï¼Œæ™šå®‰~&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;t23-5&quot;</span>: [<span class="string">&quot;ä½ æ˜¯å¤œçŒ«å­å‘€ï¼Ÿè¿™ä¹ˆæ™šè¿˜ä¸ç¡è§‰ï¼Œæ˜å¤©èµ·çš„æ¥å˜›&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;default&quot;</span>: [<span class="string">&quot;å—¨~ å¿«æ¥é€—æˆ‘ç©å§ï¼&quot;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;referrer_message&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;localhost&quot;</span>: [<span class="string">&quot;æ¬¢è¿é˜…è¯»&lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&quot;</span>, <span class="string">&quot;ã€&lt;/span&gt;&quot;</span>, <span class="string">&quot; - &quot;</span>],</span><br><span class="line">            <span class="attr">&quot;baidu&quot;</span>: [<span class="string">&quot;Hello! æ¥è‡ª ç™¾åº¦æœç´¢ çš„æœ‹å‹&lt;br&gt;ä½ æ˜¯æœç´¢ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&quot;</span>, <span class="string">&quot;&lt;/span&gt; æ‰¾åˆ°çš„æˆ‘å—ï¼Ÿ&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;so&quot;</span>: [<span class="string">&quot;Hello! æ¥è‡ª 360æœç´¢ çš„æœ‹å‹&lt;br&gt;ä½ æ˜¯æœç´¢ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&quot;</span>, <span class="string">&quot;&lt;/span&gt; æ‰¾åˆ°çš„æˆ‘å—ï¼Ÿ&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;google&quot;</span>: [<span class="string">&quot;Hello! æ¥è‡ª è°·æ­Œæœç´¢ çš„æœ‹å‹&lt;br&gt;æ¬¢è¿é˜…è¯»&lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&quot;</span>, <span class="string">&quot;ã€&lt;/span&gt;&quot;</span>, <span class="string">&quot; - &quot;</span>],</span><br><span class="line">            <span class="attr">&quot;default&quot;</span>: [<span class="string">&quot;Hello! æ¥è‡ª &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&quot;</span>, <span class="string">&quot;&lt;/span&gt; çš„æœ‹å‹&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;none&quot;</span>: [<span class="string">&quot;æ¬¢è¿é˜…è¯»&lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&quot;</span>, <span class="string">&quot;ã€&lt;/span&gt;&quot;</span>, <span class="string">&quot; - &quot;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;referrer_hostname&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;yaoxi-std.github.io&quot;</span>: [<span class="string">&quot;yaoxi-std&quot;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;model_message&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;1&quot;</span>: [<span class="string">&quot;æ¥è‡ª Potion Maker çš„ Pio é…± ~&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;2&quot;</span>: [<span class="string">&quot;æ¥è‡ª Potion Maker çš„ Tia é…± ~&quot;</span>]  </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;hitokoto_api_message&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;lwl12.com&quot;</span>: [<span class="string">&quot;è¿™å¥ä¸€è¨€æ¥è‡ª &lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&#123;source&#125;ã€&lt;/span&gt;&quot;</span>, <span class="string">&quot;ï¼Œæ˜¯ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&#123;creator&#125;&lt;/span&gt; æŠ•ç¨¿çš„&quot;</span>, <span class="string">&quot;ã€‚&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;fghrsh.net&quot;</span>: [<span class="string">&quot;è¿™å¥ä¸€è¨€å‡ºå¤„æ˜¯ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&#123;source&#125;ã€&lt;/span&gt;ï¼Œæ˜¯ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;FGHRSH&lt;/span&gt; åœ¨ &#123;date&#125; æ”¶è—çš„ï¼&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;jinrishici.com&quot;</span>: [<span class="string">&quot;è¿™å¥è¯—è¯å‡ºè‡ª &lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€Š&#123;title&#125;ã€‹&lt;/span&gt;ï¼Œæ˜¯ &#123;dynasty&#125;è¯—äºº &#123;author&#125; åˆ›ä½œçš„ï¼&quot;</span>],</span><br><span class="line">            <span class="attr">&quot;hitokoto.cn&quot;</span>: [<span class="string">&quot;è¿™å¥ä¸€è¨€æ¥è‡ª &lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&#123;source&#125;ã€&lt;/span&gt;ï¼Œæ˜¯ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&#123;creator&#125;&lt;/span&gt; åœ¨ hitokoto.cn æŠ•ç¨¿çš„ã€‚&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;mouseover&quot;</span>: [</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.container a[href^=&#x27;http&#x27;]&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;è¦çœ‹çœ‹ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&#123;text&#125;&lt;/span&gt; ä¹ˆï¼Ÿ&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.fui-home&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ç‚¹å‡»å‰å¾€é¦–é¡µï¼Œæƒ³å›åˆ°ä¸Šä¸€é¡µå¯ä»¥ä½¿ç”¨æµè§ˆå™¨çš„åé€€åŠŸèƒ½å“¦&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.fui-chat&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ä¸€è¨€ä¸€è¯­ï¼Œä¸€é¢¦ä¸€ç¬‘ã€‚ä¸€å­—ä¸€å¥ï¼Œä¸€é¢—èµ›è‰‡ã€‚&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.fui-eye&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;å—¯Â·Â·Â· è¦åˆ‡æ¢ çœ‹æ¿å¨˜ å—ï¼Ÿ&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.fui-user&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;å–œæ¬¢æ¢è£… Play å—ï¼Ÿ&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.fui-photo&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;è¦æ‹å¼ çºªå¿µç…§ç‰‡å—ï¼Ÿ&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.fui-info-circle&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;è¿™é‡Œæœ‰å…³äºæˆ‘çš„ä¿¡æ¯å‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.fui-cross&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ä½ ä¸å–œæ¬¢æˆ‘äº†å—...&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#tor_show&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ç¿»é¡µæ¯”è¾ƒéº»çƒ¦å—ï¼Œç‚¹å‡»å¯ä»¥æ˜¾ç¤ºè¿™ç¯‡æ–‡ç« çš„ç›®å½•å‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#comment_go&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;æƒ³è¦å»è¯„è®ºäº›ä»€ä¹ˆå—ï¼Ÿ&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#night_mode&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;æ·±å¤œæ—¶è¦çˆ±æŠ¤çœ¼ç›å‘€&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#qrcode&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;æ‰‹æœºæ‰«ä¸€ä¸‹å°±èƒ½ç»§ç»­çœ‹ï¼Œå¾ˆæ–¹ä¾¿å‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.comment_reply&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;è¦åæ§½äº›ä»€ä¹ˆå‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#back-to-top&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;å›åˆ°å¼€å§‹çš„åœ°æ–¹å§&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#author&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;è¯¥æ€ä¹ˆç§°å‘¼ä½ å‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#mail&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ç•™ä¸‹ä½ çš„é‚®ç®±ï¼Œä¸ç„¶å°±æ˜¯æ— å¤´åƒäººå£«äº†&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#url&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ä½ çš„å®¶åœ¨å“ªé‡Œå‘¢ï¼Œå¥½è®©æˆ‘å»å‚è§‚å‚è§‚&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#textarea&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;è®¤çœŸå¡«å†™å“¦ï¼Œåƒåœ¾è¯„è®ºæ˜¯ç¦æ­¢äº‹é¡¹&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.OwO-logo&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;è¦æ’å…¥ä¸€ä¸ªè¡¨æƒ…å—&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;#csubmit&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;è¦[æäº¤]^(Commit)äº†å—ï¼Œé¦–æ¬¡è¯„è®ºéœ€è¦å®¡æ ¸ï¼Œè¯·è€å¿ƒç­‰å¾…~&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.ImageBox&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ç‚¹å‡»å›¾ç‰‡å¯ä»¥æ”¾å¤§å‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;input[name=s]&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;æ‰¾ä¸åˆ°æƒ³çœ‹çš„å†…å®¹ï¼Ÿæœç´¢çœ‹çœ‹å§&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.previous&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;å»ä¸Šä¸€é¡µçœ‹çœ‹å§&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.next&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;å»ä¸‹ä¸€é¡µçœ‹çœ‹å§&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.dropdown-toggle&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;è¿™é‡Œæ˜¯èœå•&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;c-player a.play-icon&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;æƒ³è¦å¬ç‚¹éŸ³ä¹å—&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;c-player div.time&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;åœ¨è¿™é‡Œå¯ä»¥è°ƒæ•´&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æ’­æ”¾è¿›åº¦&lt;/span&gt;å‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;c-player div.volume&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;åœ¨è¿™é‡Œå¯ä»¥è°ƒæ•´&lt;span style=\&quot;color:#0099cc;\&quot;&gt;éŸ³é‡&lt;/span&gt;å‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;c-player div.list-button&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æ’­æ”¾åˆ—è¡¨&lt;/span&gt;é‡Œéƒ½æœ‰ä»€ä¹ˆå‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;c-player div.lyric-button&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;æœ‰&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æ­Œè¯&lt;/span&gt;çš„è¯å°±èƒ½è·Ÿç€ä¸€èµ·å”±å‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.waifu #live2d&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;å¹²å˜›å‘¢ä½ ï¼Œå¿«æŠŠæ‰‹æ‹¿å¼€&quot;</span>, <span class="string">&quot;é¼ â€¦é¼ æ ‡æ”¾é”™åœ°æ–¹äº†ï¼&quot;</span>] &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;click&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;selector&quot;</span>: <span class="string">&quot;.waifu #live2d&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;text&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;æ˜¯â€¦æ˜¯ä¸å°å¿ƒç¢°åˆ°äº†å§&quot;</span>,</span><br><span class="line">                <span class="string">&quot;èè‰æ§æ˜¯ä»€ä¹ˆå‘€&quot;</span>,</span><br><span class="line">                <span class="string">&quot;ä½ çœ‹åˆ°æˆ‘çš„å°ç†Šäº†å—&quot;</span>,</span><br><span class="line">                <span class="string">&quot;å†æ‘¸çš„è¯æˆ‘å¯è¦æŠ¥è­¦äº†ï¼âŒ‡â—ï¹â—âŒ‡&quot;</span>,</span><br><span class="line">                <span class="string">&quot;110å—ï¼Œè¿™é‡Œæœ‰ä¸ªå˜æ€ä¸€ç›´åœ¨æ‘¸æˆ‘(Ã³ï¹Ã²ï½¡)&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;seasons&quot;</span>: [</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;01/01&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;å…ƒæ—¦&lt;/span&gt;äº†å‘¢ï¼Œæ–°çš„ä¸€å¹´åˆå¼€å§‹äº†ï¼Œä»Šå¹´æ˜¯&#123;year&#125;å¹´~&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;02/14&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;åˆæ˜¯ä¸€å¹´&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æƒ…äººèŠ‚&lt;/span&gt;ï¼Œ&#123;year&#125;å¹´æ‰¾åˆ°å¯¹è±¡äº†å˜›~&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;03/08&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ä»Šå¤©æ˜¯&lt;span style=\&quot;color:#0099cc;\&quot;&gt;å¦‡å¥³èŠ‚&lt;/span&gt;ï¼&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;03/12&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ä»Šå¤©æ˜¯&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æ¤æ ‘èŠ‚&lt;/span&gt;ï¼Œè¦ä¿æŠ¤ç¯å¢ƒå‘€&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;04/01&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;æ‚„æ‚„å‘Šè¯‰ä½ ä¸€ä¸ªç§˜å¯†~&lt;span style=\&quot;background-color:#34495e;\&quot;&gt;ä»Šå¤©æ˜¯æ„šäººèŠ‚ï¼Œä¸è¦è¢«éª—äº†å“¦~&lt;/span&gt;&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;05/01&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ä»Šå¤©æ˜¯&lt;span style=\&quot;color:#0099cc;\&quot;&gt;äº”ä¸€åŠ³åŠ¨èŠ‚&lt;/span&gt;ï¼Œè®¡åˆ’å¥½å‡æœŸå»å“ªé‡Œäº†å—~&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;06/01&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;å„¿ç«¥èŠ‚&lt;/span&gt;äº†å‘¢ï¼Œå¿«æ´»çš„æ—¶å…‰æ€»æ˜¯çŸ­æš‚ï¼Œè¦æ˜¯æ°¸è¿œé•¿ä¸å¤§è¯¥å¤šå¥½å•Šâ€¦&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;09/03&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;ä¸­å›½äººæ°‘æŠ—æ—¥æˆ˜äº‰èƒœåˆ©çºªå¿µæ—¥&lt;/span&gt;ï¼Œé“­è®°å†å²ã€ç¼…æ€€å…ˆçƒˆã€ççˆ±å’Œå¹³ã€å¼€åˆ›æœªæ¥ã€‚&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;09/10&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æ•™å¸ˆèŠ‚&lt;/span&gt;ï¼Œåœ¨å­¦æ ¡è¦ç»™è€å¸ˆé—®å£°å¥½å‘€~&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;10/01&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;å›½åº†èŠ‚&lt;/span&gt;ï¼Œæ–°ä¸­å›½å·²ç»æˆç«‹äº†å‘¢&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;11/05-11/12&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;ä»Šå¹´çš„&lt;span style=\&quot;color:#0099cc;\&quot;&gt;åŒåä¸€&lt;/span&gt;æ˜¯å’Œè°ä¸€èµ·è¿‡çš„å‘¢~&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;12/20-12/31&quot;</span>, <span class="attr">&quot;text&quot;</span>: [<span class="string">&quot;è¿™å‡ å¤©æ˜¯&lt;span style=\&quot;color:#0099cc;\&quot;&gt;åœ£è¯èŠ‚&lt;/span&gt;ï¼Œä¸»äººè‚¯å®šåˆå»å‰æ‰‹ä¹°ä¹°ä¹°äº†~&quot;</span>] &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>themes/next/live2d-widget/waifu-tips.css</code>ï¼Œ<strong>ä¸è¦åˆ æ‰</strong>åŸæœ‰å†…å®¹ï¼Œåœ¨æ–‡æ¡£æœ«å°¾æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.waifu</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">20px</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">20px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">15px</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">15px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu-tips</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: -<span class="number">20px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">rgba</span>(<span class="number">224</span>, <span class="number">186</span>, <span class="number">140</span>, <span class="number">0.62</span>);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">236</span>, <span class="number">217</span>, <span class="number">188</span>, <span class="number">0.5</span>);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">3px</span> <span class="number">15px</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">191</span>, <span class="number">158</span>, <span class="number">118</span>, <span class="number">0.2</span>);</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">animation-delay</span>: <span class="number">5s</span>;</span><br><span class="line">    <span class="attribute">animation-duration</span>: <span class="number">50s</span>;</span><br><span class="line">    <span class="attribute">animation-iteration-count</span>: infinite;</span><br><span class="line">    <span class="attribute">animation-name</span>: shake;</span><br><span class="line">    <span class="attribute">animation-timing-function</span>: ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu-tool</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#aaa</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.waifu-tool</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu-tool</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#5b6c7d</span>;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">0.2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu-tool</span> <span class="selector-tag">span</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#34495e</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu</span> <span class="selector-id">#live2d</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> shake &#123;</span><br><span class="line">    <span class="number">2%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">4%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">6%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">8%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">10%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">12%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">14%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">16%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">18%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">20%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">22%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">24%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">26%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">1.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">28%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">0.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">30%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">1.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">32%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">34%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">36%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">38%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">40%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">0.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">42%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">44%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">46%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">1.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">48%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">50%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">52%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">0.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">54%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">56%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">58%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">60%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">62%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">64%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">66%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">68%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">70%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">72%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">0.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">74%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">76%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">78%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">80%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">82%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">84%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">0.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">86%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">88%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">90%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">92%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">94%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">96%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">98%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">0%</span>, <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>) <span class="built_in">rotate</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;Flat-UI-Icons&#x27;</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;flat-ui-icons-regular.eot&#x27;</span>);</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;flat-ui-icons-regular.eot?#iefix&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;embedded-opentype&#x27;</span>), <span class="built_in">url</span>(<span class="string">&#x27;flat-ui-icons-regular.woff&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff&#x27;</span>), <span class="built_in">url</span>(<span class="string">&#x27;flat-ui-icons-regular.ttf&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;truetype&#x27;</span>), <span class="built_in">url</span>(<span class="string">&#x27;flat-ui-icons-regular.svg#flat-ui-icons-regular&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;svg&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[class^=<span class="string">&quot;fui-&quot;</span>]</span>,</span><br><span class="line"><span class="selector-attr">[class*=<span class="string">&quot;fui-&quot;</span>]</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;Flat-UI-Icons&#x27;</span>;</span><br><span class="line">  speak: none;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">font-variant</span>: normal;</span><br><span class="line">  <span class="attribute">text-transform</span>: none;</span><br><span class="line">  -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span><br><span class="line">  -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-cross</span>:before &#123;</span><br><span class="line">  content: <span class="string">&quot;\e609&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-info-circle</span>:before &#123;</span><br><span class="line">  content: <span class="string">&quot;\e60f&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-photo</span>:before &#123;</span><br><span class="line">  content: <span class="string">&quot;\e62a&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-eye</span>:before &#123;</span><br><span class="line">  content: <span class="string">&quot;\e62c&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-chat</span>:before &#123;</span><br><span class="line">  content: <span class="string">&quot;\e62d&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-home</span>:before &#123;</span><br><span class="line">  content: <span class="string">&quot;\e62e&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-user</span>:before &#123;</span><br><span class="line">  content: <span class="string">&quot;\e631&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ°<a href="https://github.com/fghrsh/live2d_demo">è¿™é‡Œ</a>ä¸‹è½½ä»¥<code>flat-ui-icons</code>å¼€å¤´çš„$4$ä¸ªå›¾æ ‡æ–‡ä»¶ï¼Œæ”¾åœ¨<code>themes/next/live2d-widget/</code>æ–‡ä»¶å¤¹ä¸­ã€‚</p>
<p>è‡³æ­¤å·¥ä½œå…¨éƒ¨å®Œæˆï¼Œæ¸…ç†ç›®å½•å¹¶é‡æ–°ç”Ÿæˆ<code>html</code>æ–‡ä»¶ï¼Œæ‰“å¼€<code>localhost</code>ï¼Œä½ ä¼šå‘ç°è§’è‰²å¯ä»¥æ­£å¸¸æ¢è£…äº†ã€‚</p>
]]></content>
      <tags>
        <tag>blog</tag>
      </tags>
  </entry>
  <entry>
    <title>CF553E Kyoya and Train</title>
    <url>/2022/01/09/sol-cf553e/</url>
    <content><![CDATA[<h2 id="CF553E-Kyoya-and-Train"><a href="#CF553E-Kyoya-and-Train" class="headerlink" title="CF553E Kyoya and Train"></a>CF553E Kyoya and Train</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF553E">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è€ƒè™‘dpã€‚$dp_{u,i}$è¡¨ç¤ºç‚¹$u$å¤„å·²èŠ±è´¹æ—¶é—´$i$çš„æœ€å°ä»£ä»·ã€‚</p>
<script type="math/tex; mode=display">
dp_{u,i} = 
\begin{cases}
0 & (u = n, i \lt t) \\
x & (u = n, i \ge t) \\
\min\limits_{e:u \to v,w}{w+\sum\limits_{k=1}^{t}{p_{e,k} dp_{v,i+k}}} & (u \neq n, i \lt t) \\
dist(u, n) & (u \neq n, i \ge t) \\
\end{cases}</script><p>æš´åŠ›è§£dpï¼Œå¤æ‚åº¦$O(mt^2)$ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦çš„ç“¶é¢ˆåœ¨äºç¬¬ä¸‰è¡Œçš„æ±‚å’Œï¼Œè€ƒè™‘ä¼˜åŒ–å®ƒã€‚</p>
<p>è®¾$g_{e,i} = w_e + \sum\limits_{k=1}^{t}{p_{e,k} dp_{v_e,i+k}}$ï¼Œå†è®¾$f_{e,i+t} = g_{e,i}$ï¼Œå°±æœ‰äº†</p>
<script type="math/tex; mode=display">
f_{e,i+t} = w_e + \sum_{k=1}^{t}{p_{e,k} dp_{v_e,i+k}}</script><p>è®¾$pâ€™_k=p_{t-k}$ï¼ˆç¿»è½¬ï¼‰ï¼Œè¿™ä¸ªæ±‚å’Œå°±å˜æˆäº†å·ç§¯ï¼š</p>
<script type="math/tex; mode=display">
f_{e,i+t} = w_e + \sum_{k=1}^{t}{p'_{e,t-k} dp_{v_e,i+k}}</script><p>é€šè¿‡åˆ†æ²»FFTè½¬ç§»ï¼Œå¤æ‚åº¦é™åˆ°$O(mt \log^2 t)$ï¼Œå¯ä»¥æ¥å—ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF553E.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF553E</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">55</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">120</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXK = <span class="number">1</span> &lt;&lt; <span class="number">17</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> EPS = <span class="number">1e-6</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line"><span class="keyword">using</span> comp = complex&lt;<span class="keyword">double</span>&gt;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXK] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fft</span><span class="params">(comp* f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * PI / h), sin(<span class="number">2</span> * PI / h))</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                f[k] = u + t, f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                w *= wn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] /= len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;  <span class="comment">// namespace maths</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> u, v, w;</span><br><span class="line">    <span class="keyword">double</span> p[MAXK];</span><br><span class="line">    <span class="built_in">Edge</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Edge</span>(<span class="keyword">int</span> _u, <span class="keyword">int</span> _v, <span class="keyword">int</span> _w) : <span class="built_in">u</span>(_u), <span class="built_in">v</span>(_v), <span class="built_in">w</span>(_w) &#123;&#125;</span><br><span class="line">&#125; edge[MAXM];</span><br><span class="line"><span class="keyword">int</span> n, m, t, x;</span><br><span class="line"><span class="keyword">int</span> dis[MAXN][MAXN];</span><br><span class="line"><span class="keyword">double</span> f[MAXM][MAXK], dp[MAXN][MAXK];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> comp tf[MAXK], tg[MAXK];</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> lx = r - mid, rx = r - l, len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt;= lx + rx)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> e = <span class="number">1</span>; e &lt;= m; ++e) &#123;</span><br><span class="line">        Edge&amp; ed = edge[e];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            tf[i] = tg[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lx; ++i)</span><br><span class="line">            tf[i] = dp[ed.v][i + mid + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rx; ++i)</span><br><span class="line">            tg[i] = ed.p[rx - i];</span><br><span class="line">        <span class="built_in">fft</span>(tf, len, <span class="number">1</span>), <span class="built_in">fft</span>(tg, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            tf[i] *= tg[i];</span><br><span class="line">        <span class="built_in">fft</span>(tf, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = l; i &lt;= mid; ++i)</span><br><span class="line">            f[e][i] += tf[i + rx - mid - <span class="number">1</span>].<span class="built_in">real</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> comp tf[MAXK], tg[MAXK];</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            dp[edge[i].u][l] = <span class="built_in">min</span>(dp[edge[i].u][l], f[i][l] + edge[i].w);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">calc</span>(l, r);</span><br><span class="line">    <span class="built_in">solve</span>(l, mid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(t), <span class="built_in">read</span>(x);</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dis));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        dis[i][i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        Edge&amp; ed = edge[i];</span><br><span class="line">        <span class="built_in">read</span>(ed.u), <span class="built_in">read</span>(ed.v), <span class="built_in">read</span>(ed.w);</span><br><span class="line">        dis[ed.u][ed.v] = <span class="built_in">min</span>(dis[ed.u][ed.v], ed.w);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= t; ++j)</span><br><span class="line">            <span class="built_in">read</span>(ed.p[j]) /= <span class="number">1e5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= n; ++k)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">                <span class="keyword">if</span> (dis[i][j] &gt; dis[i][k] + dis[k][j])</span><br><span class="line">                    dis[i][j] = dis[i][k] + dis[k][j];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= t; ++j)</span><br><span class="line">            dp[i][j] = INF;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = t + <span class="number">1</span>; j &lt;= t + t; ++j)</span><br><span class="line">            dp[i][j] = dis[i][n] + x;</span><br><span class="line">    <span class="built_in">calc</span>(<span class="number">0</span>, t + t);</span><br><span class="line">    <span class="built_in">solve</span>(<span class="number">0</span>, t);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.10lf\n&quot;</span>, dp[<span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF773F Test Data Generation</title>
    <url>/2022/01/07/sol-cf773f/</url>
    <content><![CDATA[<h2 id="CF773F-Test-Data-Generation"><a href="#CF773F-Test-Data-Generation" class="headerlink" title="CF773F Test Data Generation"></a>CF773F Test Data Generation</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF773F">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>update: å‘ç°<a href="https://www.luogu.com.cn/discuss/396583">FFTä¸åŒå†™æ³•ä¼šè¾“å‡ºä¸åŒçš„ç­”æ¡ˆ</a></p>
<p>ç¬¬ä¸€ç§è§£æ³•å‡ºé”™ï¼Œæ˜¾ç„¶$n$è¦æ˜¯å¥‡æ•°ã€‚</p>
<p>ç¬¬äºŒç§è§£æ³•å‡ºé”™ï¼Œåˆ™$a_n$å’Œ$\frac{a_n}{g}$å¥‡å¶æ€§ä¸åŒï¼Œåªæœ‰$a_n$ä¸ºå¶æ•°ï¼Œ$\frac{a_n}{g}$ä¸ºå¥‡æ•°ã€‚è¿™æ—¶$a_n$ä¸­å› æ•°$2$çš„ä¸ªæ•°ä¸$g$ä¸­çš„ç›¸åŒã€‚</p>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥æšä¸¾$g$ä¸­å› æ•°$2$çš„ä¸ªæ•°$k$ï¼Œå°†åºåˆ—$a$çš„æ‰€æœ‰æ•°é™¤ä»¥$2^k$ï¼Œç­”æ¡ˆå°±æ˜¯$1 \le a_i \le \frac{max_a}{2^k}$ä¸”$a_n$ä¸ºå¥‡æ•°çš„ä¸ªæ•°ã€‚</p>
<p>ä»¤$f_{a,n}$è¡¨ç¤ºæ‰€æœ‰æ•°$\in [1,a]$ï¼Œé•¿åº¦ä¸º$n$ï¼Œæœ€åä¸€ä½ä¸ºå¥‡æ•°çš„æ–¹æ¡ˆæ•°ã€‚</p>
<p>ä»¤$g_{a,n}$è¡¨ç¤ºæ‰€æœ‰æ•°$\in [1,a]$ï¼Œé•¿åº¦ä¸º$n$ï¼Œæœ€åä¸€ä½ä¸ºå¶æ•°çš„æ–¹æ¡ˆæ•°ã€‚</p>
<p>ç­”æ¡ˆæ˜¯</p>
<script type="math/tex; mode=display">\sum\limits_{i \equiv 1 \pmod{2}} f_{\lfloor\frac{max_a}{2^k}\rfloor,i}</script><p>ç”±äºè¦è®¡ç®—æ¯ä¸ª$f_{\lfloor\frac{max_a}{2^k}\rfloor}$ï¼Œå¦‚æœå¯ä»¥ä»$f_{\lfloor\frac{max_a}{2^{k+1}}\rfloor}$è½¬ç§»å°±å¯ä»¥ä¸ç”¨æ¯æ¬¡éƒ½é‡æ–°è®¡ç®—ã€‚</p>
<p>æ‰€ä»¥åˆ†ä¸º$f_{a} \to f_{2a}$å’Œ$f_{a-1} \to f_{a}$ä¸¤ç§æƒ…å†µè½¬ç§»ã€‚</p>
<p>ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œå½“$a$ä¸ºå¥‡æ•°æ—¶ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f_{2a,k} &= \sum_{i+j=k}{(f_{a,i}+g_{a,i})g_{a,j}}-g_{a,k}g_{a,0}[k \neq 0] \\
g_{2a,k} &= \sum_{i+j=k}{(f_{a,i}+g_{a,i})f_{a,j}}-f_{a,k}f_{a,0}[k \neq 0] \\
\end{aligned}</script><p>ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œå½“$a$ä¸ºå¶æ•°æ—¶ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f_{2a,k} &= \sum_{i+j=k}{(f_{a,i}+g_{a,i})f_{a,j}}-g_{a,k}f_{a,0}[k \neq 0] \\
g_{2a,k} &= \sum_{i+j=k}{(f_{a,i}+g_{a,i})g_{a,j}}-f_{a,k}g_{a,0}[k \neq 0] \\
\end{aligned}</script><p>ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œå¾ˆå®¹æ˜“è½¬ç§»ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f_{a,k} &= f_{a-1,k} + (f_{a-1,k-1} + g_{a-1,k-1})[a \equiv 1 \pmod{2}] \\
g_{a,k} &= g_{a-1,k} + (f_{a-1,k-1} + g_{a-1,k-1})[a \equiv 0 \pmod{2}] \\
\end{aligned}</script><p>æ—¶é—´å¤æ‚åº¦$O(max_n \log max_n \log max_a)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF773F.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF773F</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">16</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line"><span class="keyword">int</span> mod;</span><br><span class="line"><span class="keyword">using</span> comp = complex&lt;<span class="keyword">long</span> <span class="keyword">double</span>&gt;;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= mod ? x - mod : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fft</span><span class="params">(comp* f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * PI / h), sin(<span class="number">2</span> * PI / h))</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                f[k] = u + t, f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                w *= wn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] /= len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">polymul</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span>* lhs, <span class="keyword">int</span>* rhs, <span class="keyword">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> comp f1[MAXN], f2[MAXN];</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt;= n + n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        f1[i] = f2[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">        f1[i] = lhs[i], f2[i] = rhs[i];</span><br><span class="line">    <span class="built_in">fft</span>(f1, len, <span class="number">1</span>), <span class="built_in">fft</span>(f2, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        f1[i] *= f2[i];</span><br><span class="line">    <span class="built_in">fft</span>(f1, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">        ans[i] = (<span class="keyword">int</span>)(f1[i].<span class="built_in">real</span>() + <span class="number">0.5</span>) % mod;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;  <span class="comment">// namespace maths</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="keyword">int</span> n, m, ans;</span><br><span class="line"><span class="keyword">int</span> f[MAXN], g[MAXN], tf[MAXN], tg[MAXN], sum[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in"><span class="keyword">void</span></span>(f[<span class="number">0</span>] = <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> y = x &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve</span>(y);</span><br><span class="line">    <span class="keyword">if</span> (y &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">            sum[i] = <span class="built_in">add</span>(f[i], g[i]);</span><br><span class="line">        f[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">polymul</span>(n, sum, f, tg);</span><br><span class="line">        <span class="built_in">polymul</span>(n, sum, g, tf);</span><br><span class="line">        f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            f[i] = <span class="built_in">add</span>(f[i], tf[i]);</span><br><span class="line">            g[i] = <span class="built_in">add</span>(g[i], tg[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">            sum[i] = <span class="built_in">add</span>(f[i], g[i]);</span><br><span class="line">        f[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">polymul</span>(n, sum, f, tf);</span><br><span class="line">        <span class="built_in">polymul</span>(n, sum, g, tg);</span><br><span class="line">        f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            f[i] = <span class="built_in">add</span>(f[i], tf[i]);</span><br><span class="line">            g[i] = <span class="built_in">add</span>(g[i], tg[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; --i)</span><br><span class="line">            f[i] = <span class="built_in">add</span>(f[i], <span class="built_in">add</span>(f[i - <span class="number">1</span>], g[i - <span class="number">1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i += <span class="number">2</span>)</span><br><span class="line">        ans = <span class="built_in">add</span>(ans, f[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(mod);</span><br><span class="line">    <span class="built_in">solve</span>(m &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF623E Transforming Sequence</title>
    <url>/2022/01/05/sol-cf623e/</url>
    <content><![CDATA[<h2 id="CF623E-Transforming-Sequence"><a href="#CF623E-Transforming-Sequence" class="headerlink" title="CF623E Transforming Sequence"></a>CF623E Transforming Sequence</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF623E">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>åºåˆ—$a$çš„å‰ç¼€æˆ–ä¸¥æ ¼å•è°ƒé€’å¢ï¼Œè€ƒè™‘åˆ°$b_n$äºŒè¿›åˆ¶è¡¨ç¤ºä¸­åŒ…å«$k$ä¸ª$1$çš„æƒ…å†µæœ¬è´¨ç›¸åŒè€Œé¡ºåºä¸é‡è¦ï¼Œæ‰€ä»¥è®¾$dp_{n,k}$è¡¨ç¤ºé•¿åº¦ä¸º$n$çš„åºåˆ—$a$ä¸­ï¼Œ$b_n$äºŒè¿›åˆ¶è¡¨ç¤ºä¸­åŒ…å«$k$ä¸ª$1$ã€‚åˆ™æœ‰</p>
<script type="math/tex; mode=display">
\begin{aligned}
dp_{n+m,k} &= \sum_{i+j=k}{dp_{n,i} \times dp_{m,j} \times \binom{k}{i} \times 2^{m \times i}} \\
&= \sum_{i+j=k}{dp_{n,i} \times dp_{m,j} \times \frac{k!}{i!j!} \times 2^{m \times i}} \\
&= k! \times \sum_{i+j=k}{(dp_{n,i} \times \frac{1}{i!} \times 2^{m \times i}) \times (dp_{m,j} \times \frac{1}{j!})} \\
\end{aligned}</script><p>ä»¤$n=m$ï¼Œå€å¢NTTæ±‚è§£ã€‚</p>
<p>éœ€è¦æ³¨æ„ï¼Œé‡Œé¢çš„$(dp_{n,i} \times i!)$å’Œç±»ä¼¼çš„ä¸æ˜¯å·ç§¯è€Œæ˜¯æŒ‰ä½å°†ç³»æ•°ç›¸ä¹˜ï¼Œåªæœ‰$i$å’Œ$j$ä¸åŒæ—¶æ‰æ˜¯å·ç§¯è¿ç®—ã€‚äºæ˜¯é˜¶ä¹˜å’Œé€†å…ƒä¸éœ€è¦å‚ä¸å·ç§¯è¿ç®—çš„ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿ï¼Œä»£ç ä¸­çš„<code>operator*()</code>æ˜¯æŒ‰ä½ä¹˜ç³»æ•°ï¼Œ<code>operator^()</code>æ˜¯å·ç§¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(k \log n \log k)$ã€‚</p>
<p>æ³¨æ„æ¨¡æ•°æ˜¯$10^9+7$è¦ç”¨<a href="/2021/12/05/sol-p4245/" title="ä»»æ„æ¨¡æ•°NTT">ä»»æ„æ¨¡æ•°NTT</a>ã€‚</p>
<p>PS: MTTå¸¦ä¸ª$5$çš„å¸¸æ•°ï¼Œè¿™é‡Œ$\log_2n=60$ï¼Œ$k=3\times 10^4$ï¼ŒFFTé•¿åº¦å–$2^{16}$ï¼Œå¯¼è‡´ç†è®ºä¸Šçš„è¿ç®—æ¬¡æ•°å·²ç»å¡æ»¡äº†$10^9$ï¼Œæœ¬åœ°å°æ ·ä¾‹éƒ½è¦è·‘$7$ç§’ï¼Œä½†è°å«CFè¯„æµ‹æœºå¿«å‘¢ï½</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF623E.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF623E</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">16</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LOGN = <span class="number">60</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> BLOC = <span class="number">1</span> &lt;&lt; <span class="number">15</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="keyword">using</span> comp = complex&lt;<span class="keyword">long</span> <span class="keyword">double</span>&gt;;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        x += y;</span><br><span class="line">        <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        x -= y;</span><br><span class="line">        <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % p;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fft</span><span class="params">(comp* f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * PI / h), sin(<span class="number">2</span> * PI / h))</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                    f[k] = u + t, f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                    w *= wn;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] /= len;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">poly</span> &#123;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">static</span> <span class="keyword">int</span> len = <span class="number">1</span> &lt;&lt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">int</span> a[MAXN];</span><br><span class="line">        <span class="keyword">int</span> <span class="keyword">operator</span>[](<span class="keyword">int</span> i) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span>&amp; <span class="keyword">operator</span>[](<span class="keyword">int</span> i) &#123;</span><br><span class="line">            <span class="keyword">return</span> a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        poly <span class="keyword">operator</span>*(<span class="keyword">const</span> poly&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            poly ret;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                ret[i] = a[i] * rhs[i] % MOD;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        poly <span class="keyword">operator</span>^(<span class="keyword">const</span> poly&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">static</span> comp f1[MAXN], f2[MAXN], f3[MAXN];</span><br><span class="line">            poly ret;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">                f1[i] = <span class="built_in">comp</span>(a[i] / BLOC, a[i] % BLOC);</span><br><span class="line">                f2[i] = <span class="built_in">comp</span>(a[i] / BLOC, -a[i] % BLOC);</span><br><span class="line">                f3[i] = <span class="built_in">comp</span>(rhs[i] / BLOC, rhs[i] % BLOC);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">fft</span>(f1, len, <span class="number">1</span>), <span class="built_in">fft</span>(f2, len, <span class="number">1</span>), <span class="built_in">fft</span>(f3, len, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">                f1[i] *= f3[i];</span><br><span class="line">                f2[i] *= f3[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">fft</span>(f1, len, <span class="number">-1</span>), <span class="built_in">fft</span>(f2, len, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">                <span class="keyword">int</span> axay = (<span class="keyword">int</span>)<span class="built_in">round</span>((f1[i].<span class="built_in">real</span>() + f2[i].<span class="built_in">real</span>()) / <span class="number">2</span>) % MOD;</span><br><span class="line">                <span class="keyword">int</span> bxby = (<span class="keyword">int</span>)<span class="built_in">round</span>((f2[i].<span class="built_in">real</span>() - f1[i].<span class="built_in">real</span>()) / <span class="number">2</span>) % MOD;</span><br><span class="line">                <span class="keyword">int</span> axby = (<span class="keyword">int</span>)<span class="built_in">round</span>((f1[i].<span class="built_in">imag</span>() + f2[i].<span class="built_in">imag</span>()) / <span class="number">2</span>) % MOD;</span><br><span class="line">                <span class="keyword">int</span> aybx = (<span class="keyword">int</span>)<span class="built_in">round</span>((f1[i].<span class="built_in">imag</span>() - f2[i].<span class="built_in">imag</span>()) / <span class="number">2</span>) % MOD;</span><br><span class="line">                ret[i] = (axay * BLOC % MOD * BLOC + (axby + aybx) * BLOC % MOD + bxby) % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="keyword">int</span> n, k;</span><br><span class="line">poly fac, inv, lhs, rhs, ans;</span><br><span class="line">poly pw2[LOGN], dp[LOGN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binom</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fac[x] * inv[y] % MOD * inv[x - y] % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = fac[<span class="number">0</span>] = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    inv[k] = <span class="built_in">qpow</span>(fac[k], MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = k - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = pw2[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">        pw2[<span class="number">0</span>][i] = pw2[<span class="number">0</span>][i - <span class="number">1</span>] * <span class="number">2</span> % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">        dp[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i) &#123;</span><br><span class="line">        pw2[i] = pw2[i - <span class="number">1</span>] * pw2[i - <span class="number">1</span>];</span><br><span class="line">        lhs = dp[i - <span class="number">1</span>] * inv * pw2[i - <span class="number">1</span>];</span><br><span class="line">        rhs = dp[i - <span class="number">1</span>] * inv;</span><br><span class="line">        dp[i] = (lhs ^ rhs) * fac;</span><br><span class="line">    &#125;</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LOGN; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!((n &gt;&gt; i) &amp; <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        lhs = ans * inv * pw2[i];</span><br><span class="line">        rhs = dp[i] * inv;</span><br><span class="line">        ans = (lhs ^ rhs) * fac;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= k; ++i)</span><br><span class="line">        tot = <span class="built_in">add</span>(tot, ans[i] * <span class="built_in">binom</span>(k, i) % MOD);</span><br><span class="line">    <span class="built_in">write</span>(tot), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF755G PolandBall and Many Other Balls</title>
    <url>/2022/01/03/sol-cf755g/</url>
    <content><![CDATA[<h2 id="CF755G-PolandBall-and-Many-Other-Balls"><a href="#CF755G-PolandBall-and-Many-Other-Balls" class="headerlink" title="CF755G PolandBall and Many Other Balls"></a>CF755G PolandBall and Many Other Balls</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF755G">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¦–å…ˆæƒ³åˆ°æœ´ç´ çš„dpã€‚ä»¤$dp_{n,k}$è¡¨ç¤º$n$ä¸ªæ•°å–$k$ä¸ªï¼Œåˆ™</p>
<script type="math/tex; mode=display">dp_{x+y,k} = \sum_{i+j=k}{dp_{x,i} \times dp_{y,j}} + \sum_{i+j=k-1}{dp_{x-1,i} \times dp_{y-1,j}}</script><p>å‘ç°å·¦å³ä¸¤ä¸ªæ±‚å’Œç¬¦å·éƒ½å®¹æ˜“å†™æˆå·ç§¯çš„å½¢å¼ï¼Œä¸å¦¨å¯¹äºæ¯ä¸ª$x+y$å–$x=y$ä»£å…¥è®¡ç®—ï¼Œè¿™æ ·ç”¨å€å¢NTTå°±å¯ä»¥ã€‚</p>
<p>ä½†æ˜¯æ±‚$dp_{x+y}$æ—¶è¿˜è¦çŸ¥é“$dp_{x-1}$å’Œ$dp_{y-1}$ï¼Œæ‰€ä»¥å†è®¾$F_{t,0 \le l \le 2}(x)$è¡¨ç¤ºåŸæ¥çš„$dp_{2^t-l,x}$çš„ç”Ÿæˆå‡½æ•°ï¼Œæœ‰ä»¥ä¸‹è½¬ç§»æ–¹ç¨‹</p>
<script type="math/tex; mode=display">
\begin{aligned}
F_{t,0}(x) &= F_{t-1,0}(x) \times F_{t-1,0}(x) + F_{t-1,1}(x) \times F_{t-1,1}(x) \\
F_{t,1}(x) &= F_{t-1,0}(x) \times F_{t-1,1}(x) + F_{t-1,1}(x) \times F_{t-1,2}(x) \\
F_{t,2}(x) &= F_{t-1,1}(x) \times F_{t-1,1}(x) + F_{t-1,2}(x) \times F_{t-1,2}(x)
\end{aligned}</script><p>æ—¶é—´å¤æ‚åº¦$O(k \log n \log k)$ï¼Œå¯é€šè¿‡ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF755G.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF755G</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXK = <span class="number">1</span> &lt;&lt; <span class="number">17</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LOGN = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        x += y;</span><br><span class="line">        <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        x -= y;</span><br><span class="line">        <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % p;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXK];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ntt</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="keyword">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = <span class="built_in">add</span>(u, t), f[k + h / <span class="number">2</span>] = <span class="built_in">sub</span>(u, t);</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="keyword">int</span> n, k;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">knap</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> dp[MAXK];</span><br><span class="line">        <span class="built_in">node</span>() &#123; <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp)); &#125;</span><br><span class="line">        <span class="built_in">node</span>(<span class="keyword">const</span> node&amp; o) &#123; <span class="built_in">memcpy</span>(dp, o.dp, <span class="built_in"><span class="keyword">sizeof</span></span>(dp)); &#125;</span><br><span class="line">        node <span class="keyword">operator</span>+(<span class="keyword">const</span> node&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            node ret;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= k; ++i)</span><br><span class="line">                ret.dp[i] = <span class="built_in">add</span>(dp[i], rhs.dp[i]);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        node <span class="keyword">operator</span>*(<span class="keyword">const</span> node&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">int</span> f1[MAXK], f2[MAXK];</span><br><span class="line">            node ret;</span><br><span class="line">            <span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (len &lt; k + k + <span class="number">2</span>)</span><br><span class="line">                len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f1[i] = dp[i], f2[i] = rhs.dp[i];</span><br><span class="line">            <span class="built_in">ntt</span>(f1, len, <span class="number">1</span>), <span class="built_in">ntt</span>(f2, len, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f1[i] = f1[i] * f2[i] % MOD;</span><br><span class="line">            <span class="built_in">ntt</span>(f1, len, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= k; ++i)</span><br><span class="line">                ret.dp[i] = f1[i];</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        node <span class="keyword">operator</span>&lt;&lt;(<span class="keyword">int</span> rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">            node ret;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = rhs; i &lt;= k; ++i)</span><br><span class="line">                ret.dp[i] = dp[i - rhs];</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; dp[<span class="number">3</span>];</span><br><span class="line">    knap <span class="keyword">operator</span>*(<span class="keyword">const</span> knap&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        knap ret;</span><br><span class="line">        ret.dp[<span class="number">0</span>] = dp[<span class="number">0</span>] * rhs.dp[<span class="number">0</span>] + ((dp[<span class="number">1</span>] * rhs.dp[<span class="number">1</span>]) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        ret.dp[<span class="number">1</span>] = dp[<span class="number">0</span>] * rhs.dp[<span class="number">1</span>] + ((dp[<span class="number">1</span>] * rhs.dp[<span class="number">2</span>]) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        ret.dp[<span class="number">2</span>] = dp[<span class="number">1</span>] * rhs.dp[<span class="number">1</span>] + ((dp[<span class="number">2</span>] * rhs.dp[<span class="number">2</span>]) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">knap dp[LOGN], ans;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    ans.dp[<span class="number">0</span>].dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">0</span>].dp[<span class="number">0</span>].dp[<span class="number">0</span>] = dp[<span class="number">0</span>].dp[<span class="number">0</span>].dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">0</span>].dp[<span class="number">1</span>].dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        dp[i] = dp[i - <span class="number">1</span>] * dp[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LOGN; ++i)</span><br><span class="line">        <span class="keyword">if</span>  ((n &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            ans = ans * dp[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans.dp[<span class="number">0</span>].dp[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == k]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF1613F Tree Coloring</title>
    <url>/2022/01/03/sol-cf1613f/</url>
    <content><![CDATA[<h2 id="CF1613F-Tree-Coloring"><a href="#CF1613F-Tree-Coloring" class="headerlink" title="CF1613F Tree Coloring"></a>CF1613F Tree Coloring</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF1613F">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸æ˜“ç›´æ¥è®¡ç®—ç¬¦åˆæ¡ä»¶çš„æ–¹æ¡ˆæ•°ï¼Œæ‰€ä»¥åˆ©ç”¨å®¹æ–¥è®¡ç®—ä¸ç¬¦åˆæ¡ä»¶çš„æ–¹æ¡ˆæ•°ã€‚å‡è®¾æœ‰$i$ä¸ªç‚¹çš„$c_k=c_{fa_k}-1$ï¼Œæ•´æ£µæ ‘å°±è¢«åˆ†æˆäº†$n-i$æ¡é“¾ï¼Œæ¯æ¡é“¾åªè¦æœ‰ä¸€ä¸ªç‚¹ç¡®å®šäº†åˆ™å…¶ä»–ç‚¹éƒ½èƒ½ç¡®å®šï¼Œæ’åˆ—æ•°ä¸º$(n-i)!$ã€‚è®¾æœ‰$i$ä¸ªç‚¹çš„$c_k=c_{fa_k}-1$å…±æœ‰$f(i)$ç§æ–¹æ¡ˆï¼Œåˆ™</p>
<script type="math/tex; mode=display">ans=\sum_{i=0}^{n-1}{(-1)^i(n-i)!f(i)}</script><p>è€ƒè™‘å¦‚ä½•è®¡ç®—$f(i)$ã€‚å¯¹äºèŠ‚ç‚¹$u$ï¼Œè¦ä¹ˆä¸å’Œå­èŠ‚ç‚¹ç›¸å·®ä¸º$1$ï¼Œè¦ä¹ˆåªèƒ½å’Œå…¶ä¸­ä¸€ä¸ªå­èŠ‚ç‚¹ç›¸å·®ä¸º$1$ï¼Œæ‰€ä»¥å…¶ç”Ÿæˆå‡½æ•°ä¸º</p>
<script type="math/tex; mode=display">F_u(x) = deg_ux + 1</script><p>$f(i)$çš„ç”Ÿæˆå‡½æ•°æ˜¾ç„¶æ˜¯æ¯ä¸ª$u$çš„ç”Ÿæˆå‡½æ•°ä¹˜èµ·æ¥ï¼š</p>
<script type="math/tex; mode=display">F(x) = \prod_{u=1}^{n}{(deg_ux + 1)}</script><p>æ‰€ä»¥æ±‚å‡º$f(i)$å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">f(i) = [x^i]\prod_{u=1}^{n}{(deg_ux + 1)}</script><p>ä½¿ç”¨åˆ†æ²»NTTè®¡ç®—ï¼Œæ—¶é—´å¤æ‚åº¦$O(n \log^2 n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF1613F.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF1613F</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">19</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        x += y;</span><br><span class="line">        <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        x -= y;</span><br><span class="line">        <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % p;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ntt</span><span class="params">(<span class="keyword">int</span>* f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="keyword">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = <span class="built_in">add</span>(u, t), f[k + h / <span class="number">2</span>] = <span class="built_in">sub</span>(u, t);</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="keyword">int</span> n, fa[MAXN], deg[MAXN], fac[MAXN];</span><br><span class="line"><span class="keyword">int</span> f[MAXN], f1[MAXN], f2[MAXN];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; g[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    fa[u] = f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u])</span><br><span class="line">        <span class="keyword">if</span> (v != f)</span><br><span class="line">            <span class="built_in">build</span>(v, u), ++deg[u];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (r - l == <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, len = r - l;</span><br><span class="line">    <span class="built_in">solve</span>(l, mid), <span class="built_in">solve</span>(mid, r);</span><br><span class="line">    <span class="built_in">copy</span>(f + l, f + mid, f1);</span><br><span class="line">    <span class="built_in">fill</span>(f1 + len / <span class="number">2</span>, f1 + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">copy</span>(f + mid, f + r, f2);</span><br><span class="line">    <span class="built_in">fill</span>(f2 + len / <span class="number">2</span>, f2 + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(f1, len, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(f2, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        f1[i] = f1[i] * f2[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(f1, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(f1, f1 + len, f + l);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt;= n + n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i += <span class="number">2</span>)</span><br><span class="line">        f[i] = <span class="number">1</span>, f[i + <span class="number">1</span>] = deg[i &gt;&gt; <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">solve</span>(<span class="number">0</span>, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = fac[<span class="number">0</span>] = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            ans = <span class="built_in">sub</span>(ans, fac[n - i] * f[i] % MOD);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ans = <span class="built_in">add</span>(ans, fac[n - i] * f[i] % MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF986D Perfect Encoding</title>
    <url>/2022/01/02/sol-cf986d/</url>
    <content><![CDATA[<h2 id="CF986D-Perfect-Encoding"><a href="#CF986D-Perfect-Encoding" class="headerlink" title="CF986D Perfect Encoding"></a>CF986D Perfect Encoding</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF986D">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸€é“æ€ç»´éš¾åº¦ä½ä½†ç é‡æå¤§ä¸”åŠå…¶å¡å¸¸çš„çƒ‚é¢˜ã€‚</p>
<p>é¦–å…ˆæ ¹æ®å°å­¦å¥¥æ•°å­¦è¿‡çš„ä¸œè¥¿ï¼Œå¯ä»¥çŸ¥é“åˆ†è§£å‡ºè®¸å¤š$3$ï¼Œå‰©ä¸‹æ— æ³•åˆ†è§£çš„å‡‘æˆ$1$åˆ°$2$ä¸ª$2$ï¼Œè¿™æ ·å¾—åˆ°çš„ç§¯ä¸€å®šæ˜¯æœ€å¤§çš„ã€‚</p>
<p>ç­”æ¡ˆæ˜æ˜¾æ˜¯å•è°ƒçš„ï¼Œå¯ä»¥è€ƒè™‘äºŒåˆ†+åˆ¤æ–­ã€‚$n$çš„èŒƒå›´å·¨å¤§ï¼Œéœ€è¦ç”¨é«˜ç²¾åº¦+FFT+å¿«é€Ÿå¹‚ï¼Œæ—¶é—´å¤æ‚åº¦ä¸€ä¸‹å­$O(n \log^3 n)$çº§åˆ«ï¼Œæ— æ³•é€šè¿‡ã€‚</p>
<p>è¿›ä¸€æ­¥æ€è€ƒï¼Œç­”æ¡ˆåº”è¯¥æ¥è¿‘$\log_3n$ï¼Œä¸å¦¨ä»$\lfloor \log_3n \rfloor$å¼€å§‹æšä¸¾ç­”æ¡ˆï¼Œåªéœ€è¦æšä¸¾å¤§çº¦$6$ä¸ªå°±å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆï¼Œä¼˜åŒ–æˆ$O(n \log^2 n)$ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦æ— æ³•è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œäºæ˜¯è®¾æ³•å¼€å§‹å¡å¸¸ã€‚é¦–å…ˆè¿™ä¸ªé«˜ç²¾åº¦å¿…é¡»å¾—å‹ä½ï¼Œè€Œä¸”ä¸ºäº†é˜²æ­¢MLEåˆä¸èƒ½å¼€<code>long long</code>ï¼Œæ‰€ä»¥å‡è®¾å‹$x$ä½ï¼Œå°±è¦æ±‚FFTæ—¶$(10^x)^2 \times \frac{1.5 \times 10^6}{10^x} \le$ <code>INT_MAX</code>ï¼Œäºæ˜¯$x$æœ€å¤§å–åˆ°$3$ï¼Œå‹$3$ä½ã€‚</p>
<p>å…¶æ¬¡åœ¨è¿›è¡Œå¿«é€Ÿå¹‚æ—¶ï¼Œå˜é‡$x$éœ€è¦ä¸€ç›´ä¹˜ä¸Šè‡ªå·±ï¼Œå¯ä»¥çœç•¥ä¸€æ¬¡FFTã€‚ç”±äºå¿«é€Ÿå¹‚åˆšå¼€å§‹æ—¶æ•°å­—ä¸æ˜¯å¾ˆå¤§ï¼Œæˆ‘ä»¬é€‰æ‹©ç”¨<code>vector</code>å‚¨å­˜é«˜ç²¾åº¦è€Œä¸æ˜¯ä½¿ç”¨å®šé•¿æ•°ç»„ï¼Œè¿™æ ·åˆå¯ä»¥æé«˜ä¸€äº›å˜é‡æ‹·è´çš„æ•ˆç‡ã€‚è‡³æ­¤æˆ‘å°±æ²¡æœ‰å†æƒ³åˆ°èƒ½å¤Ÿè¿›ä¸€æ­¥ä¼˜åŒ–çš„æ–¹æ³•äº†ï¼Œä½†æ˜¯ä¹Ÿè¶³ä»¥åœ¨æ—¶é™å†…é€šè¿‡äº†ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF986D.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF986D</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// åŠ å¤§ç«è½¦</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">21</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXB = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXK = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> LOG3_10 = <span class="built_in">log</span>(<span class="number">10</span>) / <span class="built_in">log</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">namespace</span> bignum &#123;</span><br><span class="line">    <span class="keyword">using</span> comp = complex&lt;<span class="keyword">double</span>&gt;;</span><br><span class="line">    comp flhs[MAXN], frhs[MAXN];</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> tmp[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(comp *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fft</span><span class="params">(comp *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * PI / h), sin(<span class="number">2</span> * PI / h))</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                    f[k] = u + t;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                    w = w * wn;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] /= len;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt;&amp; <span class="title">polymul</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; lhs, <span class="keyword">int</span> rhs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lhs.<span class="built_in">size</span>(); ++i)</span><br><span class="line">            lhs[i] *= rhs;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lhs.<span class="built_in">size</span>() - <span class="number">1</span>; ++i)</span><br><span class="line">            lhs[i + <span class="number">1</span>] += lhs[i] / MAXB, lhs[i] %= MAXB;</span><br><span class="line">        <span class="keyword">int</span> len = lhs.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">while</span> (lhs[len - <span class="number">1</span>] &gt;= MAXB)</span><br><span class="line">            lhs.<span class="built_in">push_back</span>(lhs[len - <span class="number">1</span>] / MAXB), lhs[len - <span class="number">1</span>] %= MAXB, ++len;</span><br><span class="line">        <span class="keyword">return</span> lhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt;&amp; <span class="title">polymul</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; lhs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt; lhs.<span class="built_in">size</span>() * <span class="number">2</span>)</span><br><span class="line">            len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lhs.<span class="built_in">size</span>(); ++i)</span><br><span class="line">            flhs[i] = lhs[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = lhs.<span class="built_in">size</span>(); i &lt; len; ++i)</span><br><span class="line">            flhs[i] = <span class="number">0</span>;</span><br><span class="line">        lhs.<span class="built_in">resize</span>(len);</span><br><span class="line">        <span class="built_in">fft</span>(flhs, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            flhs[i] = flhs[i] * flhs[i];</span><br><span class="line">        <span class="built_in">fft</span>(flhs, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            tmp[i] = (<span class="keyword">long</span> <span class="keyword">long</span>)(flhs[i].<span class="built_in">real</span>() + <span class="number">0.5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; ++i)</span><br><span class="line">            tmp[i + <span class="number">1</span>] += tmp[i] / MAXB, tmp[i] %= MAXB;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            lhs[i] = tmp[i];</span><br><span class="line">        <span class="keyword">while</span> (*lhs.<span class="built_in">rbegin</span>() == <span class="number">0</span>)</span><br><span class="line">            lhs.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="keyword">return</span> lhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt;&amp; <span class="title">polymul</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; lhs, <span class="keyword">const</span> vector&lt;<span class="keyword">int</span>&gt;&amp; rhs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt; lhs.<span class="built_in">size</span>() + rhs.<span class="built_in">size</span>())</span><br><span class="line">            len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lhs.<span class="built_in">size</span>(); ++i)</span><br><span class="line">            flhs[i] = lhs[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = lhs.<span class="built_in">size</span>(); i &lt; len; ++i)</span><br><span class="line">            flhs[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rhs.<span class="built_in">size</span>(); ++i)</span><br><span class="line">            frhs[i] = rhs[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rhs.<span class="built_in">size</span>(); i &lt; len; ++i)</span><br><span class="line">            frhs[i] = <span class="number">0</span>;</span><br><span class="line">        lhs.<span class="built_in">resize</span>(len);</span><br><span class="line">        <span class="built_in">fft</span>(flhs, len, <span class="number">1</span>), <span class="built_in">fft</span>(frhs, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            flhs[i] = flhs[i] * frhs[i];</span><br><span class="line">        <span class="built_in">fft</span>(flhs, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            tmp[i] = (<span class="keyword">long</span> <span class="keyword">long</span>)(flhs[i].<span class="built_in">real</span>() + <span class="number">0.5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; ++i)</span><br><span class="line">            tmp[i + <span class="number">1</span>] += tmp[i] / MAXB, tmp[i] %= MAXB;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            lhs[i] = tmp[i];</span><br><span class="line">        <span class="keyword">while</span> (*lhs.<span class="built_in">rbegin</span>() == <span class="number">0</span>)</span><br><span class="line">            lhs.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="keyword">return</span> lhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_less</span><span class="params">(<span class="keyword">const</span> vector&lt;<span class="keyword">int</span>&gt;&amp; lhs, <span class="keyword">const</span> vector&lt;<span class="keyword">int</span>&gt;&amp; rhs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (lhs.<span class="built_in">size</span>() != rhs.<span class="built_in">size</span>())</span><br><span class="line">            <span class="keyword">return</span> lhs.<span class="built_in">size</span>() &lt; rhs.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = lhs.<span class="built_in">size</span>() - <span class="number">1</span>; ~i; --i)</span><br><span class="line">            <span class="keyword">if</span> (lhs[i] != rhs[i])</span><br><span class="line">                <span class="keyword">return</span> lhs[i] &lt; rhs[i];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">qpow</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; ret&#123;<span class="number">1</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, <span class="built_in">polymul</span>(x, x))</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">polymul</span>(ret, x);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> bignum;</span><br><span class="line"><span class="keyword">int</span> n, cur, num;</span><br><span class="line"><span class="keyword">char</span> buf[MAXN];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; inp, now, now2;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, vec[vec.<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = vec.<span class="built_in">size</span>() - <span class="number">2</span>; ~i; --i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02d&quot;</span>, vec[i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">6</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">is_less</span>(inp, vector&lt;<span class="keyword">int</span>&gt;&#123;n&#125;);</span><br><span class="line">    <span class="keyword">int</span> tx, ty;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">        tx = n / <span class="number">3</span> - <span class="number">1</span>, ty = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">3</span> == <span class="number">1</span>)</span><br><span class="line">        tx = n / <span class="number">3</span> - <span class="number">1</span>, ty = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">3</span> == <span class="number">2</span>)</span><br><span class="line">        tx = n / <span class="number">3</span> - <span class="number">1</span>, ty = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">while</span> (cur &lt; tx)</span><br><span class="line">        <span class="built_in">polymul</span>(now, <span class="number">3</span>), ++cur;</span><br><span class="line">    <span class="built_in">polymul</span>(now2 = now, ty);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">is_less</span>(inp, now2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">    n = <span class="built_in">strlen</span>(buf);</span><br><span class="line">    num = <span class="built_in">floor</span>(<span class="number">3</span> * LOG3_10 * (n - <span class="number">1</span>));</span><br><span class="line">    cur = <span class="built_in">max</span>((<span class="keyword">int</span>)<span class="number">0</span>, num / <span class="number">3</span> - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">reverse</span>(buf, buf + n);</span><br><span class="line">    <span class="keyword">while</span> (n % MAXK)</span><br><span class="line">        buf[n++] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i += MAXK) &#123;</span><br><span class="line">        inp.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>, x = <span class="number">1</span>; j &lt; MAXK; ++j, x *= <span class="number">10</span>)</span><br><span class="line">            *inp.<span class="built_in">rbegin</span>() += x * (buf[i + j] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    now = <span class="built_in">qpow</span>(vector&lt;<span class="keyword">int</span>&gt;&#123;<span class="number">3</span>&#125;, cur);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = num; ; ++i)</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(i))</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">write</span>(i), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>), <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜</title>
    <url>/2021/12/31/sol-p4009/</url>
    <content><![CDATA[<h2 id="P4009-æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜"><a href="#P4009-æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜" class="headerlink" title="P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜"></a>P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://www.luogu.com.cn/problem/P4009">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>åˆ†å±‚å›¾è·‘dijkstraã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4009.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4009</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> pii = pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">150</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXK = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = <span class="number">4e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> DX[<span class="number">4</span>] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> DY[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, cost;</span><br><span class="line">&#125; edge[MAXE];</span><br><span class="line"><span class="keyword">int</span> n, k, a, b, c, mp[MAXN][MAXN];</span><br><span class="line"><span class="keyword">int</span> s, t, num, pt[MAXN][MAXN][MAXK];</span><br><span class="line"><span class="keyword">int</span> tot, head[MAXV], nxt[MAXE], dis[MAXV];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">    edge[++tot] = &#123;v, cost&#125;;</span><br><span class="line">    nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    priority_queue&lt;pii, vector&lt;pii&gt;, greater&lt;pii&gt;&gt; que;</span><br><span class="line">    <span class="built_in">fill</span>(dis, dis + MAXV, INF);</span><br><span class="line">    dis[s] = <span class="number">0</span>, que.<span class="built_in">push</span>(&#123;dis[s], s&#125;);</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">int</span> u = que.<span class="built_in">top</span>().second, d = que.<span class="built_in">top</span>().first;</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span> (d &gt; dis[u])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                que.<span class="built_in">push</span>(&#123;dis[v], v&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k), <span class="built_in">read</span>(a), <span class="built_in">read</span>(b), <span class="built_in">read</span>(c);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(mp[i][j]);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt;= k; ++l)</span><br><span class="line">                pt[i][j][l] = ++num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    s = pt[<span class="number">1</span>][<span class="number">1</span>][k], t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= k; ++i)</span><br><span class="line">        <span class="built_in">addedge</span>(pt[n][n][i], t, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mp[i][j]) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt;= k; ++l)</span><br><span class="line">                    <span class="built_in">addedge</span>(pt[i][j][l], pt[i][j][k], a);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> d = <span class="number">0</span>; d &lt; <span class="number">4</span>; ++d) &#123;</span><br><span class="line">                    <span class="keyword">int</span> x = i + DX[d], y = j + DY[d];</span><br><span class="line">                    <span class="keyword">if</span> (x &lt; <span class="number">1</span> || y &lt; <span class="number">1</span> || x &gt; n || y &gt; n)</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="built_in">addedge</span>(pt[i][j][k], pt[x][y][k - <span class="number">1</span>], d &gt; <span class="number">1</span> ? <span class="number">0</span> : b);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> d = <span class="number">0</span>; d &lt; <span class="number">4</span>; ++d) &#123;</span><br><span class="line">                    <span class="keyword">int</span> x = i + DX[d], y = j + DY[d];</span><br><span class="line">                    <span class="keyword">if</span> (x &lt; <span class="number">1</span> || y &lt; <span class="number">1</span> || x &gt; n || y &gt; n)</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>; l &lt;= k; ++l)</span><br><span class="line">                        <span class="built_in">addedge</span>(pt[i][j][l], pt[x][y][l - <span class="number">1</span>], d &gt; <span class="number">1</span> ? <span class="number">0</span> : b);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">addedge</span>(pt[i][j][<span class="number">0</span>], pt[i][j][k], a + c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(<span class="built_in">dijkstra</span>(s, t)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4015 è¿è¾“é—®é¢˜</title>
    <url>/2021/12/30/sol-p4015/</url>
    <content><![CDATA[<h2 id="P4015-è¿è¾“é—®é¢˜"><a href="#P4015-è¿è¾“é—®é¢˜" class="headerlink" title="P4015 è¿è¾“é—®é¢˜"></a>P4015 è¿è¾“é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4015">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ€ä¹ˆä¼šæœ‰è¿™ä¹ˆsbçš„é¢˜ç›®å•Šã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4015.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4015</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MINCMF</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="keyword">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MAXCMF</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="keyword">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = <span class="number">2e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t, num, a[MAXN], b[MAXN], c[MAXN][MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">MINCMF&lt;MAXV, MAXE&gt; minnt;</span><br><span class="line">MAXCMF&lt;MAXV, MAXE&gt; maxnt;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]), pt[i][<span class="number">0</span>] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">read</span>(b[i]), pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(c[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        minnt.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], a[i], <span class="number">0</span>);</span><br><span class="line">        maxnt.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], a[i], <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        minnt.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, b[i], <span class="number">0</span>);</span><br><span class="line">        maxnt.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, b[i], <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">            minnt.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[j][<span class="number">1</span>], INF, c[i][j]);</span><br><span class="line">            maxnt.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[j][<span class="number">1</span>], INF, c[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(minnt.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">write</span>(maxnt.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4014 åˆ†é…é—®é¢˜</title>
    <url>/2021/12/30/sol-p4014/</url>
    <content><![CDATA[<h2 id="P4014-åˆ†é…é—®é¢˜"><a href="#P4014-åˆ†é…é—®é¢˜" class="headerlink" title="P4014 åˆ†é…é—®é¢˜"></a>P4014 åˆ†é…é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4014">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸å°±æ˜¯ä¸ªäºŒåˆ†å›¾æœ€å°/æœ€å¤§æƒåŒ¹é…å—ï¼Œå°±è¿™ä¹Ÿèƒ½ç´«é¢˜ï¼Ÿ</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4014.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4014</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MINCMF</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="keyword">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MAXCMF</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="keyword">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = <span class="number">2e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> n, s, t, num, a[MAXN][MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">MINCMF&lt;MAXV, MAXE&gt; minnt;</span><br><span class="line">MAXCMF&lt;MAXV, MAXE&gt; maxnt;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num, pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        minnt.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        maxnt.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        minnt.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        maxnt.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            minnt.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[j][<span class="number">1</span>], <span class="number">1</span>, a[i][j]);</span><br><span class="line">            maxnt.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[j][<span class="number">1</span>], <span class="number">1</span>, a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(minnt.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">write</span>(maxnt.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4013 æ•°å­—æ¢¯å½¢é—®é¢˜</title>
    <url>/2021/12/30/sol-p4013/</url>
    <content><![CDATA[<h2 id="P4013-æ•°å­—æ¢¯å½¢é—®é¢˜"><a href="#P4013-æ•°å­—æ¢¯å½¢é—®é¢˜" class="headerlink" title="P4013 æ•°å­—æ¢¯å½¢é—®é¢˜"></a>P4013 æ•°å­—æ¢¯å½¢é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4013">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸‰æ¬¡è¯¢é—®åˆ†åˆ«æ‹†ç‚¹æ„å»ºç½‘ç»œæµå³å¯ã€‚</p>
<p>è´¹ç”¨æµä¸èƒ½åœ¨æ®‹ä½™ç½‘ç»œä¸ŠåŠ è¾¹é‡æ–°è·‘ï¼Œå¦åˆ™æ— æ³•ä¿è¯æœ€å¤§/æœ€å°è´¹ç”¨ã€‚</p>
<p>æ•°ç»„åº”å½“å¼€$20 \times 40$è€Œä¸æ˜¯$20 \times 20$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4013.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4013</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MCMF</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="keyword">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">45</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">4e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = <span class="number">4e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> m, n, s, t, num, a[MAXN][MAXN], pt[MAXN][MAXN][<span class="number">2</span>];</span><br><span class="line">MCMF&lt;MAXV, MAXE&gt; nt[<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; m + i; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(a[i][j]);</span><br><span class="line">            pt[i][j][<span class="number">0</span>] = ++num;</span><br><span class="line">            pt[i][j][<span class="number">1</span>] = ++num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> w = <span class="number">0</span>; w &lt; <span class="number">3</span>; ++w) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            nt[w].<span class="built_in">addedge</span>(s, pt[<span class="number">1</span>][i][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m + n; ++i)</span><br><span class="line">            nt[w].<span class="built_in">addedge</span>(pt[n][i][<span class="number">1</span>], t, INF, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; m + i; ++j)</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">0</span>], pt[i][j][<span class="number">1</span>], <span class="number">1</span>, a[i][j]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; m + i; ++j) &#123;</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i + <span class="number">1</span>][j][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> w = <span class="number">1</span>; w &lt; <span class="number">3</span>; ++w) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; m + i; ++j)</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">0</span>], pt[i][j][<span class="number">1</span>], INF, a[i][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> w = <span class="number">2</span>; w &lt; <span class="number">3</span>; ++w) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; m + i; ++j) &#123;</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i + <span class="number">1</span>][j][<span class="number">0</span>], INF, <span class="number">0</span>);</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">0</span>], INF, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> w = <span class="number">0</span>; w &lt; <span class="number">3</span>; ++w)</span><br><span class="line">        <span class="built_in">write</span>(nt[w].<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4012 æ·±æµ·æœºå™¨äººé—®é¢˜</title>
    <url>/2021/12/30/sol-p4012/</url>
    <content><![CDATA[<h2 id="P4012-æ·±æµ·æœºå™¨äººé—®é¢˜"><a href="#P4012-æ·±æµ·æœºå™¨äººé—®é¢˜" class="headerlink" title="P4012 æ·±æµ·æœºå™¨äººé—®é¢˜"></a>P4012 æ·±æµ·æœºå™¨äººé—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4012">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å›¾è›®å¥½å»ºçš„ï¼Œè·‘MCMFã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4012.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4012</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MCMF</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="keyword">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">50</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> a, b, p, q, s, t, num, pt[MAXN][MAXN];</span><br><span class="line">MCMF&lt;MAXV, MAXE&gt; network;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(a), <span class="built_in">read</span>(b);</span><br><span class="line">    <span class="built_in">read</span>(p), <span class="built_in">read</span>(q);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= p; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= q; ++j)</span><br><span class="line">            pt[i][j] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= p; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; q; ++j) &#123;</span><br><span class="line">            <span class="keyword">int</span> cost;</span><br><span class="line">            <span class="built_in">read</span>(cost);</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[i][j], pt[i][j + <span class="number">1</span>], <span class="number">1</span>, cost);</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[i][j], pt[i][j + <span class="number">1</span>], INF, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= q; ++j) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> cost;</span><br><span class="line">            <span class="built_in">read</span>(cost);</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[i][j], pt[i + <span class="number">1</span>][j], <span class="number">1</span>, cost);</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[i][j], pt[i + <span class="number">1</span>][j], INF, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= a; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> k, x, y;</span><br><span class="line">        <span class="built_in">read</span>(k), <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        network.<span class="built_in">addedge</span>(s, pt[x][y], k, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= b; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> k, x, y;</span><br><span class="line">        <span class="built_in">read</span>(k), <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[x][y], t, k, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(network.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3357 æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜</title>
    <url>/2021/12/27/sol-p3357/</url>
    <content><![CDATA[<h2 id="P3357-æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜"><a href="#P3357-æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜" class="headerlink" title="P3357 æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜"></a>P3357 æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3357">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>åœ¨<a href="/2021/12/27/sol-p3358/" title="P3358">P3358</a>çš„åŸºç¡€ä¸Šï¼Œå¤šå‡ºæ¥äº†çº¿æ®µä¸$x$è½´å‚ç›´çš„é—®é¢˜ï¼Œå¦‚æœå’Œåˆšåˆšä¸€æ ·è¿è¾¹å°±ä¼šå¯¼è‡´$i \to i$è‡ªç¯çš„é—®é¢˜ã€‚æ‰€ä»¥è¿›è¡Œæ‹†ç‚¹ï¼Œå¦‚æœ$l=r$åˆ™è¿æ¥$in(l)$å’Œ$out(r)$ï¼Œå¦åˆ™è¿æ¥$out(l)$å’Œ$in(r)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3357.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3357</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MCMF</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="keyword">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> n, k, m, s, t, num, a[MAXN], l[MAXN], r[MAXN], p[MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">MCMF&lt;MAXV, MAXE&gt; network;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> sx, sy, tx, ty;</span><br><span class="line">        <span class="built_in">read</span>(sx), <span class="built_in">read</span>(sy);</span><br><span class="line">        <span class="built_in">read</span>(tx), <span class="built_in">read</span>(ty);</span><br><span class="line">        <span class="keyword">if</span> (sx &gt; tx)</span><br><span class="line">            <span class="built_in">swap</span>(sx, tx);</span><br><span class="line">        l[i] = sx, r[i] = tx;</span><br><span class="line">        p[++m] = l[i], p[++m] = r[i];</span><br><span class="line">        a[i] = <span class="built_in">sqrt</span>((sx - tx) * (sx - tx) + (sy - ty) * (sy - ty));</span><br><span class="line">    &#125;</span><br><span class="line">    p[++m] = -INF, p[++m] = INF;</span><br><span class="line">    <span class="built_in">sort</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>);</span><br><span class="line">    m = <span class="built_in">unique</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>) - p - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num, pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">    s = pt[<span class="number">1</span>][<span class="number">0</span>], t = pt[m][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        l[i] = <span class="built_in">lower_bound</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>, l[i]) - p;</span><br><span class="line">        r[i] = <span class="built_in">lower_bound</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>, r[i]) - p;</span><br><span class="line">        <span class="keyword">if</span> (l[i] == r[i])</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[l[i]][<span class="number">0</span>], pt[r[i]][<span class="number">1</span>], <span class="number">1</span>, a[i]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[l[i]][<span class="number">1</span>], pt[r[i]][<span class="number">0</span>], <span class="number">1</span>, a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[i][<span class="number">1</span>], k, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; ++i)</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], pt[i + <span class="number">1</span>][<span class="number">0</span>], k, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">write</span>(network.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3358 æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜</title>
    <url>/2021/12/27/sol-p3358/</url>
    <content><![CDATA[<h2 id="P3358-æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜"><a href="#P3358-æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜" class="headerlink" title="P3358 æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜"></a>P3358 æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3358">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å…ˆç¦»æ•£åŒ–ï¼Œç„¶ååœ¨åæ ‡ä¸Šè¿æ¥$l_i \to r_i$ï¼ŒèŠ±è´¹ä¸º$r_i-l_i$ï¼Œå…¶ä»–è¾¹$i \to i+1$æµé‡ä¸º$k$ï¼Œæ˜¾ç„¶è¿™æ ·å¾—åˆ°çš„æœ€å¤§è´¹ç”¨æœ€å¤§æµå°±æ˜¯ç­”æ¡ˆã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3358.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3358</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MCMF</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="keyword">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> n, k, m, a[MAXN], l[MAXN], r[MAXN], p[MAXN];</span><br><span class="line">MCMF&lt;MAXN, MAXM&gt; network;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(l[i]), <span class="built_in">read</span>(r[i]);</span><br><span class="line">        p[++m] = l[i], p[++m] = r[i];</span><br><span class="line">        a[i] = r[i] - l[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p[++m] = -INF, p[++m] = INF;</span><br><span class="line">    <span class="built_in">sort</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>);</span><br><span class="line">    m = <span class="built_in">unique</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>) - p - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        l[i] = <span class="built_in">lower_bound</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>, l[i]) - p;</span><br><span class="line">        r[i] = <span class="built_in">lower_bound</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>, r[i]) - p;</span><br><span class="line">        network.<span class="built_in">addedge</span>(l[i], r[i], <span class="number">1</span>, a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; ++i)</span><br><span class="line">        network.<span class="built_in">addedge</span>(i, i + <span class="number">1</span>, k, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">write</span>(network.<span class="built_in">mcmf</span>(<span class="number">1</span>, m).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3356 ç«æ˜Ÿæ¢é™©é—®é¢˜</title>
    <url>/2021/12/27/sol-p3356/</url>
    <content><![CDATA[<h2 id="P3356-ç«æ˜Ÿæ¢é™©é—®é¢˜"><a href="#P3356-ç«æ˜Ÿæ¢é™©é—®é¢˜" class="headerlink" title="P3356 ç«æ˜Ÿæ¢é™©é—®é¢˜"></a>P3356 ç«æ˜Ÿæ¢é™©é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3356">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é—®é¢˜å¾ˆå®¹æ˜“è½¬åŒ–æˆæœ€å¤§è´¹ç”¨æœ€å¤§æµï¼Œæ‹†ç‚¹åˆ†åˆ«è€ƒè™‘å³å¯ã€‚</p>
<p>å¦‚ä½•è¾“å‡ºè·¯å¾„å‘¢ï¼Ÿåªéœ€è¦è·‘ä¸€æ¬¡$dfs$æˆ–$bfs$ï¼Œä»$S$åˆ°$T$èµ°åè¾¹æµé‡éé›¶çš„è¾¹å³å¯ï¼Œè®°å¾—æ¯æ¬¡èµ°å®Œå°†åè¾¹çš„æµé‡$-1$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3356.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3356</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MCMF</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="keyword">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">40</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">4e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = <span class="number">8e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> n, p, q, s, t, num, mp[MAXN][MAXN];</span><br><span class="line"><span class="keyword">int</span> px[MAXV], py[MAXV], pt[MAXN][MAXN][<span class="number">2</span>];</span><br><span class="line">MCMF&lt;MAXV, MAXE&gt; network;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> cnt, <span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = network.head[u]; i; i = network.nxt[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = network.edge[i].v;</span><br><span class="line">        <span class="keyword">if</span> ((i &amp; <span class="number">1</span>) == <span class="number">0</span> &amp;&amp; network.edge[i ^ <span class="number">1</span>].flow) &#123;</span><br><span class="line">            <span class="keyword">if</span> (px[u] &amp;&amp; py[u] &amp;&amp; px[v] &amp;&amp; py[v] &amp;&amp; ((px[u] ^ px[v]) || (py[u] ^ py[v])))</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%lld %lld\n&quot;</span>, cnt, py[v] - py[u]);</span><br><span class="line">            --network.edge[i ^ <span class="number">1</span>].flow;</span><br><span class="line">            <span class="built_in">print</span>(cnt, v);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(p), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= p; ++j)</span><br><span class="line">            <span class="built_in">read</span>(mp[i][j]);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= p; ++j) &#123;</span><br><span class="line">            pt[i][j][<span class="number">0</span>] = ++num;</span><br><span class="line">            px[num] = i, py[num] = j;</span><br><span class="line">            pt[i][j][<span class="number">1</span>] = ++num;</span><br><span class="line">            px[num] = i, py[num] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    network.<span class="built_in">addedge</span>(s, pt[<span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], n, <span class="number">0</span>);</span><br><span class="line">    network.<span class="built_in">addedge</span>(pt[q][p][<span class="number">1</span>], t, n, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= p; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mp[i][j] != <span class="number">1</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j][<span class="number">0</span>], pt[i][j][<span class="number">1</span>], INF, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (mp[i][j] == <span class="number">2</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j][<span class="number">0</span>], pt[i][j][<span class="number">1</span>], <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (i &lt; q)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i + <span class="number">1</span>][j][<span class="number">0</span>], INF, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (j &lt; p)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i][j + <span class="number">1</span>][<span class="number">0</span>], INF, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    network.<span class="built_in">mcmf</span>(s, t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">print</span>(i, s);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3355 éª‘å£«å…±å­˜é—®é¢˜</title>
    <url>/2021/12/25/sol-p3355/</url>
    <content><![CDATA[<h2 id="P3355-éª‘å£«å…±å­˜é—®é¢˜"><a href="#P3355-éª‘å£«å…±å­˜é—®é¢˜" class="headerlink" title="P3355 éª‘å£«å…±å­˜é—®é¢˜"></a>P3355 éª‘å£«å…±å­˜é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3355">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ˜¾ç„¶æ˜¯ä¸€ä¸ªäºŒåˆ†å›¾æœ€å°å‰²é—®é¢˜ã€‚</p>
<p>å¦‚æœä¸è€ƒè™‘éšœç¢ï¼Œå¯ä»¥ç›´æ¥æºç‚¹åˆ°å·¦è¾¹ç‚¹ã€å³è¾¹ç‚¹åˆ°æ±‡ç‚¹è¿$1$çš„è¾¹ï¼Œè€Œå·¦å³ç‚¹ä¹‹é—´å†²çªçš„è¿$+\infty$ã€‚</p>
<p>ç°åœ¨è€ƒè™‘éšœç¢ç‰©ã€‚æ€è€ƒä¹‹å‰å»ºå›¾çš„æ„ä¹‰ï¼Œä¸€ä¸ªç‚¹å’Œæºç‚¹/æ±‡ç‚¹ä¹‹é—´çš„è¾¹è¢«å‰²æ‰ä»£è¡¨ä¸å–è¿™ä¸ªç‚¹ã€‚äºæ˜¯è¿™äº›éšœç¢ç‰©æ˜¾ç„¶ä¸èƒ½å–ï¼Œæ‰€ä»¥å¹²è„†ä¸å°†å®ƒä»¬è¿è¾¹ï¼Œæœ€åç­”æ¡ˆåœ¨$n \times n - mincut$çš„åŸºç¡€ä¸Šå†å‡å»$m$å°±å¯ä»¥äº†ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3355.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3355</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXV], lev[MAXV], cur[MAXV], nxt[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(lev, lev + MAXV, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">205</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">4e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXE = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> DX[<span class="number">8</span>] = &#123;<span class="number">-2</span>, <span class="number">-2</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> DY[<span class="number">8</span>] = &#123;<span class="number">-1</span>, <span class="number">1</span>, <span class="number">-2</span>, <span class="number">2</span>, <span class="number">-2</span>, <span class="number">2</span>, <span class="number">-1</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t, num, mp[MAXN][MAXN], pt[MAXN][MAXN];</span><br><span class="line">Dinic&lt;MAXV, MAXE&gt; network;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> x, y;</span><br><span class="line">        <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        mp[x][y] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            pt[i][j] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mp[i][j])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> ((i ^ j) &amp; <span class="number">1</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(s, pt[i][j], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], t, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">8</span>; ++k) &#123;</span><br><span class="line">                <span class="keyword">int</span> x = i + DX[k];</span><br><span class="line">                <span class="keyword">int</span> y = j + DY[k];</span><br><span class="line">                <span class="keyword">if</span> (x &lt; <span class="number">1</span> || y &lt; <span class="number">1</span> || x &gt; n || y &gt; n)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (mp[x][y])</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> ((i ^ j) &amp; <span class="number">1</span>)</span><br><span class="line">                    network.<span class="built_in">addedge</span>(pt[i][j], pt[x][y], INF);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans = n * n - m - network.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3254 åœ†æ¡Œé—®é¢˜</title>
    <url>/2021/12/25/sol-p3254/</url>
    <content><![CDATA[<h2 id="P3254-åœ†æ¡Œé—®é¢˜"><a href="#P3254-åœ†æ¡Œé—®é¢˜" class="headerlink" title="P3254 åœ†æ¡Œé—®é¢˜"></a>P3254 åœ†æ¡Œé—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3254">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è¾ƒä¸ºæ˜¾ç„¶çš„äºŒåˆ†å›¾ç½‘ç»œæµã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3254.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3254</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">550</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(lev, lev + MAXN, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXN, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t, num, r[MAXN], c[MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">Dinic network;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; answ[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">read</span>(r[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(c[i]);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        network.<span class="built_in">addedge</span>(s, pt[i][<span class="number">1</span>], r[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], t, c[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[j][<span class="number">1</span>], pt[i][<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        sum += r[i];</span><br><span class="line">    <span class="keyword">if</span> (network.<span class="built_in">maxflow</span>(s, t) != sum)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>), <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = network.head[pt[i][<span class="number">0</span>]]; j; j = network.nxt[j])</span><br><span class="line">            <span class="keyword">if</span> (network.edge[j].flow &amp;&amp; network.edge[j].v &gt; n + <span class="number">2</span>)</span><br><span class="line">                answ[network.edge[j].v - n - <span class="number">2</span>].<span class="built_in">push_back</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; answ[i].<span class="built_in">size</span>(); ++j)</span><br><span class="line">            <span class="built_in">write</span>(answ[i][j]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[j == answ[i].<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2774 æ–¹æ ¼å–æ•°é—®é¢˜</title>
    <url>/2021/12/25/sol-p2774/</url>
    <content><![CDATA[<h2 id="P2774-æ–¹æ ¼å–æ•°é—®é¢˜"><a href="#P2774-æ–¹æ ¼å–æ•°é—®é¢˜" class="headerlink" title="P2774 æ–¹æ ¼å–æ•°é—®é¢˜"></a>P2774 æ–¹æ ¼å–æ•°é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2774">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä½¿ç”¨å‰²æ¨¡å‹æ¥åšã€‚ç”±äºç›¸é‚»çš„æ•°ä¸èƒ½åŒæ—¶å–ï¼Œäºæ˜¯å¾ˆå®¹æ˜“æƒ³åˆ°å»ºç«‹äºŒåˆ†å›¾ï¼ŒäºŒåˆ†å›¾ä¸¤ä¾§çš„ç‚¹ä¹‹é—´è¿$+\infty$çš„è¾¹ï¼Œå¹¶ä¸”åˆ†åˆ«å‘æºç‚¹å’Œæ±‡ç‚¹è¿è¾¹ï¼Œæµé‡ä¸ºå¯¹åº”æƒå€¼ã€‚è¿™æ ·æœ€å°å‰²ä¸€å®šåªèƒ½å‰²æ‰ä¸¤ä¾§ä¸æºç‚¹å’Œæ±‡ç‚¹çš„è¿è¾¹ï¼Œè¢«å‰²æ‰çš„è¾¹ä¸€å®šä¸å–ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2774.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2774</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(lev, lev + MAXN, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXN, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t, num, a[MAXN][MAXN], pt[MAXN][MAXN];</span><br><span class="line">Dinic network;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">            <span class="built_in">read</span>(a[i][j]);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">            pt[i][j] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((i ^ j) &amp; <span class="number">1</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(s, pt[i][j], a[i][j]);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], t, a[i][j]);</span><br><span class="line">            <span class="keyword">if</span> (((i ^ j) &amp; <span class="number">1</span>) == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">1</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], pt[i - <span class="number">1</span>][j], INF);</span><br><span class="line">            <span class="keyword">if</span> (j &gt; <span class="number">1</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], pt[i][j - <span class="number">1</span>], INF);</span><br><span class="line">            <span class="keyword">if</span> (i &lt; n)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], pt[i + <span class="number">1</span>][j], INF);</span><br><span class="line">            <span class="keyword">if</span> (j &lt; m)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], pt[i][j + <span class="number">1</span>], INF);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">            ans += a[i][j];</span><br><span class="line">    ans -= network.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4716 ã€æ¨¡ç‰ˆã€‘æœ€å°æ ‘å½¢å›¾</title>
    <url>/2021/12/25/sol-p4716/</url>
    <content><![CDATA[<h2 id="P4716-ã€æ¨¡ç‰ˆã€‘æœ€å°æ ‘å½¢å›¾"><a href="#P4716-ã€æ¨¡ç‰ˆã€‘æœ€å°æ ‘å½¢å›¾" class="headerlink" title="P4716 ã€æ¨¡ç‰ˆã€‘æœ€å°æ ‘å½¢å›¾"></a>P4716 ã€æ¨¡ç‰ˆã€‘æœ€å°æ ‘å½¢å›¾</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4716">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ¨¡ç‰ˆé¢˜æ²¡å•¥å¥½è¯´çš„ï¼Œç”¨$zl$ç®—æ³•å³å¯ã€‚</p>
<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯¹äºæ¯ä¸ªé™¤äº†æ ¹èŠ‚ç‚¹ä¹‹å¤–çš„èŠ‚ç‚¹ï¼Œä»¤å…¶è¾¹æƒæœ€å°çš„å…¥è¾¹ä¸º$fa_u$ï¼Œè¾¹æƒä¸º$mn_u$ã€‚</li>
<li>åˆ¤æ–­æ˜¯å¦æœ‰èŠ‚ç‚¹æ²¡æœ‰å…¥è¾¹ï¼Œè‹¥æ²¡æœ‰åˆ™æ— è§£ï¼Œç›´æ¥è¿”å›$-1$ã€‚å¦åˆ™ç­”æ¡ˆåŠ ä¸Š$mn_u$ã€‚</li>
<li>å°†å›¾ä¸­è¿™äº›è¾¹å½¢æˆçš„ç¯å…¨éƒ¨ç¼©ç‚¹ï¼Œå¹¶é‡æ–°ç¼–å·ã€‚</li>
<li>è‹¥å›¾ä¸­æ— ç¯ï¼Œç»“æŸç®—æ³•ï¼Œè¿”å›å½“å‰ç­”æ¡ˆã€‚</li>
<li>å°†ä¸åœ¨ç¯ä¸­çš„ç‚¹ä¹Ÿé‡æ–°ç¼–å·ã€‚</li>
<li>å¯¹äºæ¯æ¡è¾¹$(u,v,w)$ï¼Œå°†$w$å‡å»$mn_v$ã€‚</li>
<li>æ›´æ–°å˜é‡$n$å’Œ$rt$ï¼Œæ¸…ç©ºæœ€å¤§ç¼–å·ï¼Œé‡å¤æ­¥éª¤$1$ã€‚</li>
</ol>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4716.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4716</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">150</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> u, v, w;</span><br><span class="line">&#125; e[MAXM];</span><br><span class="line"><span class="keyword">int</span> n, m, r;</span><br><span class="line"><span class="keyword">int</span> tot, head[MAXN], nxt[MAXM];</span><br><span class="line"><span class="keyword">int</span> mn[MAXN], fa[MAXN], tp[MAXN], lp[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">    e[++tot] = &#123;u, v, w&#125;;</span><br><span class="line">    nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mdst</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>, tn = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="built_in">fill</span>(fa, fa + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(tp, tp + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(lp, lp + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(mn, mn + n + <span class="number">1</span>, INF);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="keyword">if</span> (e[i].u != e[i].v &amp;&amp; e[i].w &lt; mn[e[i].v])</span><br><span class="line">                mn[e[i].v] = e[i].w, fa[e[i].v] = e[i].u;</span><br><span class="line">        mn[rt] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            ret += mn[i];</span><br><span class="line">            <span class="keyword">if</span> (mn[i] == INF)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = u;</span><br><span class="line">            <span class="keyword">while</span> (v != rt &amp;&amp; tp[v] != u &amp;&amp; !lp[v])</span><br><span class="line">                tp[v] = u, v = fa[v];</span><br><span class="line">            <span class="keyword">if</span> (v != rt &amp;&amp; !lp[v]) &#123;</span><br><span class="line">                lp[v] = ++tn;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = fa[v]; k != v; k = fa[k])</span><br><span class="line">                    lp[k] = tn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!tn)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!lp[i])</span><br><span class="line">                lp[i] = ++tn;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            e[i].w -= mn[e[i].v], e[i].u = lp[e[i].u], e[i].v = lp[e[i].v];</span><br><span class="line">        n = tn, rt = lp[rt], tn = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(r);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, w;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v), <span class="built_in">read</span>(w);</span><br><span class="line">        <span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(<span class="built_in">mdst</span>(r)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2770 èˆªç©ºè·¯çº¿é—®é¢˜</title>
    <url>/2021/12/24/sol-p2770/</url>
    <content><![CDATA[<h2 id="P2770-èˆªç©ºè·¯çº¿é—®é¢˜"><a href="#P2770-èˆªç©ºè·¯çº¿é—®é¢˜" class="headerlink" title="P2770 èˆªç©ºè·¯çº¿é—®é¢˜"></a>P2770 èˆªç©ºè·¯çº¿é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2770">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>$O(n^3)$çš„$dp$æ˜¾ç„¶<del>ï¼ˆbushi</del></p>
<p>è€ƒè™‘ç½‘ç»œæµçš„åšæ³•ã€‚é¦–å…ˆæ¯ä¸ªç‚¹ç»è¿‡ä¸€æ¬¡å°±æƒ³åˆ°æ‹†ç‚¹ï¼Œç„¶åæŒ‰ç…§åŸå›¾è¿è¾¹ï¼Œä»$1$åˆ°$n$çš„æœ€å¤§æµ$\ge 2$å°±æœ‰è§£ã€‚</p>
<p>éœ€è¦æ³¨æ„æµ‹è¯•ç‚¹$2$æ˜¯$1$åˆ°$n$æœ‰è¿è¾¹ä¸”åªæœ‰$1 \to n \to 1$è¿™ç§èµ°æ³•çš„ï¼Œä½†å…¶å®å¯ä»¥ä¸ç”¨ç‰¹åˆ¤è§£å†³ï¼Œè¾“å‡ºè·¯å¾„æ—¶å¦‚æœå‰©ä½™æµé‡$=+\infty-2$æ—¶å¤šè·‘ä¸€æ¬¡å³å¯ï¼ˆå…·ä½“è§ä»£ç ï¼‰ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2770.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2770</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">505</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">2e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXS = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>, cost = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], dis[MAXN], cur[MAXN];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXN, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXN, -INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>, vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>(), vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v])</span><br><span class="line">                        que.<span class="built_in">push</span>(v), vis[v] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXN, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t, num, pt[MAXN][<span class="number">2</span>];</span><br><span class="line"><span class="keyword">char</span> buf[MAXS], str[MAXN][MAXS];</span><br><span class="line">Dinic network;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str[u]);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str[u]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = network.head[pt[u][<span class="number">1</span>]]; i; i = network.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (network.edge[i].flow == INF - <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>((network.edge[i].v - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>, on);</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str[u]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str[i]);</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num;</span><br><span class="line">        pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">    &#125;</span><br><span class="line">    network.<span class="built_in">addedge</span>(s, pt[<span class="number">1</span>][<span class="number">1</span>], <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    network.<span class="built_in">addedge</span>(pt[n][<span class="number">0</span>], t, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[i][<span class="number">1</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf, str[j]) == <span class="number">0</span>)</span><br><span class="line">                u = j;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf, str[j]) == <span class="number">0</span>)</span><br><span class="line">                v = j;</span><br><span class="line">        <span class="keyword">if</span> (u &gt; v)</span><br><span class="line">            <span class="built_in">swap</span>(u, v);</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[u][<span class="number">1</span>], pt[v][<span class="number">0</span>], INF, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (network.<span class="built_in">mcmf</span>(s, t) != <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;No Solution!&quot;</span>), <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">write</span>(network.cost), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = network.head[pt[<span class="number">1</span>][<span class="number">1</span>]], on = <span class="number">1</span>; i; i = network.nxt[i]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (network.edge[i].flow &lt; INF - <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = network.edge[i].flow; j &lt; INF; ++j, on = -on) &#123;</span><br><span class="line">            <span class="keyword">if</span> (on == <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str[<span class="number">1</span>]);</span><br><span class="line">            <span class="built_in">print</span>((network.edge[i].v - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>, on);</span><br><span class="line">            <span class="keyword">if</span> (on == <span class="number">-1</span>)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2766 æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜</title>
    <url>/2021/12/24/sol-p2766/</url>
    <content><![CDATA[<h2 id="P2766-æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜"><a href="#P2766-æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜" class="headerlink" title="P2766 æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜"></a>P2766 æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2766">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ç¬¬ä¸€é—®ç›´æ¥$O(n^2)$æ±‚ã€‚</p>
<p>ç¬¬äºŒé—®æ ¹æ®ç¬¬ä¸€é—®$dp$çš„åˆæ³•è½¬ç§»å»ºç«‹$DAG$å›¾ï¼Œæ‹†ç‚¹å¹¶æ±‚å‡ºæœ€å¤§æµã€‚å³å¯¹äº$\forall a_j \le a_i, dp_i = dp_j + 1$ï¼Œè¿æ¥$j_1 \to i_0$ï¼Œæµé‡ä¸º$1$ï¼Œä¸”è¿æ¥æ¯ä¸ª$i_0 \to i_1$ã€‚å¦‚æœ$dp_i=1$åˆ™è¿æ¥$S \to i_0$ï¼Œ$dp_i=ans_1$åˆ™è¿æ¥$i_1 \to T$ã€‚è¿™æ ·å°±ä¿è¯äº†æ¯æ¬¡å¢å¹¿éƒ½æ‰¾åˆ°ä¸€ä¸ªé•¿åº¦æœ€é•¿çš„å­åºåˆ—ï¼Œå¹¶ä¸”æ¯ä¸ªç‚¹åªèƒ½å–ä¸€æ¬¡ã€‚</p>
<p>ç¬¬ä¸‰é—®ç”±äº$1$å’Œ$n$æ— é™åˆ¶ï¼Œæ‰€ä»¥å°†$S \to 1$å’Œ$n \to T$ï¼ˆå¦‚æœæœ‰ï¼‰çš„æµé‡æ”¹ä¸º$+\infty$ï¼Œå¹¶å°†$1_0 \to 1_1$å’Œ$n_0 \to n_1$ä¹Ÿæ”¹ä¸º$+\infty$å³å¯ã€‚æ³¨æ„è¦ç‰¹åˆ¤$n=1$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2766.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2766</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(lev));</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in"><span class="keyword">sizeof</span></span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, s, t, num, a[MAXN], dp[MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">Dinic network;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">int</span> ans1 = <span class="number">0</span>, ans2 = <span class="number">0</span>, ans3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; ++j)</span><br><span class="line">            <span class="keyword">if</span> (a[j] &lt;= a[i])</span><br><span class="line">                dp[i] = <span class="built_in">max</span>(dp[i], dp[j] + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ans1 = *<span class="built_in">max_element</span>(dp + <span class="number">1</span>, dp + n + <span class="number">1</span>);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num, pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[i][<span class="number">1</span>], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (dp[i] == <span class="number">1</span>)</span><br><span class="line">            network.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (dp[i] == ans1)</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; i; ++j)</span><br><span class="line">            <span class="keyword">if</span> (a[j] &lt;= a[i] &amp;&amp; dp[j] + <span class="number">1</span> == dp[i])</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[j][<span class="number">1</span>], pt[i][<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ans2 = network.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">    <span class="keyword">if</span> (dp[<span class="number">1</span>] == <span class="number">1</span>)</span><br><span class="line">        network.<span class="built_in">addedge</span>(s, pt[<span class="number">1</span>][<span class="number">0</span>], INF - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (dp[n] == ans1)</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[n][<span class="number">1</span>], t, INF - <span class="number">1</span>);</span><br><span class="line">    network.<span class="built_in">addedge</span>(pt[<span class="number">1</span>][<span class="number">0</span>], pt[<span class="number">1</span>][<span class="number">1</span>], INF - <span class="number">1</span>);</span><br><span class="line">    network.<span class="built_in">addedge</span>(pt[n][<span class="number">0</span>], pt[n][<span class="number">1</span>], INF - <span class="number">1</span>);</span><br><span class="line">    ans3 = (n == <span class="number">1</span>) ? <span class="number">1</span> : network.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">    <span class="built_in">write</span>(ans1), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">write</span>(ans2), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">write</span>(ans3), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2765 é­”æœ¯çƒé—®é¢˜</title>
    <url>/2021/12/24/sol-p2765/</url>
    <content><![CDATA[<h2 id="P2765-é­”æœ¯çƒé—®é¢˜"><a href="#P2765-é­”æœ¯çƒé—®é¢˜" class="headerlink" title="P2765 é­”æœ¯çƒé—®é¢˜"></a>P2765 é­”æœ¯çƒé—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2765">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><a href="/2021/12/24/sol-p2764/" title="P2764">P2764</a>å€’è¿‡æ¥ã€‚

å°†å’Œä¸ºå®Œå…¨å¹³æ–¹æ•°çš„æ•°å¯¹$(a,b)$ä¹‹é—´è¿æœ‰å‘è¾¹ï¼Œå¤§çš„è¿å‘å°çš„ï¼Œç­”æ¡ˆå°±æ˜¯æœ€é•¿è·¯å¾„è¦†ç›–ã€‚

æšä¸¾ç­”æ¡ˆåˆ¤æ–­å³å¯ã€‚

### ACä»£ç 

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2765.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2765</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(lev));</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in"><span class="keyword">sizeof</span></span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, s, t, num, cnt, pre[MAXN], col[MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">Dinic maxflow;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; answ[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">issqrt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = <span class="built_in">sqrt</span>(x);</span><br><span class="line">    <span class="keyword">return</span> t * t == x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> w = <span class="number">1</span>; ; ++w) &#123;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fill</span>(col, col + w, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(pre, pre + w, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt; w; ++u) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = maxflow.head[pt[u][<span class="number">0</span>]]; i; i = maxflow.nxt[i])</span><br><span class="line">                <span class="keyword">if</span> (maxflow.edge[i].flow == INF - <span class="number">1</span>)</span><br><span class="line">                    pre[(maxflow.edge[i].v - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>] = u;</span><br><span class="line">        &#125;</span><br><span class="line">        pt[w][<span class="number">0</span>] = ++num, pt[w][<span class="number">1</span>] = ++num;</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(s, pt[w][<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(pt[w][<span class="number">1</span>], t, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; w; ++i)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">issqrt</span>(i + w))</span><br><span class="line">                maxflow.<span class="built_in">addedge</span>(pt[w][<span class="number">0</span>], pt[i][<span class="number">1</span>], INF);</span><br><span class="line">        <span class="keyword">int</span> tmp = w - maxflow.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">        <span class="keyword">if</span> (tmp &gt; n) &#123;</span><br><span class="line">            <span class="built_in">write</span>(w - <span class="number">1</span>), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = w - <span class="number">1</span>; i; --i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!pre[i])</span><br><span class="line">                    col[i] = ++cnt;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    col[i] = col[pre[i]];</span><br><span class="line">                answ[col[i]].<span class="built_in">push_back</span>(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i) &#123;</span><br><span class="line">                <span class="built_in">reverse</span>(answ[i].<span class="built_in">begin</span>(), answ[i].<span class="built_in">end</span>());</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; answ[i].<span class="built_in">size</span>(); ++j)</span><br><span class="line">                    <span class="built_in">write</span>(answ[i][j]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[j == answ[i].<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2764 æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜</title>
    <url>/2021/12/24/sol-p2764/</url>
    <content><![CDATA[<h2 id="P2764-æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜"><a href="#P2764-æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜" class="headerlink" title="P2764 æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜"></a>P2764 æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2764">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸å¦¨å…ˆå‡è®¾æ¯ä¸ªç‚¹éƒ½å•ç‹¬è¢«ä¸€æ¡è·¯å¾„è¦†ç›–ï¼Œæˆ‘ä»¬æƒ³è¦è®©æœ€å¤šçš„è·¯å¾„ç›¸è¿æ¥ã€‚</p>
<p>å¯¹äºæ¯ä¸ªç‚¹åªèƒ½æœ‰æœ€å¤šä¸€æ¡å…¥è¾¹å’Œæœ€å¤šä¸€æ¡å‡ºè¾¹ï¼Œè€ŒåŸå›¾ä¸­æœ‰è¾¹çš„å¯ä»¥ç›¸è¿ï¼Œå»ºå›¾æ–¹å¼æ˜¾ç„¶ï¼Œç±»ä¼¼äºŒåˆ†å›¾ï¼Œæºç‚¹è¿å‘å·¦è¾¹çš„ç‚¹ï¼Œå³è¾¹çš„ç‚¹è¿å‘æ±‡ç‚¹ï¼Œæµé‡ä¸º$1$ï¼ŒåŸå›¾ä¸­çš„è¾¹$(u,v)$åœ¨ç½‘ç»œä¸­ä¸º$v$å³è¾¹çš„è¿å‘$u$å·¦è¾¹çš„ï¼Œä¸ºä¾¿äºè¾“å‡ºæ–¹æ¡ˆæµé‡è®¾ä¸º$+\infty$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2764.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2764</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">505</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">2e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(lev));</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in"><span class="keyword">sizeof</span></span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t, num, cnt, pre[MAXN], col[MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">Dinic maxflow;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; answ[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num, pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(pt[u][<span class="number">0</span>], pt[v][<span class="number">1</span>], INF);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans = n - maxflow.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = maxflow.head[pt[u][<span class="number">0</span>]]; i; i = maxflow.nxt[i])</span><br><span class="line">            <span class="keyword">if</span> (maxflow.edge[i].flow == INF - <span class="number">1</span>)</span><br><span class="line">                pre[(maxflow.edge[i].v - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>] = u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!pre[i])</span><br><span class="line">            col[i] = ++cnt;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            col[i] = col[pre[i]];</span><br><span class="line">        answ[col[i]].<span class="built_in">push_back</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; answ[i].<span class="built_in">size</span>(); ++j)</span><br><span class="line">            <span class="built_in">write</span>(answ[i][j]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[j == answ[i].<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2763 è¯•é¢˜åº“é—®é¢˜</title>
    <url>/2021/12/23/sol-p2763/</url>
    <content><![CDATA[<h2 id="P2763-è¯•é¢˜åº“é—®é¢˜"><a href="#P2763-è¯•é¢˜åº“é—®é¢˜" class="headerlink" title="P2763 è¯•é¢˜åº“é—®é¢˜"></a>P2763 è¯•é¢˜åº“é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2763">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è¿™é“æ¯”è¾ƒå®¹æ˜“å»ºå›¾äº†ã€‚</p>
<p>æºç‚¹è¿å‘æ¯ç±»è¯•é¢˜ï¼Œæµé‡ä¸ºè¦é€‰å‡ºçš„é¢˜ç›®æ•°é‡ã€‚æ¯ç±»è¯•é¢˜å‘é¢˜åº“ä¸­çš„è¯•é¢˜è¿è¾¹ï¼Œæµé‡$+\infty$ã€‚æœ€åæ¯é“é¢˜å‘æ±‡ç‚¹è¿è¾¹ï¼Œæµé‡ä¸º$1$å³å¯ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2763.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2763</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(lev));</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in"><span class="keyword">sizeof</span></span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> k, n, m, s, t, num, a[MAXN];</span><br><span class="line">Dinic maxflow;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(k), <span class="built_in">read</span>(n);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">        m += a[i];</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(s, ++num, a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> p, x;</span><br><span class="line">        <span class="built_in">read</span>(p);</span><br><span class="line">        ++num;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= p; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            maxflow.<span class="built_in">addedge</span>(x + <span class="number">2</span>, num, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(num, t, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (maxflow.<span class="built_in">maxflow</span>(s, t) != m)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;No Solution!&quot;</span>), <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld: &quot;</span>, i);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = maxflow.head[i + <span class="number">2</span>], c = <span class="number">0</span>; j; j = maxflow.nxt[j])</span><br><span class="line">            <span class="keyword">if</span> (maxflow.edge[j].flow == INF - <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>, maxflow.edge[j].v - k - <span class="number">2</span>, <span class="string">&quot; \n&quot;</span>[++c == a[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2762 å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜</title>
    <url>/2021/12/22/sol-p2762/</url>
    <content><![CDATA[<h2 id="P2762-å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜"><a href="#P2762-å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜" class="headerlink" title="P2762 å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜"></a>P2762 å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2762">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å‘æ¥å‘å»æœ€åè¢«è¯»å…¥ç»™å‘åˆ°äº†ã€‚</p>
<p>ä½¿ç”¨å‰²æ¨¡å‹ï¼Œä»æºç‚¹è¿è¾¹åˆ°å®éªŒï¼Œæµé‡ä¸ºè¯¥å®éªŒå¯è·å¾—çš„é’±$p_i$ï¼Œå†ä»ä»ªå™¨è¿è¾¹é“æ±‡ç‚¹ï¼Œæµé‡ä¸ºè¯¥ä»ªå™¨çš„ä»·æ ¼$c_i$ï¼Œæœ€åå°†å®éªŒå’Œä»ªå™¨ä¹‹é—´è¿è¾¹ï¼Œæµé‡ä¸º$+\infty$ã€‚</p>
<p>æ€è€ƒè¿™ç§è¿è¾¹æ–¹å¼çš„å«ä¹‰ã€‚æœ€å°å‰²åçš„æ®‹ä½™ç½‘ç»œä¸­ï¼Œä¸æºç‚¹ç›¸è¿çš„ç‚¹éƒ½æ˜¯è¦å–çš„ï¼Œä¸æ±‡ç‚¹ç›¸è¿çš„ç‚¹éƒ½æ˜¯ä¸å–çš„ï¼Œåˆ†åˆ«å¯¹åº”$S$é›†åˆå’Œ$T$é›†åˆã€‚åŸç½‘ç»œæ‰€ä»£è¡¨çš„çŠ¶æ€æ˜¯$m$ä¸ªå®éªŒéƒ½åšï¼Œä½†è¿™æ˜¾ç„¶æ˜¯ä¸åˆæ³•çš„ï¼Œæ‰€ä»¥è·‘ä¸€éæœ€å°å‰²åï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°å®éªŒåœ¨$S$é›†åˆè€Œå¯¹åº”ä»ªå™¨åœ¨$T$é›†åˆä¸­çš„æƒ…å†µï¼ˆå› ä¸ºæ— æ³•å‰²æ–­å®éªŒå’Œä»ªå™¨ä¹‹é—´çš„è¿è¾¹ï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®éªŒåœ¨$T$é›†åˆè€Œå¯¹åº”ä»ªå™¨åœ¨$S$é›†åˆçš„æ–¹æ¡ˆæ˜¯åˆæ³•çš„ã€‚è€Œæ‰€æ±‚çš„æœ€å°å‰²å°±æ˜¯ä½¿å¾—æ–¹æ¡ˆåˆæ³•çš„æœ€å°ä»£ä»·ã€‚</p>
<p>äºæ˜¯ç­”æ¡ˆä¸º$\sum\limits_{i=1}^{m}{p_i} - mincut$ã€‚</p>
<h4 id="æ¶å¿ƒçš„è¯»å…¥"><a href="#æ¶å¿ƒçš„è¯»å…¥" class="headerlink" title="æ¶å¿ƒçš„è¯»å…¥"></a>æ¶å¿ƒçš„è¯»å…¥</h4><p>å› ä¸ºä¸å–œæ¬¢ç”¨<code>cin</code>æ‰€ä»¥ç ”ç©¶å¦‚ä½•ç”¨<code>scanf</code>ä¼˜é›…åœ°è¯»å…¥æ•´è¡Œï¼Œäºæ˜¯å‘ç°ï¼š</p>
<ul>
<li><code>scanf(&quot;%[^\n]&quot;, buf)</code>å¯ä»¥è¯»å…¥æ•´è¡Œï¼Œå…¶ä¸­<code>buf</code>æ˜¯<code>char</code>æ•°ç»„ã€‚</li>
</ul>
<p>æ‰€ä»¥ç”¨<code>buf</code>è¿›è¡Œæ‰‹å†™å¿«è¯»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»å­—ç¬¦ä¸²`s`ä¸­è¯»å…¥æ•°å­—åˆ°`x`ï¼Œå¹¶è¿”å›`s`ä¸­å½“å‰æ•°å­—ä¸‹ä¸€ä½çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span>* <span class="title">sread</span><span class="params">(<span class="keyword">char</span> *s, _Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = *s++;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = *s++; <span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (sign)</span><br><span class="line">        x = -x;</span><br><span class="line">    <span class="keyword">return</span> --s; <span class="comment">// è¿”å›ä¸Šä¸€ä¸ªä½ç½®çš„åŸå› æ˜¯å¿«è¯»ä¼šåˆ¤æ–­æ•°å­—åä¸€ä½å¹¶ä¸”å°†æŒ‡é’ˆ`s`ç§»åˆ°æ•°å­—åä¸¤ä½ï¼Œè¿™æ ·æ— æ³•åˆ¤æ–­å­—ç¬¦ä¸²ç»“æŸ`&#x27;\0&#x27;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(p[i]);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%[^\n]%c&quot;</span>, buf, &amp;chr);</span><br><span class="line">        <span class="keyword">char</span> *pos = buf;</span><br><span class="line">        <span class="keyword">for</span> (k[i] = <span class="number">0</span>; (*pos) &amp;&amp; ++k[i];)</span><br><span class="line">            pos = <span class="built_in">sread</span>(pos, a[i][k[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(c[i]);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2762.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2762</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span>* <span class="title">sread</span><span class="params">(<span class="keyword">char</span> *s, _Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = *s++;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = *s++; <span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (sign)</span><br><span class="line">        x = -x;</span><br><span class="line">    <span class="keyword">return</span> --s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">150</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">3e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXS = <span class="number">1</span> &lt;&lt; <span class="number">15</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(lev));</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in"><span class="keyword">sizeof</span></span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, p[MAXN], c[MAXN], k[MAXN], a[MAXN][MAXN];</span><br><span class="line"><span class="keyword">char</span> chr, buf[MAXS];</span><br><span class="line"><span class="keyword">bool</span> use1[MAXN], use2[MAXN];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; ans1, ans2;</span><br><span class="line">Dinic mincut;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(p[i]);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%[^\n]%c&quot;</span>, buf, &amp;chr);</span><br><span class="line">        <span class="keyword">char</span> *pos = buf;</span><br><span class="line">        <span class="keyword">for</span> (k[i] = <span class="number">0</span>; (*pos) &amp;&amp; ++k[i];)</span><br><span class="line">            pos = <span class="built_in">sread</span>(pos, a[i][k[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(c[i]);</span><br><span class="line">    <span class="keyword">int</span> ss = <span class="number">1</span>, tt = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        mincut.<span class="built_in">addedge</span>(i + <span class="number">2</span>, tt, c[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        mincut.<span class="built_in">addedge</span>(ss, i + n + <span class="number">2</span>, p[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= k[i]; ++j)</span><br><span class="line">            mincut.<span class="built_in">addedge</span>(i + n + <span class="number">2</span>, a[i][j] + <span class="number">2</span>, INF);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        ans += p[i];</span><br><span class="line">    ans -= mincut.<span class="built_in">maxflow</span>(ss, tt);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="keyword">if</span> (mincut.lev[i + n + <span class="number">2</span>] != <span class="number">-1</span>)</span><br><span class="line">            ans1.<span class="built_in">push_back</span>(i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">if</span> (mincut.lev[i + <span class="number">2</span>] != <span class="number">-1</span>)</span><br><span class="line">            ans2.<span class="built_in">push_back</span>(i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ans1.<span class="built_in">size</span>(); ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans1[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == ans1.<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ans2.<span class="built_in">size</span>(); ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans2[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == ans2.<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2754 æ˜Ÿé™…è½¬ç§»é—®é¢˜</title>
    <url>/2021/12/22/sol-p2754/</url>
    <content><![CDATA[<h2 id="P2754-æ˜Ÿé™…è½¬ç§»é—®é¢˜"><a href="#P2754-æ˜Ÿé™…è½¬ç§»é—®é¢˜" class="headerlink" title="P2754 æ˜Ÿé™…è½¬ç§»é—®é¢˜"></a>P2754 æ˜Ÿé™…è½¬ç§»é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2754">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¥—è·¯åœ°æ‹†ç‚¹ã€‚$pt_{u,t}$è¡¨ç¤ºèŠ‚ç‚¹$u$åœ¨æ—¶é—´ä¸º$t$æ—¶çš„çŠ¶æ€ã€‚æŒ‰ç…§å¤ªç©ºèˆ¹åœ¨$t$æ—¶çš„ä½ç½®è¿è¾¹ï¼Œè·‘æœ€å¤§æµåˆ¤æ–­æ˜¯å¦å¯è¡Œã€‚</p>
<p>ä¸€ç§æ–¹æ³•ä¸ºäºŒåˆ†ç­”æ¡ˆï¼Œä½†æ˜¯æ¯æ¬¡éœ€è¦é‡æ–°å»ºå›¾ï¼›å¦ä¸€ç§åˆ™æ˜¯ç›´æ¥æšä¸¾ç­”æ¡ˆï¼Œæ¯æ¬¡åªè¿æ–°åŠ å…¥çš„è¾¹ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ®‹ä½™ç½‘ç»œä¸Šç»§ç»­è·‘$maxflow$ã€‚æ®è¯´äºŒåˆ†åè€Œè·‘çš„æ¯”æšä¸¾æ…¢ä¸€äº›ã€‚</p>
<h4 id="G-V-E-ä¸­-V-å’Œ-E-çš„èŒƒå›´"><a href="#G-V-E-ä¸­-V-å’Œ-E-çš„èŒƒå›´" class="headerlink" title="$G(V,E)$ä¸­$|V|$å’Œ$|E|$çš„èŒƒå›´"></a>$G(V,E)$ä¸­$|V|$å’Œ$|E|$çš„èŒƒå›´</h4><p><strong>ä»¤$n=n+2$</strong>ï¼Œå…ˆè®¡ç®—æœ€é•¿å¯èƒ½çš„æ—¶é—´$T$ã€‚æœ€åçš„å¯èƒ½æ€§æ˜¯åªæœ‰ä¸€è‰˜å¤ªç©ºèˆ¹ä¸”å®¹é‡ä¸º$1$ï¼Œå¹¶ä¸”è¿™è‰˜å¤ªç©ºèˆ¹åœ¨$n$ä¸ªç‚¹ä¹‹é—´å‘¨è½¬ã€‚æ­¤æ—¶æœ€é•¿æ—¶é—´$T \le k \times n \le 750$ï¼ˆå¾ˆå¤šé¢˜è§£éƒ½è¯´æ˜¯$500$ï¼Œå…¶å®æ˜¯é”™çš„ï¼Œæ´›è°·è®¨è®ºåŒºé‡Œæœ‰$hack$ï¼‰ã€‚</p>
<p>æ¯æ¬¡æšä¸¾æ–°çš„æ—¶é—´ï¼Œæœ€å¤šå¢åŠ $n$ä¸ªç‚¹ï¼Œæ‰€ä»¥ç‚¹é›†å¤§å°$|V| \le n \times T \le 11250$ï¼Œå¼€åˆ°$2 \times 10^4$å³å¯ã€‚</p>
<p>è€Œåœ¨æ¯æ¬¡æ·»åŠ è·¯å¾„æ—¶ï¼Œ$pt_{u,t-1}$è¿å‘$pt_{u,t}$ï¼Œå¹¶ä¸”æ¯è‰˜å¤ªç©ºèˆ¹å¢åŠ ä¸€æ¡è¾¹ï¼Œè€ƒè™‘<strong>ç½‘ç»œæµå»ºåè¾¹éœ€è¦$\times 2$</strong>ï¼Œåˆ™æ¯æ¬¡æœ€å¤šæ·»åŠ $(n + m) \times 2 \le 80$æ¡è¾¹ï¼Œæ‰€ä»¥è¾¹é›†å¤§å°$|E| \le T \times 80 \le 60000$ï¼Œå¼€$10^5$ç®¡å¤Ÿã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2754.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2754</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXS = <span class="number">800</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXT = <span class="number">55</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(lev));</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in"><span class="keyword">sizeof</span></span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, k, sx, tx, ss, tt, num;</span><br><span class="line"><span class="keyword">int</span> h[MAXT], r[MAXT], s[MAXT][MAXT], pt[MAXT][MAXS];</span><br><span class="line">Dinic maxflow;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(k);</span><br><span class="line">    sx = n + <span class="number">1</span>, tx = n + <span class="number">2</span>;</span><br><span class="line">    ss = ++num, tt = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(h[i]), <span class="built_in">read</span>(r[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; r[i]; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(s[i][j]);</span><br><span class="line">            <span class="keyword">if</span> (s[i][j] == <span class="number">0</span>)</span><br><span class="line">                s[i][j] = sx;</span><br><span class="line">            <span class="keyword">if</span> (s[i][j] == <span class="number">-1</span>)</span><br><span class="line">                s[i][j] = tx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> w = <span class="number">0</span>; w &lt;= <span class="number">750</span>; ++w) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n + <span class="number">2</span>; ++i)</span><br><span class="line">            pt[i][w] = ++num;</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(ss, pt[sx][w], INF);</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(pt[tx][w], tt, INF);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; w &amp;&amp; i &lt;= n + <span class="number">2</span>; ++i)</span><br><span class="line">            maxflow.<span class="built_in">addedge</span>(pt[i][w - <span class="number">1</span>], pt[i][w], INF);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; w &amp;&amp; i &lt;= m; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = s[i][(w - <span class="number">1</span>) % r[i]];</span><br><span class="line">            <span class="keyword">int</span> v = s[i][w % r[i]];</span><br><span class="line">            maxflow.<span class="built_in">addedge</span>(pt[u][w - <span class="number">1</span>], pt[v][w], h[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (maxflow.<span class="built_in">maxflow</span>(ss, tt) &gt;= k)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">write</span>(w), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>), <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P1251 é¤å·¾è®¡åˆ’é—®é¢˜</title>
    <url>/2021/12/22/sol-p1251/</url>
    <content><![CDATA[<h2 id="P1251-é¤å·¾è®¡åˆ’é—®é¢˜"><a href="#P1251-é¤å·¾è®¡åˆ’é—®é¢˜" class="headerlink" title="P1251 é¤å·¾è®¡åˆ’é—®é¢˜"></a>P1251 é¤å·¾è®¡åˆ’é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P1251">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¢˜ç›®ä¸­å·²ç»æš—ç¤ºäº†è¦ç”¨è´¹ç”¨æµã€‚</p>
<p>ä½¿ç”¨æµæ¨¡å‹ï¼Œæµè¡¨ç¤ºé¤å·¾çš„æ•°é‡ã€‚ä½†æ˜¯ä¸æ˜“å¤„ç†é¤å·¾å¹²å‡€ä¸å¦ï¼Œæ‰€ä»¥æ‹†ç‚¹ï¼Œå°†ä¸€å¤©æ‹†æˆä¸¤ä¸ªç‚¹ï¼Œåˆ†åˆ«è¡¨ç¤ºè¿™å¤©æ‹¥æœ‰çš„å¹²å‡€é¤å·¾æ•°é‡å’Œè„çš„é¤å·¾æ•°é‡ã€‚ä¸ºæ–¹ä¾¿è¡¨è¿°ï¼Œåˆ†åˆ«è®¾ä¸º$used_{i,0}$å’Œ$used_{i,1}$ã€‚</p>
<p>ç”±äºæ¯å¤©éœ€è¦ä½¿ç”¨$r_i$å—é¤å·¾ï¼Œæ‰€ä»¥è®©$used_{i,0}$è¿å‘æ±‡ç‚¹$T$ï¼Œè´¹ç”¨ä¸º$0$ï¼Œæµé‡ä¸º$r_i$ï¼Œè¡¨ç¤ºè¿™å¤©è‡³å°‘éœ€è¦æ‹¥æœ‰$r_i$å—å¹²å‡€é¤å·¾ã€‚åŒæ—¶è®©æºç‚¹$S$è¿å‘$used_{i,1}$ï¼Œè´¹ç”¨ä¸º$0$ï¼Œæµé‡ä¸º$r_i$ï¼Œè¡¨ç¤ºè¿™å¤©è¿‡åä¼šå¤šå‡º$r_i$å—è„çš„é¤å·¾ã€‚</p>
<p>æ¥ä¸‹æ¥è€ƒè™‘è´­ä¹°é¤å·¾ï¼Œæ˜¾ç„¶å¯ä»¥ç›´æ¥ä»$S$è¿å‘$used_{i,0}$ï¼Œè´¹ç”¨ä¸º$p$ï¼Œæµé‡ä¸º$+\infty$ã€‚è€Œä½¿ç”¨å¿«æ´—éƒ¨åˆ™ä»$used_{i,1}$è¿å‘$used_{i+m,0}$ï¼Œè´¹ç”¨ä¸º$f$ï¼Œæµé‡ä¸º$+\infty$ã€‚åŒç†ï¼Œæ…¢æ´—éƒ¨$used_{i,1}$è¿å‘$used_{i+n,0}$ï¼Œè´¹ç”¨ä¸º$s$ï¼Œæµé‡ä¸º$+\infty$ã€‚å¦ä¸€ç§ä¿ç•™é¤å·¾åˆ™$used_{i,1}$è¿å‘$used_{i+1,1}$ï¼Œè´¹ç”¨ä¸º$0$ï¼Œæµé‡ä¸º$+\infty$ã€‚</p>
<p>å½¢å¼åŒ–åœ°ï¼Œå®šä¹‰å‡½æ•°<code>addedge(u, v, cost, flow)</code>ï¼Œåˆ™éœ€è¦</p>
<ol>
<li><code>addedge(used[i][0], T, 0, r[i])</code></li>
<li><code>addedge(S, used[i][1], 0, r[i])</code></li>
<li><code>addedge(S, used[i][0], p, INF)</code></li>
<li><code>if (i + 1 &lt;= N) addedge(used[i][1], used[i + 1][1], 0, INF)</code></li>
<li><code>if (i + m &lt;= N) addedge(used[i][1], used[i + m][0], f, INF)</code></li>
<li><code>if (i + n &lt;= N) addedge(used[i][1], used[i + n][0], s, INF)</code></li>
</ol>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P1251.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P1251</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, cost, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, cost = <span class="number">0</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], dis[MAXN], cur[MAXN];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> cost, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, cost, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, -cost, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(vis));</span><br><span class="line">        <span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dis));</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>, vis[s] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>(), vis[u] = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[u] + edge[i].cost != dis[v])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            cost += edge[i].cost * tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in"><span class="keyword">sizeof</span></span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, qp, qm, qf, qn, qs;</span><br><span class="line"><span class="keyword">int</span> a[MAXN], used[MAXN][<span class="number">2</span>];</span><br><span class="line">Dinic mcmf;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="built_in">read</span>(qp), <span class="built_in">read</span>(qm), <span class="built_in">read</span>(qf), <span class="built_in">read</span>(qn), <span class="built_in">read</span>(qs);</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">1</span>, t = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        used[i][<span class="number">0</span>] = i * <span class="number">2</span> + <span class="number">1</span>, used[i][<span class="number">1</span>] = i * <span class="number">2</span> + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        mcmf.<span class="built_in">addedge</span>(used[i][<span class="number">0</span>], t, <span class="number">0</span>, a[i]);</span><br><span class="line">        mcmf.<span class="built_in">addedge</span>(s, used[i][<span class="number">1</span>], <span class="number">0</span>, a[i]);</span><br><span class="line">        mcmf.<span class="built_in">addedge</span>(s, used[i][<span class="number">0</span>], qp, INF);</span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span> &lt;= n)</span><br><span class="line">            mcmf.<span class="built_in">addedge</span>(used[i][<span class="number">1</span>], used[i + <span class="number">1</span>][<span class="number">1</span>], <span class="number">0</span>, INF);</span><br><span class="line">        <span class="keyword">if</span> (i + qm &lt;= n)</span><br><span class="line">            mcmf.<span class="built_in">addedge</span>(used[i][<span class="number">1</span>], used[i + qm][<span class="number">0</span>], qf, INF);</span><br><span class="line">        <span class="keyword">if</span> (i + qn &lt;= n)</span><br><span class="line">            mcmf.<span class="built_in">addedge</span>(used[i][<span class="number">1</span>], used[i + qn][<span class="number">0</span>], qs, INF);</span><br><span class="line">    &#125;</span><br><span class="line">    mcmf.<span class="built_in">mcmf</span>(s, t);</span><br><span class="line">    <span class="built_in">write</span>(mcmf.cost), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4016 è´Ÿè½½å¹³è¡¡é—®é¢˜</title>
    <url>/2021/12/21/sol-p4016/</url>
    <content><![CDATA[<h2 id="P4016-è´Ÿè½½å¹³è¡¡é—®é¢˜"><a href="#P4016-è´Ÿè½½å¹³è¡¡é—®é¢˜" class="headerlink" title="P4016 è´Ÿè½½å¹³è¡¡é—®é¢˜"></a>P4016 è´Ÿè½½å¹³è¡¡é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ˜¾ç„¶æœ‰è´ªå¿ƒè§£æ³•ï¼Œä½†ä¸ºäº†ç»ƒä¹ è´¹ç”¨æµé€‰æ‹©ä½¿ç”¨ç½‘ç»œæµè§£æ³•ã€‚</p>
<p>ç¬¬ä¸€æ¬¡å†™$spfa$å’Œè´¹ç”¨æµï¼Œæ²¡æƒ³åˆ°ä¼šå‡ºç°è¿™ä¹ˆå¤šé—®é¢˜ã€‚ã€‚ã€‚</p>
<p>æœ‰å‡ ä¸ªè¦æ³¨æ„çš„ç‚¹ï¼š</p>
<ol>
<li>è´¹ç”¨æµå»ºåè¾¹çš„$cost$æ˜¯åŸæ¥çš„$cost$çš„<strong>ç›¸åæ•°</strong>ï¼Œå³éœ€è¦<code>add(u, v, c, f), add(v, u, -c, 0);</code></li>
<li>è®¡ç®—æµé‡çš„æ–¹å¼å’Œæ™®é€šç½‘ç»œæµç›¸åŒï¼Œä½†æ˜¯è®¡ç®—æ€»$cost$æ˜¯æ¯æ¬¡åŠ ä¸Š<code>edge.cost * flow</code>ï¼Œ<strong>ä¸è¦å¿˜è®°ä¹˜ä¸Š$cost$</strong>ï¼Œç”¨å…¨å±€å˜é‡å­˜$cost$ä¼šå¥½å†™ä¸€äº›ã€‚</li>
<li>ç”±äºè´¹ç”¨æµçš„è¾¹æƒå¯èƒ½$\le 0$ï¼Œæ‰€ä»¥<strong>å¿…é¡»</strong>ç”¨$spfa$è€Œæ— æ³•ä½¿ç”¨$dijkstra$ï¼Œå¹¶ä¸”$dfs$<strong>å¢å¹¿æ—¶å¿…é¡»å¼€$vis$æ•°ç»„é˜²æ­¢æ— é™é€’å½’</strong>ã€‚</li>
<li>ï¼ˆè¿™åº”è¯¥ç®—æ˜¯ä¸ªå°$tip$ï¼‰ç½‘ç»œæµ$tot$ä¸€å¼€å§‹æ¸…ç©ºæˆ$1$å¯ä»¥ä¸éœ€è¦å†è°ƒç”¨<code>init</code>å‡½æ•°ï¼Œä¹Ÿä¸éœ€è¦å†æŠŠ$head$æ¸…ç©ºæˆ$-1$ã€‚</li>
</ol>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4016.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4016</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">150</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>, cost = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], dis[MAXN], cur[MAXN];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXN, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXN, INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>, vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>(), vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v])</span><br><span class="line">                        que.<span class="built_in">push</span>(v), vis[v] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXN, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, a[MAXN];</span><br><span class="line">Dinic nf;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]), num += a[i];</span><br><span class="line">    num /= n;</span><br><span class="line">    <span class="keyword">int</span> s = n + <span class="number">1</span>, t = n + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &gt; num)</span><br><span class="line">            nf.<span class="built_in">addedge</span>(s, i, a[i] - num, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (a[i] &lt; num)</span><br><span class="line">            nf.<span class="built_in">addedge</span>(i, t, num - a[i], <span class="number">0</span>);</span><br><span class="line">        nf.<span class="built_in">addedge</span>(i, i % n + <span class="number">1</span>, INF, <span class="number">1</span>);</span><br><span class="line">        nf.<span class="built_in">addedge</span>(i % n + <span class="number">1</span>, i, INF, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    nf.<span class="built_in">mcmf</span>(s, t);</span><br><span class="line">    <span class="built_in">write</span>(nf.cost), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4011 å­¤å²›è¥æ•‘é—®é¢˜</title>
    <url>/2021/12/21/sol-p4011/</url>
    <content><![CDATA[<h2 id="P4011-å­¤å²›è¥æ•‘é—®é¢˜"><a href="#P4011-å­¤å²›è¥æ•‘é—®é¢˜" class="headerlink" title="P4011 å­¤å²›è¥æ•‘é—®é¢˜"></a>P4011 å­¤å²›è¥æ•‘é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4011">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ˜¾ç„¶çš„çŠ¶å‹åˆ†å±‚$BFS$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4011.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4011</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXK = <span class="number">1</span> &lt;&lt; <span class="number">11</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> DX[<span class="number">4</span>] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> DY[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y, s;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, p, k, s, a[MAXN][MAXN], dis[MAXN][MAXN][MAXK], g[MAXN][MAXN][MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(p);</span><br><span class="line">    <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> tx1, ty1, tx2, ty2, tg;</span><br><span class="line">        <span class="built_in">read</span>(tx1), <span class="built_in">read</span>(ty1), <span class="built_in">read</span>(tx2), <span class="built_in">read</span>(ty2), <span class="built_in">read</span>(tg);</span><br><span class="line">        g[tx1][ty1][tx2][ty2] |= <span class="number">1</span> &lt;&lt; tg;</span><br><span class="line">        g[tx2][ty2][tx1][ty1] |= <span class="number">1</span> &lt;&lt; tg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">read</span>(s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= s; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> tx, ty, tq;</span><br><span class="line">        <span class="built_in">read</span>(tx), <span class="built_in">read</span>(ty), <span class="built_in">read</span>(tq);</span><br><span class="line">        a[tx][ty] |= <span class="number">1</span> &lt;&lt; tq;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dis));</span><br><span class="line">    queue&lt;node&gt; que;</span><br><span class="line">    que.<span class="built_in">push</span>(&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    dis[<span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ans = INF;</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        node t = que.<span class="built_in">front</span>();</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">int</span> x = t.x, y = t.y, s = t.s;</span><br><span class="line">        <span class="keyword">if</span> (x == n &amp;&amp; y == m)</span><br><span class="line">            ans = <span class="built_in">min</span>(ans, dis[x][y][s]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> tx = x + DX[i];</span><br><span class="line">            <span class="keyword">int</span> ty = y + DY[i];</span><br><span class="line">            <span class="keyword">if</span> (tx &lt; <span class="number">1</span> || ty &lt; <span class="number">1</span> || tx &gt; n || ty &gt; m)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> ((g[x][y][tx][ty] &amp; s) != g[x][y][tx][ty])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> ts = s | a[tx][ty];</span><br><span class="line">            <span class="keyword">if</span> (dis[tx][ty][ts] != <span class="number">-1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            dis[tx][ty][ts] = dis[x][y][s] + <span class="number">1</span>;</span><br><span class="line">            que.<span class="built_in">push</span>(&#123;tx, ty, ts&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(ans == INF ? <span class="number">-1</span> : ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P276 è½¯ä»¶è¡¥ä¸é—®é¢˜</title>
    <url>/2021/12/20/sol-p2761/</url>
    <content><![CDATA[<h2 id="P276-è½¯ä»¶è¡¥ä¸é—®é¢˜"><a href="#P276-è½¯ä»¶è¡¥ä¸é—®é¢˜" class="headerlink" title="P276 è½¯ä»¶è¡¥ä¸é—®é¢˜"></a>P276 è½¯ä»¶è¡¥ä¸é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2761">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è¿™é¢˜<strong>ä¸æ˜¯ç½‘ç»œæµï¼</strong></p>
<p>çŠ¶å‹+æœ€çŸ­è·¯å³å¯ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2761.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2761</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">200</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> u, dis;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> node &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dis &gt; o.dis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bugfix</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> c, b1, b2, f1, f2;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, dis[MAXM];</span><br><span class="line">bugfix g[MAXN];</span><br><span class="line"><span class="keyword">char</span> buf[MAXN];</span><br><span class="line">priority_queue&lt;node&gt; que;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(g[i].c);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (buf[j] == <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">                g[i].b1 |= (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">            <span class="keyword">if</span> (buf[j] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                g[i].b2 |= (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (buf[j] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                g[i].f1 |= (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">            <span class="keyword">if</span> (buf[j] == <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">                g[i].f2 |= (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dis));</span><br><span class="line">    dis[(<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    que.<span class="built_in">push</span>(&#123;(<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>, <span class="number">0ll</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        node t = que.<span class="built_in">top</span>();</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span> (dis[t.u] &lt; t.dis)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> u = t.u, d = t.dis;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            bugfix&amp; b = g[i];</span><br><span class="line">            <span class="keyword">if</span> ((u &amp; b.b1) == b.b1 &amp;&amp; (u &amp; b.b2) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = (u &amp; (~b.f1)) | b.f2;</span><br><span class="line">                <span class="keyword">if</span> (dis[v] &gt; dis[u] + b.c) &#123;</span><br><span class="line">                    dis[v] = dis[u] + b.c;</span><br><span class="line">                    que.<span class="built_in">push</span>(&#123;v, dis[v]&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dis[<span class="number">0</span>] == INF)</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">write</span>(dis[<span class="number">0</span>]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2756 é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜</title>
    <url>/2021/12/20/sol-p2756/</url>
    <content><![CDATA[<h2 id="P2756-é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜"><a href="#P2756-é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜" class="headerlink" title="P2756 é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜"></a>P2756 é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜</h2><span id="more"></span>
<p>åšäº†å‡ é“è“è‰²çš„æ°´é¢˜</p>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2756">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>äºŒåˆ†å›¾ç½‘ç»œæµæ¿å­ï¼Œç”¨æ¥å¼ºè¿«è‡ªå·±æ•²ä¸€é$dinic$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2756.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2756</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">350</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">edges</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, w, next;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> n, tot, head[MAXN];</span><br><span class="line">    <span class="keyword">int</span> cur[MAXN], lev[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n, tot = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fill</span>(head, head + n + <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        edge[tot] = &#123;v, w, head[u]&#125;;</span><br><span class="line">        head[u] = tot++;</span><br><span class="line">        edge[tot] = &#123;u, <span class="number">0</span>, head[v]&#125;;</span><br><span class="line">        head[v] = tot++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(lev, lev + n + <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s), lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = edge[i].next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].w &amp;&amp; lev[edge[i].v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[edge[i].v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(edge[i].v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; ~i; i = edge[i].next) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v, w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">dfs</span>(v, t, <span class="built_in">min</span>(mx, w));</span><br><span class="line">            edge[i].w -= tmp, edge[i ^ <span class="number">1</span>].w += tmp;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + n + <span class="number">1</span>, cur);</span><br><span class="line">            ret += <span class="built_in">dfs</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t;</span><br><span class="line">dinic nf;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">    s = n + <span class="number">1</span>, t = n + <span class="number">2</span>;</span><br><span class="line">    nf.<span class="built_in">init</span>(n + <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        nf.<span class="built_in">addedge</span>(s, i, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = m + <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        nf.<span class="built_in">addedge</span>(i, t, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> u, v;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;u, &amp;v), u != <span class="number">-1</span> &amp;&amp; v != <span class="number">-1</span>)</span><br><span class="line">        nf.<span class="built_in">addedge</span>(u, v, INF);</span><br><span class="line">    <span class="built_in">write</span>(nf.<span class="built_in">maxflow</span>(s, t)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nf.tot; i += <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> (nf.edge[i].w == INF - <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld %lld\n&quot;</span>, nf.edge[i ^ <span class="number">1</span>].v, nf.edge[i].v);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3181 [HAOI2016] æ‰¾ç›¸åŒå­—ç¬¦ä¸²</title>
    <url>/2021/12/19/sol-p3181/</url>
    <content><![CDATA[<h2 id="P3181-HAOI2016-æ‰¾ç›¸åŒå­—ç¬¦ä¸²"><a href="#P3181-HAOI2016-æ‰¾ç›¸åŒå­—ç¬¦ä¸²" class="headerlink" title="P3181 [HAOI2016] æ‰¾ç›¸åŒå­—ç¬¦ä¸²"></a>P3181 [HAOI2016] æ‰¾ç›¸åŒå­—ç¬¦ä¸²</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3181">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å‡è®¾æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•è®¡ç®—å•ä¸€ä¸²çš„ç­”æ¡ˆï¼Œä¹‹åå¯ä»¥å°†ä¸¤ä¸ªä¸²æ‹¼æ¥ï¼Œä¸­é—´é—´éš”å­—ç¬¦<code>$</code>ï¼Œç®—å‡ºæ–°ä¸²çš„ç­”æ¡ˆã€‚ä½†æ˜¯è¿™æ ·ä¼šé‡å¤è®¡ç®—ä¸¤ä¸ªå­ä¸²åœ¨åŒä¸€ä¸ªåŸä¸²ï¼Œæ‰€ä»¥è¿˜éœ€å‡å»ä¸¤ä¸ªåŸä¸²çš„ç­”æ¡ˆã€‚å³$ans=ans_s-ans_{s1}-ans_{s2}$ã€‚</p>
<p>ç°åœ¨åªéœ€è€ƒè™‘å¦‚ä½•ç®—å‡ºä¸€ä¸ªå•ä¸€ä¸²çš„ç­”æ¡ˆã€‚æ ¹æ®åç¼€æ•°ç»„çš„æ€§è´¨ï¼Œæ˜¾ç„¶ç­”æ¡ˆä¸º</p>
<script type="math/tex; mode=display">
\begin{aligned}
ans_s &= \sum_{1 \le i \lt j \le n}{|lcp(suf_i, suf_j)|} \\
&= \sum_{1 \le i \lt j \le n}{\min_{i \lt sa_k \le j}{height(k)}}
\end{aligned}</script><p>ç®—å‡ºæ¯ä¸ª$height$å¯¹$ans$çš„è´¡çŒ®$(i - pre_i) \times (nxt_i - i) \times height(i)$ï¼Œå…¶ä¸­$pre_i$è¡¨ç¤ºå‰ä¸€ä¸ª<strong>å°äº</strong>$height(i)$çš„ä½ç½®ï¼Œ$nxt_i$è¡¨ç¤ºåä¸€ä¸ª<strong>å°äºç­‰äº</strong>$height_i$çš„ä½ç½®ã€‚å•è°ƒæ ˆç»´æŠ¤ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ï¼Œä½†æ˜¾ç„¶å¯ä»¥é€šè¿‡ä½¿ç”¨æ›´é«˜çº§çš„$SA$ä¼˜åŒ–åˆ°$O(n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3181.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3181</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">suffix_array</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> *str;</span><br><span class="line">    <span class="keyword">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">radix_sort</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;str = s;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">128</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>, top;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> pre[MAXN], nxt[MAXN], sta[MAXN];</span><br><span class="line">        sta[top = <span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (top &amp;&amp; ht[sa[sta[top]]] &gt;= ht[sa[i]])</span><br><span class="line">                --top;</span><br><span class="line">            pre[i] = i - sta[top];</span><br><span class="line">            sta[++top] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        sta[top = <span class="number">0</span>] = n + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (top &amp;&amp; ht[sa[sta[top]]] &gt; ht[sa[i]])</span><br><span class="line">                --top;</span><br><span class="line">            nxt[i] = sta[top] - i;</span><br><span class="line">            sta[++top] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            ret += pre[i] * nxt[i] * ht[sa[i]];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n0, n1, n2;</span><br><span class="line"><span class="keyword">char</span> s0[MAXN], s1[MAXN], s2[MAXN];</span><br><span class="line">suffix_array sa0, sa1, sa2;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>, s1 + <span class="number">1</span>, s2 + <span class="number">1</span>);</span><br><span class="line">    n1 = <span class="built_in">strlen</span>(s1 + <span class="number">1</span>);</span><br><span class="line">    n2 = <span class="built_in">strlen</span>(s2 + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(s1 + <span class="number">1</span>, s1 + n1 + <span class="number">1</span>, s0 + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(s2 + <span class="number">1</span>, s2 + n2 + <span class="number">1</span>, s0 + n1 + <span class="number">2</span>);</span><br><span class="line">    s0[n1 + <span class="number">1</span>] = <span class="string">&#x27;$&#x27;</span>, n0 = n1 + n2 + <span class="number">1</span>;</span><br><span class="line">    sa0.<span class="built_in">build</span>(s0, n0);</span><br><span class="line">    sa1.<span class="built_in">build</span>(s1, n1);</span><br><span class="line">    sa2.<span class="built_in">build</span>(s2, n2);</span><br><span class="line">    <span class="keyword">int</span> ans = sa0.<span class="built_in">calc</span>() - sa1.<span class="built_in">calc</span>() - sa2.<span class="built_in">calc</span>();</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>[AHOI2013] å·®å¼‚ é¢˜è§£</title>
    <url>/2021/12/17/sol-p4248/</url>
    <content><![CDATA[<h2 id="AHOI2013-å·®å¼‚-é¢˜è§£"><a href="#AHOI2013-å·®å¼‚-é¢˜è§£" class="headerlink" title="[AHOI2013] å·®å¼‚ é¢˜è§£"></a>[AHOI2013] å·®å¼‚ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4248">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä½¿ç”¨åç¼€æ•°ç»„æ±‚å‡º$height$æ•°ç»„ï¼ˆç®€å†™ä¸º$ht$ï¼‰ï¼Œç­”æ¡ˆå˜æˆäº†</p>
<script type="math/tex; mode=display">ans = \sum\limits_{1 \le i \lt j \le n}{len(T_i) + len(T_j) - 2 \times \min\limits_{k=i+1}^{j}{ht_k}}</script><p>åŒ–ç®€ï¼Œå¾—</p>
<script type="math/tex; mode=display">ans = \frac{n \times (n + 1) \times (n - 1)}{2} - 2\times\sum\limits_{1 \le i \lt j \le n}{\min\limits_{k=i+1}^{j}{ht_k}}</script><p>æ±‚å’Œç¬¦å·é‡Œçš„ç”¨å•è°ƒæ ˆç»´æŠ¤ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4248.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4248</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="keyword">using</span> pii = pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">suffix_array</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">radix_sort</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] - <span class="string">&#x27;a&#x27;</span> + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, top;</span><br><span class="line">pii sta[MAXN];</span><br><span class="line"><span class="keyword">char</span> s[MAXN];</span><br><span class="line">suffix_array sa;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">    n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">    sa.<span class="built_in">init</span>(s, n);</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>, sum = <span class="number">0</span>;</span><br><span class="line">    sta[top = <span class="number">1</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> p = sa.sa[i];</span><br><span class="line">        <span class="keyword">while</span> (top &amp;&amp; sta[top].fi &gt;= sa.ht[p])</span><br><span class="line">            sum -= sta[top].fi * (sta[top].se - sta[top - <span class="number">1</span>].se), --top;</span><br><span class="line">        sta[++top] = &#123;sa.ht[p], i&#125;, sum += sta[top].fi * (sta[top].se - sta[top - <span class="number">1</span>].se);</span><br><span class="line">        ans += sum;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = (n * (n + <span class="number">1</span>) * (n - <span class="number">1</span>)) / <span class="number">2</span> - ans * <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4051 [JSOI2007] å­—ç¬¦åŠ å¯† é¢˜è§£</title>
    <url>/2021/12/17/sol-p4051/</url>
    <content><![CDATA[<h2 id="P4051-JSOI2007-å­—ç¬¦åŠ å¯†-é¢˜è§£"><a href="#P4051-JSOI2007-å­—ç¬¦åŠ å¯†-é¢˜è§£" class="headerlink" title="P4051 [JSOI2007] å­—ç¬¦åŠ å¯† é¢˜è§£"></a>P4051 [JSOI2007] å­—ç¬¦åŠ å¯† é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4051">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ˜¾ç„¶ç›´æ¥æ±‚åç¼€æ•°ç»„çæã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4051.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4051</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">suffix_array</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">radix_sort</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">128</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">char</span> s[MAXN];</span><br><span class="line">suffix_array sa;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">    n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        s[i + n] = s[i];</span><br><span class="line">    sa.<span class="built_in">init</span>(s, n + n);</span><br><span class="line">    <span class="keyword">int</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n + n; ++i)</span><br><span class="line">        <span class="keyword">if</span> (sa.sa[i] &lt;= n)</span><br><span class="line">            <span class="built_in">putchar</span>(s[sa.sa[i] + n - <span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2408 ä¸åŒå­ä¸²ä¸ªæ•° é¢˜è§£</title>
    <url>/2021/12/17/sol-p2408/</url>
    <content><![CDATA[<h2 id="P2408-ä¸åŒå­ä¸²ä¸ªæ•°-é¢˜è§£"><a href="#P2408-ä¸åŒå­ä¸²ä¸ªæ•°-é¢˜è§£" class="headerlink" title="P2408 ä¸åŒå­ä¸²ä¸ªæ•° é¢˜è§£"></a>P2408 ä¸åŒå­ä¸²ä¸ªæ•° é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2408">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ ¹æ®<a href="/2021/12/17/top-suffixarray/" title="åç¼€æ•°ç»„">åç¼€æ•°ç»„</a>çš„å®šä¹‰ï¼Œ$ans = \frac{n \times (n + 1)}{2} - \sum\limits_{i=1}^{n}{ht_i}$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2408.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2408</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">suffix_array</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">radix_sort</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] - <span class="string">&#x27;0&#x27;</span> + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">char</span> s[MAXN];</span><br><span class="line">suffix_array sa;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">    sa.<span class="built_in">init</span>(s, n);</span><br><span class="line">    <span class="keyword">int</span> ans = n * (n + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ans -= sa.ht[i];</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>sol-log6184</title>
    <url>/2021/12/17/sol-loj6184/</url>
    <content><![CDATA[<h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><span id="more"></span>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼</title>
    <url>/2021/12/17/top-poly/</url>
    <content><![CDATA[<h2 id="ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼"><a href="#ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼" class="headerlink" title="ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼"></a>ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼</h2><p>ä¸»è¦ä¸º$FFT$ï¼Œ$NTT$ï¼Œå¤šé¡¹å¼æ±‚é€†ç­‰å˜æ¢ï¼Œå¯ä»¥å’Œç”Ÿæˆå‡½æ•°ç»“åˆèµ·æ¥è€ƒè®¡æ•°é¢˜ã€‚<a href="/2021/11/28/sol-p3803/" title="è¿™ç¯‡é¢˜è§£">è¿™ç¯‡é¢˜è§£</a>ä¸­æœ‰å¯¹å¤šé¡¹å¼ä¹˜æ³•çš„è¾ƒè¯¦ç»†è¯æ˜è¿‡ç¨‹ã€‚</p>
<p>å¯¹äºä½¿ç”¨ç”Ÿæˆå‡½æ•°åˆ¤æ–­æ–¹æ¡ˆæ˜¯å¦åˆæ³•ï¼ˆè€Œä¸æ˜¯ç»Ÿè®¡æ–¹æ¡ˆçš„æ•°é‡ï¼‰ï¼Œä½¿ç”¨å•æ¨¡æ•°å®¹æ˜“è¢«å¡ï¼Œå»ºè®®åœ¨$998244353$ï¼Œ$1004535809$å’Œ$469762049$ä¸­é€‰å–ä¸¤ä¸ªï¼Œå…¶åŸæ ¹éƒ½ä¸º$3$ã€‚</p>
<p>è‹¥é¢˜ç›®ä¸­è¦æ±‚å¯¹å¥‡æ€ªçš„æ•°å–æ¨¡ï¼Œä¸€å®šè®°å¾—è®¡ç®—æ¨¡æ•°çš„åŸæ ¹ï¼Œæœ‰å¯èƒ½ä¸æ˜¯$3$ï¼</p>
<span id="more"></span>
<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><a href="/2021/11/28/sol-p3803/" title="P3803 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰">P3803 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰</a> </br>

<a href="/2021/12/05/sol-p4245/" title="P4245 ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•">P4245 ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•</a> </br>

<a href="/2021/12/05/sol-p4721/" title="P4721 ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT é¢˜è§£">P4721 ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT é¢˜è§£</a> </br>

<a href="/2021/12/05/sol-p4238/" title="P4238 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€† é¢˜è§£">P4238 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€† é¢˜è§£</a> </br>

<a href="/2021/12/05/sol-cf632e/" title="CF632E Thief in a Shop é¢˜è§£">CF632E Thief in a Shop é¢˜è§£</a> </br>

<a href="/2022/01/02/sol-cf986d/" title="CF986D Perfect Encoding">CF986D Perfect Encoding</a> </br>

<a href="/2022/01/03/sol-cf1613f/" title="CF1613F Tree Coloring">CF1613F Tree Coloring</a> </br>

<a href="/2022/01/03/sol-cf755g/" title="CF755G PolandBall and Many Other Balls">CF755G PolandBall and Many Other Balls</a> </br>

<a href="/2022/01/05/sol-cf623e/" title="CF623E Transforming Sequence">CF623E Transforming Sequence</a> </br>

<a href="/2022/01/07/sol-cf773f/" title="CF773F Test Data Generation">CF773F Test Data Generation</a> </br>

<a href="/2022/01/09/sol-cf553e/" title="CF553E Kyoya and Train">CF553E Kyoya and Train</a>
<h3 id="æ¨¡ç‰ˆä»£ç "><a href="#æ¨¡ç‰ˆä»£ç " class="headerlink" title="æ¨¡ç‰ˆä»£ç "></a>æ¨¡ç‰ˆä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">double</span> MPI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="comment">// const int MOD = 1004535809; // å¤‡ç”¨</span></span><br><span class="line"><span class="comment">// const int MOD = 469762049; // å¤‡ç”¨</span></span><br><span class="line"><span class="keyword">using</span> comp = std::complex&lt;<span class="keyword">double</span>&gt;;</span><br><span class="line"><span class="keyword">int</span> rev[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(comp *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fft</span><span class="params">(comp *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * MPI / h), sin(<span class="number">2</span> * MPI / h))</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                f[k] = u + t;</span><br><span class="line">                f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                w = w * wn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i].<span class="built_in">real</span>(f[i].<span class="built_in">real</span>() / len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ntt</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                <span class="keyword">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                g = g * gn % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] = f[i] * inv % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ä¸“é¢˜</category>
      </categories>
      <tags>
        <tag>topics</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä¸“é¢˜ã€‘è™šæ ‘</title>
    <url>/2021/12/17/top-virtualtree/</url>
    <content><![CDATA[<h2 id="ã€ä¸“é¢˜ã€‘è™šæ ‘"><a href="#ã€ä¸“é¢˜ã€‘è™šæ ‘" class="headerlink" title="ã€ä¸“é¢˜ã€‘è™šæ ‘"></a>ã€ä¸“é¢˜ã€‘è™šæ ‘</h2><p>è¿™ç§ä¸œè¥¿æƒ³åˆ°è¦ç”¨å¾ˆå®¹æ˜“ï¼Œå…³é”®æ˜¯å»ºå®Œè™šæ ‘åæ€ä¹ˆåšã€‚</p>
<p>è™šæ ‘é¢˜çš„ç‰¹å¾ä¸º<strong>å¤šæ¬¡è¯¢é—®ä¸”å‡ºç°$\sum M \le 10^5$ä¸€ç±»çš„æ•°æ®èŒƒå›´</strong>ã€‚</p>
<p>å¦‚æœé¢˜ç›®ç»™å‡ºçš„æ˜¯ä¸€å¼ å›¾è€Œä¸æ˜¯ä¸€æ£µæ ‘ï¼Œå¯ä»¥æ€è€ƒæ˜¯å¦èƒ½å¤Ÿç»“åˆåœ†æ–¹æ ‘ç­‰ç®—æ³•è½¬åŒ–ä¸ºè™šæ ‘ã€‚</p>
<p>å¯¹äºæ¯æ¬¡è¯¢é—®ï¼Œå°†è¯¢é—®çš„èŠ‚ç‚¹å’Œå…¶åœ¨åŸæ ‘ä¸Šçš„$LCA$å•ç‹¬å»ºå‡ºæ¥$dp$å³å¯ã€‚</p>
<span id="more"></span>
<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><a href="/2021/11/27/sol-p2495/" title="P2495 æ¶ˆè€—æˆ˜ é¢˜è§£">P2495 æ¶ˆè€—æˆ˜ é¢˜è§£</a> </br>

<a href="/2021/11/29/sol-p4606/" title="P4606 æˆ˜ç•¥æ¸¸æˆ é¢˜è§£">P4606 æˆ˜ç•¥æ¸¸æˆ é¢˜è§£</a> </br>

<a href="/2021/11/27/sol-p3233/" title="P3233 ä¸–ç•Œæ ‘ é¢˜è§£">P3233 ä¸–ç•Œæ ‘ é¢˜è§£</a> </br>

<a href="/2021/12/01/sol-cf1320e/" title="CF1320E Treeland and Viruses é¢˜è§£">CF1320E Treeland and Viruses é¢˜è§£</a> </br>

<a href="/2021/12/03/sol-cf639f/" title="CF639F Bear and Chemistry é¢˜è§£">CF639F Bear and Chemistry é¢˜è§£</a> </br>

<a href="/2021/12/17/sol-loj6184/" title="sol-log6184">sol-log6184</a>
<h3 id="æ¨¡ç‰ˆä»£ç "><a href="#æ¨¡ç‰ˆä»£ç " class="headerlink" title="æ¨¡ç‰ˆä»£ç "></a>æ¨¡ç‰ˆä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_vtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(s + <span class="number">1</span>, s + k + <span class="number">1</span>, [](<span class="keyword">int</span> x, <span class="keyword">int</span> y) &#123;</span><br><span class="line">        <span class="keyword">return</span> id[x] &lt; id[y];</span><br><span class="line">    &#125;);</span><br><span class="line">    sta[top = <span class="number">1</span>] = <span class="number">1</span>, vtr.head[<span class="number">1</span>] = <span class="number">-1</span>, vtr.tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="built_in">lca</span>(sta[top], s[i]);</span><br><span class="line">        <span class="keyword">if</span> (l &lt; <span class="number">1</span> || l &gt; bcc)</span><br><span class="line">            <span class="built_in">lca</span>(sta[top], s[i]);</span><br><span class="line">        <span class="keyword">while</span> (id[l] &lt;= id[sta[top - <span class="number">1</span>]])</span><br><span class="line">            <span class="built_in">add_vedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="keyword">if</span> (sta[top] != l)</span><br><span class="line">            vtr.head[l] = <span class="number">-1</span>, <span class="built_in">add_vedge</span>(l, sta[top]), sta[top] = l;</span><br><span class="line">        vtr.head[s[i]] = <span class="number">-1</span>, sta[++top] = s[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">add_vedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ä¸“é¢˜</category>
      </categories>
      <tags>
        <tag>topics</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ</title>
    <url>/2021/12/17/top-networkflow/</url>
    <content><![CDATA[<h2 id="ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ"><a href="#ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ" class="headerlink" title="ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ"></a>ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ</h2><p>ç½‘ç»œæµçš„è¯ï¼Œå…ˆå£ç³Šå¥½æ€ä¹ˆå»ºå›¾ï¼Œç„¶å<del>å¤åˆ¶</del>é»˜å†™ä¸€ä¸‹æ¿å­å°±å¥½äº†ã€‚</p>
<p>éš¾ç‚¹å…¶å®æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å¦‚ä½•å»ºå›¾ï¼Œå¦ä¸€ä¸ªæ˜¯è¾“å‡ºè·¯å¾„ã€‚</p>
<p>å¦‚æœä¸€é“é¢˜æœ‰è®¸å¤šå¥‡æ€ªçš„é™åˆ¶ï¼Œå¹¶ä¸”$n$å’Œ$m$å¾ˆå°ï¼Œå¯¼è‡´$O(n^2m)$å¯ä»¥é€šè¿‡ï¼Œå°±å¯ä»¥å¾€ç½‘ç»œæµæ–¹é¢å»æƒ³ã€‚</p>
<p><del>å…¶å®ç½‘ç»œæµ24é¢˜çš„å…¨ç§°å«ç½‘ç»œæµå’Œçº¿æ€§è§„åˆ’24é¢˜ï¼Ÿ</del></p>
<span id="more"></span>
<h3 id="è´¹ç”¨æµéœ€è¦æ³¨æ„çš„åœ°æ–¹"><a href="#è´¹ç”¨æµéœ€è¦æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="è´¹ç”¨æµéœ€è¦æ³¨æ„çš„åœ°æ–¹"></a>è´¹ç”¨æµéœ€è¦æ³¨æ„çš„åœ°æ–¹</h3><ol>
<li>è´¹ç”¨æµå»ºåè¾¹çš„$cost$æ˜¯åŸæ¥çš„$cost$çš„<strong>ç›¸åæ•°</strong>ï¼Œå³éœ€è¦<code>add(u, v, c, f), add(v, u, -c, 0);</code></li>
<li>è®¡ç®—æµé‡çš„æ–¹å¼å’Œæ™®é€šç½‘ç»œæµç›¸åŒï¼Œä½†æ˜¯è®¡ç®—æ€»$cost$æ˜¯æ¯æ¬¡åŠ ä¸Š<code>edge.cost * flow</code>ï¼Œ<strong>ä¸è¦å¿˜è®°ä¹˜ä¸Š$cost$</strong>ï¼Œç”¨å…¨å±€å˜é‡å­˜$cost$ä¼šå¥½å†™ä¸€äº›ã€‚</li>
<li>ç”±äºè´¹ç”¨æµçš„è¾¹æƒå¯èƒ½$\le 0$ï¼Œæ‰€ä»¥<strong>å¿…é¡»</strong>ç”¨$spfa$è€Œæ— æ³•ä½¿ç”¨$dijkstra$ï¼Œå¹¶ä¸”$dfs$<strong>å¢å¹¿æ—¶å¿…é¡»å¼€$vis$æ•°ç»„é˜²æ­¢æ— é™é€’å½’</strong>ã€‚</li>
<li>ï¼ˆè¿™åº”è¯¥ç®—æ˜¯ä¸ªå°$tip$ï¼‰ç½‘ç»œæµ$tot$ä¸€å¼€å§‹æ¸…ç©ºæˆ$1$å¯ä»¥ä¸éœ€è¦å†è°ƒç”¨<code>init</code>å‡½æ•°ï¼Œä¹Ÿä¸éœ€è¦å†æŠŠ$head$æ¸…ç©ºæˆ$-1$ã€‚</li>
</ol>
<h3 id="æµæ¨¡å‹"><a href="#æµæ¨¡å‹" class="headerlink" title="æµæ¨¡å‹"></a>æµæ¨¡å‹</h3><a href="/2021/12/20/sol-p2756/" title="P2756 é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜">P2756 é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜</a> </br>

<a href="/2021/12/21/sol-p4016/" title="P4016 è´Ÿè½½å¹³è¡¡é—®é¢˜">P4016 è´Ÿè½½å¹³è¡¡é—®é¢˜</a> </br>

<a href="/2021/12/22/sol-p1251/" title="P1251 é¤å·¾è®¡åˆ’é—®é¢˜">P1251 é¤å·¾è®¡åˆ’é—®é¢˜</a> </br>

<a href="/2021/12/22/sol-p2754/" title="P2754 æ˜Ÿé™…è½¬ç§»é—®é¢˜">P2754 æ˜Ÿé™…è½¬ç§»é—®é¢˜</a> </br>

<a href="/2021/12/23/sol-p2763/" title="P2763 è¯•é¢˜åº“é—®é¢˜">P2763 è¯•é¢˜åº“é—®é¢˜</a> </br>

<a href="/2021/12/24/sol-p2764/" title="P2764 æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜">P2764 æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜</a> </br>

<a href="/2021/12/24/sol-p2765/" title="P2765 é­”æœ¯çƒé—®é¢˜">P2765 é­”æœ¯çƒé—®é¢˜</a> </br>

<a href="/2021/12/24/sol-p2766/" title="P2766 æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜">P2766 æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜</a> </br>

<a href="/2021/12/24/sol-p2770/" title="P2770 èˆªç©ºè·¯çº¿é—®é¢˜">P2770 èˆªç©ºè·¯çº¿é—®é¢˜</a> </br>

<a href="/2021/12/25/sol-p3254/" title="P3254 åœ†æ¡Œé—®é¢˜">P3254 åœ†æ¡Œé—®é¢˜</a> </br>

<a href="/2021/12/27/sol-p3356/" title="P3356 ç«æ˜Ÿæ¢é™©é—®é¢˜">P3356 ç«æ˜Ÿæ¢é™©é—®é¢˜</a> </br>

<a href="/2021/12/27/sol-p3357/" title="P3357 æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜">P3357 æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜</a> </br>

<a href="/2021/12/27/sol-p3358/" title="P3358 æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜">P3358 æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜</a> </br>

<a href="/2021/12/30/sol-p4012/" title="P4012 æ·±æµ·æœºå™¨äººé—®é¢˜">P4012 æ·±æµ·æœºå™¨äººé—®é¢˜</a> </br>

<a href="/2021/12/30/sol-p4013/" title="P4013 æ•°å­—æ¢¯å½¢é—®é¢˜">P4013 æ•°å­—æ¢¯å½¢é—®é¢˜</a> </br>

<a href="/2021/12/30/sol-p4014/" title="P4014 åˆ†é…é—®é¢˜">P4014 åˆ†é…é—®é¢˜</a> </br>

<a href="/2021/12/30/sol-p4015/" title="P4015 è¿è¾“é—®é¢˜">P4015 è¿è¾“é—®é¢˜</a>
<h3 id="å‰²æ¨¡å‹"><a href="#å‰²æ¨¡å‹" class="headerlink" title="å‰²æ¨¡å‹"></a>å‰²æ¨¡å‹</h3><a href="/2021/12/22/sol-p2762/" title="P2762 å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜">P2762 å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜</a> </br>

<a href="/2021/12/25/sol-p2774/" title="P2774 æ–¹æ ¼å–æ•°é—®é¢˜">P2774 æ–¹æ ¼å–æ•°é—®é¢˜</a> </br>

<a href="/2021/12/25/sol-p3355/" title="P3355 éª‘å£«å…±å­˜é—®é¢˜">P3355 éª‘å£«å…±å­˜é—®é¢˜</a>
<h3 id="éæ¨¡å‹"><a href="#éæ¨¡å‹" class="headerlink" title="éæ¨¡å‹"></a>éæ¨¡å‹</h3><a href="/2021/12/20/sol-p2761/" title="P276 è½¯ä»¶è¡¥ä¸é—®é¢˜">P276 è½¯ä»¶è¡¥ä¸é—®é¢˜</a> </br>

<a href="/2021/12/21/sol-p4011/" title="P4011 å­¤å²›è¥æ•‘é—®é¢˜">P4011 å­¤å²›è¥æ•‘é—®é¢˜</a> </br>

<a href="/2021/12/31/sol-p4009/" title="P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜">P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜</a>
<h3 id="æ¨¡ç‰ˆä»£ç "><a href="#æ¨¡ç‰ˆä»£ç " class="headerlink" title="æ¨¡ç‰ˆä»£ç "></a>æ¨¡ç‰ˆä»£ç </h3><h4 id="ç½‘ç»œæµ-dinic"><a href="#ç½‘ç»œæµ-dinic" class="headerlink" title="ç½‘ç»œæµ(dinic)"></a>ç½‘ç»œæµ(dinic)</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dinic</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(lev, lev + MAXN, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxflow</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXN, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="æœ€å°è´¹ç”¨æœ€å¤§æµ-dinic"><a href="#æœ€å°è´¹ç”¨æœ€å¤§æµ-dinic" class="headerlink" title="æœ€å°è´¹ç”¨æœ€å¤§æµ(dinic)"></a>æœ€å°è´¹ç”¨æœ€å¤§æµ(dinic)</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">const</span> <span class="keyword">int</span> MAXV, <span class="keyword">const</span> <span class="keyword">int</span> MAXE&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MCMF</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="keyword">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="keyword">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> flow, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, INF);</span><br><span class="line">        queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">augment</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> t, <span class="keyword">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ä¸“é¢˜</category>
      </categories>
      <tags>
        <tag>topics</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„ SA</title>
    <url>/2021/12/17/top-suffixarray/</url>
    <content><![CDATA[<h2 id="ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„-SA"><a href="#ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„-SA" class="headerlink" title="ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„ SA"></a>ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„ SA</h2><p><del>è™½ç„¶æœ‰ä¸å°‘æ­¤ç±»é¢˜ç›®å¯ä»¥ç”¨å­—ç¬¦ä¸²hashçæ</del></p>
<p>è®°ä½ä»£ç ä¸­æ¯ä¸ªæ•°ç»„çš„å«ä¹‰ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">æ•°ç»„</th>
<th style="text-align:center">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$sa_i$</td>
<td style="text-align:center">æ’åä¸º$i$çš„åç¼€çš„èµ·å§‹ä½ç½®</td>
</tr>
<tr>
<td style="text-align:center">$rk_i$</td>
<td style="text-align:center">åç¼€$s_{i \cdots n}$çš„æ’å</td>
</tr>
<tr>
<td style="text-align:center">$tp_i$</td>
<td style="text-align:center">ä¸´æ—¶æ•°ç»„ï¼Œç”¨æ¥åœ¨åŸºæ•°æ’åºä¸­è®°å½•ä¸´æ—¶æ’å</td>
</tr>
<tr>
<td style="text-align:center">$ht_i$</td>
<td style="text-align:center">ç¬¬$rk_i$ä¸ªåç¼€å’Œç¬¬$rk_{i-1}$ä¸ªåç¼€çš„$LCP$</td>
</tr>
</tbody>
</table>
</div>
<span id="more"></span>
<h3 id="ä¸€äº›æ€§è´¨"><a href="#ä¸€äº›æ€§è´¨" class="headerlink" title="ä¸€äº›æ€§è´¨"></a>ä¸€äº›æ€§è´¨</h3><h4 id="å¯é‡å æœ€é•¿é‡å¤å­ä¸²"><a href="#å¯é‡å æœ€é•¿é‡å¤å­ä¸²" class="headerlink" title="å¯é‡å æœ€é•¿é‡å¤å­ä¸²"></a>å¯é‡å æœ€é•¿é‡å¤å­ä¸²</h4><p>å³$ht$æ•°ç»„çš„æœ€å¤§å€¼ã€‚</p>
<h4 id="ä¸åŒå­ä¸²ä¸ªæ•°"><a href="#ä¸åŒå­ä¸²ä¸ªæ•°" class="headerlink" title="ä¸åŒå­ä¸²ä¸ªæ•°"></a>ä¸åŒå­ä¸²ä¸ªæ•°</h4><p>å³$\frac{n \times (n + 1)}{2} - \sum\limits_{i=1}^{n}{ht_i}$ï¼ˆæ˜“è¯ï¼‰ã€‚</p>
<h4 id="ä»»æ„ä¸¤ä¸ªåç¼€çš„-LCP"><a href="#ä»»æ„ä¸¤ä¸ªåç¼€çš„-LCP" class="headerlink" title="ä»»æ„ä¸¤ä¸ªåç¼€çš„$LCP$"></a>ä»»æ„ä¸¤ä¸ªåç¼€çš„$LCP$</h4><p>è®¾åˆ†åˆ«ä¸ºåç¼€$s_{i \cdots n}$å’Œ$s_{j \cdots n}$ï¼Œå…¶ä¸­$i \lt j$ï¼Œ$LCP = \min\limits_{k=i+1}^{j}{ht_k}$ï¼Œç”¨$RMQ$è§£å†³ã€‚</p>
<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><a href="/2021/12/17/sol-p2408/" title="P2408 ä¸åŒå­ä¸²ä¸ªæ•° é¢˜è§£">P2408 ä¸åŒå­ä¸²ä¸ªæ•° é¢˜è§£</a> </br>

<a href="/2021/12/17/sol-p4051/" title="P4051 [JSOI2007] å­—ç¬¦åŠ å¯† é¢˜è§£">P4051 [JSOI2007] å­—ç¬¦åŠ å¯† é¢˜è§£</a> </br>

<a href="/2021/12/17/sol-p4248/" title="[AHOI2013] å·®å¼‚ é¢˜è§£">[AHOI2013] å·®å¼‚ é¢˜è§£</a> </br>

<a href="/2021/12/19/sol-p3181/" title="P3181 [HAOI2016] æ‰¾ç›¸åŒå­—ç¬¦ä¸²">P3181 [HAOI2016] æ‰¾ç›¸åŒå­—ç¬¦ä¸²</a>
<h3 id="æ¨¡ç‰ˆä»£ç "><a href="#æ¨¡ç‰ˆä»£ç " class="headerlink" title="æ¨¡ç‰ˆä»£ç "></a>æ¨¡ç‰ˆä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">suffix_array</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">radix_sort</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] - <span class="string">&#x27;0&#x27;</span> + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ä¸“é¢˜</category>
      </categories>
      <tags>
        <tag>topics</tag>
      </tags>
  </entry>
  <entry>
    <title>P3809 ã€æ¨¡ç‰ˆã€‘åç¼€æ’åº é¢˜è§£</title>
    <url>/2021/12/16/sol-p3809/</url>
    <content><![CDATA[<h2 id="P3809-ã€æ¨¡ç‰ˆã€‘åç¼€æ’åº-é¢˜è§£"><a href="#P3809-ã€æ¨¡ç‰ˆã€‘åç¼€æ’åº-é¢˜è§£" class="headerlink" title="P3809 ã€æ¨¡ç‰ˆã€‘åç¼€æ’åº é¢˜è§£"></a>P3809 ã€æ¨¡ç‰ˆã€‘åç¼€æ’åº é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3809">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ¨¡ç‰ˆé¢˜ä¸å¤šè¯´</p>
<p>è®°ä½ä»£ç ä¸­æ¯ä¸ªæ•°ç»„çš„å«ä¹‰ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">æ•°ç»„</th>
<th style="text-align:center">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$sa_i$</td>
<td style="text-align:center">æ’åä¸º$i$çš„åç¼€çš„èµ·å§‹ä½ç½®</td>
</tr>
<tr>
<td style="text-align:center">$rk_i$</td>
<td style="text-align:center">åç¼€$s_{i \cdots n}$çš„æ’å</td>
</tr>
<tr>
<td style="text-align:center">$tp_i$</td>
<td style="text-align:center">ä¸´æ—¶æ•°ç»„ï¼Œç”¨æ¥åœ¨åŸºæ•°æ’åºä¸­è®°å½•ä¸´æ—¶æ’å</td>
</tr>
<tr>
<td style="text-align:center">$ht_i$</td>
<td style="text-align:center">ç¬¬$rk_i$ä¸ªåç¼€å’Œç¬¬$rk_{i-1}$ä¸ªåç¼€çš„$LCP$</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">suffix_array</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">radix_sort</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] - <span class="string">&#x27;0&#x27;</span> + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3809.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3809</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">suffix_array</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">radix_sort</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] - <span class="string">&#x27;0&#x27;</span> + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">char</span> s[MAXN];</span><br><span class="line">suffix_array sa;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">    n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">    sa.<span class="built_in">init</span>(s, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(sa.sa[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2056 [ZJOI2007] æ‰è¿·è— é¢˜è§£</title>
    <url>/2021/12/15/sol-p2056/</url>
    <content><![CDATA[<h2 id="P2056-ZJOI2007-æ‰è¿·è—-é¢˜è§£"><a href="#P2056-ZJOI2007-æ‰è¿·è—-é¢˜è§£" class="headerlink" title="P2056 [ZJOI2007] æ‰è¿·è— é¢˜è§£"></a>P2056 [ZJOI2007] æ‰è¿·è— é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2056">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æƒ³åˆ°æ˜¯ç‚¹åˆ†æ ‘å°±æ¯”è¾ƒå¥½åšäº†ã€‚</p>
<p>çœ‹åˆ°æ ‘ä¸Šè·¯å¾„æƒ³åˆ°$LCA$æˆ–ç‚¹åˆ†æ ‘ã€‚å…ˆè€ƒè™‘å•æ¬¡æŸ¥è¯¢çš„ç‚¹åˆ†æ²»åšæ³•ï¼Œ$dp1_u$è¡¨ç¤º$u$ä¸ºé‡å¿ƒçš„å—ä¸­åˆ°$fa_u$çš„æœ€é•¿è·ç¦»ï¼Œ$dp0_u$è¡¨ç¤º$u$ä¸ºé‡å¿ƒçš„å—ä¸­ç»è¿‡$u$çš„æœ€é•¿è·¯å¾„ï¼Œæ˜¾ç„¶$dp0_u$ä¸ºæ¯ä¸ªå„¿å­$v$çš„$dp1_v$æœ€å¤§å€¼ä¸æ¬¡å¤§å€¼ä¹‹å’Œã€‚</p>
<p>å°†æ­¤æ–¹æ³•æ‹“å±•åˆ°ç‚¹åˆ†æ ‘ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸¤ä¸ªå¯åˆ å †ï¼Œåˆ†åˆ«å°±è¡¨ç¤º$dp0_u$å’Œ$dp1_u$çš„å€¼ï¼Œæœ€åç»Ÿè®¡åˆ°ç­”æ¡ˆä¸­ã€‚</p>
<p>ç©ºé—´å¤æ‚åº¦$O(n \log n)$ï¼Œæ—¶é—´å¤æ‚åº¦$O(n \log^2 n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2056.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LOGN = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">heap</span> &#123;</span></span><br><span class="line">    priority_queue&lt;<span class="keyword">int</span>&gt; q, p;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        q.<span class="built_in">push</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        p.<span class="built_in">push</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (p.<span class="built_in">size</span>() &amp;&amp; q.<span class="built_in">size</span>() &amp;&amp; p.<span class="built_in">top</span>() == q.<span class="built_in">top</span>())</span><br><span class="line">            p.<span class="built_in">pop</span>(), q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> q.<span class="built_in">top</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (p.<span class="built_in">size</span>() &amp;&amp; q.<span class="built_in">size</span>() &amp;&amp; p.<span class="built_in">top</span>() == q.<span class="built_in">top</span>())</span><br><span class="line">            p.<span class="built_in">pop</span>(), q.<span class="built_in">pop</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> q.<span class="built_in">size</span>() - p.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sectop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> t = <span class="built_in">top</span>();</span><br><span class="line">        <span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">int</span> r = <span class="built_in">top</span>();</span><br><span class="line">        <span class="built_in">push</span>(t);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, q, fa[MAXN], dep[MAXN], fq[MAXN][LOGN];</span><br><span class="line"><span class="keyword">int</span> scnt, siz[MAXN], mxsiz[MAXN];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN], opn[MAXN];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; g[MAXN];</span><br><span class="line">heap shp, hp[MAXN][<span class="number">2</span>];</span><br><span class="line"><span class="keyword">char</span> buf[<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getroot</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f, <span class="keyword">int</span> sz)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    siz[u] = <span class="number">1</span>, mxsiz[u] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f || vis[v])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> tmp = <span class="built_in">getroot</span>(v, u, sz);</span><br><span class="line">        <span class="keyword">if</span> (mxsiz[tmp] &lt; mxsiz[ret])</span><br><span class="line">            ret = tmp;</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        mxsiz[u] = <span class="built_in">max</span>(mxsiz[u], siz[v]);</span><br><span class="line">    &#125;</span><br><span class="line">    mxsiz[u] = <span class="built_in">max</span>(mxsiz[u], sz - siz[u]);</span><br><span class="line">    <span class="keyword">if</span> (mxsiz[u] &lt; mxsiz[ret])</span><br><span class="line">        ret = u;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    fq[u][<span class="number">0</span>] = f, dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fq[u][i] = fq[fq[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u])</span><br><span class="line">        <span class="keyword">if</span> (v != f)</span><br><span class="line">            <span class="built_in">build1</span>(v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f, <span class="keyword">int</span> sz)</span> </span>&#123;</span><br><span class="line">    vis[u] = <span class="literal">true</span>, fa[u] = f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f || vis[v])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> ns = (siz[u] &gt; siz[v]) ? siz[v] : sz - siz[u];</span><br><span class="line">        <span class="keyword">int</span> rt = <span class="built_in">getroot</span>(v, u, ns);</span><br><span class="line">        <span class="built_in">build2</span>(rt, u, ns);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="keyword">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fq[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fq[u][i] != fq[v][i])</span><br><span class="line">            u = fq[u][i], v = fq[v][i];</span><br><span class="line">    <span class="keyword">return</span> fq[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dist</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dep[u] + dep[v] - (dep[<span class="built_in">lca</span>(u, v)] &lt;&lt; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (hp[x][<span class="number">0</span>].<span class="built_in">size</span>() &gt;= <span class="number">2</span>)</span><br><span class="line">        shp.<span class="built_in">erase</span>(hp[x][<span class="number">0</span>].<span class="built_in">top</span>() + hp[x][<span class="number">0</span>].<span class="built_in">sectop</span>());</span><br><span class="line">    <span class="keyword">if</span> (opn[x])</span><br><span class="line">        hp[x][<span class="number">0</span>].<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        hp[x][<span class="number">0</span>].<span class="built_in">erase</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (hp[x][<span class="number">0</span>].<span class="built_in">size</span>() &gt;= <span class="number">2</span>)</span><br><span class="line">        shp.<span class="built_in">push</span>(hp[x][<span class="number">0</span>].<span class="built_in">top</span>() + hp[x][<span class="number">0</span>].<span class="built_in">sectop</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u = x; fa[u]; u = fa[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hp[fa[u]][<span class="number">0</span>].<span class="built_in">size</span>() &gt;= <span class="number">2</span>)</span><br><span class="line">            shp.<span class="built_in">erase</span>(hp[fa[u]][<span class="number">0</span>].<span class="built_in">top</span>() + hp[fa[u]][<span class="number">0</span>].<span class="built_in">sectop</span>());</span><br><span class="line">        <span class="keyword">if</span> (hp[u][<span class="number">1</span>].<span class="built_in">size</span>())</span><br><span class="line">            hp[fa[u]][<span class="number">0</span>].<span class="built_in">erase</span>(hp[u][<span class="number">1</span>].<span class="built_in">top</span>());</span><br><span class="line">        <span class="keyword">if</span> (opn[x])</span><br><span class="line">            hp[u][<span class="number">1</span>].<span class="built_in">push</span>(<span class="built_in">dist</span>(fa[u], x));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            hp[u][<span class="number">1</span>].<span class="built_in">erase</span>(<span class="built_in">dist</span>(fa[u], x));</span><br><span class="line">        <span class="keyword">if</span> (hp[u][<span class="number">1</span>].<span class="built_in">size</span>())</span><br><span class="line">            hp[fa[u]][<span class="number">0</span>].<span class="built_in">push</span>(hp[u][<span class="number">1</span>].<span class="built_in">top</span>());</span><br><span class="line">        <span class="keyword">if</span> (hp[fa[u]][<span class="number">0</span>].<span class="built_in">size</span>() &gt;= <span class="number">2</span>)</span><br><span class="line">            shp.<span class="built_in">push</span>(hp[fa[u]][<span class="number">0</span>].<span class="built_in">top</span>() + hp[fa[u]][<span class="number">0</span>].<span class="built_in">sectop</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> shp.<span class="built_in">size</span>() ? shp.<span class="built_in">top</span>() : (scnt ? <span class="number">0</span> : <span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g[u].<span class="built_in">emplace_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">emplace_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    mxsiz[<span class="number">0</span>] = INF;</span><br><span class="line">    <span class="built_in">build1</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">build2</span>(<span class="built_in">getroot</span>(<span class="number">1</span>, <span class="number">0</span>, n), <span class="number">0</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        opn[i] = <span class="literal">true</span>, <span class="built_in">update</span>(i), ++scnt;</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">if</span> (buf[<span class="number">0</span>] == <span class="string">&#x27;G&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">write</span>(<span class="built_in">query</span>()), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> x;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            opn[x] ? --scnt : ++scnt;</span><br><span class="line">            opn[x] = !opn[x];</span><br><span class="line">            <span class="built_in">update</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€äº›æœ‰è¶£çš„äº‹æƒ…</title>
    <url>/2021/12/13/interesting/</url>
    <content><![CDATA[<h2 id="ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼ˆå¯ä»¥è®©è¿™ä¸ªåšå®¢å……æ»¡æ´»è·ƒçš„æ°”æ°›ï¼‰"><a href="#ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼ˆå¯ä»¥è®©è¿™ä¸ªåšå®¢å……æ»¡æ´»è·ƒçš„æ°”æ°›ï¼‰" class="headerlink" title="ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼ˆå¯ä»¥è®©è¿™ä¸ªåšå®¢å……æ»¡æ´»è·ƒçš„æ°”æ°›ï¼‰"></a>ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼ˆå¯ä»¥è®©è¿™ä¸ªåšå®¢<del>å……æ»¡</del>æ´»è·ƒ<del>çš„æ°”æ°›</del>ï¼‰</h2><span id="more"></span>
<h3 id="2021-12-13"><a href="#2021-12-13" class="headerlink" title="2021.12.13"></a>2021.12.13</h3><p>ä¸Šå‘¨å…­æ‰å–è¿‡ $H_2CO_3$ï¼ˆæŒ‡å¯ä¹ï¼‰å¹¶ä¸”è¢«æŸå·¨ä½¬æé†’ $H_2O+CO_2=H_2CO_3$ </p>
<p>äºæ˜¯åŒ–å­¦è€ƒè¯•<strong>çŒœ</strong>å‡º $C$ å’Œ $CuO$ ï¼Œ<strong>çŒœ</strong>å‡º $H_2CO_3 $ï¼Œ<strong>çŒœ</strong>å‡º $CO_2$ å’Œ $H_2O$ çš„ä½ç½®ï¼Œ<strong>çŒœ</strong>å‡ºå’Œ $Fe_2O_3$ ååº”çš„æ˜¯ $H_2$ å¹¶ä¸”<strong>çŒœ</strong>å¯¹äº†æˆ‘ç‹¬ç«‹åšå‡ºæ¥çš„ç¬¬ä¸€é“ç‰©è´¨æ¨æ–­é¢˜ï¼ˆçœŸå°±å…¨æ˜¯çŒœå¯¹çš„ï¼‰</p>
<p>æ‰€ä»¥è¯´å‘¨å…­é›†è®­ä¸€å®šè¦ä¹°å¯ä¹ã€‚<del>å¯ä»¥è®©ä½ åŒ–å­¦è€ƒè¯•åŠ åˆ†</del></p>
]]></content>
  </entry>
  <entry>
    <title>P6329 ã€æ¨¡ç‰ˆã€‘ç‚¹åˆ†æ ‘ï½œéœ‡æ³¢</title>
    <url>/2021/12/10/sol-p6329/</url>
    <content><![CDATA[<h2 id="P6329-ã€æ¨¡ç‰ˆã€‘ç‚¹åˆ†æ ‘ï½œéœ‡æ³¢"><a href="#P6329-ã€æ¨¡ç‰ˆã€‘ç‚¹åˆ†æ ‘ï½œéœ‡æ³¢" class="headerlink" title="P6329 ã€æ¨¡ç‰ˆã€‘ç‚¹åˆ†æ ‘ï½œéœ‡æ³¢"></a>P6329 ã€æ¨¡ç‰ˆã€‘ç‚¹åˆ†æ ‘ï½œéœ‡æ³¢</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P6329">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p><del>é¢˜ç›®é‡Œéƒ½è¯´äº†æ˜¯ç‚¹åˆ†æ ‘</del></p>
<p>å‘ç°è‡ªå·±å­¦è¿‡çš„ç‚¹åˆ†æ ‘ç°åœ¨å·²ç»ä¸ä¼šå†™äº†ï¼Œ<strong>æ”¹å¤©</strong>æ¥è¡¥ä¸ªç‚¹åˆ†æ ‘çš„é¢˜è§£å§ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P6329.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P6329</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LOGN = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">binary_indexed_tree</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; c;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ##sb-mistakes## å¼€`vector`å½“åŠ¨æ€å¼€ç‚¹æ ‘çŠ¶æ•°ç»„`resize`æ—¶æ²¡æœ‰$+1$</span></span><br><span class="line">        <span class="comment">// c.resize(n = m);</span></span><br><span class="line">        c.<span class="built_in">resize</span>((n = m) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= n; i += (i &amp; -i))</span><br><span class="line">            c[i] += v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        x = <span class="built_in">min</span>(x, n);</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = x; i; i -= (i &amp; -i))</span><br><span class="line">            ret += c[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, q, a[MAXN], fa[MAXN], dep[MAXN], fq[MAXN][LOGN];</span><br><span class="line"><span class="keyword">int</span> cur[MAXN], siz[MAXN], mxsiz[MAXN];</span><br><span class="line">bitset&lt;MAXN&gt; vis;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; g[MAXN];</span><br><span class="line">binary_indexed_tree bit[MAXN][<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getroot</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f, <span class="keyword">int</span> sz)</span> </span>&#123;</span><br><span class="line">    siz[u] = <span class="number">1</span>;</span><br><span class="line">    mxsiz[u] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f || vis[v])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> tmp = <span class="built_in">getroot</span>(v, u, sz);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        mxsiz[u] = <span class="built_in">max</span>(mxsiz[u], siz[v]);</span><br><span class="line">        <span class="keyword">if</span> (mxsiz[tmp] &lt; mxsiz[ret])</span><br><span class="line">            ret = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    mxsiz[u] = <span class="built_in">max</span>(mxsiz[u], sz - siz[u]);</span><br><span class="line">    <span class="keyword">if</span> (mxsiz[u] &lt; mxsiz[ret])</span><br><span class="line">        ret = u;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f, <span class="keyword">int</span> sz)</span> </span>&#123;</span><br><span class="line">    fa[u] = f, vis[u] = <span class="literal">true</span>;</span><br><span class="line">    bit[u][<span class="number">0</span>].<span class="built_in">init</span>(sz + <span class="number">2</span>);</span><br><span class="line">    bit[u][<span class="number">1</span>].<span class="built_in">init</span>(sz + <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (vis[v])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> nsz = (siz[u] &gt; siz[v]) ? siz[v] : (sz - siz[u]);</span><br><span class="line">        <span class="keyword">int</span> nrt = <span class="built_in">getroot</span>(v, <span class="number">0</span>, nsz);</span><br><span class="line">        <span class="built_in">build1</span>(nrt, u, nsz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    fq[u][<span class="number">0</span>] = f, dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fq[u][i] = fq[fq[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u])</span><br><span class="line">        <span class="keyword">if</span> (v != f)</span><br><span class="line">            <span class="built_in">build2</span>(v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="keyword">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fq[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fq[u][i] != fq[v][i])</span><br><span class="line">            u = fq[u][i], v = fq[v][i];</span><br><span class="line">    <span class="keyword">return</span> fq[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getdis</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = <span class="built_in">lca</span>(x, y);</span><br><span class="line">    <span class="keyword">return</span> dep[x] + dep[y] - <span class="number">2</span> * dep[l];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u = x; u; u = fa[u]) &#123;</span><br><span class="line">        bit[u][<span class="number">0</span>].<span class="built_in">add</span>(<span class="built_in">getdis</span>(u, x) + <span class="number">1</span>, v - cur[x]);</span><br><span class="line">        <span class="keyword">if</span> (fa[u])</span><br><span class="line">            bit[u][<span class="number">1</span>].<span class="built_in">add</span>(<span class="built_in">getdis</span>(fa[u], x) + <span class="number">1</span>, v - cur[x]);</span><br><span class="line">    &#125;</span><br><span class="line">    cur[x] = v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u = x; u; u = fa[u]) &#123;</span><br><span class="line">        <span class="keyword">int</span> d = k - <span class="built_in">getdis</span>(u, x);</span><br><span class="line">        <span class="keyword">if</span> (d &gt;= <span class="number">0</span>)</span><br><span class="line">            ret += bit[u][<span class="number">0</span>].<span class="built_in">sum</span>(d + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (fa[u]) &#123;</span><br><span class="line">            d = k - <span class="built_in">getdis</span>(fa[u], x);</span><br><span class="line">            <span class="keyword">if</span> (d &gt;= <span class="number">0</span>)</span><br><span class="line">                ret -= bit[u][<span class="number">1</span>].<span class="built_in">sum</span>(d + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    mxsiz[<span class="number">0</span>] = INFL;</span><br><span class="line">    <span class="built_in">build1</span>(<span class="built_in">getroot</span>(<span class="number">1</span>, <span class="number">0</span>, n), <span class="number">0</span>, n);</span><br><span class="line">    <span class="built_in">build2</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> tt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">modify</span>(i, a[i]);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="keyword">int</span> op, x, y;</span><br><span class="line">        <span class="built_in">read</span>(op), <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        x ^= tt, y ^= tt;</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">write</span>(tt = <span class="built_in">query</span>(x, y));</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">modify</span>(x, y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2664 æ ‘ä¸Šæ¸¸æˆ é¢˜è§£</title>
    <url>/2021/12/10/sol-p2664/</url>
    <content><![CDATA[<h2 id="P2664-æ ‘ä¸Šæ¸¸æˆ-é¢˜è§£"><a href="#P2664-æ ‘ä¸Šæ¸¸æˆ-é¢˜è§£" class="headerlink" title="P2664 æ ‘ä¸Šæ¸¸æˆ é¢˜è§£"></a>P2664 æ ‘ä¸Šæ¸¸æˆ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2664">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>åˆ†åˆ«è€ƒè™‘æ¯ç§é¢œè‰²ï¼Œå¯¹äºé¢œè‰²$col$ï¼Œå°†æ‰€æœ‰$c_u=col$çš„$u$åˆ å»å°±å¾—åˆ°è‹¥å¹²è¿é€šå—ï¼Œé¢œè‰²$col$å¯¹$sum_v$çš„è´¡çŒ®æ˜¯$n-num_v$ï¼Œ$num_v$ä¸º$v$æ‰€åœ¨è¿é€šå—å¤§å°ã€‚ç‰¹åˆ«åœ°ï¼Œæˆ‘ä»¬ä»¤$c_u=col$æ—¶$num_u=0$ã€‚</p>
<p>æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ˜¯ç»™æ¯ç§é¢œè‰²åˆ†åˆ«å»ºç«‹è™šæ ‘è®¡ç®—è´¡çŒ®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(n \log n)$ã€‚</p>
<p>ä½†æ˜¯è¿™é“é¢˜æ˜¯æœ‰$O(n)$çš„åšæ³•æ»´ã€‚åšæ³•ä¸ºä¸¤é$dfs$ï¼Œç¬¬ä¸€éé¢„å¤„ç†å‡ºæ¯ä¸ª$col=c_{fa_u}$å¯¹åº”çš„$num_u$ã€‚$num_u$å°±æ˜¯$siz_u$å‡å»å­æ ‘$u$ä¸­ä¸ç»è¿‡å…¶ä»–é¢œè‰²ä¸º$c_u$çš„èŠ‚ç‚¹ç›´æ¥ä¸$u$è¿æ¥çš„é¢œè‰²ä¸º$c_u$çš„ç‚¹çš„$siz$ä¹‹å’Œã€‚$dfs$æ—¶é¡ºä¾¿é¢„å¤„ç†å‡º$col_i$è¡¨ç¤ºæ ¹èŠ‚ç‚¹å‘¨å›´çš„é¢œè‰²ä¸º$i$è¿é€šå—å¤§å°ã€‚ç¬¬äºŒéç›´æ¥ç»Ÿè®¡ç­”æ¡ˆã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2664.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2664</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> n, c[MAXN], son[MAXN], cnt[MAXN], col[MAXN], cur[MAXN];</span><br><span class="line"><span class="keyword">int</span> sum, len, siz[MAXN], num[MAXN], ans[MAXN];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; g[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp = cur[c[u]];</span><br><span class="line">    siz[u] = <span class="number">1</span>;</span><br><span class="line">    cur[c[u]] = u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        son[u] = v;</span><br><span class="line">        <span class="built_in">dfs1</span>(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">    &#125;</span><br><span class="line">    cur[c[u]] = tmp;</span><br><span class="line">    num[u] += siz[u];</span><br><span class="line">    <span class="keyword">if</span> (son[cur[c[u]]])</span><br><span class="line">        num[son[cur[c[u]]]] -= siz[u];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        col[c[u]] -= siz[u];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (son[cur[c[u]]])</span><br><span class="line">        sum -= num[son[cur[c[u]]]];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        sum -= col[c[u]];</span><br><span class="line">    sum += num[u];</span><br><span class="line">    ans[u] = n * len - sum;</span><br><span class="line">    <span class="keyword">int</span> tmp = cur[c[u]];</span><br><span class="line">    cur[c[u]] = u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        son[u] = v;</span><br><span class="line">        <span class="built_in">dfs2</span>(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    cur[c[u]] = tmp;</span><br><span class="line">    sum -= num[u];</span><br><span class="line">    <span class="keyword">if</span> (son[cur[c[u]]])</span><br><span class="line">        sum += num[son[cur[c[u]]]];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        sum += col[c[u]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(c[i]), ++cnt[c[i]];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAXN; ++i)</span><br><span class="line">        <span class="keyword">if</span> (cnt[i])</span><br><span class="line">            ++len, col[i] = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAXN; ++i)</span><br><span class="line">        sum += col[i];</span><br><span class="line">    num[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans[i]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF1096G Lucky Tickets é¢˜è§£</title>
    <url>/2021/12/08/sol-cf1096g/</url>
    <content><![CDATA[<h2 id="CF1096G-Lucky-Tickets-é¢˜è§£"><a href="#CF1096G-Lucky-Tickets-é¢˜è§£" class="headerlink" title="CF1096G Lucky Tickets é¢˜è§£"></a>CF1096G Lucky Tickets é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF1096G">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p><del>ç¬¬ä¸€æ¬¡è¿™ä¹ˆè½»æ¾åœ°åšè®¡æ•°é¢˜</del></p>
<p>æœ‰äº†<a href="/2021/12/05/sol-cf632e/" title="CF632E">CF632E</a>çš„ç»éªŒï¼Œè¿™é¢˜$10$ç§’ä»¥å†…å°±èƒ½åˆ‡ã€‚</p>
<p>å…ˆæ„é€ ç”Ÿæˆå‡½æ•°$f(x) = \sum\limits_{i \in K}{x^i}$ï¼Œå–å…¶ä¸­$\frac{n}{2}$ä¸ªæ•°å­—çš„å’Œç›¸å½“äº$f^\frac{n}{2}(x)$ã€‚$NTT$è®¡ç®—å³å¯ï¼Œç­”æ¡ˆå¾ˆå¥½ç»Ÿè®¡ã€‚</p>
<p>$5$åˆ†é’Ÿå°±åšæ‰äº†ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF1096G.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF1096G</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">21</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> G0 = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">int</span> n, k, f[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x % MOD;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ntt</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> gn = <span class="built_in">qpow</span>(G0, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                <span class="keyword">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                g = g * gn % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] = f[i] * inv % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n) /= <span class="number">2</span>, <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, x; i &lt;= k; ++i)</span><br><span class="line">        <span class="built_in">read</span>(x), f[x] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt;= n * <span class="number">9</span>)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">ntt</span>(f, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        f[i] = <span class="built_in">qpow</span>(f[i], n);</span><br><span class="line">    <span class="built_in">ntt</span>(f, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        (ans += f[i] * f[i]) %= MOD;</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>AT2064 Many Easy Problems é¢˜è§£</title>
    <url>/2021/12/06/sol-at2064/</url>
    <content><![CDATA[<h2 id="AT2064-Many-Easy-Problems-é¢˜è§£"><a href="#AT2064-Many-Easy-Problems-é¢˜è§£" class="headerlink" title="AT2064 Many Easy Problems é¢˜è§£"></a>AT2064 Many Easy Problems é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/AT2064">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¯¹äºæ¯ä¸ªèŠ‚ç‚¹$u$ï¼Œè€ƒè™‘å…¶å¯¹$f(i)$çš„è´¡çŒ®ã€‚</p>
<p>æ­£é¢çš„è´¡çŒ®ä¸å¥½è®¡ç®—ï¼Œè€ƒè™‘ç”¨æ€»æ–¹æ¡ˆæ•°å‡å»ä¸ç»è¿‡$u$çš„æ•°é‡ï¼Œåˆ™</p>
<script type="math/tex; mode=display">
\begin{aligned}
f(i) &= \sum\limits_{u=1}^{n}{\left(\binom{n}{i} - \binom{n-siz_u}{i} - \sum\limits_{v \in son_u}{\binom{siz_v}{i}}\right)} \\
&= n\binom{n}{i} - \sum\limits_{u=1}^{n}{\left(\binom{n-siz_u}{i} + \sum\limits_{v \in son_u}{\binom{siz_v}{i}}\right)}
\end{aligned}</script><p>è®¾$cnt_i$è¡¨ç¤ºå­æ ‘å¤§å°ä¸º$i$çš„èŠ‚ç‚¹æ•°é‡ã€‚ä¸ºäº†ä¾¿äºä¹‹åçš„è®¡ç®—ï¼Œæˆ‘ä»¬å°†ä¸åœ¨èŠ‚ç‚¹$u$å­æ ‘ä¸­çš„èŠ‚ç‚¹å®šä¹‰ä¸ºä¸€æ£µæ–°çš„å­æ ‘å¹¶åŠ å…¥$son_u$ã€‚å½¢å¼åŒ–åœ°ï¼Œå³å¯¹äºæ¯ä¸ªèŠ‚ç‚¹$u\neq 1$ï¼Œå°†$n-siz_u$åŠ å…¥$cnt$æ•°ç»„ä¸­ã€‚å¼å­ç®€åŒ–å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f(i) &= n\binom{n}{i} - \sum\limits_{u=1}^{n}{\sum\limits_{v \in son_u}{\binom{siz_v}{i}}} \\
&= n\binom{n}{i} - \sum\limits_{j=i}^{n}{cnt_j \cdot \binom{j}{i}}
\end{aligned}</script><p>å±•å¼€ç»„åˆæ•°å¾—åˆ°</p>
<script type="math/tex; mode=display">
\begin{aligned}
f(i) &= n\binom{n}{i} - \sum\limits_{j=i}^{n}{cnt_j \cdot \binom{j}{i}} \\
&= n\binom{n}{i} - \sum\limits_{j=i}^{n}{\frac{cnt_j \cdot j!}{i! (j - i)!}} \\
&= n\binom{n}{i} - \frac{1}{i!}\sum\limits_{j=i}^{n}{\frac{cnt_j \cdot j!}{(j - i)!}}
\end{aligned}</script><p>ç”±äºåé¢çš„æ±‚å’Œç¬¦å·ä¸­æ—¢æœ‰$j$åˆæœ‰$i-j$ï¼Œæƒ³åŠæ³•å°†å…¶åŒ–ä¸ºå·ç§¯çš„å½¢å¼ã€‚</p>
<script type="math/tex; mode=display">
\begin{aligned}
f(i) &= n\binom{n}{i} - \frac{1}{i!}\sum\limits_{j=i}^{n}{\frac{cnt_j \cdot j!}{(j - i)!}} \\
&= n\binom{n}{i} - \frac{1}{i!}\sum\limits_{j=0}^{n-i}{\frac{cnt_{n - j} \cdot (n - j)!}{(n - i - j)!}}
\end{aligned}</script><p>æ‰€ä»¥ä»¤$F_j = cnt_{n - j} \cdot (n - j)!$ï¼Œ$G_j = \frac{1}{j!}$ï¼Œæœ€ç»ˆå¼å­æˆäº†</p>
<script type="math/tex; mode=display">
f(i) = n\binom{n}{i} - \frac{1}{i!}\sum\limits_{j=0}^{n-i}{F_j \cdot G_{n - i - j}}</script><p>ä½¿ç”¨$NTT$ä¼˜åŒ–å³å¯ã€‚æ³¨æ„$924844033$çš„åŸæ ¹æ˜¯$5$è€Œä¸æ˜¯$3$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           AT2064.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/AT2064</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">924844033</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> G0 = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ntt</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> gn = <span class="built_in">qpow</span>(G0, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="keyword">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n, fa[MAXN], siz[MAXN], cnt[MAXN], ans[MAXN];</span><br><span class="line"><span class="keyword">int</span> fac[MAXN], inv[MAXN], f[MAXN], g[MAXN], res[MAXN];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; tr[MAXN];</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    fa[u] = f, siz[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : tr[u])</span><br><span class="line">        <span class="keyword">if</span> (v != f)</span><br><span class="line">            <span class="built_in">build</span>(v, u), siz[u] += siz[v];</span><br><span class="line">    ++cnt[siz[u]], ++cnt[n - siz[u]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = fac[<span class="number">0</span>] = <span class="number">1</span>; i &lt; MAXN; ++i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    inv[MAXN - <span class="number">1</span>] = <span class="built_in">qpow</span>(fac[MAXN - <span class="number">1</span>], MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXN - <span class="number">2</span>; ~i; --i)</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binom</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fac[x] * inv[y] % MOD * inv[x - y] % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        tr[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        tr[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>), cnt[<span class="number">0</span>] = cnt[n] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// ##sb-mistakes## è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬FFT/NTTåšå·ç§¯ä¸€å®šè¦å¼€ä¸¤å€é•¿åº¦</span></span><br><span class="line">    <span class="comment">// while (len &lt;= n)</span></span><br><span class="line">    <span class="keyword">while</span> (len &lt;= n + n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">        f[i] = cnt[n - i] * fac[n - i] % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">        g[i] = inv[i];</span><br><span class="line">    <span class="built_in">ntt</span>(f, len, <span class="number">1</span>), <span class="built_in">ntt</span>(g, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        res[i] = f[i] * g[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(res, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ans[i] = (n * <span class="built_in">binom</span>(n, i) % MOD - inv[i] * res[n - i] % MOD + MOD) % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans[i]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4245 ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•</title>
    <url>/2021/12/05/sol-p4245/</url>
    <content><![CDATA[<h2 id="P4245-ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•"><a href="#P4245-ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•" class="headerlink" title="P4245 ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•"></a>P4245 ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4245">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¯¹äºä»»æ„æ¨¡æ•°çš„å¤šé¡¹å¼ä¹˜æ³•æ˜¾ç„¶æ— æ³•ç›´æ¥å¥—ç”¨$NTT$ã€‚è€Œç”±äºæ•°é‡çº§è¿‡å¤§ï¼Œé‡‡ç”¨<code>std::complex&lt;long double&gt;</code>çš„$FFT$ä¹Ÿä¼šäº§ç”Ÿæ¯”è¾ƒå¤šçš„ç²¾åº¦ä¸¢å¤±ã€‚</p>
<h4 id="æ–¹æ³•1-NTT-åˆå¹¶"><a href="#æ–¹æ³•1-NTT-åˆå¹¶" class="headerlink" title="æ–¹æ³•1: $NTT$åˆå¹¶"></a>æ–¹æ³•1: $NTT$åˆå¹¶</h4><p>ç”±äº$a_i,b_i \le 10^9$ä¸”$n \le 10^5$ï¼Œæ‰€ä»¥ç­”æ¡ˆçš„æ•°é‡çº§ä¸è¶…è¿‡$10^9 \times 10^9 \times 10^5 = 10^{23}$ï¼Œè¿™æ ·å°±å¯ä»¥æ‰¾$3$ä¸ª$10^8$å·¦å³çš„æ¨¡æ•°åˆ†åˆ«ç”¨$NTT$ç®—å‡ºå¯¹å…¶å–æ¨¡çš„ç­”æ¡ˆï¼Œç”¨ä¸­å›½å‰©ä½™å®šç†åˆå¹¶ã€‚</p>
<p>è¿™é‡Œæ¯”è¾ƒå¸¸ç”¨çš„$3$ä¸ªæ¨¡æ•°åˆ†åˆ«æ˜¯</p>
<script type="math/tex; mode=display">
\begin{aligned}
p_1 &= 998244353 = 7 \times 17 \times 2^{23} + 1, &g &= 3 \\
p_2 &= 1004535809 = 479 \times 2^{21} + 1, &g &= 3 \\
p_3 &= 469762049 = 7 \times 2^{26} + 1, &g &= 3
\end{aligned}</script><p>ä¸‹é¢å‡è®¾æˆ‘ä»¬æ±‚å‡ºäº†å¯¹è¿™$3$ä¸ªæ¨¡æ•°çš„ç­”æ¡ˆåˆ†åˆ«ä¸º$x_1,x_2,x_3$ï¼Œå¾—åˆ°åŒä½™æ–¹ç¨‹å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{cases}
x \equiv x_1 \pmod{p_1} \\
x \equiv x_2 \pmod{p_2} \\
x \equiv x_3 \pmod{p_3} \\
\end{cases}</script><p>ç”±äºä¹˜ç§¯è¿‡å¤§æ— æ³•ç”¨<code>long long</code>å‚¨å­˜ï¼Œæ‰€ä»¥æ­£å¸¸çš„$CRT$ä¸èƒ½åœ¨æ­¤ä½¿ç”¨ï¼ˆå½“ç„¶å¦‚æœä½ å†™é«˜ç²¾åº¦å°±å½“æˆ‘æ²¡è¯´ï¼‰ï¼Œäºæ˜¯è€ƒè™‘æ‰‹åŠ¨åˆå¹¶ã€‚å…ˆæŠŠå‰ä¸¤ä¸ªåˆå¹¶ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
x_1 + k_1 p_1 &= x_2 + k_2 p_2 \\
x_1 + k_1 p_1 &\equiv x_2 &\pmod{p_2} \\
k_1 &\equiv \frac{x_2 - x_1}{p_1} &\pmod{p_2} \\
\end{aligned}</script><p>è¿™æ ·ä¾¿æ±‚å‡ºäº†$k_1$ï¼ŒåŒæ—¶å¾—åˆ°æ–°çš„æ–¹ç¨‹$x \equiv x_1 + k_1 p_1 \pmod{p_1 p_2}$ã€‚è®°$x_4  = x_1 + k_1 p_1$ã€‚</p>
<script type="math/tex; mode=display">
\begin{aligned}
x_4 + k_4 p_1 p_2 &= x_3 + k_3 p_3 \\
x_4 + k_4 p_1 p_2 &\equiv x_3 &\pmod{p_3} \\
k_4 &\equiv \frac{x_3 - x_4}{p_1 p_2} &\pmod{p_3} \\
\end{aligned}</script><p>æ±‚å‡º$k_4$åï¼Œå¾—åˆ°$x \equiv x_4 + k_4 p_1 p_2 \pmod{p_3}$ã€‚ç”±äº$x \lt p_1 p_2 p_3$ï¼Œæ‰€ä»¥$x = x_4 + k_4 p_1 p_2$ã€‚</p>
<p>å…±éœ€è¦è·‘$3 \times 3 = 9$æ¬¡$NTT$ï¼Œå¸¸æ•°è¾ƒå¤§ã€‚</p>
<h4 id="æ–¹æ³•2-æ‹†ç³»æ•°-FFT"><a href="#æ–¹æ³•2-æ‹†ç³»æ•°-FFT" class="headerlink" title="æ–¹æ³•2: æ‹†ç³»æ•°$FFT$"></a>æ–¹æ³•2: æ‹†ç³»æ•°$FFT$</h4><p>æŠŠä¸€ä¸ªæ•°æ‹†åˆ†æˆ$a \times 2^{15} + b$çš„å½¢å¼ï¼Œåˆ™$a, b \lt 2^{15}$</p>
<p>å°†$a$å’Œ$b$åˆ†åˆ«åšå¤šé¡¹å¼ï¼Œç›¸ä¹˜çš„å€¼åŸŸæ˜¯$2^{15} \times 2^{15} \times 10^5 \approx 10^{14}$ï¼Œå¯ä»¥æ¥å—ã€‚äºæ˜¯</p>
<script type="math/tex; mode=display">
\begin{aligned}
c_1 \times c_2 &= (a_1 \times 2^{15} + b_1) \times (a_2 \times 2^{15} + b_2) \\
&= a_1 a_2 \times 2^{30} + (a_1 b_2 + a_2 b_1) \times 2^{15} + b_1 b_2
\end{aligned}</script><p>ä¹ä¸€çœ‹å¥½åƒéœ€è¦ç®—$4$æ¬¡ä¹˜æ³•ï¼Œå…±$12$æ¬¡$FFT$ï¼Œé‚£å²‚ä¸æ˜¯æ¯”æ–¹æ³•1æ›´åŠ£ï¼Ÿ</p>
<p>å¼€å§‹æ¨å¼å­å§ã€‚å‡è®¾æœ‰$4$ä¸ªå¤šé¡¹å¼$A_1,A_2,B_1,B_2$ï¼Œå¦‚ä½•æ±‚ä»–ä»¬çš„ä¸¤ä¸¤ä¹˜ç§¯ã€‚</p>
<p>ç”±äº$(a+bi) \times (c+di) = (ac-bd) + (ad+bc)i$ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¾å¤å¤šé¡¹å¼$P = A_1 + iB_1$ï¼Œ$Q = A_2 + iB_2$ï¼ˆè¿™æ˜¯å“ªä½ç¥ä»™æƒ³å‡ºæ¥çš„å•Šï¼‰ï¼Œè€Œ$FFT$æœ¬èº«å°±æ˜¯ä½¿ç”¨å¤æ•°è®¡ç®—æ‰€ä»¥ç›´æ¥ä¼ å…¥å¤æ•°ä¹Ÿæ²¡å…³ç³»ã€‚</p>
<p>è®¾$T_1 = P \times Q = A_1 A_2 - B_1 B_2 + (A_1 B_2 + A_2 B_1)i$ï¼Œ</p>
<p>åˆè®¾$Pâ€™ = A_1 - iB_1$ï¼Œ</p>
<p>é‚£$T_2 = Pâ€™ \times Q = A_1 A_2 + B_1 B_2 + (A_1 B_2 - A_2 B_1)i$ï¼Œ</p>
<p>ä¸¤è€…$T_1$å’Œ$T_2$è¿›è¡Œå’Œå·®å°±å¾—åˆ°äº†å¤šé¡¹å¼çš„ä¸¤ä¸¤ä¹˜ç§¯ï¼ˆå¦™å•Šï¼‰ã€‚</p>
<p>æ€»çš„$FFT$æ¬¡æ•°ä¸º$3$æ¬¡DFT$+2$æ¬¡IDFT$=5$æ¬¡ã€‚</p>
<p>çªç„¶å‘ç°å€¼åŸŸå…¶å®åº”è¯¥æ˜¯$10^{19}$è€Œä¸æ˜¯$10^{14}$ï¼Œå› ä¸º$IDFT$ä¹‹å‰è¿˜å¾—é™¤ä»¥$n$â€¦â€¦</p>
<p>çœ‹æ•°æ®å¼ºåº¦è·‘å§ï¼Œä»£ç å€’æ˜¯æŒºå¥½å†™çš„ã€‚</p>
<p><strong>è®¡ç®—$\pi$ä¸è¦ç”¨å¸¸é‡<code>M_PI</code>è€Œæ˜¯è¦ç”¨<code>acos(-1)</code>!!!!ä¸ç„¶è¿™é¢˜ä¸¢å¤±ç²¾åº¦åªèƒ½è¿‡å‰$10$ä¸ªç‚¹!!!!</strong></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4245.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4245</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> comp = complex&lt;<span class="keyword">long</span> <span class="keyword">double</span>&gt;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">double</span> MPI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="comment">// å¯¹åº”æ–¹æ³•1</span></span><br><span class="line"><span class="keyword">namespace</span> solve1 &#123;</span><br><span class="line">    <span class="keyword">int</span> mod;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> mod)</span> </span>&#123;</span><br><span class="line">        solve1::mod = mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qmul</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> p = mod)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = (x + x) % p)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = (ret + x) % p;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> p = mod)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = <span class="built_in">qmul</span>(x, x, p))</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = <span class="built_in">qmul</span>(ret, x, p);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ntt</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (mod - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="keyword">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % mod;</span><br><span class="line">                    f[k] = (u + t + mod) % mod;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + mod) % mod;</span><br><span class="line">                    g = g * gn % mod;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(len, mod - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MODS[<span class="number">3</span>] = &#123;<span class="number">998244353</span>, <span class="number">1004535809</span>, <span class="number">469762049</span>&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INV1 = <span class="built_in">qpow</span>(MODS[<span class="number">0</span>], MODS[<span class="number">1</span>] - <span class="number">2</span>, MODS[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> INV2 = <span class="built_in">qpow</span>(MODS[<span class="number">0</span>] * MODS[<span class="number">1</span>] % MODS[<span class="number">2</span>], MODS[<span class="number">2</span>] - <span class="number">2</span>, MODS[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">int</span> n, m, p, a[<span class="number">3</span>][MAXN], b[<span class="number">3</span>][MAXN], ans[<span class="number">3</span>][MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">crt</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> t = (a2 - a1 + MODS[<span class="number">1</span>]) % MODS[<span class="number">1</span>] * INV1 % MODS[<span class="number">1</span>] * MODS[<span class="number">0</span>] + a1;</span><br><span class="line">        <span class="keyword">return</span> ((a3 - t % MODS[<span class="number">2</span>] + MODS[<span class="number">2</span>]) % MODS[<span class="number">2</span>] * INV2 % MODS[<span class="number">2</span>] * (MODS[<span class="number">0</span>] * MODS[<span class="number">1</span>] % p) % p + t) % p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(p);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, x; i &lt;= n; ++i)</span><br><span class="line">            <span class="built_in">read</span>(x) %= p, a[<span class="number">0</span>][i] = a[<span class="number">1</span>][i] = a[<span class="number">2</span>][i] = x;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, x; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">read</span>(x) %= p, b[<span class="number">0</span>][i] = b[<span class="number">1</span>][i] = b[<span class="number">2</span>][i] = x;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt; n + m + <span class="number">1</span>)</span><br><span class="line">            len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">3</span>; ++k) &#123;</span><br><span class="line">            <span class="built_in">init</span>(MODS[k]);</span><br><span class="line">            <span class="built_in">ntt</span>(a[k], len, <span class="number">1</span>), <span class="built_in">ntt</span>(b[k], len, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                ans[k][i] = a[k][i] * b[k][i] % mod;</span><br><span class="line">            <span class="built_in">ntt</span>(ans[k], len, <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n + m; ++i)</span><br><span class="line">            <span class="built_in">write</span>(<span class="built_in">crt</span>(ans[<span class="number">0</span>][i], ans[<span class="number">1</span>][i], ans[<span class="number">2</span>][i])), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n + m]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯¹åº”æ–¹æ³•2</span></span><br><span class="line"><span class="keyword">namespace</span> solve2 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(comp *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fft</span><span class="params">(comp *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * MPI / h), sin(<span class="number">2</span> * MPI / h))</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                    f[k] = u + t;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                    w *= wn;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] /= len;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> BLOC = <span class="number">1</span> &lt;&lt; <span class="number">15</span>;</span><br><span class="line">    <span class="keyword">int</span> n, m, p, a[MAXN], b[MAXN], ans[MAXN];</span><br><span class="line">    comp p1[MAXN], p2[MAXN], q[MAXN], t1[MAXN], t2[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(p);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="built_in">read</span>(a[i]) %= p;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">read</span>(b[i]) %= p;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt; n + m + <span class="number">1</span>)</span><br><span class="line">            len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            p1[i] = <span class="built_in">comp</span>(a[i] / BLOC, a[i] % BLOC);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            p2[i] = <span class="built_in">comp</span>(a[i] / BLOC, -a[i] % BLOC);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            q[i] = <span class="built_in">comp</span>(b[i] / BLOC, b[i] % BLOC);</span><br><span class="line">        <span class="built_in">fft</span>(p1, len, <span class="number">1</span>), <span class="built_in">fft</span>(p2, len, <span class="number">1</span>), <span class="built_in">fft</span>(q, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            t1[i] = p1[i] * q[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            t2[i] = p2[i] * q[i];</span><br><span class="line">        <span class="built_in">fft</span>(t1, len, <span class="number">-1</span>), <span class="built_in">fft</span>(t2, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> a1a2 = ((<span class="keyword">int</span>)((t1[i].<span class="built_in">real</span>() + t2[i].<span class="built_in">real</span>()) / <span class="number">2</span> + <span class="number">0.5</span>)) % p;</span><br><span class="line">            <span class="keyword">int</span> a1b2 = ((<span class="keyword">int</span>)((t2[i].<span class="built_in">imag</span>() + t1[i].<span class="built_in">imag</span>()) / <span class="number">2</span> + <span class="number">0.5</span>)) % p;</span><br><span class="line">            <span class="keyword">int</span> a2b1 = ((<span class="keyword">int</span>)((t1[i].<span class="built_in">imag</span>() - t2[i].<span class="built_in">imag</span>()) / <span class="number">2</span> + <span class="number">0.5</span>)) % p;</span><br><span class="line">            <span class="keyword">int</span> b1b2 = ((<span class="keyword">int</span>)((t2[i].<span class="built_in">real</span>() - t1[i].<span class="built_in">real</span>()) / <span class="number">2</span> + <span class="number">0.5</span>)) % p;</span><br><span class="line">            ans[i] = (a1a2 * (<span class="number">1ll</span> &lt;&lt; <span class="number">30</span>) % p + (a1b2 + a2b1) * (<span class="number">1ll</span> &lt;&lt; <span class="number">15</span>) % p + b1b2) % p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n + m; ++i)</span><br><span class="line">            <span class="built_in">write</span>(ans[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n + m]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// return solve1::main();</span></span><br><span class="line">    <span class="keyword">return</span> solve2::<span class="built_in">main</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF632E Thief in a Shop é¢˜è§£</title>
    <url>/2021/12/05/sol-cf632e/</url>
    <content><![CDATA[<h2 id="CF632E-Thief-in-a-Shop-é¢˜è§£"><a href="#CF632E-Thief-in-a-Shop-é¢˜è§£" class="headerlink" title="CF632E Thief in a Shop é¢˜è§£"></a>CF632E Thief in a Shop é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF632E">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p><del>å…¶å®è¿™é¢˜å¯ä»¥ç›´æ¥æš´åŠ›åšçš„</del></p>
<p>è¿˜æ˜¯å­¦ä¹ ä¸€ä¸‹<a href="https://oi-wiki.org/math/gen-func/ogf/">ç”Ÿæˆå‡½æ•°</a>å§ã€‚</p>
<p>å¯¹äºæ‰€æœ‰ç‰©å“æ„é€ ç”Ÿæˆå‡½æ•°$f(x) = \sum\limits_{i\in S}{x^i}$</p>
<p>å–å‡º$k$ä¸ªç‰©å“ç›¸å½“äº$f^k(x)$ã€‚</p>
<p>ä½†æ˜¯é¢˜è§£é‡Œè¯´æ¨¡æ•°$998244353$å’Œ$1004535809$éƒ½è¢«å¡äº†ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©ä½¿ç”¨åŒæ¨¡æ•°é˜²æ­¢è¢«$hack$ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(N \log N)$ï¼Œå…¶ä¸­$N$æ˜¯$10^6$çº§åˆ«çš„ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF632E.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF632E</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="keyword">int</span> mod;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> mod)</span> </span>&#123;</span><br><span class="line">        maths::mod = mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % mod)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % mod;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ntt</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (mod - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="keyword">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % mod;</span><br><span class="line">                    f[k] = (u + t + mod) % mod;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + mod) % mod;</span><br><span class="line">                    g = g * gn % mod;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(len, mod - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n, k, cnt, a[MAXN], b[MAXN], answ[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="built_in">read</span>(x);</span><br><span class="line">        a[x] = b[x] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line">    maths::<span class="built_in">init</span>(<span class="number">998244353</span>);</span><br><span class="line">    maths::<span class="built_in">ntt</span>(a, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        a[i] = maths::<span class="built_in">qpow</span>(a[i], k);</span><br><span class="line">    maths::<span class="built_in">ntt</span>(a, len, <span class="number">-1</span>);</span><br><span class="line">    maths::<span class="built_in">init</span>(<span class="number">1004535809</span>);</span><br><span class="line">    maths::<span class="built_in">ntt</span>(b, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        b[i] = maths::<span class="built_in">qpow</span>(b[i], k);</span><br><span class="line">    maths::<span class="built_in">ntt</span>(b, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (a[i] || b[i])</span><br><span class="line">            answ[++cnt] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i)</span><br><span class="line">        <span class="built_in">write</span>(answ[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == cnt]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4721 ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT é¢˜è§£</title>
    <url>/2021/12/05/sol-p4721/</url>
    <content><![CDATA[<h2 id="P4721-ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT-é¢˜è§£"><a href="#P4721-ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT-é¢˜è§£" class="headerlink" title="P4721 ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT é¢˜è§£"></a>P4721 ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4721">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ç”±äº$f_i$ä¾èµ–äº$f_j(1\le j\lt i)$ï¼Œæ‰€ä»¥è€ƒè™‘åˆ†æ²»è®¡ç®—ï¼Œæ¯æ¬¡å…ˆè®¡ç®—å·¦åŠæ®µï¼Œå°†è´¡çŒ®åŠ åˆ°å³åŠæ®µåç»§ç»­é€’å½’è®¡ç®—å³åŠæ®µã€‚</p>
<p>æ€è€ƒå¦‚ä½•è®¡ç®—è´¡çŒ®ã€‚å‘ç°é¢˜ç›®ä¸­$f_i=\sum\limits_{j=1}^{i}{f_{i-j}g_j}$çš„æ–¹å¼å¾ˆåƒå¤šé¡¹å¼ä¹˜æ³•ï¼ŒåŒºé—´$[l,mid]$å¯¹$f_i(mid \lt i \le r)$çš„è´¡çŒ®å°±æ˜¯$F(x) = f(x) \times g(x)$çš„$F(i)$ï¼Œç”¨$NTT$è¿›è¡Œè®¡ç®—å³å¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log^2 n)$ï¼ˆä¼¼ä¹æ¯”å¤šé¡¹å¼æ±‚é€†è¦æ…¢ä¸å°‘ï¼‰ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4721.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4721</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">18</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> G0 = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ntt</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> gn = <span class="built_in">qpow</span>(G0, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="keyword">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> maths::ntt;</span><br><span class="line"><span class="keyword">int</span> n, a[MAXN], b[MAXN], f[MAXN], g[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> len = r - l + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve</span>(l, mid);</span><br><span class="line">    <span class="built_in">copy</span>(f + l, f + mid + <span class="number">1</span>, a);</span><br><span class="line">    <span class="built_in">copy</span>(g, g + len, b);</span><br><span class="line">    <span class="built_in">fill</span>(a + len / <span class="number">2</span>, a + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(a, len, <span class="number">1</span>), <span class="built_in">ntt</span>(b, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        a[i] = a[i] * b[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(a, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span>; i &lt;= r; ++i)</span><br><span class="line">        f[i] = (f[i] + a[i - l]) % MOD;</span><br><span class="line">    <span class="built_in">solve</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(g[i]);</span><br><span class="line">    <span class="keyword">int</span> len = f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve</span>(<span class="number">0</span>, len - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(f[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4238 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€† é¢˜è§£</title>
    <url>/2021/12/05/sol-p4238/</url>
    <content><![CDATA[<h2 id="P4238-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€†-é¢˜è§£"><a href="#P4238-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€†-é¢˜è§£" class="headerlink" title="P4238 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€† é¢˜è§£"></a>P4238 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€† é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4238">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å‡è®¾æˆ‘ä»¬è¦æ±‚</p>
<script type="math/tex; mode=display">f(x) \cdot g(x) \equiv 1 \pmod{x^n}</script><p>å¦‚æœå·²ç»çŸ¥é“</p>
<script type="math/tex; mode=display">f(x) \cdot h(x) \equiv 1 \pmod{x^\frac{n}{2}}</script><p>é‚£ä¹ˆç›¸å‡å¯å¾—</p>
<script type="math/tex; mode=display">f(x) \cdot (g(x) - h(x)) \equiv 0 \pmod{x^\frac{n}{2}}</script><script type="math/tex; mode=display">g(x) - h(x) \equiv 0 \pmod{x^\frac{n}{2}}</script><p>ä¸¤è¾¹åŒæ—¶å¹³æ–¹å¾—åˆ°</p>
<script type="math/tex; mode=display">g^2(x) - 2 \cdot g(x) \cdot h(x) + h^2(x) \equiv 0 \pmod{x^n}</script><p>ä¹˜ä¸Š$f(x)$å¾—åˆ°</p>
<script type="math/tex; mode=display">g(x) - 2 \cdot h(x) + f(x) \cdot h^2(x) \equiv 0 \pmod{x^n}</script><p>ç§»é¡¹å¾—åˆ°</p>
<script type="math/tex; mode=display">g(x) \equiv h(x) \cdot (2 - f(x) \cdot h(x)) \pmod{x^n}</script><p>é€’å½’è®¡ç®—å³å¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦</p>
<script type="math/tex; mode=display">T(n) = T\left(\frac{n}{2}\right) + O(n \log n) = O(n \log n)</script><h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4238.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4238</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">18</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ntt</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="keyword">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">polyinv</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len, <span class="keyword">int</span> *g)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> tmp[MAXN];</span><br><span class="line">        <span class="built_in">fill</span>(tmp, tmp + len + len, <span class="number">0</span>);</span><br><span class="line">        g[<span class="number">0</span>] = <span class="built_in">qpow</span>(f[<span class="number">0</span>], MOD - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> t = <span class="number">2</span>; t &lt;= len; t &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(f, f + t, tmp);</span><br><span class="line">            <span class="built_in">fill</span>(tmp + t, tmp + t + t, <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">ntt</span>(g, t + t, <span class="number">1</span>), <span class="built_in">ntt</span>(tmp, t + t, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; t + t; ++i)</span><br><span class="line">                g[i] = g[i] * (<span class="number">2</span> - tmp[i] * g[i] % MOD + MOD) % MOD;</span><br><span class="line">            <span class="built_in">ntt</span>(g, t + t, <span class="number">-1</span>);</span><br><span class="line">            <span class="built_in">fill</span>(g + t, g + t + t, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="keyword">int</span> n, f[MAXN], g[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(f[i]);</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">polyinv</span>(f, len, g);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(g[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF526G Spiders Evil Plan é¢˜è§£</title>
    <url>/2021/12/04/sol-cf526g/</url>
    <content><![CDATA[<h2 id="CF526G-Spiders-Evil-Plan-é¢˜è§£"><a href="#CF526G-Spiders-Evil-Plan-é¢˜è§£" class="headerlink" title="CF526G Spiders Evil Plan é¢˜è§£"></a>CF526G Spiders Evil Plan é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF526G">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æœ‰æ„æ€ï¼Œå¾ˆæœ‰æ„æ€ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬æš‚æ—¶å¿½ç•¥è·¯å¾„å¿…é¡»ç»è¿‡$x$çš„é™åˆ¶è¿›è¡Œæ€è€ƒã€‚å®¹æ˜“æƒ³åˆ°æœ€é•¿çš„ä¸€æ¡è·¯å¾„æ˜¯æ ‘çš„ç›´å¾„ï¼Œä¸”å…¶ä»–è·¯å¾„éƒ½æ˜¯ä¸€ä¸ªå¶å­åˆ°å¦ä¸€ä¸ªå¶å­çš„ç±»å‹ï¼Œæ¥ç€å‘ç°å¦‚æœè·¯å¾„å¿…é¡»ç»è¿‡$x$ä¹Ÿéœ€è¦ä¿è¯æœ€é•¿è·¯å¾„ç»è¿‡ç›´å¾„çš„å…¶ä¸­ä¸€ä¸ªç«¯ç‚¹ï¼ˆæ˜¾ç„¶æœ€ä¼˜ï¼‰ã€‚äºæ˜¯æƒ³åˆ°ä»¥ç›´å¾„ä¸¤ä¸ªç«¯ç‚¹ä¸ºæ ¹åˆ†åˆ«å»ºä¸€æ£µæ ‘ï¼Œåˆ†åˆ«æ±‚æ ¹ç»è¿‡$x$åˆ°ä¸€ä¸ªå¶å­ç»“ç‚¹çš„æœ€é•¿è·¯å¾„å$\max$ï¼Œå¯é€šè¿‡$y=1$ã€‚</p>
<p>å°†æ¯æ¡è·¯å¾„æ‹†åˆ†ä¸º$2$ä¸ªå¶å­ç»“ç‚¹çš„è·¯å¾„ã€‚å¦‚æœæ— éœ€ç»è¿‡èŠ‚ç‚¹$x$ï¼Œé‚£ä¹ˆé™¤å»åˆ°æ ¹çš„è·¯å¾„ä¹‹å¤–è¿˜éœ€è¦å–å‡º$2y-1$ä¸ªå¶å­ç»“ç‚¹è·¯å¾„ã€‚ç„¶åéœ€è¦ç”¨åˆ°ä¸€ä¸ª<strong>é•¿é“¾å‰–åˆ†</strong>å°$trick$ï¼ˆä¹Ÿæ˜¯è¿™é¢˜æœ€å¦™çš„åœ°æ–¹ï¼‰ï¼Œå¯¹äºæ¯æ¡é•¿é“¾ï¼Œå®šä¹‰å…¶å¸¦æƒé•¿åº¦ä¸º<strong>é“¾å¤´çš„çˆ¶èŠ‚ç‚¹åˆ°é“¾å°¾çš„è·ç¦»</strong>ï¼Œå³<code>sdep[u] - sdep[fa[top[u]]]</code>ï¼Œå¯ä»¥è¯æ˜<strong>æ›´é•¿çš„é“¾ä¸€å®šä¼šæ¯”æ›´çŸ­çš„é“¾å…ˆè¢«å–åˆ°ï¼Œä¸”è´¡çŒ®å³ä¸ºé“¾çš„å¸¦æƒé•¿åº¦</strong>ã€‚äºæ˜¯å–å‡ºæ ‘ä¸Šçš„æ‰€æœ‰é•¿é“¾å¹¶ä»å¤§åˆ°å°æ’åºï¼Œå–å¾—å‰$2y-1$ä¸ªå¸¦æƒé•¿åº¦ä¹‹å’Œå³ä¸ºä¸ç»è¿‡$x$çš„$y$ä¸ªæœ€é•¿è·¯å¾„é•¿åº¦ä¹‹å’Œã€‚</p>
<p><img src="sol-cf526g-tree1.png" alt=""></p>
<p>å¦‚å›¾æ‰€ç¤ºçš„ä¸€æ£µæ ‘ï¼Œé»‘è‰²è¾¹ä¸ºå…¶ç›´å¾„ï¼Œå°†å…¶<strong>æŒ‰è¾¹æƒ</strong>é•¿é“¾å‰–åˆ†åå¾—åˆ°å‡ æ¡é“¾ï¼Œæ˜¾ç„¶è¦å…ˆå–é»‘è‰²é“¾ï¼Œå†æŒ‰é¡ºåºå–è“è‰²ã€ç²‰è‰²å’Œæ©™è‰²é“¾ï¼Œè€Œæ¯åŠ å…¥ä¸€æ¡é“¾åå¯¹ç­”æ¡ˆçš„è´¡çŒ®å°±æ˜¯é“¾çš„å¸¦æƒé•¿åº¦ã€‚</p>
<p>ç°åœ¨è€ƒè™‘å¿…é¡»ç»è¿‡$x$çš„å–æ³•ã€‚åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œè‹¥å‰$2y-1$æ¡é“¾ç»è¿‡$x$ç›´æ¥å–å‰ç¼€å’Œè®¡ç®—ï¼ˆè‡³äºå¦‚ä½•åˆ¤æ–­å¯ä½¿ç”¨æ ‘ä¸Š$dp$ç»´æŠ¤å­æ ‘å†…å¶å­èŠ‚ç‚¹æ‰€åœ¨é“¾çš„æœ€é å‰æ’åï¼‰ã€‚å¦åˆ™æˆ‘ä»¬è¦æ‰¾åˆ°ç¬¬$1$åˆ°$2y-1$ä¸­çš„ä¸€æ¡é“¾ï¼ˆå‡å®šä¸º$k$ï¼‰ï¼Œå°†å…¶ç§»é™¤å¹¶åŠ å…¥ç»è¿‡$x$çš„æœ€é•¿é“¾ã€‚</p>
<p>æŸ¥æ‰¾å¹¶åˆ é™¤ä¸€æ¡é“¾æ—¶ï¼Œä»å¯ä»¥åˆ†ä¸¤ç§æƒ…å†µã€‚è‹¥ç¬¬$k$æ¡é“¾çš„$top_k$ä¸æ˜¯$x$çš„ç¥–å…ˆï¼Œåˆ™å…¶åˆ é™¤çš„ä»£ä»·ä¸º$len_k$ï¼Œæ˜¾ç„¶$k=2y-1$æ—¶æœ€ä¼˜ã€‚å¦ä¸€ç§$top_k$ä¸º$x$çš„ç¥–å…ˆï¼Œä»$u$å¾€ä¸Šå€å¢æ‰¾åˆ°ç¬¬ä¸€æ¡$k\le 2y-1$çš„é“¾ï¼Œå…¶å¶å­ç»“ç‚¹ä¸$x$çš„$lca$ä¸º$s$ï¼Œåˆ é™¤çš„ä»£ä»·ä¸º$sdep_k - dep_s$ï¼ŒäºŒè€…å–$\min$å³å¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O((n+q)\log n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF526G.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF526G</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LOGN = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tree</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">edges</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> u, v, w;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> n, rt, head[MAXN], nxt[MAXM], tot;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> _n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = _n;</span><br><span class="line">        rt = tot = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(head));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        edge[tot] = &#123;u, v, w&#125;;</span><br><span class="line">        nxt[tot] = head[u];</span><br><span class="line">        head[u] = tot++; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">int</span> dis[MAXN], pre[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxdis</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">        dis[u] = d, pre[u] = u;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v, w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (v != f &amp;&amp; dis[<span class="built_in">maxdis</span>(v, u, d + w)] &gt; dis[pre[u]])</span><br><span class="line">                pre[u] = pre[v];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pre[u];</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">int</span> dfc, sfa[MAXN], dfn[MAXN], len[MAXN], wson[MAXN];</span><br><span class="line">    <span class="keyword">int</span> dep[MAXN], sdep[MAXN], fa[MAXN][LOGN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">        len[u] = wson[u] = <span class="number">0</span>, fa[u][<span class="number">0</span>] = f;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">            fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v, w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (v != f) &#123;</span><br><span class="line">                dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">                sdep[v] = sdep[u] + w;</span><br><span class="line">                <span class="built_in">build1</span>(v, u);</span><br><span class="line">                <span class="keyword">if</span> (len[v] + w &gt; len[u])</span><br><span class="line">                    len[u] = len[v] + w, wson[u] = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> sf)</span> </span>&#123;</span><br><span class="line">        sfa[u] = sf, dfn[u] = ++dfc;</span><br><span class="line">        <span class="keyword">if</span> (wson[u])</span><br><span class="line">            <span class="built_in">build2</span>(wson[u], sf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (v != fa[u][<span class="number">0</span>] &amp;&amp; v != wson[u])</span><br><span class="line">                <span class="built_in">build2</span>(v, v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">int</span> dp[MAXN], rnk[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">        dp[u] = rnk[u] ? rnk[u] : INFL;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; ~i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (v != f) &#123;</span><br><span class="line">                <span class="built_in">dfs</span>(v, u);</span><br><span class="line">                dp[u] = <span class="built_in">min</span>(dp[u], dp[v]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getlca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">            <span class="keyword">if</span> (dp[fa[u][i]] &gt; k)</span><br><span class="line">                u = fa[u][i];</span><br><span class="line">        <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">int</span> lef, id[MAXN], sum[MAXN * <span class="number">2</span>];</span><br><span class="line">    pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; leaf[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> _rt)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;rt = _rt, lef = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">build1</span>(rt, <span class="number">0</span>), <span class="built_in">build2</span>(rt, rt);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!wson[i])</span><br><span class="line">                leaf[++lef] = &#123;sdep[i] - sdep[fa[sfa[i]][<span class="number">0</span>]], i&#125;;</span><br><span class="line">        <span class="built_in">sort</span>(leaf + <span class="number">1</span>, leaf + lef + <span class="number">1</span>, greater&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt;());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= lef; ++i)</span><br><span class="line">            rnk[leaf[i].second] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= lef; ++i)</span><br><span class="line">            id[i] = leaf[i].second;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            sum[i] = sum[i - <span class="number">1</span>] + leaf[i].first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            sum[i + n] = sum[i + n - <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">dfs</span>(rt, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> k = <span class="number">2</span> * y - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (dp[x] &lt;= k)</span><br><span class="line">            <span class="keyword">return</span> sum[k];</span><br><span class="line">        <span class="keyword">int</span> s = <span class="built_in">getlca</span>(x, k);</span><br><span class="line">        <span class="keyword">return</span> sum[k] + sdep[id[dp[x]]] - sdep[s] - <span class="built_in">min</span>(leaf[k].first, sdep[id[dp[s]]] - sdep[s]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; tr1, tr2;</span><br><span class="line"><span class="keyword">int</span> n, q;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(q);</span><br><span class="line">    tr1.<span class="built_in">clear</span>(n), tr2.<span class="built_in">clear</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, w;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v), <span class="built_in">read</span>(w);</span><br><span class="line">        tr1.<span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">        tr1.<span class="built_in">addedge</span>(v, u, w);</span><br><span class="line">        tr2.<span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">        tr2.<span class="built_in">addedge</span>(v, u, w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> rt1 = tr1.<span class="built_in">maxdis</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> rt2 = tr1.<span class="built_in">maxdis</span>(rt1, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    tr1.<span class="built_in">init</span>(rt1), tr2.<span class="built_in">init</span>(rt2);</span><br><span class="line">    <span class="keyword">int</span> lastans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="keyword">int</span> x, y;</span><br><span class="line">        <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        x = (x + lastans - <span class="number">1</span>) % n + <span class="number">1</span>;</span><br><span class="line">        y = (y + lastans - <span class="number">1</span>) % n + <span class="number">1</span>;</span><br><span class="line">        lastans = <span class="built_in">max</span>(tr1.<span class="built_in">solve</span>(x, y), tr2.<span class="built_in">solve</span>(x, y));</span><br><span class="line">        <span class="built_in">write</span>(lastans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF639F Bear and Chemistry é¢˜è§£</title>
    <url>/2021/12/03/sol-cf639f/</url>
    <content><![CDATA[<h2 id="CF639F-Bear-and-Chemistry-é¢˜è§£"><a href="#CF639F-Bear-and-Chemistry-é¢˜è§£" class="headerlink" title="CF639F Bear and Chemistry é¢˜è§£"></a>CF639F Bear and Chemistry é¢˜è§£</h2><span id="more"></span>
<p>åˆä¸€é“é»‘</p>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF639F">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ€è·¯å¾ˆå¥½æƒ³ï¼Œé¢„å¤„ç†ä¸€éè¾¹åŒç¼©ç‚¹å¾—åˆ°ä¸€æ£µæ ‘ï¼Œè¯¢é—®å»ºå®Œè™šæ ‘å†ä¸€éè¾¹åŒç¼©ç‚¹è·‘å‡ºæ¥$V$é›†åˆä¸­çš„ç‚¹æ˜¯å¦å…¨åœ¨ä¸€ä¸ªè¾¹åŒä¸­ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ï¼Œå¸¸æ•°å·¨å¤§ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><p>è°ƒäº†ä¸¤å¤©åå‘ç°æ˜¯å› ä¸º<del>tarjané€€æ ˆçš„æ—¶å€™æŠŠ<code>ins</code>æ ‡è®°æ”¹æˆäº†<code>true</code></del></p>
<p><del>å†™é¢˜ä¸æ³¨æ„ï¼Œå¯¹æ‹ä¸¤å°æ—¶ï¼ˆå…³é”®è¿˜$^{TM}$æ²¡æ‹å‡ºé”™è¯¯ï¼Ÿï¼‰</del></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF639F.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF639F</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LOGN = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">bool</span> m_be;</span><br><span class="line"><span class="keyword">int</span> n, m, q, k, h, cnt, len, is[MAXN], iu[MAXN], iv[MAXN], s[MAXN], nd[MAXN];</span><br><span class="line"><span class="keyword">int</span> idn, top, rt[MAXN], id[MAXN], dep[MAXN], fa[MAXN][LOGN], sta[MAXN];</span><br><span class="line"><span class="keyword">int</span> dfc1, bcc1, top1, sta1[MAXN], sfa1[MAXN], dfn1[MAXN], low1[MAXN], col1[MAXN];</span><br><span class="line"><span class="keyword">int</span> dfc2, bcc2, top2, sta2[MAXN], sfa2[MAXN], dfn2[MAXN], low2[MAXN], col2[MAXN];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; g[MAXN], tr[MAXN], vtr[MAXN];</span><br><span class="line"><span class="keyword">bool</span> ins1[MAXN], ins2[MAXN];</span><br><span class="line"><span class="keyword">bool</span> m_ed;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    sfa1[u] = f;</span><br><span class="line">    dfn1[u] = low1[u] = ++dfc1;</span><br><span class="line">    sta1[++top1] = u, ins1[u] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">int</span> cntf = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f) &#123;</span><br><span class="line">            ++cntf;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!dfn1[v]) &#123;</span><br><span class="line">            <span class="built_in">tarjan1</span>(v, u);</span><br><span class="line">            low1[u] = <span class="built_in">min</span>(low1[u], low1[v]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ins1[v]) &#123;</span><br><span class="line">            low1[u] = <span class="built_in">min</span>(low1[u], dfn1[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (f &amp;&amp; cntf &gt; <span class="number">1</span>)</span><br><span class="line">        low1[u] = <span class="built_in">min</span>(low1[u], dfn1[f]);</span><br><span class="line">    <span class="keyword">if</span> (dfn1[u] == low1[u]) &#123;</span><br><span class="line">        ++bcc1;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = sta1[top1--];</span><br><span class="line">            ins1[v] = <span class="literal">false</span>;</span><br><span class="line">            col1[v] = bcc1;</span><br><span class="line">            <span class="keyword">if</span> (u == v)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    sfa2[u] = f;</span><br><span class="line">    dfn2[u] = low2[u] = ++dfc2;</span><br><span class="line">    sta2[++top2] = u, ins2[u] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">int</span> cntf = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : vtr[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f) &#123;</span><br><span class="line">            ++cntf;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!dfn2[v]) &#123;</span><br><span class="line">            <span class="built_in">tarjan2</span>(v, u);</span><br><span class="line">            low2[u] = <span class="built_in">min</span>(low2[u], low2[v]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ins2[v]) &#123;</span><br><span class="line">            low2[u] = <span class="built_in">min</span>(low2[u], dfn2[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (f &amp;&amp; cntf &gt; <span class="number">1</span>)</span><br><span class="line">        low2[u] = <span class="built_in">min</span>(low2[u], dfn2[f]);</span><br><span class="line">    <span class="keyword">if</span> (dfn2[u] == low2[u]) &#123;</span><br><span class="line">        ++bcc2;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = sta2[top2--];</span><br><span class="line">            ins2[v] = <span class="literal">false</span>;</span><br><span class="line">            col2[v] = bcc2;</span><br><span class="line">            <span class="keyword">if</span> (u == v)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addvedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    vtr[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">    vtr[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    id[u] = ++idn, rt[u] = (f ? rt[f] : u);</span><br><span class="line">    dep[u] = dep[f] + <span class="number">1</span>, fa[u][<span class="number">0</span>] = f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : tr[u])</span><br><span class="line">        <span class="keyword">if</span> (v != f)</span><br><span class="line">            <span class="built_in">build1</span>(v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="keyword">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build2</span><span class="params">(<span class="keyword">int</span> rtx, <span class="keyword">int</span> cl)</span> </span>&#123;</span><br><span class="line">    sta[top = <span class="number">1</span>] = rtx, vtr[rtx].<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = cl; i &lt;= cnt &amp;&amp; rt[s[i]] == rtx; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] == rtx)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="built_in">lca</span>(s[i], sta[top]);</span><br><span class="line">        <span class="keyword">while</span> (id[l] &lt;= id[sta[top - <span class="number">1</span>]])</span><br><span class="line">            <span class="built_in">addvedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="keyword">if</span> (l != sta[top])</span><br><span class="line">            vtr[l].<span class="built_in">clear</span>(), <span class="built_in">addvedge</span>(l, sta[top]), sta[top] = nd[++len] = l;</span><br><span class="line">        vtr[s[i]].<span class="built_in">clear</span>(), sta[++top] = s[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">addvedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        <span class="keyword">if</span> (u == v)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">if</span> (!dfn1[i])</span><br><span class="line">            <span class="built_in">tarjan1</span>(i, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sfa1[i] &amp;&amp; col1[i] != col1[sfa1[i]]) &#123;</span><br><span class="line">            tr[col1[sfa1[i]]].<span class="built_in">push_back</span>(col1[i]);</span><br><span class="line">            tr[col1[i]].<span class="built_in">push_back</span>(col1[sfa1[i]]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= bcc1; ++i)</span><br><span class="line">        <span class="keyword">if</span> (!id[i])</span><br><span class="line">            <span class="built_in">build1</span>(i, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> rnd = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> tt = <span class="number">1</span>; tt &lt;= q; ++tt) &#123;</span><br><span class="line">        <span class="keyword">bool</span> answ = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">read</span>(k), <span class="built_in">read</span>(h), cnt = bcc2 = dfc2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            <span class="built_in">read</span>(is[i]), is[i] = (is[i] + rnd - <span class="number">1</span>) % n + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= h; ++i) &#123;</span><br><span class="line">            <span class="built_in">read</span>(iu[i]), iu[i] = (iu[i] + rnd - <span class="number">1</span>) % n + <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">read</span>(iv[i]), iv[i] = (iv[i] + rnd - <span class="number">1</span>) % n + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            s[++cnt] = col1[is[i]];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= h; ++i)</span><br><span class="line">            s[++cnt] = col1[iu[i]], s[++cnt] = col1[iv[i]];</span><br><span class="line">        <span class="built_in">sort</span>(s + <span class="number">1</span>, s + cnt + <span class="number">1</span>, [](<span class="keyword">int</span> x, <span class="keyword">int</span> y) &#123;</span><br><span class="line">            <span class="keyword">return</span> id[x] &lt; id[y];</span><br><span class="line">        &#125;);</span><br><span class="line">        len = cnt = <span class="built_in">unique</span>(s + <span class="number">1</span>, s + cnt + <span class="number">1</span>) - s - <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">copy</span>(s + <span class="number">1</span>, s + cnt + <span class="number">1</span>, nd + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i)</span><br><span class="line">            <span class="keyword">if</span> (rt[s[i]] != rt[s[i - <span class="number">1</span>]])</span><br><span class="line">                <span class="built_in">build2</span>(rt[s[i]], i);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= h; ++i)</span><br><span class="line">            <span class="keyword">if</span> (col1[iu[i]] != col1[iv[i]])</span><br><span class="line">                <span class="built_in">addvedge</span>(col1[iu[i]], col1[iv[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">            dfn2[nd[i]] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!dfn2[nd[i]])</span><br><span class="line">                <span class="built_in">tarjan2</span>(nd[i], <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            <span class="keyword">if</span> (col2[col1[is[i]]] != col2[col1[is[<span class="number">1</span>]]])</span><br><span class="line">                answ = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">puts</span>(answ ? <span class="string">&quot;YES&quot;</span> : <span class="string">&quot;NO&quot;</span>), (rnd += answ ? tt : <span class="number">0</span>) %= n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF1320E Treeland and Viruses é¢˜è§£</title>
    <url>/2021/12/01/sol-cf1320e/</url>
    <content><![CDATA[<h2 id="CF1320E-Treeland-and-Viruses-é¢˜è§£"><a href="#CF1320E-Treeland-and-Viruses-é¢˜è§£" class="headerlink" title="CF1320E Treeland and Viruses é¢˜è§£"></a>CF1320E Treeland and Viruses é¢˜è§£</h2><span id="more"></span>
<p><del>æ°´é»‘</del></p>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF1320E">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å»ºè™šæ ‘ï¼Œè·‘$dijkstra$ã€‚</p>
<p><del>æ‰€ä»¥è¿™é¢˜ä¸ºä»€ä¹ˆèƒ½è¯„é»‘</del></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><p><strong><code>nd</code>æ•°ç»„åˆ«å¼€å°äº†ï¼Œè¦å¼€$4 \times 10^5$</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF1320E.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF1320E</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LOGN = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFI = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">graph</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">edges</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> u, v, w;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], tot;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        tot = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(head));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">        edge[tot] = &#123;u, v, w&#125;;</span><br><span class="line">        nxt[tot] = head[u];</span><br><span class="line">        head[u] = tot++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">distant</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> id, fr, ve, dis; <span class="comment">// from, velocity, distance</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">calc</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ##sb-mistakes## `(0 - 1) / x + 1 == 1`ï¼Œè¦ç‰¹åˆ¤æˆ–è€…å†™æˆ`(? + x - 1) / x`</span></span><br><span class="line">        <span class="keyword">return</span> (dis + ve - <span class="number">1</span>) / ve;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> distant &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> cx = <span class="built_in">calc</span>(), cy = o.<span class="built_in">calc</span>();</span><br><span class="line">        <span class="keyword">return</span> cx == cy ? id &lt; o.id : cx &lt; cy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&gt;(<span class="keyword">const</span> distant &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> cx = <span class="built_in">calc</span>(), cy = o.<span class="built_in">calc</span>();</span><br><span class="line">        <span class="keyword">return</span> cx == cy ? id &lt; o.id : cx &lt; cy;</span><br><span class="line">    &#125;</span><br><span class="line">    distant <span class="keyword">operator</span>+(<span class="keyword">int</span> x) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> distant&#123;id, fr, ve, dis + x&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, q, k, m, cnt, idn, id[MAXN], nd[MAXM];</span><br><span class="line"><span class="keyword">int</span> top, sta[MAXN], dep[MAXN], fa[MAXN][LOGN];</span><br><span class="line"><span class="keyword">int</span> iv[MAXN], iu[MAXN], is[MAXN];</span><br><span class="line"><span class="comment">// ##sb-mistakes## `std::priority_queue`é»˜è®¤æ˜¯`std::less&lt;_Tp&gt;`ï¼Œè‡ªå®šä¹‰ç±»å‹è¦ä¹ˆæŒ‰ç…§`\gt`çš„é€»è¾‘é‡è½½`operator&lt;()`ï¼Œè¦ä¹ˆæŒ‰ç…§`\gt`çš„é€»è¾‘é‡è½½`operator&gt;()`å¹¶ä¸”ä¿®æ”¹é»˜è®¤å‚æ•°</span></span><br><span class="line">priority_queue&lt;pair&lt;distant, <span class="keyword">int</span>&gt;, vector&lt;pair&lt;distant, <span class="keyword">int</span>&gt;&gt;, greater&lt;pair&lt;distant, <span class="keyword">int</span>&gt;&gt;&gt; que;</span><br><span class="line">distant dis[MAXN];</span><br><span class="line">graph tr, vtr;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    id[u] = ++idn, fa[u][<span class="number">0</span>] = f, dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = tr.head[u]; ~i; i = tr.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (tr.edge[i].v != f)</span><br><span class="line">            <span class="built_in">build</span>(tr.edge[i].v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="keyword">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_vedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> w = dep[v] - dep[u];</span><br><span class="line">    vtr.<span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">    vtr.<span class="built_in">addedge</span>(v, u, w);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_vtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(nd + <span class="number">1</span>, nd + cnt + <span class="number">1</span>, [](<span class="keyword">int</span> x, <span class="keyword">int</span> y) &#123;</span><br><span class="line">        <span class="keyword">return</span> id[x] &lt; id[y];</span><br><span class="line">    &#125;);</span><br><span class="line">    cnt = <span class="built_in">unique</span>(nd + <span class="number">1</span>, nd + cnt + <span class="number">1</span>) - nd - <span class="number">1</span>;</span><br><span class="line">    sta[top = <span class="number">1</span>] = <span class="number">1</span>, vtr.head[<span class="number">1</span>] = <span class="number">-1</span>, vtr.tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nd[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="built_in">lca</span>(sta[top], nd[i]);</span><br><span class="line">        <span class="keyword">while</span> (id[l] &lt;= id[sta[top - <span class="number">1</span>]])</span><br><span class="line">            <span class="built_in">add_vedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="keyword">if</span> (sta[top] != l)</span><br><span class="line">            vtr.head[l] = <span class="number">-1</span>, <span class="built_in">add_vedge</span>(l, sta[top]), sta[top] = l;</span><br><span class="line">        vtr.head[nd[i]] = <span class="number">-1</span>, sta[++top] = nd[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">add_vedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear_dis</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    dis[u] = &#123;INFI, INFI, <span class="number">1</span>, INFI&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = vtr.head[u]; ~i; i = vtr.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (vtr.edge[i].v != f)</span><br><span class="line">            <span class="built_in">clear_dis</span>(vtr.edge[i].v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    tr.<span class="built_in">clear</span>(), vtr.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(u, v);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="built_in">read</span>(k), <span class="built_in">read</span>(m), cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            <span class="built_in">read</span>(iv[i]), <span class="built_in">read</span>(is[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">read</span>(iu[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            nd[++cnt] = iv[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            nd[++cnt] = iu[i];</span><br><span class="line">        <span class="built_in">build_vtr</span>(), <span class="built_in">clear_dis</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>())</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">            dis[iv[i]] = &#123;i, iv[i], is[i], <span class="number">0</span>&#125;;</span><br><span class="line">            que.<span class="built_in">push</span>(&#123;dis[iv[i]], iv[i]&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            distant d = que.<span class="built_in">top</span>().first;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">top</span>().second;</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span> (dis[u] &lt; d)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = vtr.head[u]; ~i; i = vtr.nxt[i]) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = vtr.edge[i].v, w = vtr.edge[i].w;</span><br><span class="line">                <span class="keyword">if</span> (d + w &lt; dis[v]) &#123;</span><br><span class="line">                    dis[v] = d + w;</span><br><span class="line">                    que.<span class="built_in">push</span>(&#123;dis[v], v&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">write</span>(dis[iu[i]].id), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == m]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4606 æˆ˜ç•¥æ¸¸æˆ é¢˜è§£</title>
    <url>/2021/11/29/sol-p4606/</url>
    <content><![CDATA[<h2 id="P4606-æˆ˜ç•¥æ¸¸æˆ-é¢˜è§£"><a href="#P4606-æˆ˜ç•¥æ¸¸æˆ-é¢˜è§£" class="headerlink" title="P4606 æˆ˜ç•¥æ¸¸æˆ é¢˜è§£"></a>P4606 æˆ˜ç•¥æ¸¸æˆ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4606">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><blockquote>
<p>åœ†æ–¹æ ‘ä¸Šåœ†æ–¹æœ</p>
<p>åœ†æ–¹æ ‘ä¸‹ä½ å’Œæˆ‘</p>
<p>åœ†æ–¹æ ‘å‰å»ºè™šæ ‘</p>
<p>æ¬¢ä¹å¤šåˆå¤š <del>/kk</del></p>
</blockquote>
<p>çœ‹åˆ°$\sum|S|$äºæ˜¯å¼€å§‹å¥—è·¯åœ°æƒ³åˆ°è™šæ ‘ã€‚</p>
<p>ä½†æ˜¯ç»™å®šçš„æ˜¯ä¸€ä¸ªæ— å‘å›¾ä¸æ˜¯ä¸€æ£µæ ‘å•Šâ€¦â€¦</p>
<p>æ‰€ä»¥è¦æƒ³åŠæ³•æŠŠå›¾è½¬åŒ–æˆä¸€æ£µæ ‘ï¼Œè¿™æ ·çš„æ•°æ®ç»“æ„å«åš<a href="https://oi-wiki.org/graph/block-forest/">åœ†æ–¹æ ‘</a>ã€‚</p>
<p><del><strong>è¿™é‡Œå‡è®¾ä½ å·²ç»å­¦ä¼šåœ†æ–¹æ ‘äº†</strong></del></p>
<p>è€ƒè™‘åœ†æ–¹æ ‘çš„æ€§è´¨ã€‚æ˜¾ç„¶å¯¹äºä¸€å¯¹èŠ‚ç‚¹$(u, v)$ï¼Œå®ƒä»¬åœ¨åœ†æ–¹æ ‘ä¸Šçš„è·¯å¾„ä¸­çš„åœ†ç‚¹ï¼ˆä¸åŒ…æ‹¬è‡ªèº«ï¼‰å°±æ˜¯åˆ æ‰åèƒ½ä½¿å¾—$u$å’Œ$v$ä¸è¿é€šçš„ç‚¹ã€‚å› ä¸ºæ ¹æ®åœ†æ–¹æ ‘çš„æ€§è´¨ï¼Œæ‰€æœ‰å’ŒåŒä¸€ä¸ªæ–¹ç‚¹è¿è¾¹çš„åœ†ç‚¹éƒ½åœ¨åŒä¸€ä¸ªåŒè”é€šåˆ†é‡é‡Œï¼Œå»æ‰ä¸€ä¸ªæ–¹ç‚¹ä¸ä¼šæ”¹å˜å›¾çš„è¿é€šæ€§ã€‚è€Œé‚£äº›å’Œå¤šä¸ªæ–¹ç‚¹è¿è¾¹çš„åœ†ç‚¹éƒ½å¯ä»¥æˆä¸ºè¿™äº›æ–¹ç‚¹çš„å‰²ç‚¹ï¼Œå»æ‰åå›¾çš„è¿é€šæ€§å°±æ”¹å˜äº†ã€‚</p>
<p>äºæ˜¯ç­”æ¡ˆå°±æ˜¯æ‰€æœ‰ç‰¹æ®ŠèŠ‚ç‚¹ä¹‹é—´çš„è·¯å¾„å¹¶ä¸Šåœ†ç‚¹æ•°é‡å‡å»$|S|$ã€‚</p>
<p>æ€è·¯è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä¸»è¦æ˜¯ä»£ç ä¸­çš„<del>äº¿ç‚¹ç‚¹</del>ç»†èŠ‚ã€‚æ¯”å¦‚è¯´<code>MAXN</code>è¦å¼€ä¸¤å€å¤§å°ï¼ˆå› ä¸ºæœ‰åœ†æ–¹æ ‘ï¼‰ã€ç»Ÿè®¡ç­”æ¡ˆä¸è¦æŠŠè™šæ ‘çš„æ‰€æœ‰è¾¹æƒéƒ½åŠ ä¸Šï¼ˆå› ä¸ºè™šæ ‘è¦å»ºç«‹èŠ‚ç‚¹$1$è€Œæœ‰æ—¶èŠ‚ç‚¹$1$å¹¶ä¸å‡ºç°åœ¨è·¯å¾„å¹¶ä¸­ï¼‰<del>ä»¥åŠå¤šæµ‹è¦æ¸…ç©º<code>dfn</code>æ•°ç»„</del>ç­‰ç­‰ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ï¼ˆæ„Ÿè§‰å¸¸æ•°å·¨å¤§æ— æ¯”ï¼‰ã€‚è°ƒäº†ä¸¤å¤©ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4606.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4606</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">8e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> LOGN = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Graph</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> v, w;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], tot;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">        edge[tot] = &#123;v, w&#125;;</span><br><span class="line">        nxt[tot] = head[u];</span><br><span class="line">        head[u] = tot++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, q, k, dfc, top, bcc, idn;</span><br><span class="line"><span class="keyword">int</span> s[MAXN], dfn[MAXN], low[MAXN], sta[MAXN];</span><br><span class="line"><span class="keyword">int</span> id[MAXN], dep[MAXN], fa[MAXN][LOGN];</span><br><span class="line"><span class="keyword">bool</span> tag[MAXN];</span><br><span class="line">Graph g, tr, vtr;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    g.tot = tr.tot = vtr.tot = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// ##sb-mistakes## å¤šæµ‹ä¸æ¸…ç©ºï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª/kk å¤šæµ‹`dfn`æ•°ç»„è®°å¾—æ¸…ç©ºå•Š</span></span><br><span class="line">    <span class="built_in">memset</span>(dfn, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dfn));</span><br><span class="line">    <span class="built_in">memset</span>(g.head, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(g.head));</span><br><span class="line">    <span class="built_in">memset</span>(tr.head, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(tr.head));</span><br><span class="line">    <span class="built_in">memset</span>(vtr.head, <span class="number">-1</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(vtr.head));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    dfn[u] = low[u] = ++dfc;</span><br><span class="line">    sta[++top] = u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = g.head[u]; ~i; i = g.nxt[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = g.edge[i].v;</span><br><span class="line">        <span class="keyword">if</span> (!dfn[v]) &#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(v);</span><br><span class="line">            low[u] = <span class="built_in">min</span>(low[u], low[v]);</span><br><span class="line">            <span class="keyword">if</span> (dfn[u] == low[v]) &#123;</span><br><span class="line">                ++bcc;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x != v; --top) &#123;</span><br><span class="line">                    x = sta[top];</span><br><span class="line">                    tr.<span class="built_in">addedge</span>(bcc, x);</span><br><span class="line">                    tr.<span class="built_in">addedge</span>(x, bcc);</span><br><span class="line">                &#125;</span><br><span class="line">                tr.<span class="built_in">addedge</span>(bcc, u);</span><br><span class="line">                tr.<span class="built_in">addedge</span>(u, bcc);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            low[u] = <span class="built_in">min</span>(low[u], dfn[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    id[u] = ++idn;</span><br><span class="line">    fa[u][<span class="number">0</span>] = f;</span><br><span class="line">    dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = tr.head[u]; ~i; i = tr.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (tr.edge[i].v != f)</span><br><span class="line">            <span class="built_in">build</span>(tr.edge[i].v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="keyword">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_vedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> w = ((dep[v] - dep[u]) &amp; <span class="number">1</span>) ? ((dep[v] - dep[u]) / <span class="number">2</span>) : ((dep[v] - dep[u]) / <span class="number">2</span> - (v &lt;= n));</span><br><span class="line">    vtr.<span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_vtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(s + <span class="number">1</span>, s + k + <span class="number">1</span>, [](<span class="keyword">int</span> x, <span class="keyword">int</span> y) &#123;</span><br><span class="line">        <span class="keyword">return</span> id[x] &lt; id[y];</span><br><span class="line">    &#125;);</span><br><span class="line">    sta[top = <span class="number">1</span>] = <span class="number">1</span>, vtr.head[<span class="number">1</span>] = <span class="number">-1</span>, vtr.tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="built_in">lca</span>(sta[top], s[i]);</span><br><span class="line">        <span class="keyword">if</span> (l &lt; <span class="number">1</span> || l &gt; bcc)</span><br><span class="line">            <span class="built_in">lca</span>(sta[top], s[i]);</span><br><span class="line">        <span class="keyword">while</span> (id[l] &lt;= id[sta[top - <span class="number">1</span>]])</span><br><span class="line">            <span class="built_in">add_vedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="keyword">if</span> (sta[top] != l)</span><br><span class="line">            vtr.head[l] = <span class="number">-1</span>, <span class="built_in">add_vedge</span>(l, sta[top]), sta[top] = l;</span><br><span class="line">        vtr.head[s[i]] = <span class="number">-1</span>, sta[++top] = s[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">add_vedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">bool</span> tg)</span> </span>&#123;</span><br><span class="line">    tg |= tag[u];</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>, sum = (u &lt;= n), chd = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = vtr.head[u]; ~i; i = vtr.nxt[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = vtr.edge[i].v, w = vtr.edge[i].w;</span><br><span class="line">        sum += w, ret += <span class="built_in">calc</span>(v, tg), chd++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret + ((tg || chd &gt; <span class="number">1</span>) ? sum : <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    bcc = n, dfc = idn = <span class="number">0</span>, <span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g.<span class="built_in">addedge</span>(u, v);</span><br><span class="line">        g.<span class="built_in">addedge</span>(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    top = <span class="number">0</span>, <span class="built_in">tarjan</span>(<span class="number">1</span>), <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="built_in">read</span>(k);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            <span class="built_in">read</span>(s[i]), tag[s[i]] = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">build_vtr</span>();</span><br><span class="line">        <span class="built_in">write</span>(<span class="built_in">calc</span>(<span class="number">1</span>, <span class="literal">false</span>) - k), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            tag[s[i]] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    <span class="built_in">read</span>(t);</span><br><span class="line">    <span class="keyword">while</span> (t--)</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3803 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰</title>
    <url>/2021/11/28/sol-p3803/</url>
    <content><![CDATA[<h2 id="P3803-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰"><a href="#P3803-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰" class="headerlink" title="P3803 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰"></a>P3803 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3803">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>FFT æ¨¡ç‰ˆé¢˜</p>
<p>ä¸ºäº†é˜²æ­¢è‡ªå·±å¿˜è®°å°±å†™ä¸€ä¸‹è¯æ˜å§ã€‚é¡ºä¾¿æŠŠ NTT ä¹Ÿå†™ä¸€ä¸‹ã€‚</p>
<h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><h4 id="å¤šé¡¹å¼è¡¨ç¤ºæ–¹æ³•"><a href="#å¤šé¡¹å¼è¡¨ç¤ºæ–¹æ³•" class="headerlink" title="å¤šé¡¹å¼è¡¨ç¤ºæ–¹æ³•"></a>å¤šé¡¹å¼è¡¨ç¤ºæ–¹æ³•</h4><h5 id="ç³»æ•°è¡¨ç¤ºæ³•"><a href="#ç³»æ•°è¡¨ç¤ºæ³•" class="headerlink" title="ç³»æ•°è¡¨ç¤ºæ³•"></a>ç³»æ•°è¡¨ç¤ºæ³•</h5><p>å³</p>
<script type="math/tex; mode=display">f(x) = \sum_{i=0}^{n-1}{a_ix^i}</script><h5 id="ç‚¹å€¼è¡¨ç¤ºæ³•"><a href="#ç‚¹å€¼è¡¨ç¤ºæ³•" class="headerlink" title="ç‚¹å€¼è¡¨ç¤ºæ³•"></a>ç‚¹å€¼è¡¨ç¤ºæ³•</h5><p>ä¸å¦¨å°†å¤šé¡¹å¼çœ‹æˆä¸€ä¸ª$n-1$æ¬¡å‡½æ•°ï¼Œä»ä¸Šé¢å–$n$ä¸ªç‚¹æ¥å”¯ä¸€åœ°è¡¨ç¤ºè¿™ä¸ªå‡½æ•°ã€‚</p>
<p>è®¾æƒ³ä¸€ä¸‹é«˜æ–¯æ¶ˆå…ƒæ³•ï¼Œå°±èƒ½çŸ¥é“ä¸ºä»€ä¹ˆ$n$ä¸ªä¸åŒçš„ç‚¹å°±èƒ½å”¯ä¸€ç¡®å®šè¿™ä¸ªå‡½æ•°äº†ã€‚</p>
<script type="math/tex; mode=display">f(x) = \{(x_0,y_0),(x_1,y_1),\cdots,(x_{n-1},y_{n-1})\}</script><p>è¿™æ ·çš„è¡¨ç¤ºæ³•æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯å¦‚æœè¦è®¡ç®—å¤šé¡¹å¼ä¹˜æ³•ï¼Œè®¾</p>
<script type="math/tex; mode=display">g(x) = \{(x_0,g(x_0)),(x_1,g(x_1)),\cdots,(x_{n-1},g(x_{n-1}))\}</script><script type="math/tex; mode=display">h(x) = \{(x_0,h(x_0)),(x_1,h(x_1)),\cdots,(x_{n-1},h(x_{n-1}))\}</script><p>é‚£ä¹ˆ</p>
<script type="math/tex; mode=display">
\begin{aligned}
f(x) &= g(x) \times h(x) \\
&= \{(x_0,g(x_0)h(x_0)),(x_1,g(x_1)h(x_1)),\cdots,(x_{n-1},g(x_{n-1})h(x_{n-1}))\}
\end{aligned}</script><p>å°±å¯ä»¥$O(n)$åœ°æ±‚å‡ºå¤šé¡¹å¼ä¹˜æ³•ã€‚</p>
<p>æ‰€ä»¥FFTè¦åšçš„äº‹å°±æ˜¯å°†ç³»æ•°è¡¨ç¤ºæ³•å’Œç‚¹å€¼è¡¨ç¤ºæ³•è¿›è¡Œè½¬æ¢ã€‚</p>
<h4 id="å¤æ•°ï¼ˆè¿™ä¸ªå¤§å®¶éƒ½ä¼šï¼‰"><a href="#å¤æ•°ï¼ˆè¿™ä¸ªå¤§å®¶éƒ½ä¼šï¼‰" class="headerlink" title="å¤æ•°ï¼ˆè¿™ä¸ªå¤§å®¶éƒ½ä¼šï¼‰"></a>å¤æ•°ï¼ˆè¿™ä¸ªå¤§å®¶éƒ½ä¼šï¼‰</h4><p>ä»¤$i^2 = -1$ï¼Œå¤æ•°å¯è¢«è¡¨ç¤ºä¸º$a + bi$çš„å½¢å¼</p>
<p>è€ƒè™‘åœ¨å¤å¹³é¢ä¸Šçš„ä¸¤ä¸ªå‘é‡$(a,b)$å’Œ$(c,d)$ï¼Œå°†å…¶è¡¨ç¤ºçš„å¤æ•°ç›¸ä¹˜å¾—åˆ°$(a + bi) \times (c + di) = ac - bd + (ad + bc)i$ï¼Œå³å‘é‡$(ac - bd, ad + bc)$ã€‚</p>
<p>æˆ‘ä»¬è®¡ç®—å‡ ä¸ªå‘é‡çš„æ¨¡ï¼Œåˆ†åˆ«ä¸º$\sqrt{a^2 + b^2}$ï¼Œ$\sqrt{c^2 + d^2}$å’Œ$\sqrt{a^2c^2 + b^2d^2 + a^2d^2 + b^2c^2} = \sqrt{(a^2 + b^2) \times (c^2 + d^2)}$ï¼Œå³ä¸¤ä¸ªå‘é‡æ¨¡é•¿çš„ä¹˜ç§¯ã€‚</p>
<p>æ‰€ä»¥å¦‚æœä¸¤ä¸ªåŸå‘é‡æ¨¡é•¿éƒ½ä¸º$1$ï¼Œä¹˜ç§¯çš„å‘é‡ä¹Ÿä¸º$1$ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå¤å¹³é¢ä¸Šå•ä½åœ†ä¸Šçš„å‘é‡ï¼Œè®¾å…¶è¾è§’åˆ†åˆ«ä¸º$\alpha$å’Œ$\beta$ï¼Œåˆ™è¿™ä¸¤ä¸ªå‘é‡è¡¨ç¤ºä¸º$(\cos\alpha,\sin\alpha)$å’Œ$(\cos\beta,\sin\beta)$ï¼Œå…¶ä¹˜ç§¯ä¸º$(\cos\alpha\cos\beta-\sin\alpha\sin\beta,\cos\alpha\sin\beta+\sin\alpha\cos\beta)$ã€‚æ ¹æ®äºŒè§’å’Œå·®å…¬å¼</p>
<script type="math/tex; mode=display">\cos(\alpha + \beta) = \cos\alpha\cos\beta-\sin\alpha\sin\beta</script><script type="math/tex; mode=display">\sin(\alpha + \beta) = \sin\alpha\cos\beta+\cos\alpha\sin\beta</script><p>å¯ä»¥å‘ç°è¿™ä¸ªæ–°çš„å‘é‡çš„è¾è§’å°±ç­‰äºä¸¤ä¸ªåŸå‘é‡çš„è¾è§’ç›¸åŠ ã€‚äºæ˜¯å°†å¾—åˆ°ç»“è®ºï¼šä¸¤ä¸ªæ¨¡é•¿ä¸º$1$çš„å‘é‡ç›¸ä¹˜ï¼Œå¾—åˆ°çš„ä»æ˜¯æ¨¡é•¿ä¸º$1$çš„å‘é‡ï¼Œè¾è§’ä¸ºä¸¤ä¸ªå‘é‡è¾è§’çš„å’Œã€‚</p>
<h4 id="å•ä½å¤æ ¹"><a href="#å•ä½å¤æ ¹" class="headerlink" title="å•ä½å¤æ ¹"></a>å•ä½å¤æ ¹</h4><p>ç”±äºæˆ‘ä»¬è¦å»è®¡ç®—è‹¥å¹²ä¸ª$x_i$å¯¹åº”çš„$f(x_i)$ï¼Œæœ€å¥½çš„åŠæ³•ä¾¿æ˜¯æ‰¾ä¸€äº›ç‰¹æ®Šçš„æ•°å€¼å¸¦è¿›å»è®¡ç®—ã€‚è¿™é‡Œå¼•å…¥å•ä½å¤æ ¹çš„æ¦‚å¿µã€‚</p>
<p>æˆ‘ä»¬ç§°$x^n = 1$åœ¨å¤æ•°æ„ä¹‰ä¸‹çš„è§£æ˜¯$n$æ¬¡å¤æ ¹ã€‚æ˜¾ç„¶è¿™æ ·çš„è§£æœ‰$n$ä¸ªã€‚è®¾$\omega_n = e^{\frac{2\pi i}{n}}$ï¼Œåˆ™$x^n = 1$çš„è§£é›†è¡¨ç¤ºä¸º$\{\omega^k_n \mid k=0,1,\cdots,n-1\}$ï¼Œç§°$w_n$ä¸º$n$æ¬¡å•ä½å¤æ ¹ã€‚æ ¹æ®å¤å¹³é¢çš„çŸ¥è¯†ï¼Œ$n$æ¬¡å•ä½å¤æ ¹æ˜¯å¤å¹³é¢æŠŠå•ä½åœ†$n$ç­‰åˆ†çš„ç¬¬ä¸€ä¸ªè§’æ‰€å¯¹åº”çš„å‘é‡ï¼Œå…¶ä»–å¤æ ¹å‡å¯ä»¥ç”¨å•ä½å¤æ ¹çš„å¹‚è¡¨ç¤ºã€‚</p>
<p>æ‰€ä»¥æ˜¾ç„¶è¿˜èƒ½å¾—åˆ°$\omega_n = e^{\frac{2\pi i}{n}} = \cos(\frac{2\pi}{n}) + i \sin(\frac{2\pi}{n})$ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œ$n=4$æ—¶ï¼Œ$w_n = i$ï¼Œå¦‚å›¾æ‰€ç¤ºï¼ˆå›¾æ¥è‡ª<a href="https://oi-wiki.org/math/poly/fft/">oi-wiki</a>ï¼‰</p>
<p><img src="fft-1.png" alt="fft-1"></p>
<p>å¹¶ä¸”å•ä½å¤æ ¹è¿˜æœ‰ä¸‰ä¸ªé‡è¦çš„æ€§è´¨å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
w^n_n &= 1 \\
w^k_n &= w^{2k}_{2n} \\
w^{k+n}_{2n} &= -w^k_{2n}
\end{aligned}</script><h4 id="ç»ˆäºå¼€å§‹è®²FFTäº†"><a href="#ç»ˆäºå¼€å§‹è®²FFTäº†" class="headerlink" title="ç»ˆäºå¼€å§‹è®²FFTäº†"></a>ç»ˆäºå¼€å§‹è®²FFTäº†</h4><p>FFTå…¶æœ¬è´¨ä¸ºåˆ†æ²»ç®—æ³•ã€‚æ¯”æ–¹è¯´å¯¹äº</p>
<script type="math/tex; mode=display">f(x) = a_0 + a_1x + a_2x^2 + a_3x^3 + a_4x^4 + a_5x^5 + a_6x^6 + a_7x^7</script><p>æŒ‰ç…§æ¬¡æ•°çš„å¥‡å¶æ¥åˆ†ç»„å¾—åˆ°</p>
<script type="math/tex; mode=display">f(x) = (a_0 + a_2x^2 + a_4x^4 + a_6x^6) + (a_1x^1 + a_3x^3 + a_5x^5 + a_7x^7)</script><p>å³è¾¹æå–$x$å¾—åˆ°</p>
<script type="math/tex; mode=display">f(x) = (a_0 + a_2x^2 + a_4x^4 + a_6x^6) + x(a_1 + a_3x^2 + a_5x^4 + a_7x^6)</script><p>æŒ‰ç…§å¥‡å¶æ¬¡é¡¹å»ºç«‹æ–°çš„å‡½æ•°</p>
<script type="math/tex; mode=display">g(x) = a_0 + a_2x^1 + a_4x^2 + a_6x^3</script><script type="math/tex; mode=display">h(x) = a_1 + a_3x^1 + a_5x^2 + a_7x^3</script><p>åŸæ¥çš„$f(x)$å¯ä»¥è¢«è¡¨ç¤ºæˆ</p>
<script type="math/tex; mode=display">f(x) = g(x^2) + x \times h(x^2)</script><p>åˆ©ç”¨å•ä½å¤æ ¹çš„æ€§è´¨å¾—åˆ°</p>
<script type="math/tex; mode=display">\begin{aligned}
FFT(f(\omega^k_n)) &= FFT(g((\omega^k_n)^2)) + \omega^k_n \times FFT(h((\omega^k_n)^2)) \\
&= FFT(g(\omega^{2k}_n)) + \omega^k_n \times FFT(h(\omega^{2k}_n)) \\
&= FFT(g(\omega^k_{n/2})) + \omega^k_n \times FFT(h(\omega^k_{n/2}))
\end{aligned}</script><p>åŒç†å¯å¾—</p>
<script type="math/tex; mode=display">\begin{aligned}
FFT(f(\omega^{k+n/2}_n)) &= FFT(g(\omega^{2k+n}_n)) + \omega^{k+n/2}_n \times FFT(h(\omega^{2k+n}_n)) \\
&= FFT(g(\omega^{2k}_n)) - \omega^k_n \times FFT(h(\omega^{2k}_n)) \\
&= FFT(g(\omega^k_{n/2})) - \omega^k_n \times FFT(h(\omega^k_{n/2}))
\end{aligned}</script><p>è€Œç”±äº$n/2$éœ€è¦ä¸€ç›´ä¸ºæ•´æ•°ï¼Œæ‰€ä»¥$n$éœ€è¦æ˜¯$2^m$ï¼Œä¸å¦¨åœ¨ä¸€å¼€å§‹å°†å¤šé¡¹å¼çš„æ¬¡æ•°è¡¥åˆ°é•¿åº¦ä¸ºé•¿åº¦ä¸º$2^m$ï¼Œæ¬¡æ•°ä¸º$2^m-1$çš„å¤šé¡¹å¼å³å¯ã€‚</p>
<p>ä»£ç å®ç°æ–¹é¢ï¼ŒSTLæä¾›äº†å¤æ•°çš„æ¨¡ç‰ˆï¼ˆæˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡çŸ¥é“æœ‰è¿™ç§å¥½äº‹ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨<code>std::complex&lt;double&gt;</code>ã€‚</p>
<h4 id="NTT"><a href="#NTT" class="headerlink" title="NTT"></a>NTT</h4><p>æ¨¡ç‰ˆå’ŒFFTåŸºæœ¬ç›¸åŒï¼Œç”¨<a href="https://oi-wiki.org/math/number-theory/primitive-root/">åŸæ ¹</a>ä»£æ›¿å•ä½å¤æ ¹ï¼ˆæ€§è´¨åŸºæœ¬ç›¸åŒï¼‰ã€‚</p>
<script type="math/tex; mode=display">p = 998244353 = 7 \times 17 \times 2^{23} + 1, g = 3</script><script type="math/tex; mode=display">p = 1004535809 = 479 \times 2^{21} + 1, g = 3</script><script type="math/tex; mode=display">p = 469762049 = 7 \times 2^{26} + 1, g = 3</script><p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3803.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3803</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> comp = complex&lt;<span class="keyword">double</span>&gt;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">21</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> fft &#123;</span><br><span class="line">    <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(comp *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fft</span><span class="params">(comp *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * M_PI / h), sin(<span class="number">2</span> * M_PI / h))</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                    f[k] = u + t;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                    w = w * wn;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i].<span class="built_in">real</span>(f[i].<span class="built_in">real</span>() / len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> n, m, len;</span><br><span class="line">    comp a[MAXN], b[MAXN], ans[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> x;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            a[i].<span class="built_in">real</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> x;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            b[i].<span class="built_in">real</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt;= n + m)</span><br><span class="line">            len *= <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">fft</span>(a, len, <span class="number">1</span>), <span class="built_in">fft</span>(b, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            ans[i] = a[i] * b[i];</span><br><span class="line">        <span class="built_in">fft</span>(ans, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n + m; ++i)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>, (<span class="keyword">int</span>)(ans[i].<span class="built_in">real</span>() + <span class="number">0.5</span>), <span class="string">&quot; \n&quot;</span>[i == n + m]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> ntt &#123;</span><br><span class="line">    <span class="keyword">int</span> rev[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ntt</span><span class="params">(<span class="keyword">int</span> *f, <span class="keyword">int</span> len, <span class="keyword">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="keyword">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> n, m, len;</span><br><span class="line">    <span class="keyword">int</span> a[MAXN], b[MAXN], ans[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="built_in">read</span>(a[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">read</span>(b[i]);</span><br><span class="line">        len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt;= n + m)</span><br><span class="line">            len *= <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">ntt</span>(a, len, <span class="number">1</span>), <span class="built_in">ntt</span>(b, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            ans[i] = a[i] * b[i] % MOD;</span><br><span class="line">        <span class="built_in">ntt</span>(ans, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n + m; ++i)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>, ans[i], <span class="string">&quot; \n&quot;</span>[i == n + m]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// return fft::main();</span></span><br><span class="line">    <span class="keyword">return</span> ntt::<span class="built_in">main</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3233 ä¸–ç•Œæ ‘ é¢˜è§£</title>
    <url>/2021/11/27/sol-p3233/</url>
    <content><![CDATA[<h2 id="P3233-ä¸–ç•Œæ ‘-é¢˜è§£"><a href="#P3233-ä¸–ç•Œæ ‘-é¢˜è§£" class="headerlink" title="P3233 ä¸–ç•Œæ ‘ é¢˜è§£"></a>P3233 ä¸–ç•Œæ ‘ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3233">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p><strong>ä»¥ä¸‹æ‰€æœ‰çš„â€œå…³é”®ç‚¹â€éƒ½è¡¨ç¤ºé¢˜ç›®ä¸­çš„è®®äº‹å¤„</strong></p>
<p>çœ‹å®Œè¿™é¢˜é¢˜è§£åå»å­¦ä¹ äº†è™šæ ‘<del>ï¼ˆç„¶åday2ä¸Šåˆæ¨¡æ‹Ÿèµ›è€ƒäº†é“ç±»ä¼¼è™šæ ‘ä½†ä¸ç”¨å»º$lca$çš„é¢˜ç›®ï¼‰</del></p>
<p>äºæ˜¯çœ‹åˆ°$\sum m \le 3 \times 10^5$ ç›´æ¥å»ºç«‹è™šæ ‘ï¼ˆç„¶è€Œå¦‚æœæ²¡å­¦è¿‡è™šæ ‘å°±çœ‹ä¸å‡ºæ¥äº†ï¼‰ã€‚</p>
<p>ç”¨<code>pair&lt;int, int&gt;</code>å‚¨å­˜æ ‘ä¸ŠèŠ‚ç‚¹åˆ°è¾¾æœ€è¿‘å…³é”®ç‚¹çš„è·ç¦»å’Œå…³é”®ç‚¹ç¼–å·ä»¥ä¾¿äºæ¯”è¾ƒã€‚å…ˆå¯¹è™šæ ‘ä¸Šçš„èŠ‚ç‚¹åšä¸€éæ¢æ ¹$dp$ï¼Œæ–¹ç¨‹æ˜¾ç„¶æ˜¯$dp_u = \min\limits_{v,w}{dp_v + w}$å…¶ä¸­$v, w$åˆ†åˆ«ä¸ºå­èŠ‚ç‚¹å’Œåˆ°å­èŠ‚ç‚¹çš„è·ç¦»ã€‚ä¹‹åä¸ºäº†æ–¹ä¾¿è¡¨è¿°è®¾<strong>$f_u$è¡¨ç¤º<code>dp[u].first</code>ï¼Œ$g_u$è¡¨ç¤º<code>dp[u].second</code></strong>ã€‚</p>
<p>æ¥ä¸‹æ¥è€ƒè™‘ä¸åœ¨è™šæ ‘ä¸Šçš„èŠ‚ç‚¹ã€‚é¦–å…ˆå¦‚æœè™šæ ‘ä¸ŠæŸèŠ‚ç‚¹çš„ä¸€ä¸ªåŸæ ‘ä¸Šå­èŠ‚ç‚¹çš„å­æ ‘ä¸­éƒ½æ²¡æœ‰è™šæ ‘ä¸Šçš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥å­æ ‘ä¸­çš„çš„æ‰€æœ‰èŠ‚ç‚¹çš„æœ€è¿‘å…³é”®ç‚¹éƒ½åº”å½“ä¸è¯¥è™šæ ‘èŠ‚ç‚¹ç›¸åŒã€‚å½¢å¼åŒ–åœ°ï¼Œè‹¥å¯¹äºè™šæ ‘ä¸Šçš„èŠ‚ç‚¹$u$æœ‰èŠ‚ç‚¹$u \to v_{real}$ä½¿å¾—ä¸å­˜åœ¨$v_{real} \to \cdots \to x$åœ¨è™šæ ‘ä¸Šï¼Œé‚£ä¹ˆ$g_x = g_u$ï¼Œå³$cnt_{g_u} += siz_{v_{real}}$ã€‚å¦‚åœ¨ä¸‹å›¾ä¸­çš„èŠ‚ç‚¹ä¸­$v=6,v=7,v=10$éƒ½æ»¡è¶³è¯¥ç§æƒ…å†µï¼ˆåŠ ç²—èŠ‚ç‚¹è¡¨ç¤ºè™šæ ‘èŠ‚ç‚¹ï¼‰ã€‚</p>
<p><img src="sol-p3233-1.png" alt="è™šæ ‘"></p>
<p>å…¶æ¬¡æ˜¯åœ¨è™šæ ‘çš„é“¾ä¸Šçš„ç‚¹ã€‚ä¸å¦¨å°†ä¾‹å¦‚ä¸Šå›¾ä¸­çš„èŠ‚ç‚¹$9$è®¡ç®—åˆ°èŠ‚ç‚¹$4$ä¸­ï¼ˆå› ä¸º$g_4$ä¸€å®šç­‰äº$g_9$ï¼‰ï¼Œè€ƒè™‘ä¸€æ¡é“¾$fa \to u$ï¼Œè‹¥$g_{fa} = g_u$åˆ™é“¾ä¸ŠèŠ‚ç‚¹å…¨éƒ¨åŠ åˆ°$g_u$ä¸­ï¼ˆåŒæ ·è®¾$v_{real}$è¡¨ç¤º$fa$åœ¨åŸæ ‘ä¸­çš„$u$æ–¹å‘çš„å­èŠ‚ç‚¹ï¼Œç›¸å½“äº$cnt_{g_u} += siz_{v_{real}} - siz_u$ï¼‰ï¼Œå¦åˆ™å€å¢æ‰¾åˆ°æ·±åº¦æœ€å°çš„æ»¡è¶³å–$g_u$æ›´ä¼˜çš„ç‚¹$cur$ï¼Œæ˜¾ç„¶$cnt_{g_u} += siz_{cur} - siz_u$ï¼Œ$cnt_{g_{fa}} += siz_{v_{real}} - siz_{cur}$ã€‚</p>
<p>äºæ˜¯æœ¬é¢˜å°±ç»“æŸäº†ã€‚åªæ˜¯æœ‰å¤ªå¤šå¤ªå¤šç»†èŠ‚è¦æ³¨æ„äº†ï¼Œ<del>å†™é”™ä¸€ä¸ªè°ƒä¸€æ•´å¹´å•Š/kk</del></p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ç¨³è¿‡ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3233.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3233</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> pii = pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">6e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXK = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">graph</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> u, v, w;</span><br><span class="line">    &#125; e[MAXM];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], tot;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">        e[++tot] = &#123;u, v, w&#125;;</span><br><span class="line">        nxt[tot] = head[u];</span><br><span class="line">        head[u] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, q, top, inde, h[MAXN], dfn[MAXN], dep[MAXN];</span><br><span class="line"><span class="keyword">int</span> fa[MAXN][MAXK], siz[MAXN], sta[MAXN], cnt[MAXN], ori[MAXN];</span><br><span class="line">pii dis[MAXN][<span class="number">2</span>], tmp[MAXN], pre[MAXN], nxt[MAXN];</span><br><span class="line"><span class="keyword">bool</span> tag[MAXN];</span><br><span class="line">graph tr, vtr;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_tr</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    siz[u] = <span class="number">1</span>, dfn[u] = ++inde, dep[u] = dep[f] + <span class="number">1</span>, fa[u][<span class="number">0</span>] = f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAXK; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = tr.head[u]; i; i = tr.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (tr.e[i].v != f)</span><br><span class="line">            <span class="built_in">build_tr</span>(tr.e[i].v, u), siz[u] += siz[tr.e[i].v];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="keyword">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">jump</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((d &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_vedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// debug(&quot;virtual tree: %lld -&gt; %lld, w = %lld&quot;, u, v, dep[v] - dep[u]);</span></span><br><span class="line">    vtr.<span class="built_in">addedge</span>(u, v, dep[v] - dep[u]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_vtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(h + <span class="number">1</span>, h + m + <span class="number">1</span>, [](<span class="keyword">int</span> x, <span class="keyword">int</span> y) &#123;</span><br><span class="line">        <span class="keyword">return</span> dfn[x] &lt; dfn[y];</span><br><span class="line">    &#125;);</span><br><span class="line">    sta[top = <span class="number">1</span>] = <span class="number">1</span>, vtr.head[<span class="number">1</span>] = <span class="number">0</span>, vtr.tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (h[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="built_in">lca</span>(sta[top], h[i]);</span><br><span class="line">        <span class="keyword">while</span> (dfn[l] &lt;= dfn[sta[top - <span class="number">1</span>]])</span><br><span class="line">            <span class="built_in">add_vedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="keyword">if</span> (sta[top] != l)</span><br><span class="line">            vtr.head[l] = <span class="number">0</span>, <span class="built_in">add_vedge</span>(l, sta[top]), sta[top] = l;</span><br><span class="line">        vtr.head[h[i]] = <span class="number">0</span>, sta[++top] = h[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">add_vedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs0</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    dis[u][<span class="number">0</span>] = tag[u] ? pii&#123;<span class="number">0</span>, u&#125; : pii&#123;INFL, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = vtr.head[u]; i; i = vtr.nxt[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = vtr.e[i].v, w = vtr.e[i].w;</span><br><span class="line">        <span class="built_in">dfs0</span>(v), dis[u][<span class="number">0</span>] = <span class="built_in">min</span>(dis[u][<span class="number">0</span>], &#123;dis[v][<span class="number">0</span>].fi + w, dis[v][<span class="number">0</span>].se&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// debug(&quot;dis of dfs0(%lld) = &#123;%lld, %lld&#125;&quot;, u, dis[u][0].fi, dis[u][0].se);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = vtr.head[u]; i; i = vtr.nxt[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = vtr.e[i].v, w = vtr.e[i].w;</span><br><span class="line">        tmp[++len] = &#123;dis[v][<span class="number">0</span>].fi + w, dis[v][<span class="number">0</span>].se&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tag[u])</span><br><span class="line">        dis[u][<span class="number">1</span>] = &#123;<span class="number">0</span>, u&#125;;</span><br><span class="line">    pre[<span class="number">0</span>] = nxt[len + <span class="number">1</span>] = dis[u][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">        pre[i] = <span class="built_in">min</span>(pre[i - <span class="number">1</span>], tmp[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = len; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">        nxt[i] = <span class="built_in">min</span>(nxt[i + <span class="number">1</span>], tmp[i]);</span><br><span class="line">    len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = vtr.head[u]; i; i = vtr.nxt[i]) &#123;</span><br><span class="line">        ++len;</span><br><span class="line">        pii t = <span class="built_in">min</span>(pre[len - <span class="number">1</span>], nxt[len + <span class="number">1</span>]);</span><br><span class="line">        <span class="comment">// ##sb-mistakes## æ¢æ ¹$dp$ä¸è¦åœ¨ç»Ÿè®¡$pre$å’Œ$nxt$æ•°ç»„æ—¶å°±å†™$dfs$!!!æ•°ç»„æ•´ä¸ªæ”¹å˜!!!ä¸ç„¶ä¼šæ­»å¾—å¾ˆæƒ¨ï¼ˆæŒ‡å¯¹ç€n=1000,m=100çš„å¤§æ ·ä¾‹è°ƒ1hï¼‰</span></span><br><span class="line">        dis[vtr.e[i].v][<span class="number">1</span>] = &#123;t.fi + vtr.e[i].w, t.se&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = vtr.head[u]; i; i = vtr.nxt[i])</span><br><span class="line">        <span class="built_in">dfs1</span>(vtr.e[i].v);</span><br><span class="line">    <span class="comment">// debug(&quot;dis of dfs1(%lld) = &#123;%lld, %lld&#125;&quot;, u, dis[u][1].fi, dis[u][1].se);</span></span><br><span class="line">    dis[u][<span class="number">1</span>] = <span class="built_in">min</span>(dis[u][<span class="number">0</span>], dis[u][<span class="number">1</span>]);</span><br><span class="line">    ++cnt[dis[u][<span class="number">1</span>].se];</span><br><span class="line">    <span class="comment">// debug(&quot;dis of dfs1(%lld) = &#123;%lld, %lld&#125;&quot;, u, dis[u][1].fi, dis[u][1].se);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = vtr.head[u]; i; i = vtr.nxt[i])</span><br><span class="line">        <span class="built_in">dfs2</span>(vtr.e[i].v, u);</span><br><span class="line">    <span class="keyword">if</span> (f) &#123;</span><br><span class="line">        <span class="comment">// debug(&quot;calculate chain %lld -&gt; %lld&quot;, f, u);</span></span><br><span class="line">        <span class="keyword">if</span> (dis[f][<span class="number">1</span>].se == dis[u][<span class="number">1</span>].se) &#123;</span><br><span class="line">            <span class="keyword">int</span> cx = siz[<span class="built_in">jump</span>(u, dep[u] - dep[f] - <span class="number">1</span>)] - siz[u];</span><br><span class="line">            <span class="comment">// debug(&quot;same color, add %lld to cnt[%lld]&quot;, cx, dis[u][1].se);</span></span><br><span class="line">            cnt[dis[u][<span class="number">1</span>].se] += cx;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> cur = u;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXK - <span class="number">1</span>; ~i; --i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dep[fa[cur][i]] &lt;= dep[f])</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                pii up&#123;dep[fa[cur][i]] - dep[f] + dis[f][<span class="number">1</span>].fi, dis[f][<span class="number">1</span>].se&#125;;</span><br><span class="line">                pii dn&#123;dep[u] - dep[fa[cur][i]] + dis[u][<span class="number">1</span>].fi, dis[u][<span class="number">1</span>].se&#125;;</span><br><span class="line">                <span class="keyword">if</span> (dn &lt; up)</span><br><span class="line">                    cur = fa[cur][i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// debug(&quot;vertex is %lld&quot;, cur);</span></span><br><span class="line">            <span class="keyword">int</span> c1 = siz[cur] - siz[u];</span><br><span class="line">            <span class="keyword">int</span> c2 = siz[<span class="built_in">jump</span>(u, dep[u] - dep[f] - <span class="number">1</span>)] - siz[cur];</span><br><span class="line">            <span class="comment">// debug(&quot;%lld&quot;, siz[jump(u, dep[u] - dep[f] - 1)]);</span></span><br><span class="line">            <span class="comment">// debug(&quot;diff color, add %lld to cnt[%lld]&quot;, c1, dis[u][1].se);</span></span><br><span class="line">            <span class="comment">// debug(&quot;diff color, add %lld to cnt[%lld]&quot;, c2, dis[f][1].se);</span></span><br><span class="line">            cnt[dis[u][<span class="number">1</span>].se] += c1;</span><br><span class="line">            cnt[dis[f][<span class="number">1</span>].se] += c2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// debug(&quot;calculate subtree of %lld&quot;, u);</span></span><br><span class="line">    <span class="keyword">int</span> rem = siz[u] - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = vtr.head[u]; i; i = vtr.nxt[i])</span><br><span class="line">        rem -= siz[<span class="built_in">jump</span>(vtr.e[i].v, dep[vtr.e[i].v] - dep[u] - <span class="number">1</span>)];</span><br><span class="line">    <span class="comment">// debug(&quot;add %lld to cnt[%lld]&quot;, rem, dis[u][1].se);</span></span><br><span class="line">    cnt[dis[u][<span class="number">1</span>].se] += rem;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(u, v);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build_tr</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="built_in">read</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            ori[i] = <span class="built_in">read</span>(h[i]), tag[h[i]] = <span class="literal">true</span>, cnt[h[i]] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">build_vtr</span>();</span><br><span class="line">        dis[<span class="number">1</span>][<span class="number">0</span>] = dis[<span class="number">1</span>][<span class="number">1</span>] = &#123;INFL, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">dfs0</span>(<span class="number">1</span>), <span class="built_in">dfs1</span>(<span class="number">1</span>), <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">write</span>(cnt[ori[i]]), <span class="built_in">putchar</span>(i == m ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            tag[h[i]] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2495 æ¶ˆè€—æˆ˜ é¢˜è§£</title>
    <url>/2021/11/27/sol-p2495/</url>
    <content><![CDATA[<h2 id="P2495-æ¶ˆè€—æˆ˜-é¢˜è§£"><a href="#P2495-æ¶ˆè€—æˆ˜-é¢˜è§£" class="headerlink" title="P2495 æ¶ˆè€—æˆ˜ é¢˜è§£"></a>P2495 æ¶ˆè€—æˆ˜ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2495">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è™šæ ‘æ¨¡ç‰ˆé¢˜ï¼Œä¸å¤šè¯´ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2495.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2495</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXK = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">graph</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> u, v, w;</span><br><span class="line">    &#125; e[MAXM];</span><br><span class="line">    <span class="keyword">int</span> head[MAXN], nxt[MAXM], tot;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        e[++tot] = &#123;u, v, w&#125;;</span><br><span class="line">        nxt[tot] = head[u];</span><br><span class="line">        head[u] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, k, inde, h[MAXN], dfn[MAXN], dep[MAXN];</span><br><span class="line"><span class="keyword">int</span> fa[MAXN][MAXK], mn[MAXN][MAXK], dp[MAXN], sta[MAXN], top;</span><br><span class="line"><span class="keyword">bool</span> tag[MAXN];</span><br><span class="line">graph tr, vtr;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_tr</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">    dfn[u] = ++inde, dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    fa[u][<span class="number">0</span>] = f, mn[u][<span class="number">0</span>] = w;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAXK; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAXK; ++i)</span><br><span class="line">        mn[u][i] = <span class="built_in">min</span>(mn[u][i - <span class="number">1</span>], mn[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = tr.head[u]; i; i = tr.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (tr.e[i].v != f)</span><br><span class="line">            <span class="built_in">build_tr</span>(tr.e[i].v, u, tr.e[i].w);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="keyword">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">minpath</span><span class="params">(<span class="keyword">int</span> f, <span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = dep[f] - dep[u];</span><br><span class="line">    <span class="keyword">int</span> ret = INFL;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            ret = <span class="built_in">min</span>(ret, mn[u][i]), u = fa[u][i];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_vedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    vtr.<span class="built_in">addedge</span>(u, v, <span class="built_in">minpath</span>(u, v));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_vtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(h + <span class="number">1</span>, h + k + <span class="number">1</span>, [](<span class="keyword">int</span> x, <span class="keyword">int</span> y) &#123;</span><br><span class="line">        <span class="keyword">return</span> dfn[x] &lt; dfn[y];</span><br><span class="line">    &#125;);</span><br><span class="line">    sta[top = <span class="number">1</span>] = <span class="number">1</span>, vtr.tot = <span class="number">0</span>, vtr.head[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (h[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="built_in">lca</span>(sta[top], h[i]);</span><br><span class="line">        <span class="keyword">if</span> (l != sta[top]) &#123;</span><br><span class="line">            <span class="keyword">while</span> (dfn[sta[top - <span class="number">1</span>]] &gt; dfn[l])</span><br><span class="line">                <span class="built_in">add_vedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">            <span class="keyword">if</span> (sta[top - <span class="number">1</span>] == l)</span><br><span class="line">                <span class="built_in">add_vedge</span>(l, sta[top]), --top;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                vtr.head[l] = <span class="number">-1</span>, <span class="built_in">add_vedge</span>(l, sta[top]), sta[top] = l;</span><br><span class="line">        &#125;</span><br><span class="line">        vtr.head[h[i]] = <span class="number">0</span>, sta[++top] = h[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">add_vedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    dp[u] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = vtr.head[u]; i; i = vtr.nxt[i]) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = vtr.e[i].v, w = vtr.e[i].w;</span><br><span class="line">        <span class="built_in">dfs</span>(v);</span><br><span class="line">        <span class="keyword">if</span> (tag[v])</span><br><span class="line">            dp[u] += w;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            dp[u] += <span class="built_in">min</span>(dp[v], w);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, w;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v), <span class="built_in">read</span>(w);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(v, u, w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fill</span>(mn[<span class="number">0</span>], mn[<span class="number">0</span>] + MAXK, INFL);</span><br><span class="line">    <span class="built_in">build_tr</span>(<span class="number">1</span>, <span class="number">0</span>, INFL);</span><br><span class="line">    <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="built_in">read</span>(k);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            <span class="built_in">read</span>(h[i]), tag[h[i]] = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">build_vtr</span>();</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">write</span>(dp[<span class="number">1</span>]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            tag[h[i]] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P7155 Spaceship P é¢˜è§£</title>
    <url>/2021/11/26/sol-p7155/</url>
    <content><![CDATA[<h2 id="P7155-Spaceship-P-é¢˜è§£"><a href="#P7155-Spaceship-P-é¢˜è§£" class="headerlink" title="P7155 Spaceship P é¢˜è§£"></a>P7155 Spaceship P é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P7155">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è€ƒè™‘åˆ°ä¸€ä¸ªåˆæ³•çš„æŒ‰é’®åºåˆ—ä¸­ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæœ€å¤§çš„æŒ‰é’®ç¼–å·ã€‚å› ä¸ºå¦‚æœè¯¥æœ€å¤§ç¼–å·ä¸º$mx$çš„æŒ‰é’®èƒ½è¢«æŒ‰ä¸‹å¤šæ¬¡ï¼Œåˆ™å¿…é¡»è¦æŒ‰ä¸‹å¦ä¸€ä¸ªæŒ‰é’®ç¼–å·$\gt mx$ä»¥ä½¿æŒ‰é’®$mx$å˜å¾—åˆæ³•ï¼Œä¸æ»¡è¶³$mx$ç¼–å·æœ€å¤§ï¼Œæ•…å‡è®¾ä¸æˆç«‹ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªæ€§è´¨ï¼Œå°±ç¡®å®šäº†åˆæ³•åºåˆ—æ•°é‡çš„ä¸Šç•Œï¼Œå¹¶ä¸”ç”±äºç¼–å·æœ€å¤§çš„æŒ‰é’®å°†åºåˆ—åˆ†æˆä¸¤æ®µï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥$dp$æ±‚è§£ã€‚è®¾$dp_{u,v,c,0/1,0/1}$è¡¨ç¤ºä»$u$èµ°åˆ°$v$çš„è·¯å¾„ä¸­æœ€å¤§æŒ‰é’®çš„ç¼–å·ä¸è¶…è¿‡$c$ï¼Œç¬¬ä¸€æ­¥æ˜¯å¦æœ‰é™åˆ¶å’Œæœ€åä¸€æ­¥æ˜¯å¦æœ‰é™åˆ¶çš„æ–¹æ¡ˆæ•°ï¼Œç­”æ¡ˆå°±æ˜¯$dp_{s,t,K,1,1}$ï¼Œäºæ˜¯$O(qn^5)$åšæ³•æ˜¾ç„¶ã€‚</p>
<p>è€ƒè™‘å¦‚ä½•ä¼˜åŒ–ï¼ˆå…¶å®ä¹ŸæŒºå¥½æƒ³ï¼‰ã€‚ä»¤$f_{u,x,c,0/1}=\sum\limits_{(t,u)}{dp_{u,t,c-1,0/1,0}}$ï¼Œ$g_{x,v,c,0/1}=\sum\limits_{(v,t)}{dp_{t,v,c-1,0,0/1}}$ï¼Œåˆ™$dp_{u,v,c,k1,k2}=\sum\limits_{t}{f_{u,t,c,k1} \times g_{t,v,c,k2}}$ï¼Œä¸€ä¸‹å­å°‘æšä¸¾å¾ˆå¤šä¸œè¥¿äº†ã€‚</p>
<p>å…·ä½“ç»†èŠ‚å°±çœ‹ä»£ç å§ï¼Œæ—¶é—´å¤æ‚åº¦$O(n^4 + qn^3)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P7155.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P7155</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">65</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> n, k, q;</span><br><span class="line"><span class="keyword">char</span> buf[MAXN];</span><br><span class="line"><span class="keyword">bool</span> mp[MAXN][MAXN];</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">2</span>][<span class="number">2</span>][MAXN][MAXN][MAXN], f[<span class="number">2</span>][MAXN][MAXN][MAXN], g[<span class="number">2</span>][MAXN][MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">uadd</span><span class="params">(<span class="keyword">int</span> &amp;x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= MOD)</span><br><span class="line">        x -= MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> bs, <span class="keyword">int</span> bt)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(f[<span class="number">1</span>], <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(f[<span class="number">1</span>]));</span><br><span class="line">    <span class="built_in">memset</span>(g[<span class="number">1</span>], <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(g[<span class="number">1</span>]));</span><br><span class="line">    <span class="built_in">memset</span>(dp[<span class="number">0</span>][<span class="number">1</span>], <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp[<span class="number">0</span>][<span class="number">1</span>]));</span><br><span class="line">    <span class="built_in">memset</span>(dp[<span class="number">1</span>][<span class="number">0</span>], <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp[<span class="number">1</span>][<span class="number">0</span>]));</span><br><span class="line">    <span class="built_in">memset</span>(dp[<span class="number">1</span>][<span class="number">1</span>], <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp[<span class="number">1</span>][<span class="number">1</span>]));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">1</span>; c &lt;= k; ++c) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span>; y &lt;= n; ++y)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">1</span>; v &lt;= n; ++v)</span><br><span class="line">                <span class="keyword">if</span> (mp[v][y]) <span class="built_in">uadd</span>(f[<span class="number">1</span>][s][y][c], dp[<span class="number">1</span>][<span class="number">0</span>][s][v][c - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt;= n; ++x)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">1</span>; v &lt;= n; ++v)</span><br><span class="line">                <span class="keyword">if</span> (mp[x][v]) <span class="built_in">uadd</span>(g[<span class="number">1</span>][x][t][c], dp[<span class="number">0</span>][<span class="number">1</span>][v][t][c - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (c == bs) <span class="built_in">uadd</span>(f[<span class="number">1</span>][s][s][c], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (c == bt) <span class="built_in">uadd</span>(g[<span class="number">1</span>][t][t][c], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">1</span>; v &lt;= n; ++v) &#123;</span><br><span class="line">            dp[<span class="number">1</span>][<span class="number">0</span>][s][v][c] = dp[<span class="number">1</span>][<span class="number">0</span>][s][v][c - <span class="number">1</span>];</span><br><span class="line">            dp[<span class="number">0</span>][<span class="number">1</span>][v][t][c] = dp[<span class="number">0</span>][<span class="number">1</span>][v][t][c - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>; l &lt;= n; ++l) &#123;</span><br><span class="line">                <span class="built_in">uadd</span>(dp[<span class="number">1</span>][<span class="number">0</span>][s][v][c], f[<span class="number">1</span>][s][l][c] * g[<span class="number">0</span>][l][v][c] % MOD);</span><br><span class="line">                <span class="built_in">uadd</span>(dp[<span class="number">0</span>][<span class="number">1</span>][v][t][c], f[<span class="number">0</span>][v][l][c] * g[<span class="number">1</span>][l][t][c] % MOD);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        dp[<span class="number">1</span>][<span class="number">1</span>][s][t][c] = dp[<span class="number">1</span>][<span class="number">1</span>][s][t][c - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">1</span>; v &lt;= n; ++v)</span><br><span class="line">            <span class="built_in">uadd</span>(dp[<span class="number">1</span>][<span class="number">1</span>][s][t][c], f[<span class="number">1</span>][s][v][c] * g[<span class="number">1</span>][v][t][c] % MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">1</span>][<span class="number">1</span>][s][t][k];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            mp[i][j] = buf[j] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">1</span>; c &lt;= k; ++c) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt;= n; ++x)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span>; y &lt;= n; ++y)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> t = <span class="number">1</span>; t &lt;= n; ++t)</span><br><span class="line">                    <span class="keyword">if</span> (mp[t][y]) <span class="built_in">uadd</span>(f[<span class="number">0</span>][x][y][c], dp[<span class="number">0</span>][<span class="number">0</span>][x][t][c - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt;= n; ++x)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span>; y &lt;= n; ++y)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> t = <span class="number">1</span>; t &lt;= n; ++t)</span><br><span class="line">                    <span class="keyword">if</span> (mp[x][t]) <span class="built_in">uadd</span>(g[<span class="number">0</span>][x][y][c], dp[<span class="number">0</span>][<span class="number">0</span>][t][y][c - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="built_in">uadd</span>(f[<span class="number">0</span>][i][i][c], <span class="number">1</span>), <span class="built_in">uadd</span>(g[<span class="number">0</span>][i][i][c], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt;= n; ++x)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span>; y &lt;= n; ++y)</span><br><span class="line">                <span class="built_in">uadd</span>(dp[<span class="number">0</span>][<span class="number">0</span>][x][y][c], dp[<span class="number">0</span>][<span class="number">0</span>][x][y][c - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt;= n; ++x)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span>; y &lt;= n; ++y)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> t = <span class="number">1</span>; t &lt;= n; ++t)</span><br><span class="line">                    <span class="built_in">uadd</span>(dp[<span class="number">0</span>][<span class="number">0</span>][x][y][c], f[<span class="number">0</span>][x][t][c] * g[<span class="number">0</span>][t][y][c] % MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="keyword">int</span> bs, s, bt, t;</span><br><span class="line">        <span class="built_in">read</span>(bs), <span class="built_in">read</span>(s), <span class="built_in">read</span>(bt), <span class="built_in">read</span>(t);</span><br><span class="line">        <span class="built_in">write</span>(<span class="built_in">query</span>(s, t, bs, bt)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>BZOJ2720 åˆ—é˜Ÿæ˜¥æ¸¸ é¢˜è§£</title>
    <url>/2021/11/26/sol-bzoj2720/</url>
    <content><![CDATA[<h2 id="BZOJ2720-åˆ—é˜Ÿæ˜¥æ¸¸-é¢˜è§£"><a href="#BZOJ2720-åˆ—é˜Ÿæ˜¥æ¸¸-é¢˜è§£" class="headerlink" title="BZOJ2720 åˆ—é˜Ÿæ˜¥æ¸¸ é¢˜è§£"></a>BZOJ2720 åˆ—é˜Ÿæ˜¥æ¸¸ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://darkbzoj.tk/problem/2720">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¯¹äºè¿™ç§å…¨æ’åˆ—çš„é¢˜ç›®å‘ç°ä¸å¤ªå¥½ç”¨$dp$ã€‚ä»”ç»†è§‚å¯Ÿå‘ç°å¯¹äºæ¯ä¸ªäººçš„æœŸæœ›è§†é‡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥ç›´æ¥ç›¸åŠ ï¼Œæ‰€ä»¥ç›´æ¥ç®—$E(c)$è¡¨ç¤ºæœ‰$c$ä¸ªäººçš„é«˜åº¦å°äºè¯¥åŒå­¦æ—¶è¯¥åŒå­¦çš„æœŸæœ›è§†é‡ã€‚ç­”æ¡ˆæ˜¾ç„¶$\sum\limits_{i=1}^{n}{E(c_i)}$ã€‚</p>
<p>è€ƒè™‘å¦‚ä½•æ±‚$E(c)$ã€‚æ ¹æ®æœŸæœ›å…¬å¼æ˜“å¾—$E(c) = \sum\limits_{i=1}^{c}{i \cdot P(i)}$ã€‚</p>
<p>ä½†æ˜¯$P(i)$ä¸å¥½æ±‚è€Œ$P(\ge i)$ç›¸å¯¹å¥½æ±‚ï¼Œäºæ˜¯ç»§ç»­è§‚å¯Ÿè¿™ä¸ªç­‰å¼ï¼Œå‘ç°æ¯ä¸ª$P(i)$éƒ½è¢«è®¡ç®—äº†æ°å¥½$i$æ¬¡ï¼Œæ‰€ä»¥$E(c)$å°±å¯ä»¥è¡¨ç¤ºä¸ºå¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
    E(c) = \sum_{i=1}^{c}{P(\ge i)}</script><p>è¿™æ ·å°±åªéœ€è¦è€ƒè™‘æ¦‚ç‡è€Œä¸éœ€è¦è€ƒè™‘æœŸæœ›äº†ã€‚</p>
<p>æ¥ä¸‹æ¥è€ƒè™‘$P(\ge i)$ã€‚æ—¢ç„¶è§†é‡$\ge i$ï¼Œé‚£ä¹ˆè‡³å°‘è¦æœ‰$i-1$ä¸ªé«˜åº¦$\lt h$çš„äººç«™åœ¨å‰é¢ï¼Œäºæ˜¯$P(\ge i)$è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{align}
        P(\ge i) &= \frac{n-i+1}{n} \cdot \frac{c^{\underline{i-1}}}{(n-1)^{\underline{i-1}}} \\
        &= \frac{n-i+1}{n} \cdot \frac{c!(n-i)!}{(n-1)!(c-i+1)!} \\
        &= \frac{c!}{n!} \cdot \frac{(n-i+1)!}{(c-i+1)!}
    \end{align}</script><p>äºæ˜¯å°†è¯¥å¼ä»£å…¥åˆ°$E(c)$ä¸­å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
    \begin{align}
        E(c) &= \sum_{i=1}^{c}{i \cdot P(i)} \\
        &= \sum_{i=1}^{c}{P(\ge i)} \\
        &= \sum_{i=1}^{c}{\frac{c!}{n!} \cdot \frac{(n-i+1)!}{(c-i+1)!}} \\
        &= \frac{c!}{n!}\sum_{i=1}^{c}{\frac{(n-i+1)!}{(c-i+1)!}} \\
        &= \frac{c!(n-c)!}{n!}\sum_{i=1}^{c}{\binom{n-i+1}{c-i+1}} \\
        &= \frac{c!(n-c)!}{n!}\sum_{i=0}^{c-1}{\binom{n-c+i+1}{i+1}}
    \end{align}</script><p>ç”±äº$\sum\limits_{i=0}^{k}{\binom{n+i}{m+i}} = \binom{n+k+1}{m+k}$ï¼ˆæ˜“è¯ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥è¿›ä¸€æ­¥å°†$E(c)$çš„$\Sigma$ä¼˜åŒ–æ‰ã€‚</p>
<script type="math/tex; mode=display">
    \begin{align}
        E(c) &= \frac{c!(n-c)!}{n!}\sum_{i=0}^{c-1}{\binom{n-c+i+1}{i+1}} \\
        &= \frac{c!(n-c)!}{n!} \cdot \binom{n+1}{c} \\
        &= \frac{c!(n-c)!}{n!} \cdot \frac{(n+1)!}{c!(n-c+1)!} \\
        &= \frac{n+1}{n-c+1}
    \end{align}</script><p>æ‰€ä»¥å¾—åˆ°ç»“è®º</p>
<script type="math/tex; mode=display">
    E(c) = \frac{n+1}{n-c+1}</script><p>äºæ˜¯æœ€ç»ˆçš„ç­”æ¡ˆå°±å˜æˆäº†</p>
<script type="math/tex; mode=display">
    ans = \sum_{i=1}^{n}{\frac{n+1}{n-c+1}}</script><p>$O(n)$æ±‚è§£å³å¯ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           BZOJ2720.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://darkbzoj.tk/problem/2720</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">using</span> ldb = <span class="keyword">long</span> <span class="keyword">double</span>;</span><br><span class="line"><span class="keyword">int</span> n, h[MAXN], cnt[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ++cnt[<span class="built_in">read</span>(h[i])];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">1000</span>; ++i)</span><br><span class="line">        cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">    ldb ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ans += (ldb)(n + <span class="number">1</span>) / (n - cnt[h[i] - <span class="number">1</span>] + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2Lf\n&quot;</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3715 é­”æ³•å’’è¯­ é¢˜è§£</title>
    <url>/2021/11/25/sol-p3715/</url>
    <content><![CDATA[<h2 id="P3715-é­”æ³•å’’è¯­-é¢˜è§£"><a href="#P3715-é­”æ³•å’’è¯­-é¢˜è§£" class="headerlink" title="P3715 é­”æ³•å’’è¯­ é¢˜è§£"></a>P3715 é­”æ³•å’’è¯­ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3715">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¤šæ¨¡å¼å­—ç¬¦ä¸²åŒ¹é…é¦–å…ˆæƒ³åˆ°ACè‡ªåŠ¨æœºï¼Œé‚£ä¹ˆå°†å¿Œè®³è¯è¯­å»ºç«‹ACè‡ªåŠ¨æœºï¼Œæ•´ä¸ª$dp$å°±æœ‰ä¸€ç»´çŠ¶æ€è®¾ä¸ºACè‡ªåŠ¨æœºçš„çŠ¶æ€ï¼Œå¦ä¸€ç»´å°±ç”¨å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¾—åˆ°$dp_{i,s}$è¡¨ç¤ºé•¿åº¦ä¸º$i$ï¼ŒåŒ¹é…åˆ°ACè‡ªåŠ¨æœºçš„çŠ¶æ€ä¸º$s$çš„å­—ç¬¦ä¸²ä¸ªæ•°ã€‚è½¬ç§»æ—¶æšä¸¾åŸºæœ¬è¯æ±‡ï¼Œåœ¨ACè‡ªåŠ¨æœºä¸Šè·‘å‡ºä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œåˆ¤æ–­æ˜¯å¦åˆæ³•ç„¶åå‘åè½¬ç§»ã€‚æ—¶é—´å¤æ‚åº¦$O(Ln \Sigma)$ï¼Œ$\Sigma$ä¸ºå¿Œè®³è¯è¯­çš„æ€»é•¿åº¦ï¼Œå¯é€šè¿‡æµ‹è¯•ç‚¹$1-6$ã€‚</p>
<p>æ¥ä¸‹æ¥åˆ†æå¦‚ä½•åšæµ‹è¯•ç‚¹$7-10$ã€‚å‘ç°æµ‹è¯•ç‚¹$7-10$æœ‰$|S_i| \le 2$çš„æ€§è´¨ï¼ˆ$|S_i|$ä¸ºåŸºæœ¬è¯æ±‡é•¿åº¦ï¼‰ï¼Œè€Œ$L \le 10^8$åˆç»™æˆ‘ä»¬ä¸€ä¸ªæç¤ºï¼Œå³æ­£è§£å¤æ‚åº¦å¸¦æœ‰$\log L$ï¼Œäºæ˜¯æƒ³åˆ°ç”¨çŸ©é˜µå¿«é€Ÿå¹‚æ¥ä¼˜åŒ–$dp$ã€‚è€ƒè™‘åˆ°å› ä¸ºæœ‰$|S_1| \le 2$ï¼Œæ‰€ä»¥$dp_{i,s}$åªä¾èµ–äº$dp_{i-2,t}$ï¼Œå°±å¯ä»¥å‚è€ƒæ–æ³¢é‚£å¥‘æ•°åˆ—çš„çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–æ¥è®¾å®šä¸€ä¸ª$(tot \times 2) \times (tot \times 2)$ï¼Œ$tot$è¡¨ç¤ºACè‡ªåŠ¨æœºçŠ¶æ€æ€»æ•°ï¼ˆæ˜¾ç„¶$tot \le \Sigma \le 100$ï¼‰çš„è½¬ç§»çŸ©é˜µå¤„ç†å³å¯ã€‚æ—¶é—´å¤æ‚åº¦$O((\Sigma)^3 \log L)$ï¼Œå¯é€šè¿‡æµ‹è¯•ç‚¹$7-10$ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(\min(Ln \Sigma, \Sigma^3 \log L))$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3715.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3715</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">205</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">uadd</span><span class="params">(<span class="keyword">int</span> &amp;x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= MOD)</span><br><span class="line">        x -= MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">matrix</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a[MAXN][MAXN], n;</span><br><span class="line">    <span class="built_in">matrix</span>(<span class="keyword">int</span> m) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = m;</span><br><span class="line">        <span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(a));</span><br><span class="line">    &#125;</span><br><span class="line">    matrix <span class="keyword">operator</span>*(<span class="keyword">const</span> matrix &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="function">matrix <span class="title">ret</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= n; ++k)</span><br><span class="line">                    <span class="built_in">uadd</span>(ret.a[i][j], a[i][k] * o.a[k][j] % MOD);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ac_automaton</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> nxt[MAXN][<span class="number">26</span>], fail[MAXN], cnt[MAXN], tot;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> rt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; s[i]; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!nxt[rt][s[i] - <span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">                nxt[rt][s[i] - <span class="string">&#x27;a&#x27;</span>] = ++tot;</span><br><span class="line">            rt = nxt[rt][s[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        ++cnt[rt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>())</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i)</span><br><span class="line">            <span class="keyword">if</span> (nxt[<span class="number">0</span>][i])</span><br><span class="line">                que.<span class="built_in">push</span>(nxt[<span class="number">0</span>][i]);</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nxt[u][i]) &#123;</span><br><span class="line">                    fail[nxt[u][i]] = nxt[fail[u]][i];</span><br><span class="line">                    que.<span class="built_in">push</span>(nxt[u][i]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nxt[u][i] = nxt[fail[u]][i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, k, sum, len[MAXN];</span><br><span class="line"><span class="keyword">int</span> dp[MAXN][MAXN];</span><br><span class="line"><span class="keyword">char</span> s[MAXN][MAXN], t[MAXN][MAXN];</span><br><span class="line">ac_automaton ac;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">posi</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sum * l + x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">matrix <span class="title">qpow</span><span class="params">(matrix x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="function">matrix <span class="title">ret</span><span class="params">(x.n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= x.n; ++i)</span><br><span class="line">        ret.a[i][i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>) ret = ret * x;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s[i] + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, t[i] + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        len[i] = <span class="built_in">strlen</span>(s[i] + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        ac.<span class="built_in">insert</span>(t[i] + <span class="number">1</span>);</span><br><span class="line">    ac.<span class="built_in">build</span>();</span><br><span class="line">    <span class="keyword">if</span> (k &lt;= <span class="number">100</span>) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= ac.tot; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ac.cnt[j])</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt;= n; ++x) &#123;</span><br><span class="line">                    <span class="keyword">int</span> p = j;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>; l &lt;= len[x]; ++l) &#123;</span><br><span class="line">                        p = ac.nxt[p][s[x][l] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> o = p; o; o = ac.fail[o]) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (ac.cnt[o]) &#123;</span><br><span class="line">                                cnt += ac.cnt[o];</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (cnt) &#123;</span><br><span class="line">                            p = <span class="number">-1</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (~p &amp;&amp; i + len[x] &lt;= k)</span><br><span class="line">                        <span class="built_in">uadd</span>(dp[i + len[x]][p], dp[i][j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= ac.tot; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!ac.cnt[i])</span><br><span class="line">                <span class="built_in">uadd</span>(ans, dp[k][i]);</span><br><span class="line">        <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        sum = ac.tot + <span class="number">1</span>;</span><br><span class="line">        <span class="function">matrix <span class="title">base</span><span class="params">(sum * <span class="number">2</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= ac.tot; ++i)</span><br><span class="line">            base.a[<span class="built_in">posi</span>(i, <span class="number">1</span>)][<span class="built_in">posi</span>(i, <span class="number">0</span>)] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= ac.tot; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ac.cnt[i])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt;= n; ++x) &#123;</span><br><span class="line">                <span class="keyword">int</span> p = i;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>; l &lt;= len[x]; ++l) &#123;</span><br><span class="line">                    p = ac.nxt[p][s[x][l] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">                    <span class="comment">// ##sb-mistakes## ACè‡ªåŠ¨æœºåœ¨åšå¤šæ¨¡å¼åŒ¹é…çš„æ—¶å€™**ä¸€å®šè¦è·³failæŒ‡é’ˆ**ä¸ç„¶ä¼š**æ¼éå†å¾ˆå¤šä¸œè¥¿**ï¼ˆACè‡ªåŠ¨æœºç™½å­¦äº†ï¼‰ï¼ï¼ï¼</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> o = p; o; o = ac.fail[o]) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (ac.cnt[o]) &#123;</span><br><span class="line">                            cnt += ac.cnt[o];</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (cnt) &#123;</span><br><span class="line">                        p = <span class="number">-1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (p == <span class="number">-1</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (len[x] == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="built_in">uadd</span>(base.a[<span class="built_in">posi</span>(i, <span class="number">0</span>)][<span class="built_in">posi</span>(p, <span class="number">0</span>)], <span class="number">1</span>);</span><br><span class="line">                    <span class="comment">// ##sb-mistakes## å†™çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–dpï¼ˆå°¤å…¶æ˜¯dp[i]ä¾èµ–äºdp[i-2]è¿™ç§ï¼‰çš„æ—¶å€™ä¸€å®šè¦ç®—å¥½ï¼Œä¸èƒ½é‡å¤åŠ äº†</span></span><br><span class="line">                    <span class="comment">// uadd(base.a[posi(i, 1)][posi(p, 1)], 1);</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">uadd</span>(base.a[<span class="built_in">posi</span>(i, <span class="number">0</span>)][<span class="built_in">posi</span>(p, <span class="number">1</span>)], <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">matrix <span class="title">tmp</span><span class="params">(sum * <span class="number">2</span>)</span></span>;</span><br><span class="line">        tmp.a[<span class="number">1</span>][<span class="built_in">posi</span>(<span class="number">0</span>, <span class="number">0</span>)] = <span class="number">1</span>;</span><br><span class="line">        tmp = tmp * <span class="built_in">qpow</span>(base, k);</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= ac.tot; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!ac.cnt[i])</span><br><span class="line">                <span class="built_in">uadd</span>(ans, tmp.a[<span class="number">1</span>][<span class="built_in">posi</span>(i, <span class="number">0</span>)]);</span><br><span class="line">        <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P7154 Sleeping Cows P é¢˜è§£</title>
    <url>/2021/11/25/sol-p7154/</url>
    <content><![CDATA[<h2 id="P7154-Sleeping-Cows-P-é¢˜è§£"><a href="#P7154-Sleeping-Cows-P-é¢˜è§£" class="headerlink" title="P7154 Sleeping Cows P é¢˜è§£"></a>P7154 Sleeping Cows P é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P7154">é¢˜ç›®é“¾æ¥</a></p>
<h2 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>å…ˆåˆ†ææ€§è´¨ã€‚é¦–å…ˆæ’åºä¸å½±å“ç­”æ¡ˆæ‰€ä»¥å°†å…¶æ’åºã€‚è‹¥$t_i$æ‰€èƒ½åŒ¹é…åˆ°çš„æœ€å¤§$s$çš„ä¸‹æ ‡ä¸º$x$ï¼Œåˆ™å¦‚æœæ”¾å¼ƒ$t_i$å°±æ„å‘³ç€$s_1$åˆ°$s_x$éƒ½è¦è¢«åŒ¹é…ã€‚æ‰€ä»¥åœ¨æ­¤æ€è·¯ä¸Š$dp$åˆ™éœ€è¦ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘æœ€å°çš„è¿˜æ²¡è€ƒè™‘çš„$s$å’Œ$t$ï¼Œæ¯æ¬¡é€‰æ‹©è¾ƒå°çš„ä¸€è¾¹è¿›è¡Œæ›´æ–°ã€‚ä¸å¦¨å°†ä¸¤ä¸ªæ•°ç»„åˆå¹¶é¡ºåºå»åšã€‚</p>
<p>è€ƒè™‘$dp$ï¼Œè®¾$dp_{i,j,0/1}$è¡¨ç¤ºè€ƒè™‘åˆ°æ–°æ•°ç»„çš„ç¬¬$i$ä¸ªæ•°ï¼Œç›®å‰æœ‰$j$ä¸ª$s$è¢«é€‰å…¥åŒ¹é…ä½†è¿˜æ²¡ç¡®å®šåŒ¹é…è°ï¼Œ$1$åˆ°$i-1$ä¸­æ˜¯å¦éƒ½å·²ç»è¢«é€‰å…¥çš„æ–¹æ¡ˆæ•°ã€‚é‚£ä¹ˆå¾—åˆ°è½¬ç§»æ–¹ç¨‹ï¼š</p>
<p>è‹¥å…ƒç´ $i$åœ¨$s$ä¸­ï¼Œåˆ™</p>
<script type="math/tex; mode=display">
    \begin{align}
    dp_{i,j,0} &= dp_{i-1,j-1,0} + dp_{i-1,j,0} + dp_{i-1,j,1} \\
    dp_{i,j,1} &= dp_{i-1,j-1,1}
    \end{align}</script><p>è‹¥å…ƒç´ $i$åœ¨$t$ä¸­ï¼Œåˆ™</p>
<script type="math/tex; mode=display">
    \begin{align}
    dp_{i,j,0} &= (j+1)dp_{i-1,j+1,0} \\
    dp_{i,j,1} = dp_{i-1,j,1} + (j+1)dp_{i-1,j+1,1}
    \end{align}</script><p>æœ€ç»ˆç­”æ¡ˆå°±æ˜¯ $dp_{n,0,0} + dp_{n,0,1}$ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n^2)$ã€‚</p>
<h2 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P7154.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/solution/P7154</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">6e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, op;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> node &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x == o.x ? op &lt; o.op : x &lt; o.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, s[MAXN], t[MAXN], dp[<span class="number">2</span>][MAXN][<span class="number">2</span>];</span><br><span class="line">node a[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> &amp;x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= MOD)</span><br><span class="line">        x -= MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(s[i]), a[++m] = &#123;s[i], <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(t[i]), a[++m] = &#123;t[i], <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + m + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">    dp[u ^ <span class="number">1</span>][<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i, u ^= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(dp[u], <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(dp[u]));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i].op == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">add</span>(dp[u][j][<span class="number">0</span>], dp[u ^ <span class="number">1</span>][j][<span class="number">0</span>]);</span><br><span class="line">                <span class="built_in">add</span>(dp[u][j][<span class="number">0</span>], dp[u ^ <span class="number">1</span>][j][<span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">if</span> (j) &#123;</span><br><span class="line">                    <span class="built_in">add</span>(dp[u][j][<span class="number">0</span>], dp[u ^ <span class="number">1</span>][j - <span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">                    <span class="built_in">add</span>(dp[u][j][<span class="number">1</span>], dp[u ^ <span class="number">1</span>][j - <span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">add</span>(dp[u][j][<span class="number">0</span>], dp[u ^ <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">0</span>] * (j + <span class="number">1</span>) % MOD);</span><br><span class="line">                <span class="built_in">add</span>(dp[u][j][<span class="number">1</span>], dp[u ^ <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">1</span>] * (j + <span class="number">1</span>) % MOD);</span><br><span class="line">                <span class="built_in">add</span>(dp[u][j][<span class="number">1</span>], dp[u ^ <span class="number">1</span>][j][<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">add</span>(sum, dp[u ^ <span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">add</span>(sum, dp[u ^ <span class="number">1</span>][<span class="number">0</span>][<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">write</span>(sum), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF575A Fibonotci é¢˜è§£</title>
    <url>/2021/11/24/sol-cf575a/</url>
    <content><![CDATA[<h2 id="CF575A-Fibonotci-é¢˜è§£"><a href="#CF575A-Fibonotci-é¢˜è§£" class="headerlink" title="CF575A Fibonotci é¢˜è§£"></a>CF575A Fibonotci é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF575A">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>$K \le 10^{18}$ æ˜¾ç„¶çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–ã€‚çŸ©é˜µè½¬ç§»æ–¹ç¨‹å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
    \begin{bmatrix}
        f_i & f_{i-1}
    \end{bmatrix}
    =
    \begin{bmatrix}
        f_{i-1} & f_{i-2}
    \end{bmatrix}
    \begin{pmatrix}
        s_{i-1} & 1 \\
        s_{i-2} & 0
    \end{pmatrix}</script><p>å¹¶å¥—è·¯åœ°è®¾</p>
<script type="math/tex; mode=display">
    M_i =
    \begin{pmatrix}
        s_{i-1} & 1 \\
        s_{i-2} & 0
    \end{pmatrix}</script><p>æœ€ç»ˆç­”æ¡ˆå³ä¸º</p>
<script type="math/tex; mode=display">
    \begin{bmatrix}
        1 & 0
    \end{bmatrix}
    \times
    \prod_{i=1}^{k}{
        \begin{pmatrix}
            s_{i-1} & 1 \\
            s_{i-2} & 0
        \end{pmatrix}
    }
    =
    \begin{bmatrix}
        1 & 0
    \end{bmatrix}
    \times
    \prod_{i=1}^{k}{M_i}</script><p>ç”±äºå‡½æ•°å¤§éƒ¨åˆ†å…·æœ‰å‘¨æœŸæ€§ï¼Œä¸å¦¨å…ˆæŒ‰ç…§åˆ†æˆè‹¥å¹²ä¸ªç±»ä¼¼$[i\cdot n, (i+1)\cdot n)$çš„åŒºé—´åˆ†åˆ«å¤„ç†ã€‚</p>
<p>å¯¹äºæœªä¿®æ”¹è¿‡çš„åŒºé—´ç›´æ¥é¢„å¤„ç†$[0,n)$çš„çŸ©é˜µä¹˜ç§¯å¹¶å¿«é€Ÿå¹‚è®¡ç®—ã€‚</p>
<p>è€ƒè™‘ä¿®æ”¹çš„åŒºé—´ã€‚ä¸ºäº†é¿å…å¯¹ä¸€ä¸ª$s_i$çš„ä¿®æ”¹å½±å“åˆ°ä¸¤ä¸ªä¸åŒçš„åŒºé—´ï¼Œå¯ä»¥å…ˆå°†å¯¹$s_i$çš„ä¿®æ”¹æ˜ å°„åˆ°å¯¹çŸ©é˜µ$M_{i+1}$å’Œ$M_{i+2}$çš„ä¿®æ”¹ã€‚ç„¶åå‘ç°å¤„ç†ä¸€ä¸ªåŒºé—´æ—¶éœ€è¦å¤šæ¬¡å•ç‚¹ä¿®æ”¹å’Œä¸€æ¬¡åŒºé—´æŸ¥è¯¢ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤å³å¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸€äº›ç‰¹åˆ¤ï¼ˆåŸºæœ¬ä¸Šæ˜¯$k \lt n$çš„æƒ…å†µï¼‰ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O((n + m) (\log{n} + \log{k}))$ã€‚</p>
<p><del>ç‰¹åˆ¤ä¸å–æ¨¡ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª/kk</del></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF575A.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF575A</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> pii = pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> t, s1, s2;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, k, p, s[MAXN];</span><br><span class="line">pii a[MAXN];</span><br><span class="line">node b[MAXN * <span class="number">2</span>];</span><br><span class="line">unordered_map&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= p ? x - p : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">matrix</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">matrix</span>() &#123; a[<span class="number">0</span>][<span class="number">0</span>] = a[<span class="number">0</span>][<span class="number">1</span>] = a[<span class="number">1</span>][<span class="number">0</span>] = a[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="built_in">matrix</span>(<span class="keyword">int</span> x) &#123; a[<span class="number">0</span>][<span class="number">0</span>] = a[<span class="number">1</span>][<span class="number">1</span>] = x, a[<span class="number">0</span>][<span class="number">1</span>] = a[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="built_in">matrix</span>(<span class="keyword">int</span> s1, <span class="keyword">int</span> s2) &#123; a[<span class="number">0</span>][<span class="number">0</span>] = s2, a[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>, a[<span class="number">1</span>][<span class="number">0</span>] = s1, a[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>; &#125;</span><br><span class="line">    matrix <span class="keyword">operator</span>*(<span class="keyword">const</span> matrix &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        matrix ret;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; ++j)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">2</span>; ++k)</span><br><span class="line">                    ret.a[i][j] = <span class="built_in">add</span>(ret.a[i][j], a[i][k] * o.a[k][j] % p);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> matrix <span class="keyword">operator</span>^(matrix x, <span class="keyword">int</span> y) &#123;</span><br><span class="line">        matrix ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>) ret = ret * x;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li (i &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ri (i &lt;&lt; 1) | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson li, l, mid</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson ri, mid + 1, r</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segment_tree</span> &#123;</span></span><br><span class="line">    matrix nd[MAXN * <span class="number">4</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        nd[i] = nd[li] * nd[ri];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, matrix v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in"><span class="keyword">void</span></span>(nd[i] = v);</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (p &lt;= mid)</span><br><span class="line">            <span class="built_in">update</span>(lson, p, v);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">update</span>(rson, p, v);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">matrix <span class="title">query</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> nd[i];</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        matrix ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            ret = ret * <span class="built_in">query</span>(lson, ql, qr);</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            ret = ret * <span class="built_in">query</span>(rson, ql, qr);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">segment_tree tr;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(k), <span class="built_in">read</span>(p);</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(s[i]);</span><br><span class="line">    <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i].first), <span class="built_in">read</span>(a[i].second);</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + m + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">1</span> &amp;&amp; a[i].first + <span class="number">1</span> == a[i - <span class="number">1</span>].first + <span class="number">2</span>)</span><br><span class="line">            b[++cnt] = &#123;a[i].first + <span class="number">1</span>, a[i - <span class="number">1</span>].second, a[i].second&#125;;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span> || a[i].first + <span class="number">1</span> != a[i - <span class="number">1</span>].first + <span class="number">2</span>)</span><br><span class="line">            b[++cnt] = &#123;a[i].first + <span class="number">1</span>, s[(a[i].first - <span class="number">1</span>) % n], a[i].second&#125;;</span><br><span class="line">        <span class="keyword">if</span> (i == m || a[i].first + <span class="number">2</span> != a[i + <span class="number">1</span>].first + <span class="number">1</span>)</span><br><span class="line">            b[++cnt] = &#123;a[i].first + <span class="number">2</span>, a[i].second, s[(a[i].first + <span class="number">1</span>) % n]&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (cnt &amp;&amp; b[cnt].t &gt; k)</span><br><span class="line">        --cnt;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        tr.<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, i, <span class="built_in">matrix</span>(s[(i + n - <span class="number">2</span>) % n], s[(i + n - <span class="number">1</span>) % n]));</span><br><span class="line">    <span class="keyword">if</span> (k == <span class="number">0</span> || k == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">write</span>(k % p), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>), <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k &lt; n) &#123;</span><br><span class="line">        matrix ret;</span><br><span class="line">        ret.a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">write</span>((ret * tr.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, <span class="number">2</span>, k)).a[<span class="number">0</span>][<span class="number">0</span>]), <span class="built_in">putchar</span>(<span class="string">&#x27;\0&#x27;</span>), <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    matrix sum = tr.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    matrix base = tr.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, <span class="number">2</span>, n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> pos = <span class="number">1</span>, pre = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (pos &lt;= cnt) &#123;</span><br><span class="line">        <span class="keyword">int</span> cur = b[pos].t / n;</span><br><span class="line">        base = base * (sum ^ (cur - pre - <span class="number">1</span>)), pre = cur;</span><br><span class="line">        <span class="keyword">int</span> cl = <span class="built_in">max</span>(<span class="number">2ll</span>, cur * n), cr = <span class="built_in">min</span>(k, cur * n + n - <span class="number">1</span>), lst = pos;</span><br><span class="line">        <span class="keyword">while</span> (pos &lt;= cnt &amp;&amp; cl &lt;= b[pos].t &amp;&amp; b[pos].t &lt;= cr) &#123;</span><br><span class="line">            tr.<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, b[pos].t % n, <span class="built_in">matrix</span>(b[pos].s1, b[pos].s2));</span><br><span class="line">            ++pos;</span><br><span class="line">        &#125;</span><br><span class="line">        base = base * tr.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, cl % n, cr % n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = lst; j &lt; pos; ++j)</span><br><span class="line">            tr.<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, b[j].t % n, <span class="built_in">matrix</span>(s[(b[j].t - <span class="number">2</span>) % n], s[(b[j].t - <span class="number">1</span>) % n]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> cur = k / n;</span><br><span class="line">    <span class="keyword">if</span> (pre &lt; cur) &#123;</span><br><span class="line">        base = base * (sum ^ (cur - pre - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = cur * n; i &lt;= k; ++i)</span><br><span class="line">            base = base * <span class="built_in">matrix</span>(s[(i - <span class="number">2</span>) % n], s[(i - <span class="number">1</span>) % n]);</span><br><span class="line">    &#125;</span><br><span class="line">    matrix ret;</span><br><span class="line">    ret.a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    ret = ret * base;</span><br><span class="line">    <span class="built_in">write</span>(ret.a[<span class="number">0</span>][<span class="number">0</span>]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P6144 Help Yourself é¢˜è§£</title>
    <url>/2021/11/23/sol-p6144/</url>
    <content><![CDATA[<h2 id="P6144-Help-Yourself-é¢˜è§£"><a href="#P6144-Help-Yourself-é¢˜è§£" class="headerlink" title="P6144 Help Yourself é¢˜è§£"></a>P6144 Help Yourself é¢˜è§£</h2><span id="more"></span>
<p><del>åº”è¯¥æ˜¯ç¬¬ä¸€æ¬¡åœ¨å­¦æ ¡åˆè‡ªä¹ æ—¶å·OIï¼ˆç„¶åsxyèµ°è¿›æ¥çœ‹äº†æˆ‘ä¸€çœ¼å•¥ä¹Ÿæ²¡è¯´ï¼‰</del></p>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P6144">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¯¹äºè¿™ç§è‹¥å¹²åŒºé—´æ±‚å€¼çš„é¢˜ç›®ï¼Œè‚¯å®šå…ˆæŒ‰ç…§å·¦ç«¯ç‚¹æˆ–è€…å³ç«¯ç‚¹æ’ä¸ªåºã€‚</p>
<p>ä¸å¦¨å…ˆæ¥è€ƒè™‘å¯¹äº$k=1$çš„æƒ…å†µdpçŠ¶æ€æ€ä¹ˆè®¾ã€‚å¥—è·¯åœ°è®¾$dp_i$è¡¨ç¤ºä»¥$i$ä¸ºå½“å‰è¦†ç›–çš„æœ€å³ç«¯ç‚¹çš„è”é€šå—æ•°ç›®ä¹‹å’Œï¼Œä¸‹é¢è¦åŠ å…¥ä¸€æ¡çº¿æ®µ$[l,r]$ï¼Œæ€è€ƒæ’å…¥è¿™æ¡çº¿æ®µå¯¹$dp$å€¼çš„å½±å“ã€‚å¯¹äº$i\lt r$çš„æ‰€æœ‰$dp_i$ä¸ä¼šè¢«å½±å“ï¼Œè€Œå¯¹æ¯ä¸ª$0 \le i \lt l$ï¼Œ$dp_r$çš„å€¼éœ€åŠ ä¸Š$dp_i + 1$ï¼Œå¯¹æ¯ä¸ª$l \le i \lt r$ï¼Œ$dp_r$çš„å€¼éœ€åŠ ä¸Š$dp_i$ã€‚æœ€åå¯¹äº$i \gt r$ï¼Œæ˜¾ç„¶æ’å…¥è¿™ä¹ˆä¸€æ¡çº¿æ®µä¸ä¼šå½±å“åˆ°å…¶å³æ–­ç‚¹ï¼Œä½†å–è¯¥çº¿æ®µå’Œä¸å–è¯¥çº¿æ®µå„æœ‰ä¸€ç§å¯èƒ½ï¼Œæ‰€ä»¥è¦å°†æ•´ä¸ªåŒºé—´ä¹˜ä¸Š2.</p>
<p>åˆ†æåˆ°è¿™é‡Œï¼Œå¦‚ä½•ç»´æŠ¤$dp$å°±ä¸€ç›®äº†ç„¶äº†ï¼šä½¿ç”¨çº¿æ®µæ ‘ç»´æŠ¤å•ç‚¹åŠ æ³•å’ŒåŒºé—´ä¹˜æ³•ä»¥åŠåŒºé—´æ±‚å’Œå³å¯ã€‚</p>
<p>æ¥ä¸‹æ¥è®¡ç®—$k \neq 1$çš„æƒ…å†µã€‚ä¸éš¾å‘ç°æ¯ä¸ª$dp_{k,i}$éƒ½å¯ä»¥è¢«è¡¨ç¤ºæˆ$\sum\limits_i{b_i^k}$çš„å½¢å¼ï¼ˆ$b_i$æ˜¯æ¯ç§å­é›†çš„è”é€šå—æ•°ç›®ï¼‰ã€‚è€ŒåŒºé—´ä¹˜ä¸Š2ç›´æ¥åšï¼Œæ±‚å’Œä¹Ÿç›´æ¥çº¿æ®µæ ‘ï¼Œæ±‚$\sum\limits_{i=0}^{l-1}{(dp_{k,i}+1)}$ç”¨äºŒé¡¹å¼å®šç†æ‹†å¼€å¾—åˆ°$\sum\limits_{j=0}^{k}\sum\limits_{i=0}^{l-1}{\binom{k}{j} \times dp_{j,i}}$å³å¯å¾—åˆ°ç­”æ¡ˆã€‚</p>
<p>æ‰€ä»¥æ—¶é—´å¤æ‚åº¦$O(k^2n\log{n})$éšä¾¿è¿‡ã€‚<del>è¿™æ¯”å‰é¢ä¸¤é“é»‘é¢˜å¥½äº›å¤šäº†</del></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P6144.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P6144</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXK = <span class="number">11</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> node &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> l == o.l ? r &lt; o.r : l &lt; o.l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li (i &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ri (i &lt;&lt; 1) | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson li, l, mid</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson ri, mid + 1, r</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segment_tree</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> sum[MAXM * <span class="number">4</span>], tag[MAXM * <span class="number">4</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        sum[i] = <span class="built_in">add</span>(sum[li], sum[ri]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getdown</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        sum[i] = sum[i] * val % MOD;</span><br><span class="line">        tag[i] = tag[i] * val % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tag[i] != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">getdown</span>(li, tag[i]);</span><br><span class="line">            <span class="built_in">getdown</span>(ri, tag[i]);</span><br><span class="line">            tag[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        sum[i] = <span class="number">0</span>; tag[i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in"><span class="keyword">void</span></span>(sum[i] = x);</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(lson, x), <span class="built_in">build</span>(rson, x);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> q, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in"><span class="keyword">void</span></span>(sum[i] = <span class="built_in">add</span>(sum[i], val));</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (q &lt;= mid)</span><br><span class="line">            <span class="built_in">update</span>(lson, q, val);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">update</span>(rson, q, val);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &gt; qr)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">getdown</span>(i, val);</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            <span class="built_in">modify</span>(lson, ql, qr, val);</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            <span class="built_in">modify</span>(rson, ql, qr, val);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &gt; qr)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> sum[i];</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ret = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            ret = <span class="built_in">add</span>(ret, <span class="built_in">query</span>(lson, ql, qr));</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            ret = <span class="built_in">add</span>(ret, <span class="built_in">query</span>(rson, ql, qr));</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, k, c[MAXK][MAXK];</span><br><span class="line">node a[MAXN];</span><br><span class="line">segment_tree tr[MAXK];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k), m = n * <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i].l), <span class="built_in">read</span>(a[i].r);</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + n + <span class="number">1</span>);</span><br><span class="line">    c[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        c[i][<span class="number">0</span>] = c[i][i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; i; ++j)</span><br><span class="line">            c[i][j] = <span class="built_in">add</span>(c[i - <span class="number">1</span>][j], c[i - <span class="number">1</span>][j - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= k; ++i)</span><br><span class="line">        tr[i].<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>, m, <span class="number">0</span>);</span><br><span class="line">    tr[<span class="number">0</span>].<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">0</span>, m, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = k; j &gt;= <span class="number">0</span>; --j) &#123;</span><br><span class="line">            <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt;= j; ++l)</span><br><span class="line">                sum = <span class="built_in">add</span>(sum, c[j][l] * tr[l].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, m, <span class="number">0</span>, a[i].l - <span class="number">1</span>) % MOD);</span><br><span class="line">            sum = <span class="built_in">add</span>(sum, tr[j].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, m, a[i].l, a[i].r));</span><br><span class="line">            tr[j].<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">0</span>, m, a[i].r, sum);</span><br><span class="line">            tr[j].<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">0</span>, m, a[i].r + <span class="number">1</span>, m, <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(tr[k].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, m, <span class="number">1</span>, m)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF710F String Set Queries é¢˜è§£</title>
    <url>/2021/11/22/sol-cf710f/</url>
    <content><![CDATA[<h2 id="CF710F-String-Set-Queries-é¢˜è§£"><a href="#CF710F-String-Set-Queries-é¢˜è§£" class="headerlink" title="CF710F String Set Queries é¢˜è§£"></a>CF710F String Set Queries é¢˜è§£</h2><span id="more"></span>
<h3 id="åˆå·å‡ºæ¥ä¸€é“é»‘é¢˜å“ˆå“ˆå“ˆ"><a href="#åˆå·å‡ºæ¥ä¸€é“é»‘é¢˜å“ˆå“ˆå“ˆ" class="headerlink" title="åˆå·å‡ºæ¥ä¸€é“é»‘é¢˜å“ˆå“ˆå“ˆ"></a><del>åˆå·å‡ºæ¥ä¸€é“é»‘é¢˜å“ˆå“ˆå“ˆ</del></h3><h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF710F">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¦–å…ˆçœ‹åˆ°å¤šæ¨¡åŒ¹é…æƒ³åˆ°ACè‡ªåŠ¨æœºã€‚</p>
<p>è¿™ä¸ªå¼ºåˆ¶åœ¨çº¿çœ‹èµ·æ¥å¾ˆéº»çƒ¦çš„æ ·å­ï¼Œå› ä¸ºACè‡ªåŠ¨æœºå¿…é¡»è¦ç¦»çº¿ä¸‹æ¥æ‰èƒ½buildã€‚æ‰€ä»¥å°±å¼•å…¥ä¸€ç§æ–°çš„ç®—æ³•å«åšâ€œäºŒè¿›åˆ¶åˆ†ç»„â€ã€‚</p>
<blockquote>
<h3 id="äºŒè¿›åˆ¶åˆ†ç»„"><a href="#äºŒè¿›åˆ¶åˆ†ç»„" class="headerlink" title="äºŒè¿›åˆ¶åˆ†ç»„"></a>äºŒè¿›åˆ¶åˆ†ç»„</h3><p><del>è¿™ä¸ªç®—æ³•ä¸€çœ‹åå­—å°±å¾ˆ$\log$</del></p>
<p>ç»´æŠ¤ä¸€ä¸ªstackï¼Œé‡Œé¢çš„å€¼éƒ½æ˜¯2çš„æ¬¡å¹‚ã€‚æ¯æ¬¡æ“ä½œåœ¨æ ˆé¡¶æ’å…¥ä¸€ä¸ª1ï¼Œå¦‚æœæ ˆé¡¶çš„ä¸¤ä¸ªæ•°ç›¸åŒå°±å°†å…¶åˆå¹¶ï¼Œå¹¶æ”¹ä¸ºä¸¤ä¸ªæ•°çš„å’Œã€‚æŸ¥è¯¢çš„æ—¶å€™éå†æ•´ä¸ªstackå¯¹æ¯ä¸ªå€¼è¿›è¡ŒæŸ¥è¯¢ã€‚</p>
<p>è¿™æ ·å‡è®¾æ¯æ¬¡åˆå¹¶å’ŒæŸ¥è¯¢stackä¸­ä¸€ä¸ªå€¼çš„å¤æ‚åº¦éƒ½æ˜¯$O(x)$çš„ï¼ˆè¿™é‡Œ$x$æŒ‡çš„æ˜¯æ ˆå†…å½“å‰å€¼çš„å¤§å°ï¼‰æ˜¾ç„¶æŸ¥è¯¢çš„å¤æ‚åº¦æ˜¯$O(x)$çš„ï¼Œç„¶åæ’å…¥çš„å¤æ‚åº¦æ˜¯$O(x\log{n})$ï¼Œå› ä¸ºæ¯ä¸ªæ’å…¥çš„æ•°åªä¼šè¢«åˆå¹¶$\log{n}$æ¬¡ã€‚æ€»å¤æ‚åº¦ä¸º$O(qx\log{n})$ã€‚</p>
</blockquote>
<p>è€Œåœ¨è¿™é“é¢˜ä¸­ï¼Œ$qx = \sum{|S|} = 3 \times 10^5$ï¼Œæ‰€ä»¥æ˜¾ç„¶æ˜¯èƒ½è¿‡çš„ã€‚</p>
<p>äºæ˜¯è¿™é“é¢˜æœ¬èº«å¹¶ä¸ç®—éš¾ï¼Œä½†æ˜¯è¯„é»‘çš„åŸå› æˆ‘è®¤ä¸ºæ˜¯å®ƒ<strong>æ¯’ç˜¤å¡ç©ºé—´ï¼ï¼ï¼</strong></p>
<p>å…³äºæˆ‘ä»£ç ä¸­å¡ç©ºé—´çš„<del>å¥‡æŠ€æ·«å·§</del>å°±æ˜¯å°†ACè‡ªåŠ¨æœºçš„èŠ‚ç‚¹å¼€æˆå†…å­˜æ± ï¼ŒåŠ¨æ€åˆ†é…ï¼ˆä»£ç ä¸­<code>node* malloc_p()</code>çš„ä½œç”¨å°±åœ¨æ­¤ï¼‰ã€‚è¿˜æœ‰å°±æ˜¯æ³¨æ„ACè‡ªåŠ¨æœºåœ¨æ„å»ºçš„æ—¶å€™æŠŠ$cnt$æ•°ç»„é¢„å¤„ç†å¥½ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡è·³$fail$æŒ‡é’ˆäº†ï¼ˆæˆ‘ä»£ç ä¸€å¼€å§‹å°±åœ¨è¿™é‡ŒTLEäº†ï¼‰ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF710F.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF710F</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> lli = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXK = <span class="number">22</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFI = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">bool</span> m_be;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> cnt, fail, nxt[<span class="number">26</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cnt = fail = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fill</span>(nxt, nxt + <span class="number">26</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> ntot, ntop;</span><br><span class="line">node nnd[MAXN];</span><br><span class="line">node *buf[MAXN];</span><br><span class="line"><span class="function">node* <span class="title">malloc_p</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ntop ? buf[ntop--] : &amp;nnd[++ntot];</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ac_automaton</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> tot;</span><br><span class="line">    node *nd[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        nd[tot = <span class="number">0</span>] = <span class="built_in">malloc_p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tot; ++i)</span><br><span class="line">            nd[i]-&gt;<span class="built_in">clear</span>(), buf[++ntop] = nd[i];</span><br><span class="line">        nd[tot = <span class="number">0</span>] = <span class="built_in">malloc_p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> rt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; s[i]; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!nd[rt]-&gt;nxt[s[i] - <span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">                nd[rt]-&gt;nxt[s[i] - <span class="string">&#x27;a&#x27;</span>] = (nd[++tot] = <span class="built_in">malloc_p</span>(), tot);</span><br><span class="line">            rt = nd[rt]-&gt;nxt[s[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        ++nd[rt]-&gt;cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> queue&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>())</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i)</span><br><span class="line">            <span class="keyword">if</span> (nd[<span class="number">0</span>]-&gt;nxt[i])</span><br><span class="line">                que.<span class="built_in">push</span>(nd[<span class="number">0</span>]-&gt;nxt[i]);</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            nd[u]-&gt;cnt += nd[nd[u]-&gt;fail]-&gt;cnt;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nd[u]-&gt;nxt[i]) &#123;</span><br><span class="line">                    nd[nd[u]-&gt;nxt[i]]-&gt;fail = nd[nd[u]-&gt;fail]-&gt;nxt[i];</span><br><span class="line">                    que.<span class="built_in">push</span>(nd[u]-&gt;nxt[i]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nd[u]-&gt;nxt[i] = nd[nd[u]-&gt;fail]-&gt;nxt[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">lli <span class="title">query</span><span class="params">(<span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">        lli ret = <span class="number">0</span>, p = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; s[i]; ++i) &#123;</span><br><span class="line">            p = nd[p]-&gt;nxt[s[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">            ret += nd[p]-&gt;cnt;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">group</span> &#123;</span></span><br><span class="line">    string dat[MAXN];</span><br><span class="line">    ac_automaton ac[MAXK];</span><br><span class="line">    <span class="keyword">int</span> n, top, sl[MAXK], sr[MAXK];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAXK; ++i)</span><br><span class="line">            ac[i].<span class="built_in">init</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">        dat[++n] = s;</span><br><span class="line">        ++top, sl[top] = n, sr[top] = n;</span><br><span class="line">        ac[top].<span class="built_in">clear</span>(), ac[top].<span class="built_in">insert</span>(s), ac[top].<span class="built_in">build</span>();</span><br><span class="line">        <span class="keyword">while</span> (top &gt; <span class="number">1</span> &amp;&amp; sr[top] - sl[top] == sr[top - <span class="number">1</span>] - sl[top - <span class="number">1</span>]) &#123;</span><br><span class="line">            sr[top - <span class="number">1</span>] = sr[top], ac[top--].<span class="built_in">clear</span>();</span><br><span class="line">            ac[top].<span class="built_in">clear</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = sl[top]; i &lt;= sr[top]; ++i)</span><br><span class="line">                ac[top].<span class="built_in">insert</span>(dat[i].<span class="built_in">c_str</span>());</span><br><span class="line">            ac[top].<span class="built_in">build</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">lli <span class="title">query</span><span class="params">(<span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">        lli ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= top; ++i)</span><br><span class="line">            ret += ac[i].<span class="built_in">query</span>(s);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> m, opt;</span><br><span class="line"><span class="keyword">char</span> s[MAXN];</span><br><span class="line">group add, sub;</span><br><span class="line"><span class="keyword">bool</span> m_ed;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">debug</span>(<span class="string">&quot;memory = %.5lfMB&quot;</span>, (&amp;m_ed - &amp;m_be) / <span class="number">1024.0</span> / <span class="number">1024.0</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    <span class="keyword">int</span> mm = m;</span><br><span class="line">    add.<span class="built_in">init</span>(), sub.<span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%s&quot;</span>, &amp;opt, s + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>) &#123;</span><br><span class="line">            add.<span class="built_in">insert</span>(s + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (opt == <span class="number">2</span>) &#123;</span><br><span class="line">            sub.<span class="built_in">insert</span>(s + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, add.<span class="built_in">query</span>(s + <span class="number">1</span>) - sub.<span class="built_in">query</span>(s + <span class="number">1</span>));</span><br><span class="line">            <span class="built_in">fflush</span>(stdout);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4632 New Home é¢˜è§£</title>
    <url>/2021/11/22/sol-p4632/</url>
    <content><![CDATA[<h2 id="P4632-New-Home-é¢˜è§£"><a href="#P4632-New-Home-é¢˜è§£" class="headerlink" title="P4632 New Home é¢˜è§£"></a>P4632 New Home é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4632">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æŠŠè¯¢é—®ç¦»çº¿ä¸‹æ¥ï¼Œè€ƒè™‘3ç§æ“ä½œï¼šæ–°å¼€ä¸€å®¶å•†åº—ï¼Œå…³æ‰ä¸€å®¶å•†åº—ï¼ŒæŸ¥è¯¢ä¸€ä¸ªç‚¹çš„ä¸æ–¹ä¾¿æŒ‡æ•°ã€‚</p>
<p>å…ˆè€ƒè™‘æŸ¥è¯¢ã€‚æ˜¾ç„¶å…·æœ‰äºŒåˆ†æ€§ï¼Œè€ƒè™‘åˆ¤æ–­ä¸€ä¸ªåŒºé—´ $[l,r]$ æ˜¯å¦åŒ…å«äº†æ‰€æœ‰çš„é¢œè‰²ã€‚è¿™ç§åŒºé—´ç»Ÿè®¡é¢œè‰²çš„é¢˜ç›®æœ‰ä¸€ä¸ªå¥—è·¯çš„è§£æ³•ï¼Œå³å¯¹äºä¸€ä¸ªç‚¹$i$ï¼Œä¿å­˜ $pre_i$ è¡¨ç¤º $i$ çš„ä¸Šä¸€ä¸ªç›¸åŒé¢œè‰²å‡ºç°çš„ä½ç½®ï¼ŒåŒºé—´ $[l,r]$ çš„ç­”æ¡ˆå³ä¸º $\sum\limits_{i=l}^{r}{(pre_i \lt l)}$ ã€‚</p>
<p>ä½†æ˜¯è¿™æ ·ä¸å¤ªä¾¿äºç»´æŠ¤ï¼Œäºæ˜¯æ€è€ƒåˆ°$pre$æ•°ç»„çš„å¦ä¸€ä¸ªæ€§è´¨ï¼šè‹¥$\min\limits_{i=r+1}^{n}{pre_i} \lt l$ï¼Œåˆ™è¯´æ˜å¿…æœ‰ä¸€ç§é¢œè‰²æ²¡æœ‰å‡ºç°åœ¨$[l,r]$ä¸­ã€‚è€Œæˆ‘ä»¬äºŒåˆ†+åˆ¤æ–­å¹¶ä¸éœ€è¦ç»Ÿè®¡é¢œè‰²çš„<strong>ä¸ªæ•°</strong>ï¼Œè€Œæ˜¯åªéœ€è¦ç»Ÿè®¡<strong>æ˜¯å¦ä¸ºkä¸ª</strong>ã€‚</p>
<p>äºæ˜¯å°±å¾ˆå®¹æ˜“ç»´æŠ¤è¿™ä¸ª$pre$æ•°ç»„å¹¶ç»Ÿè®¡ç­”æ¡ˆï¼šå°†$pre$æ”¾åœ¨æœ€å°å€¼çº¿æ®µæ ‘ä¸Šå³å¯ã€‚æ³¨æ„å¦‚æœæŸä¸ªé¢œè‰²æ²¡æœ‰å‡ºç°åœ¨$[r+1,n]$çš„è¯ä¼šå°‘è¢«è€ƒè™‘åˆ°ï¼Œæ‰€ä»¥åœ¨æœ€å·¦è¾¹å’Œæœ€å³è¾¹å„å¼€ä¸€ä¸ªå¤§èŠ‚ç‚¹ï¼Œä½œä¸ºæ‰€æœ‰é¢œè‰²å…¬ç”¨ã€‚</p>
<p>ä½†æ˜¯è¿™é“é¢˜æœ‰ä¸ªå¾ˆæ¶å¿ƒçš„åœ°æ–¹ï¼Œåœ¨äºæ¯ä¸ªç‚¹å¯èƒ½æœ‰å¤šä¸ªä¸åŒé¢œè‰²çš„å•†åº—ã€‚æ‰€ä»¥ä¸€ç§åšæ³•ä¸ºåœ¨çº¿æ®µæ ‘çš„æ¯ä¸ªå¶å­èŠ‚ç‚¹å¼€ä¸€ä¸ªsetæš´åŠ›ç»´æŠ¤ã€‚</p>
<p>æœ€åå¯¹äºä¿®æ”¹æ“ä½œä¹Ÿåªéœ€è¦å¯¹æ¯ä¸ªé¢œè‰²æš´åŠ›ç»´æŠ¤ä¸€ä¸ªsetï¼Œæ‰¾åˆ°å‰é©±å’Œåç»§å¹¶åœ¨çº¿æ®µæ ‘ä¸Šä¿®æ”¹å³å¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n\log^3{n})$<del>ï¼ˆè·‘å¾—é£å¿«ï¼‰</del></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4632.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4632</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">using</span> pii = pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> t, p, c, id;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> node &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t &lt; o.t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">query</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> t, p, id;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> query &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t &lt; o.t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> li (i &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ri (i &lt;&lt; 1) | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson li, l, mid</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson ri, mid + 1, r</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segment_tree</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> mn[MAXN * <span class="number">12</span>];</span><br><span class="line">    set&lt;pii&gt; st[MAXN * <span class="number">3</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        mn[i] = <span class="built_in">min</span>(mn[li], mn[ri]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        mn[i] = INFL;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(lson), <span class="built_in">build</span>(rson);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> q, <span class="keyword">int</span> c, <span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            st[l].<span class="built_in">insert</span>(&#123;p, c&#125;);</span><br><span class="line">            mn[i] = st[l].<span class="built_in">size</span>() ? st[l].<span class="built_in">begin</span>()-&gt;first : INFL;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (q &lt;= mid)</span><br><span class="line">            <span class="built_in">insert</span>(lson, q, c, p);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">insert</span>(rson, q, c, p);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> q, <span class="keyword">int</span> c, <span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            st[l].<span class="built_in">erase</span>(&#123;p, c&#125;);</span><br><span class="line">            mn[i] = st[l].<span class="built_in">size</span>() ? st[l].<span class="built_in">begin</span>()-&gt;first : INFL;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (q &lt;= mid)</span><br><span class="line">            <span class="built_in">erase</span>(lson, q, c, p);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">erase</span>(rson, q, c, p);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> mn[i];</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ret = INFL;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            ret = <span class="built_in">min</span>(ret, <span class="built_in">query</span>(lson, ql, qr));</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            ret = <span class="built_in">min</span>(ret, <span class="built_in">query</span>(rson, ql, qr));</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, k, q, sig, len;</span><br><span class="line"><span class="keyword">int</span> pos[MAXN * <span class="number">3</span>], answ[MAXN];</span><br><span class="line">node bd[MAXN * <span class="number">2</span>];</span><br><span class="line">query qr[MAXN];</span><br><span class="line">multiset&lt;<span class="keyword">int</span>&gt; col[MAXN];</span><br><span class="line">segment_tree tr;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(node x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x.id &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        col[x.c].<span class="built_in">insert</span>(x.p);</span><br><span class="line">        <span class="keyword">if</span> (col[x.c].<span class="built_in">count</span>(x.p) == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">auto</span> pre = <span class="built_in">prev</span>(col[x.c].<span class="built_in">lower_bound</span>(x.p));</span><br><span class="line">            <span class="keyword">auto</span> nxt = col[x.c].<span class="built_in">upper_bound</span>(x.p);</span><br><span class="line">            tr.<span class="built_in">erase</span>(<span class="number">1</span>, <span class="number">1</span>, sig, *nxt, x.c, *pre);</span><br><span class="line">            tr.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="number">1</span>, sig, *nxt, x.c, x.p);</span><br><span class="line">            tr.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="number">1</span>, sig, x.p, x.c, *pre);            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        col[x.c].<span class="built_in">erase</span>(col[x.c].<span class="built_in">find</span>(x.p));</span><br><span class="line">        <span class="keyword">if</span> (col[x.c].<span class="built_in">count</span>(x.p) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">auto</span> pre = <span class="built_in">prev</span>(col[x.c].<span class="built_in">lower_bound</span>(x.p));</span><br><span class="line">            <span class="keyword">auto</span> nxt = col[x.c].<span class="built_in">upper_bound</span>(x.p);</span><br><span class="line">            tr.<span class="built_in">erase</span>(<span class="number">1</span>, <span class="number">1</span>, sig, *nxt, x.c, x.p);</span><br><span class="line">            tr.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="number">1</span>, sig, *nxt, x.c, *pre);</span><br><span class="line">            tr.<span class="built_in">erase</span>(<span class="number">1</span>, <span class="number">1</span>, sig, x.p, x.c, *pre);            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> ps, <span class="keyword">int</span> ln)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> u = <span class="built_in">lower_bound</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>, ps - ln) - pos - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> v = <span class="built_in">upper_bound</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>, ps + ln) - pos;</span><br><span class="line">    <span class="keyword">return</span> tr.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, sig, v, sig) &gt; u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> x, t, a, b;</span><br><span class="line">        <span class="built_in">read</span>(x), <span class="built_in">read</span>(t), <span class="built_in">read</span>(a), <span class="built_in">read</span>(b);</span><br><span class="line">        bd[++len] = &#123;a, x, t, i&#125;;</span><br><span class="line">        bd[++len] = &#123;b + <span class="number">1</span>, x, t, -i&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        <span class="built_in">read</span>(qr[i].p), <span class="built_in">read</span>(qr[i].t), qr[i].id = i;</span><br><span class="line">    pos[++sig] = INFL;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">        pos[++sig] = bd[i].p;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        pos[++sig] = qr[i].p;</span><br><span class="line">    <span class="built_in">sort</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>);</span><br><span class="line">    sig = <span class="built_in">unique</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>) - pos - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">        bd[i].p = <span class="built_in">lower_bound</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>, bd[i].p) - pos;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        qr[i].p = <span class="built_in">lower_bound</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>, qr[i].p) - pos;</span><br><span class="line">    <span class="built_in">sort</span>(bd + <span class="number">1</span>, bd + len + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">sort</span>(qr + <span class="number">1</span>, qr + q + <span class="number">1</span>);</span><br><span class="line">    tr.<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, sig);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        col[i].<span class="built_in">insert</span>(<span class="number">0</span>), col[i].<span class="built_in">insert</span>(sig);</span><br><span class="line">        tr.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="number">1</span>, sig, sig, i, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> cbd = <span class="number">1</span>, cqr = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (cqr &lt;= q) &#123;</span><br><span class="line">        <span class="keyword">while</span> (cbd &lt;= len &amp;&amp; bd[cbd].t &lt;= qr[cqr].t)</span><br><span class="line">            <span class="built_in">insert</span>(bd[cbd++]);</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0x3f3f3f3f</span>, ans = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">check</span>(pos[qr[cqr].p], mid))</span><br><span class="line">                r = mid - <span class="number">1</span>, ans = mid;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        answ[qr[cqr++].id] = ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        <span class="built_in">write</span>(answ[i]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF702F T-Shirts é¢˜è§£</title>
    <url>/2021/11/22/sol-cf702f/</url>
    <content><![CDATA[<h2 id="CF702F-T-Shirts-é¢˜è§£"><a href="#CF702F-T-Shirts-é¢˜è§£" class="headerlink" title="CF702F T-Shirts é¢˜è§£"></a>CF702F T-Shirts é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF702F">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¦–å…ˆä¸éš¾æƒ³åˆ°æœ´ç´ çš„åšæ³•ï¼Œå¯¹æ¯ä¸ªäººæšä¸¾æ‰€æœ‰Tæ¤ã€‚ä½†æ˜¯è¿™æ ·æ˜¾ç„¶æ— æ³•è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p>
<p>ä½†æ˜¯å‘ç°å¯ä»¥æŒ‰é¡ºåºæšä¸¾æ‰€æœ‰Tæ¤$i$ï¼Œå¯¹æ¯ä¸ªäºº$j$è‹¥$v_j \ge c_i$åˆ™å°†$v_j$å‡å»$c_i$ï¼ŒåŒæ—¶å°†$cnt_j$åŠ ä¸€ã€‚</p>
<p>ä¸‹é¢è€ƒè™‘å¦‚ä½•ç”¨æ•°æ®ç»“æ„ä¼˜åŒ–ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯ä»¥æŸ¥æ‰¾ç¬¬ä¸€ä¸ª$\ge c_i$å¹¶ä¸”èƒ½æ”¯æŒåŒºé—´å‡å»$c_i$çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªå¯ä»¥ç”¨å¹³è¡¡æ ‘åšåˆ°ã€‚ä¼¼ä¹å…¶ä»–äººç”¨çš„éƒ½æ˜¯FHQçš„åšæ³•ï¼Œä½†æˆ‘ä¸ä¼šFHQæ‰€ä»¥åªèƒ½ç”¨splayä»£æ›¿äº†ã€‚</p>
<p>æ¯æ¬¡æ“ä½œå¯ä»¥æŠŠæ•´ä¸ªåŒºé—´åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š$[0,c_i)$ï¼Œ$[c_i,2c_i)$å’Œ$[2c_i,+\infty)$ã€‚ç¬¬ä¸€ä¸ªåŒºé—´æ˜¾ç„¶ä¸éœ€è¦æ“ä½œï¼Œç¬¬äºŒä¸ªåŒºé—´æˆ‘ä»¬æš´åŠ›åˆ é™¤å¹¶é‡æ–°æ’å…¥ï¼Œç¬¬ä¸‰ä¸ªåŒºé—´ç»´æŠ¤ä¸€ä¸ªtagæ ‡è®°ã€‚</p>
<p>è¿™æ ·çœ‹èµ·æ¥ä¼šTé£ï¼Œç„¶è€Œæ¥è®¡ç®—ä¸€ä¸‹æ—¶é—´å¤æ‚åº¦å°±ä¼šå‘ç°ï¼Œå¯¹äºä¸€ä¸ªåœ¨$[c_i,2c_i)$ä¸­çš„æ•°æ¯æ¬¡å‡å»$c_i$ï¼Œç›¸å½“äºæœ€å°‘æ¯æ¬¡$\times \frac{1}{2}$ï¼Œæ‰€ä»¥ä¸€ä¸ªæ•°$v_i$æœ€å¤šä¼šè¢«æš´åŠ›ä¿®æ”¹$\log_2{v_i}$æ¬¡ï¼Œæ‰€ä»¥å¤æ‚åº¦æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<p>å†æ¥è€ƒè™‘å¦‚ä½•åœ¨splayä¸Šæ“ä½œã€‚æˆ‘ä»¬æ‰¾åˆ°$c_i$çš„å‰é©±ï¼Œè®°ä¸ºèŠ‚ç‚¹$u$ï¼Œå†æ‰¾åˆ°$2c_i-1$çš„åç»§ï¼Œè®°ä¸ºèŠ‚ç‚¹$v$ï¼Œåªéœ€è¦å°†$u$è½¬åˆ°æ ¹èŠ‚ç‚¹ï¼Œ$v$è½¬åˆ°æ ¹èŠ‚ç‚¹çš„å³å„¿å­ï¼Œè¿™æ ·$v$å’Œ$v$çš„å³å„¿å­éƒ½åœ¨åŒºé—´$[2c_i,+\infty)$ä¸­ï¼Œç»´æŠ¤tagå¹¶æ‡’æƒ°æ›´æ–°ï¼›è€Œ$v$çš„å·¦å„¿å­å…¨éƒ½åœ¨åŒºé—´$[c_i,2c_i)$ä¸­ï¼Œåªéœ€éå†ä¸€éé‡æ–°æ’å…¥å³å¯ï¼›å…¶ä»–èŠ‚ç‚¹éƒ½ä¸éœ€è¦æ”¹åŠ¨ã€‚</p>
<p>æœ€åå°±æ˜¯æ¯æ¬¡æ“ä½œæ³¨æ„é¡ºåºï¼Œä¸€å®šè¦å…ˆæ›´æ–°$[c_i,2c_i)$å†æ›´æ–°$[2c_i,+\infty)$ï¼Œä¸ç„¶ä½ ä¼šå‘ç°æ‡’æƒ°æ ‡è®°æ‰“ä¸‹å»å¹³è¡¡æ ‘ä¸æ»¡è¶³äºŒå‰æœç´¢æ ‘çš„æ€§è´¨äº†ï¼ˆåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ï¼Œæˆ‘å°±å› ä¸ºè¿™ä¸ªè°ƒäº†ä¸€ä¸‹åˆï¼‰ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n\log^2{n})$ï¼Œç©ºé—´å¤æ‚åº¦å¦‚æœèŠ‚ç‚¹é‡å¤åˆ©ç”¨çš„è¯å¯ä»¥åšåˆ°$O(n)$ï¼ˆå…·ä½“è§ä»£ç ï¼‰ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           2021.11.21-1.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF702F</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="meta-string">&quot;.in&quot;</span>, <span class="meta-string">&quot;r&quot;</span>, stdin), freopen(#x <span class="meta-string">&quot;.out&quot;</span>, <span class="meta-string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="meta-string">&quot;[%s:%d] &quot;</span> fmt <span class="meta-string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> val, id, tag, cnt, tac;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> node &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> val == o.val ? id &lt; o.id : val &lt; o.val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> node &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> val == o.val &amp;&amp; id == o.id;</span><br><span class="line">    &#125;</span><br><span class="line">    node&amp; <span class="keyword">operator</span>+=(<span class="keyword">int</span> x) &#123;</span><br><span class="line">        val += x, tag += x, ++cnt, ++tac;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    node&amp; <span class="keyword">operator</span>+=(<span class="keyword">const</span> node &amp;o) &#123;</span><br><span class="line">        val += o.tag, tag += o.tag;</span><br><span class="line">        cnt += o.tac, tac += o.tac;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">splay_tree</span> &#123;</span></span><br><span class="line">    node val[MAXN];</span><br><span class="line">    <span class="keyword">int</span> rt, tot, top, buf[MAXN];</span><br><span class="line">    <span class="keyword">int</span> siz[MAXN], fa[MAXN], ch[MAXN][<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; siz[x] = siz[ch[x][<span class="number">0</span>]] + siz[ch[x][<span class="number">1</span>]] + <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x == ch[fa[x]][<span class="number">1</span>]; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; siz[x] = fa[x] = ch[x][<span class="number">0</span>] = ch[x][<span class="number">1</span>] = <span class="number">0</span>; val[x] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;; <span class="keyword">if</span> (x) buf[++top] = x; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> top ? buf[top--] : ++tot; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getdown</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v)</span> </span>&#123; val[x] += v; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ch[x][<span class="number">0</span>]) val[ch[x][<span class="number">0</span>]] += val[x];</span><br><span class="line">        <span class="keyword">if</span> (ch[x][<span class="number">1</span>]) val[ch[x][<span class="number">1</span>]] += val[x];</span><br><span class="line">        val[x].tag = val[x].tac = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">pushdown</span>(fa[x]), <span class="built_in">pushdown</span>(x);</span><br><span class="line">        <span class="keyword">int</span> y = fa[x], z = fa[y], w = <span class="built_in">get</span>(x);</span><br><span class="line">        ch[y][w] = ch[x][w ^ <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (ch[x][w ^ <span class="number">1</span>]) fa[ch[x][w ^ <span class="number">1</span>]] = y;</span><br><span class="line">        ch[x][w ^ <span class="number">1</span>] = y, fa[y] = x, fa[x] = z;</span><br><span class="line">        <span class="keyword">if</span> (z) ch[z][y == ch[z][<span class="number">1</span>]] = x;</span><br><span class="line">        <span class="built_in">maintain</span>(y), <span class="built_in">maintain</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> r = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> f = fa[x]; f = fa[x], f != r; <span class="built_in">rotate</span>(x))</span><br><span class="line">            <span class="keyword">if</span> (fa[f] != r) <span class="built_in">rotate</span>(<span class="built_in">get</span>(x) == <span class="built_in">get</span>(f) ? f : x);</span><br><span class="line">        <span class="keyword">if</span> (r == <span class="number">0</span>) rt = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(node k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cur = rt, f = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (cur) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(cur);</span><br><span class="line">            f = cur;</span><br><span class="line">            cur = ch[cur][val[cur] &lt; k];</span><br><span class="line">        &#125;</span><br><span class="line">        cur = <span class="built_in">newnode</span>();</span><br><span class="line">        val[cur] = k;</span><br><span class="line">        fa[cur] = f;</span><br><span class="line">        <span class="keyword">if</span> (f) ch[f][val[f] &lt; k] = cur;</span><br><span class="line">        <span class="built_in">maintain</span>(cur), <span class="built_in">maintain</span>(f);</span><br><span class="line">        <span class="built_in">splay</span>(cur);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(node k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cur = rt;</span><br><span class="line">        <span class="keyword">while</span> (cur) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(cur);</span><br><span class="line">            <span class="keyword">if</span> (k == val[cur]) &#123;</span><br><span class="line">                <span class="built_in">splay</span>(cur);</span><br><span class="line">                <span class="keyword">return</span> cur;</span><br><span class="line">            &#125;</span><br><span class="line">            cur = ch[cur][val[cur] &lt; k];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">pre</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cur = ch[rt][<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">pushdown</span>(rt), <span class="built_in">pushdown</span>(cur);</span><br><span class="line">        <span class="keyword">while</span> (ch[cur][<span class="number">1</span>])</span><br><span class="line">            cur = ch[cur][<span class="number">1</span>], <span class="built_in">pushdown</span>(cur);</span><br><span class="line">        <span class="keyword">if</span> (cur) <span class="built_in">splay</span>(cur);</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">nxt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cur = ch[rt][<span class="number">1</span>];</span><br><span class="line">        <span class="built_in">pushdown</span>(rt), <span class="built_in">pushdown</span>(cur);</span><br><span class="line">        <span class="keyword">while</span> (ch[cur][<span class="number">0</span>])</span><br><span class="line">            cur = ch[cur][<span class="number">0</span>], <span class="built_in">pushdown</span>(cur);</span><br><span class="line">        <span class="keyword">if</span> (cur) <span class="built_in">splay</span>(cur);</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(node k)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">find</span>(k);</span><br><span class="line">        <span class="keyword">if</span> (!ch[rt][<span class="number">0</span>] &amp;&amp; !ch[rt][<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="built_in">clear</span>(rt);</span><br><span class="line">            rt = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!ch[rt][<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">int</span> cur = rt;</span><br><span class="line">            rt = ch[cur][<span class="number">1</span>];</span><br><span class="line">            fa[rt] = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">clear</span>(cur);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!ch[rt][<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">int</span> cur = rt;</span><br><span class="line">            rt = ch[cur][<span class="number">0</span>];</span><br><span class="line">            fa[rt] = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">clear</span>(cur);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> cur = rt, x = <span class="built_in">pre</span>();</span><br><span class="line">            fa[ch[cur][<span class="number">1</span>]] = x;</span><br><span class="line">            ch[rt][<span class="number">1</span>] = ch[cur][<span class="number">1</span>];</span><br><span class="line">            <span class="built_in">clear</span>(cur);</span><br><span class="line">            <span class="built_in">maintain</span>(rt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">prev</span><span class="params">(node k)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">insert</span>(k);</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="built_in">pre</span>();</span><br><span class="line">        <span class="built_in">erase</span>(k);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">next</span><span class="params">(node k)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">insert</span>(k);</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="built_in">nxt</span>();</span><br><span class="line">        <span class="built_in">erase</span>(k);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, node *vals, <span class="keyword">int</span> &amp;len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(x);</span><br><span class="line">        <span class="built_in">dfs</span>(ch[x][<span class="number">0</span>], vals, len);</span><br><span class="line">        vals[++len] = val[x];</span><br><span class="line">        <span class="built_in">dfs</span>(ch[x][<span class="number">1</span>], vals, len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">static</span> node vals[MAXN];</span><br><span class="line">        <span class="keyword">int</span> u = <span class="built_in">prev</span>(&#123;cost, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">        <span class="keyword">int</span> v = <span class="built_in">next</span>(&#123;cost * <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">        <span class="built_in">splay</span>(u, <span class="number">0</span>), <span class="built_in">splay</span>(v, u);</span><br><span class="line">        <span class="built_in">dfs</span>(ch[v][<span class="number">0</span>], vals, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; ++i) &#123;</span><br><span class="line">            <span class="built_in">erase</span>(vals[i]);</span><br><span class="line">            vals[i].val -= cost;</span><br><span class="line">            vals[i].cnt++;</span><br><span class="line">            <span class="built_in">insert</span>(vals[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        val[v].val -= cost, val[v].cnt++;</span><br><span class="line">        <span class="keyword">if</span> (ch[v][<span class="number">1</span>]) <span class="built_in">getdown</span>(ch[v][<span class="number">1</span>], -cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">shirt</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> c, q;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> shirt &amp;o) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> q == o.q ? c &lt; o.c : q &gt; o.q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> n, m, b[MAXN], ans[MAXN];</span><br><span class="line">shirt a[MAXN];</span><br><span class="line">splay_tree splay;</span><br><span class="line">node tmp[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i].c), <span class="built_in">read</span>(a[i].q);</span><br><span class="line">    <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">read</span>(b[i]);</span><br><span class="line">    splay.<span class="built_in">insert</span>(&#123;-INFL, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    splay.<span class="built_in">insert</span>(&#123;INFL, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        splay.<span class="built_in">insert</span>(&#123;b[i], i, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + n + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        splay.<span class="built_in">solve</span>(a[i].c);</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">    splay.<span class="built_in">dfs</span>(splay.rt, tmp, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">        ans[tmp[i].id] = tmp[i].cnt;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans[i]), <span class="built_in">putchar</span>(i == m ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
</search>
