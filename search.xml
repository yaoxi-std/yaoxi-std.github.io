<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>å…³äºæˆ‘</title>
    <url>/2021/11/20/about-me/</url>
    <content><![CDATA[<p><img src="https://api.xecades.xyz/api?bg=255%2C255%2C255%2C1&amp;date=2022-04-10&amp;str=NOI2022%E7%9C%81%E9%80%89%E6%9C%80%E5%A4%9A&amp;quote=%E6%98%AF%E6%97%B6%E5%80%99%E5%BC%80%E5%A7%8B%E5%8A%AA%E5%8A%9B%E4%BA%86%F0%9F%92%AA&amp;img=1&amp;codeforces=yaoxi&amp;luogu=yaoxi&amp;github=yaoxi-std&amp;email=yaoxi20061225%40126.com&amp;site=yaoxi-std.github.io" alt=""></p>
<p><a href="https://www.luogu.com.cn/user/141573"><img src="https://luogu-card-qinyihao.vercel.app/about?id=141573&amp;card_width=800" alt="luogu-info"></a></p>
<p><a href="https://www.luogu.com.cn/user/141573"><img src="https://statcard.vercel.app/practice?id=141573&amp;card_width=800" alt="luogu-solved"></a></p>
<p><a href="https://www.luogu.com.cn/user/141573"><img src="https://statcard.vercel.app/shield?id=141573" alt="luogu"></a></p>
<p><a href="https://atcoder.jp/users/yaoxi_std"><img src="https://atcoder.swift-zym.workers.dev/yaoxi_std" alt="atcoder"></a></p>
<p><a href="https://codeforces.com/profile/yaoxi"><img src="https://codeforces-status.yaoxi-std.workers.dev/shields?handle=yaoxi" alt="codeforces"></a></p>
]]></content>
  </entry>
  <entry>
    <title>ä»»åŠ¡è®¡åˆ’</title>
    <url>/2021/11/20/missions/</url>
    <content><![CDATA[<h3 id="2021-11-20-Sat"><a href="#2021-11-20-Sat" class="headerlink" title="2021.11.20 (Sat)"></a>2021.11.20 (Sat)</h3><p><del><a href="/2021/11/25/sol-p3715/" title="P3715">P3715</a></del></p>
<p><del><a href="/2021/11/22/sol-cf702f/" title="CF702F">CF702F</a></del> <del><a href="/2021/11/22/sol-cf710f/" title="CF710F">CF710F</a></del></p>
<p><del><a href="/2021/11/22/sol-p4632/" title="P4632">P4632</a></del></p>
<p><del><a href="/2021/11/23/sol-p6144/" title="P6144">P6144</a></del></p>
<p><del><a href="/2021/11/24/sol-cf575a/" title="CF575A">CF575A</a></del></p>
<p><del><a href="/2021/11/25/sol-p7154/" title="P7154">P7154</a></del> <del><a href="/2021/11/26/sol-p7155/" title="P7155">P7155</a></del></p>
<p><del><a href="/2021/11/26/sol-bzoj2720/" title="BZOJ2720">BZOJ2720</a></del></p>
<h3 id="2021-11-27-Sat"><a href="#2021-11-27-Sat" class="headerlink" title="2021.11.27 (Sat)"></a>2021.11.27 (Sat)</h3><p><del><a href="/2021/11/27/sol-p2495/" title="P2495">P2495</a></del> <del><a href="/2021/11/27/sol-p3233/" title="P3233">P3233</a></del></p>
<p><del><a href="/2021/11/28/sol-p3803/" title="P3803">P3803</a></del></p>
<p><del><a href="/2021/11/29/sol-p4606/" title="P4606">P4606</a></del></p>
<p><del><a href="/2021/12/05/sol-p4238/" title="P4238">P4238</a></del></p>
<p><del><a href="/2021/12/01/sol-cf1320e/" title="CF1320E">CF1320E</a></del></p>
<p><del><a href="/2021/12/03/sol-cf639f/" title="CF639F">CF639F</a></del></p>
<p>LOJ6184</p>
<h3 id="2021-12-4-Sat"><a href="#2021-12-4-Sat" class="headerlink" title="2021.12.4 (Sat)"></a>2021.12.4 (Sat)</h3><p><del><a href="/2021/12/04/sol-cf526g/" title="CF526G">CF526G</a></del> <del><a href="/2021/11/28/sol-p3803/" title="P3803">P3803</a></del></p>
<p><del><a href="/2021/12/05/sol-p4721/" title="P4721">P4721</a></del> <del><a href="/2021/12/05/sol-cf632e/" title="CF632E">CF632E</a></del> <del><a href="/2021/12/05/sol-p4245/" title="P4245">P4245</a></del></p>
<p><del><a href="/2021/12/06/sol-at2064/" title="AT2064">AT2064</a></del></p>
<p><del><a href="/2021/12/08/sol-cf1096g/" title="CF1096G">CF1096G</a></del></p>
<p><del><a href="/2021/12/10/sol-p2664/" title="P2664">P2664</a></del> <del><a href="/2021/12/10/sol-p6329/" title="P6329">P6329</a></del></p>
<h3 id="2021-12-15-Wed"><a href="#2021-12-15-Wed" class="headerlink" title="2021.12.15 (Wed)"></a>2021.12.15 (Wed)</h3><p>å› ä¸ºæœˆè€ƒæ‰€ä»¥ğŸ¦ğŸ¦ğŸ¦äº†å‡ å¤©ï¼Œä½†æœˆè€ƒè€ƒçš„å¾ˆçƒ‚</p>
<p><del><a href="/2021/12/15/sol-p2056/" title="P2056">P2056</a></del></p>
<p><del><a href="/2021/12/16/sol-p3809/" title="P3809">P3809</a></del></p>
<p><del><a href="/2021/12/17/sol-p2408/" title="P2408">P2408</a></del> <del><a href="/2021/12/17/sol-p4051/" title="P4051">P4051</a></del> <del><a href="/2021/12/17/sol-p4248/" title="P4248">P4248</a></del></p>
<h3 id="2021-12-19-Sun"><a href="#2021-12-19-Sun" class="headerlink" title="2021.12.19 (Sun)"></a>2021.12.19 (Sun)</h3><p><del><a href="/2021/12/19/sol-p3181/" title="P3181">P3181</a></del></p>
<p><del><a href="/2021/12/20/sol-p2756/" title="P2756">P2756</a></del> <del><a href="/2021/12/20/sol-p2761/" title="P2761">P2761</a></del></p>
<p><del><a href="/2021/12/21/sol-p4011/" title="P4011">P4011</a></del> <del><a href="/2021/12/21/sol-p4016/" title="P4016">P4016</a></del></p>
<p><del><a href="/2021/12/22/sol-p1251/" title="P1251">P1251</a></del> <del><a href="/2021/12/22/sol-p2754/" title="P2754">P2754</a></del> <del><a href="/2021/12/22/sol-p2762/" title="P2762">P2762</a></del></p>
<p><del><a href="/2021/12/23/sol-p2763/" title="P2763">P2763</a></del></p>
<p><del><a href="/2021/12/24/sol-p2764/" title="P2764">P2764</a></del> <del><a href="/2021/12/24/sol-p2765/" title="P2765">P2765</a></del> <del><a href="/2021/12/24/sol-p2766/" title="P2766">P2766</a></del> <del><a href="/2021/12/24/sol-p2770/" title="P2770">P2770</a></del></p>
<p><del><a href="/2021/12/25/sol-p4716/" title="P4716">P4716</a></del> <del><a href="/2021/12/25/sol-p2774/" title="P2774">P2774</a></del> <del><a href="/2021/12/25/sol-p3254/" title="P3254">P3254</a></del> <del><a href="/2021/12/25/sol-p3355/" title="P3355">P3355</a></del></p>
<h3 id="2021-12-26-Sun"><a href="#2021-12-26-Sun" class="headerlink" title="2021.12.26 (Sun)"></a>2021.12.26 (Sun)</h3><p><del><a href="/2021/12/27/sol-p3356/" title="P3356">P3356</a></del> <del><a href="/2021/12/27/sol-p3357/" title="P3357">P3357</a></del> <del><a href="/2021/12/27/sol-p3358/" title="P3358">P3358</a></del></p>
<p><del><a href="/2021/12/30/sol-p4012/" title="P4012">P4012</a></del> <del><a href="/2021/12/30/sol-p4013/" title="P4013">P4013</a></del> <del><a href="/2021/12/30/sol-p4014/" title="P4014">P4014</a></del> <del><a href="/2021/12/30/sol-p4015/" title="P4015">P4015</a></del></p>
<p><del><a href="/2021/12/31/sol-p4009/" title="P4009">P4009</a></del></p>
<h3 id="2022-1-1-Sat"><a href="#2022-1-1-Sat" class="headerlink" title="2022.1.1 (Sat)"></a>2022.1.1 (Sat)</h3><p><del><a href="/2022/01/02/sol-cf986d/" title="CF986D">CF986D</a></del></p>
<p><del><a href="/2022/01/03/sol-cf1613f/" title="CF1613F">CF1613F</a></del></p>
<p><del><a href="/2022/01/03/sol-cf755g/" title="CF755G">CF755G</a></del></p>
<p><del><a href="/2022/01/05/sol-cf623e/" title="CF623E">CF623E</a></del></p>
<p><del><a href="/2022/01/07/sol-cf773f/" title="CF773F">CF773F</a></del></p>
<h3 id="2022-1-9-Sun"><a href="#2022-1-9-Sun" class="headerlink" title="2022.1.9 (Sun)"></a>2022.1.9 (Sun)</h3><p><del><a href="/2022/01/09/sol-cf553e/" title="CF553E">CF553E</a></del></p>
<h3 id="2022-1-18-Tue"><a href="#2022-1-18-Tue" class="headerlink" title="2022.1.18 (Tue)"></a>2022.1.18 (Tue)</h3><p>æˆ‘éƒ½ğŸ¦äº†å¤šä¹…äº†</p>
<p><del><a href="/2022/01/18/sol-p4725/" title="P4725">P4725</a></del> <del><a href="/2022/01/18/sol-p4726/" title="P4726">P4726</a></del></p>
<p><del><a href="/2022/01/17/sol-p4002/" title="P4002">P4002</a></del> <del><a href="/2022/01/20/sol-p5850/" title="P5850">P5850</a></del> <del><a href="/2022/01/20/sol-p4223/" title="P4223">P4223</a></del></p>
<p><del><a href="/2022/01/21/sol-cf297e/" title="CF297E">CF297E</a></del> <del><a href="/2022/01/23/sol-p3690/" title="P3690">P3690</a></del> <del><a href="/2022/01/23/sol-p1501/" title="P1501">P1501</a></del> <del><a href="/2022/01/25/sol-p4491/" title="P4491">P4491</a></del></p>
<h3 id="2022-1-26-Wed"><a href="#2022-1-26-Wed" class="headerlink" title="2022.1.26 (Wed)"></a>2022.1.26 (Wed)</h3><p><del><a href="/2022/01/26/sol-uva11107/" title="UVA11107">UVA11107</a></del></p>
<h3 id="2022-2-2-Wed"><a href="#2022-2-2-Wed" class="headerlink" title="2022.2.2 (Wed)"></a>2022.2.2 (Wed)</h3><p><del><a href="/2022/02/02/sol-p2336/" title="P2336">P2336</a></del> <del><a href="/2022/02/02/sol-p3649/" title="P3649">P3649</a></del></p>
<p><del><a href="/2022/02/03/sol-p4341/" title="P4341">P4341</a></del> <del><a href="/2022/02/03/sol-p4070/" title="P4070">P4070</a></del> <del><a href="/2022/02/03/sol-p5028/" title="P5028">P5028</a></del> <del><a href="/2022/02/03/sol-p4081/" title="P4081">P4081</a></del> è¾¹åšçº¸ç³Šèˆ¹è¾¹è¡¥é­”ç¦ï¼Œå¤šæ˜¯ä»¶ç¾äº‹å•Š</p>
<p><del><a href="/2022/02/04/sol-p4094/" title="P4094">P4094</a></del> <del><a href="/2022/02/04/sol-p1117/" title="P1117">P1117</a></del></p>
<p><del><a href="/2022/02/05/sol-p3900/" title="P3900">P3900</a></del> <del><a href="/2022/02/05/sol-p6095/" title="P6095">P6095</a></del></p>
<p><del><a href="/2022/02/05/sol-p4770/" title="P4770">P4770</a></del> <del><a href="/2022/02/06/sol-cf986e/" title="CF986E">CF986E</a></del></p>
<p><del><a href="/2022/02/07/sol-p3203/" title="P3203">P3203</a></del></p>
<p><del><a href="/2022/02/08/sol-p4719/" title="P4719">P4719</a></del></p>
<h3 id="2022-3-3-Thur"><a href="#2022-3-3-Thur" class="headerlink" title="2022.3.3 (Thur)"></a>2022.3.3 (Thur)</h3><p>å·²ç»$(1+1)\times 4+5+1+4$å¤©æ²¡æ›´æ–°äº†</p>
<p>è¿™ä¸¤å¤©åœ¨å­¦æ ¡é›†è®­ï¼Œæ¨¡æ‹Ÿèµ›+ä¸“é¢˜çš„æ¨¡å¼ï¼Œæ‰¾æ—¶é—´å¾—æŠŠæ¯”èµ›æ€»ç»“è¿è¿‡æ¥äº†ã€‚</p>
<h3 id="å¾…å†™çš„é¢˜è§£"><a href="#å¾…å†™çš„é¢˜è§£" class="headerlink" title="å¾…å†™çš„é¢˜è§£"></a>å¾…å†™çš„é¢˜è§£</h3>]]></content>
      <tags>
        <tag>schedules</tag>
      </tags>
  </entry>
  <entry>
    <title>SBé”™è¯¯</title>
    <url>/2021/11/20/sb-mistakes/</url>
    <content><![CDATA[<blockquote>
<p>æ•°ç»„å¼€å¤ªå°ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>å†…å­˜å¼€å¤ªå¤§ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>å¤šæµ‹ä¸æ¸…ç©ºï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p><code>cin</code> å…³åŒæ­¥ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>ç‰¹åˆ¤ä¸å–æ¨¡ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>å·ç§¯ä¸æ¸…ç©ºï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>æ–œç‡é™¤ä»¥é›¶ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
<p>æµ®ç‚¹ä¸¢ç²¾åº¦ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª</p>
</blockquote>
<span id="more"></span>
<h2 id="ä¸€äº›sbçš„é”™è¯¯æ±‡æ€»"><a href="#ä¸€äº›sbçš„é”™è¯¯æ±‡æ€»" class="headerlink" title="ä¸€äº›sbçš„é”™è¯¯æ±‡æ€»"></a>ä¸€äº›sbçš„é”™è¯¯æ±‡æ€»</h2><ul>
<li>ACè‡ªåŠ¨æœºåœ¨åšå¤šæ¨¡å¼åŒ¹é…çš„æ—¶å€™<strong>ä¸€å®šè¦è·³failæŒ‡é’ˆ</strong>ä¸ç„¶ä¼š<strong>æ¼éå†å¾ˆå¤šä¸œè¥¿</strong>ï¼ˆACè‡ªåŠ¨æœºç™½å­¦äº†ï¼‰ï¼ï¼ï¼(2021.11.20, P3715)</li>
<li>å†™çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–dpï¼ˆå°¤å…¶æ˜¯dp[i]ä¾èµ–äºdp[i-2]è¿™ç§ï¼‰çš„æ—¶å€™ä¸€å®šè¦ç®—å¥½ï¼Œä¸èƒ½é‡å¤åŠ äº†(2021.11.20, P3715)</li>
<li>å–æ¨¡çš„é¢˜ç›®é‡åˆ°<strong>ç‰¹åˆ¤</strong>ä¸€å®šè®°å¾—è¾“å‡º<strong>å–æ¨¡</strong>ï¼Œä¸ç„¶ç­‰ç€è¢«hackå§ã€‚ã€‚ã€‚(2021.11.24, CF575A)</li>
<li>æ¢æ ¹$dp$ä¸è¦åœ¨ç»Ÿè®¡$pre$å’Œ$nxt$æ•°ç»„æ—¶å°±å†™$dfs$!!!æ•°ç»„æ•´ä¸ªæ”¹å˜!!!ä¸ç„¶ä¼šæ­»å¾—å¾ˆæƒ¨ï¼ˆæŒ‡å¯¹ç€n=1000,m=100çš„å¤§æ ·ä¾‹è°ƒ1hï¼‰(2021.11.27, P3233)</li>
<li>å¤šæµ‹ä¸æ¸…ç©ºï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª/kk å¤šæµ‹<code>dfn</code>æ•°ç»„è®°å¾—æ¸…ç©ºå•Š (2021.11.29, P4606)</li>
<li><code>(0 - 1) / x + 1 == 1</code>ï¼Œè¦ç‰¹åˆ¤æˆ–è€…å†™æˆ<code>(? + x - 1) / x</code> (2021.12.1 CF1320E)</li>
<li><code>priority_queue&lt;_Tp&gt;</code>é»˜è®¤æ˜¯<code>less&lt;_Tp&gt;</code>ï¼Œè‡ªå®šä¹‰ç±»å‹è¦ä¹ˆæŒ‰ç…§$\gt$çš„é€»è¾‘é‡è½½<code>operator&lt;()</code>ï¼Œè¦ä¹ˆæŒ‰ç…§$\gt$çš„é€»è¾‘é‡è½½<code>operator&gt;()</code>å¹¶ä¸”ä¿®æ”¹é»˜è®¤å‚æ•°ï¼ˆè¿™ä¸ªå¥½åƒé”™äº†ä¸æ­¢ä¸€æ¬¡äº†ï¼‰(2021.12.1 CF1320E)</li>
<li>å¼€<code>vector</code>å½“åŠ¨æ€å¼€ç‚¹æ ‘çŠ¶æ•°ç»„<code>resize</code>æ—¶æ²¡æœ‰$+1$ (2021.12.10, P6329)</li>
<li>è´¹ç”¨æµéœ€è¦æ³¨æ„çš„åœ°æ–¹è§<a href="/2021/12/17/top-networkflow/" title="è¿™é‡Œ">è¿™é‡Œ</a> (2021.12.21, P4016)</li>
<li>è´¹ç”¨æµä¸èƒ½åœ¨æ®‹ä½™ç½‘ç»œä¸ŠåŠ è¾¹é‡æ–°è·‘ï¼Œå¦åˆ™æ— æ³•ä¿è¯æœ€å¤§/æœ€å°è´¹ç”¨ (2021.12.30, P4013)</li>
<li>FFTä¸ä»…è¦å¼€<strong>ä¸¤å€</strong>é•¿æ•°ç»„ï¼ŒåŸå‡½æ•°åŒºé—´$[n,2n)$å†…çš„ç³»æ•°è¿˜è¦<strong>æ¸…ç©º</strong>ï¼Œä¸è¦ä»¥ä¸º$\ge n$æˆ–è€…$\ge 2n$çš„ç³»æ•°ä¼šè¢«å¿½ç•¥ï¼Œå®ƒä»¬ä¼šè¢«è®¡ç®—åˆ°DFTçš„ç‚¹å€¼è¡¨è¾¾å¼ä¸­å»ï¼Œå¹¶ä¸”åœ¨IDFTæ—¶è¢«é”™è¯¯åœ°ç®—å›$\lt n$æˆ–è€…$\lt 2n$ç³»æ•°çš„è´¡çŒ®ä¸­ (2022.1.8, CF773F)</li>
<li>å¤šé¡¹å¼æ±‚é€†å‰è®°å¾—æ¸…ç©ºansæ•°ç»„å•Šï¼Œå¹¶ä¸”è¦æ¸…ç©º$len \times 2$ (2022.1.19, P4726)</li>
</ul>
]]></content>
      <tags>
        <tag>important</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸“é¢˜æ±‡æ€»</title>
    <url>/2022/01/27/topics/</url>
    <content><![CDATA[<h2 id="ä¸“é¢˜æ±‡æ€»"><a href="#ä¸“é¢˜æ±‡æ€»" class="headerlink" title="ä¸“é¢˜æ±‡æ€»"></a>ä¸“é¢˜æ±‡æ€»</h2><span id="more"></span>
<a href="/2021/12/17/top-virtualtree/" title="ã€ä¸“é¢˜ã€‘è™šæ ‘">ã€ä¸“é¢˜ã€‘è™šæ ‘</a> </br>

<a href="/2021/12/17/top-poly/" title="ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼">ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼</a> </br>

<a href="/2021/12/17/top-suffixarray/" title="ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„ SA">ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„ SA</a> </br>

<a href="/2021/12/17/top-networkflow/" title="ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ">ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ</a>]]></content>
      <categories>
        <category>ä¸“é¢˜</category>
      </categories>
  </entry>
  <entry>
    <title>ä¸€äº›tips</title>
    <url>/2021/11/20/some-tips/</url>
    <content><![CDATA[<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><span id="more"></span>
<ul>
<li>ACè‡ªåŠ¨æœºbuildä»¥åå¯ä»¥å…ˆæŠŠcntæ•°ç»„é¢„å¤„ç†å‡ºæ¥ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡éƒ½è·³failæŒ‡é’ˆäº†ï¼ˆä¹Ÿä¸çŸ¥é“ç®—å¡å¸¸è¿˜æ˜¯è¯´ä¸é¢„å¤„ç†å¤æ‚åº¦å°±ä¸å¯¹ï¼Œåæ­£æˆ‘çš„<a href="/2021/11/22/sol-cf710f/" title="CF710F">CF710F</a>å°±æ˜¯åŠ äº†è¿™ä¸ªä¼˜åŒ–æ‰è¿‡äº†çš„ï¼‰(2021.11.22, CF710F)</li>
<li>è®¡ç®—æ ‘ä¸Šæœ€é•¿è·¯å¾„å’Œå¯ä»¥ç”¨<strong><a href="/2021/12/04/sol-cf526g/" title="é•¿é“¾å‰–åˆ†çš„å¥‡å¦™æ€§è´¨">é•¿é“¾å‰–åˆ†çš„å¥‡å¦™æ€§è´¨</a></strong>æ¥ç»´æŠ¤ (2021.12.4, CF526G)</li>
<li><strong>ä¸è¦</strong>ç”¨å˜é‡<code>M_PI</code>!!! <strong>è¦</strong>ç”¨<code>acos(-1)</code>!!! (2021.12.5, P4245)</li>
<li><code>scanf(&quot;%[^\n]&quot;, buf)</code>å¯ä»¥è¯»å…¥æ•´è¡Œï¼Œå…¶ä¸­<code>buf</code>æ˜¯<code>char</code>æ•°ç»„ã€‚ (2021.12.22, P2762)</li>
</ul>
]]></content>
      <tags>
        <tag>important</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¸¸è®°ï¼ˆå¯„ï¼‰</title>
    <url>/2022/01/27/trips/</url>
    <content><![CDATA[<h2 id="æ¸¸è®°ï¼ˆå¯„ï¼‰"><a href="#æ¸¸è®°ï¼ˆå¯„ï¼‰" class="headerlink" title="æ¸¸è®°ï¼ˆå¯„ï¼‰"></a>æ¸¸è®°ï¼ˆå¯„ï¼‰</h2><span id="more"></span>
<a href="/2022/01/27/trip-wc2022/" title="WC2022æ¸¸å¯„">WC2022æ¸¸å¯„</a>
<p>èœœèœ‚å¤ªå¥½ç©äº†ï¼ˆbushi</p>
<p><img src="bee.png" alt="bee"></p>
]]></content>
      <categories>
        <category>æ¸¸è®°</category>
      </categories>
  </entry>
  <entry>
    <title>NOIç³»åˆ—æ¯”èµ›è·å¥–è®°å½•</title>
    <url>/2021/11/20/noi-records/</url>
    <content><![CDATA[<h2 id="è·å¥–è®°å½•"><a href="#è·å¥–è®°å½•" class="headerlink" title="è·å¥–è®°å½•"></a>è·å¥–è®°å½•</h2><span id="more"></span>
<p><del>åˆä¸‰æ‰æ‹¿TG1=çš„å±‘</del></p>
]]></content>
      <tags>
        <tag>records</tag>
      </tags>
  </entry>
  <entry>
    <title>Important dates</title>
    <url>/2021/11/20/date-records/</url>
    <content><![CDATA[<h2 id="ä¸€äº›åœ¨OIä¸­å¯¹æˆ‘æ¥è¯´æ¯”è¾ƒé‡è¦çš„æ—¶åˆ»"><a href="#ä¸€äº›åœ¨OIä¸­å¯¹æˆ‘æ¥è¯´æ¯”è¾ƒé‡è¦çš„æ—¶åˆ»" class="headerlink" title="ä¸€äº›åœ¨OIä¸­å¯¹æˆ‘æ¥è¯´æ¯”è¾ƒé‡è¦çš„æ—¶åˆ»"></a>ä¸€äº›åœ¨OIä¸­å¯¹æˆ‘æ¥è¯´æ¯”è¾ƒé‡è¦çš„æ—¶åˆ»</h2><span id="more"></span>
]]></content>
      <tags>
        <tag>records</tag>
      </tags>
  </entry>
  <entry>
    <title>æ ¡å†…è®­ç»ƒ</title>
    <url>/2021/11/21/school-contests/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">
  <script id="hbeData" type="hbeData" data-hmacdigest="1949d23bc09b3b9e1279b730add65bce238b75cca493bd3fa766d47d9d779a84">67362a200d4bb0b1cd1ef5f7bb774ffb58a2089a15905f15111606287b2ae8c1fda5908825b78d3bd9f0460dd575aac087b0d3ae30eb047be42cd4b539c67f53c4b0f1311d9282a9c8b625c10d8f227bb3e45c44d3465d3d9ccdb76fbaf5e7da61e6ccede5c1bb855f6e2762bdfca6feb6e75183f2cffc09751eb47da6c6b50245203ea78cdff71016778372e2d02893ce3e664baf7d6d4fafab9e7e9c3196f94ab5d902ab2b40a06a1bdf81c8ebdf267fc4477c6a065c62e4c809a6f76717cd6ec52ac9d845b1482f73c75a1f6dade960d9b8483013704af56fcc510a75d157a5cfdfa6f23df7aeee11009beea580ee5b7268b768c9265caae5c1404b8860f4468182579c62f9e0532e24e8b6d7ed94</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>school</tag>
      </tags>
  </entry>
  <entry>
    <title>AtCoder æ¯”èµ›è®°å½•</title>
    <url>/2021/11/20/atcoder-records/</url>
    <content><![CDATA[<p><a href="https://atcoder.jp/users/yaoxi_std"><img src="https://atcoder.swift-zym.workers.dev/yaoxi_std" alt="atcoder"></a></p>
<span id="more"></span>
<h2 id="AtCoder-ä¸Šçš„æ¯”èµ›è®°å½•"><a href="#AtCoder-ä¸Šçš„æ¯”èµ›è®°å½•" class="headerlink" title="AtCoder ä¸Šçš„æ¯”èµ›è®°å½•"></a>AtCoder ä¸Šçš„æ¯”èµ›è®°å½•</h2><h3 id="2021-11-21-ARC129"><a href="#2021-11-21-ARC129" class="headerlink" title="2021.11.21 ARC129"></a>2021.11.21 ARC129</h3><p>è¢«ä¹‹å‰ä¸¤é“DSé¢˜æå¾—æœ‰ç‚¹å¤´æ™•ï¼Œçœ‹äº†ä¸‹é¢˜æ„Ÿè§‰<del>åªä¼šåšA</del>æŒºæ€ç»´çš„ï¼Œäºæ˜¯åˆ‡äº†ä¸‹Aé¢˜å°±å»ç»§ç»­åš<a href="/2021/11/20/missions/" title="ä»»åŠ¡è®¡åˆ’">ä»»åŠ¡è®¡åˆ’</a>äº†ã€‚<br>update 2021.11.22 ï¼ˆæœ¬ä»¥ä¸ºè‚¯å®šè¦æ‰å¥½å¤šåˆ†ï¼Œç»“æœåˆ†æ•°<del>ä¸å‡åå¢</del>ï¼‰</p>
]]></content>
      <tags>
        <tag>records</tag>
      </tags>
  </entry>
  <entry>
    <title>Codeforces æ¯”èµ›è®°å½•</title>
    <url>/2021/11/20/codeforces-records/</url>
    <content><![CDATA[<style type="text/css">
.rated-user {
    font-family: helvetica neue,Helvetica,Arial,sans-serif;
    text-decoration: none!important;
    font-weight: 700;
    display: inline-block;
}
.legendary-user-first-letter {
    color: #000!important
}
.user-legendary {
    color: red!important
}
.user-red {
    color: red!important
}
.user-orange {
    color: #ff8c00!important
}
.user-violet {
    color: #a0a!important
}
.user-blue {
    color: blue!important
}
.user-cyan {
    color: #03a89e!important
}
.user-green {
    color: green!important
}
.user-gray {
    color: gray!important
}
</style>

<p><a href="https://codeforces.com/profile/yaoxi"><img src="https://codeforces-status.yaoxi-std.workers.dev/shields?handle=yaoxi" alt="codeforces"></a></p>
<span id="more"></span>
<h2 id="CodeForces-ä¸Šçš„æ¯”èµ›è®°å½•"><a href="#CodeForces-ä¸Šçš„æ¯”èµ›è®°å½•" class="headerlink" title="CodeForces ä¸Šçš„æ¯”èµ›è®°å½•"></a>CodeForces ä¸Šçš„æ¯”èµ›è®°å½•</h2><h3 id="2021-11-22-CF1612"><a href="#2021-11-22-CF1612" class="headerlink" title="2021.11.22 CF1612"></a>2021.11.22 CF1612</h3><p>æ²¡ç®—å¥½æ°é¥­çš„æ—¶é—´ï¼Œ<del>ä»¥åä¸æ‰“ä¸‹åˆ5ç‚¹çš„CFäº†</del></p>
<p>ä¸€æ ·æ˜¯åˆ‡äº†ABCDï¼Œçœ‹äº†çœ¼EFGèµ°äºº<del>ï¼ˆå¤ªä¸ä¸“å¿ƒäº†ï¼Œä¹Ÿä¸çŸ¥é“æ‰å¤šå°‘åˆ†ï¼‰</del><br><del>éš¾é“å­¦æ ¡ä»Šå¤©å¼€å®¶é•¿ä¼šå°±æ˜¯ä¸ºäº†è®©æˆ‘ä»¬æ‰“ä¸‹åˆçš„Codeforcesçš„ã€‚ã€‚ã€‚</del></p>
<h3 id="2022-1-3-CF1621"><a href="#2022-1-3-CF1621" class="headerlink" title="2022.1.3 CF1621"></a>2022.1.3 CF1621</h3><font class="rated-user user-blue">yaoxi</font>
$\to$
<font class="rated-user user-violet">yaoxi</font>

<p>æ—¶éš”å¤š<del>å¹´</del>æ—¥å†æ¬¡æ¡èµ·Codeforces</p>
<p>æ²¡æƒ³åˆ°Dé¢˜æ­£è§£ç«Ÿå¦‚æ­¤ç¦»è°±ï¼Œç›´æ¥å–$8$ä¸ªç‚¹çš„$\min$å°±Aäº†ã€‚</p>
]]></content>
      <tags>
        <tag>records</tag>
      </tags>
  </entry>
  <entry>
    <title>è®ºå¯¹æ‹åœ¨OIä¸­çš„å¦™ç”¨</title>
    <url>/2022/03/03/matcher/</url>
    <content><![CDATA[<h1 id="è®ºå¯¹æ‹åœ¨OIä¸­çš„å¦™ç”¨"><a href="#è®ºå¯¹æ‹åœ¨OIä¸­çš„å¦™ç”¨" class="headerlink" title="è®ºå¯¹æ‹åœ¨OIä¸­çš„å¦™ç”¨"></a>è®ºå¯¹æ‹åœ¨OIä¸­çš„å¦™ç”¨</h1><span id="more"></span>
<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå›½å†…çš„OIæ¯”èµ›ä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯ä»¥é€‰æ‰‹çš„æœ€åä¸€æ¬¡æäº¤å¾—åˆ†ä¸ºå‡†ï¼Œä¸”é€‰æ‰‹æ— æ³•åœ¨æ¯”èµ›å½“ä¸­å®æ—¶æŸ¥çœ‹å¾—åˆ†ã€‚è¿™å°±å¯¼è‡´äº†å¾ˆå¤šæ—¶å€™é€‰æ‰‹çš„æœ€ç»ˆå¾—åˆ†ä¸æœŸæœ›å¾—åˆ†ä¸ç¬¦çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œæŒ‚åˆ†â€ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œé€‰æ‰‹ä¸€èˆ¬ä¼šåœ¨æ¯”èµ›ä¸­è‡ªå·±é€ æ•°æ®ï¼Œåˆ†åˆ«è®©æš´åŠ›ç¨‹åºå’Œå¾…æ£€éªŒçš„ç¨‹åºè®¡ç®—ï¼Œæ£€éªŒè¾“å‡ºæ˜¯å¦ç›¸åŒï¼Œè¿™å°±æ˜¯æ‰€è°“â€œå¯¹æ‹â€ã€‚</p>
<blockquote>
<p>å¯¹æ‹æ˜¯ä¸€ç§è¿›è¡Œæ£€éªŒæˆ–è°ƒè¯•çš„æ–¹æ³•ï¼Œé€šè¿‡å¯¹æ¯”ä¸¤ä¸ªç¨‹åºçš„è¾“å‡ºæ¥æ£€éªŒç¨‹åºçš„æ­£ç¡®æ€§ã€‚å¯ä»¥å°†è‡ªå·±ç¨‹åºçš„è¾“å‡ºä¸å…¶ä»–ç¨‹åºçš„è¾“å‡ºè¿›è¡Œå¯¹æ¯”ï¼Œä»è€Œåˆ¤æ–­è‡ªå·±çš„ç¨‹åºæ˜¯å¦æ­£ç¡®ã€‚ </p>
<p> â€”â€” OI Wiki</p>
</blockquote>
<p>å¯¹æ‹è¿‡ç¨‹éœ€è¦å¤šæ¬¡è¿›è¡Œï¼Œå› æ­¤éœ€è¦é€‰æ‰‹å®ç°è‡ªåŠ¨åŒ–å¯¹æ‹ã€‚</p>
<p>æœ€åŸºç¡€çš„å¯¹æ‹ç¨‹åºæ¡†æ¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> cas = <span class="number">1000</span>; <span class="comment">// å¯¹æ‹æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">while</span> (cas--) &#123;</span><br><span class="line">        <span class="comment">// åœ¨ Linux / macOS ä¸‹è¿è¡Œå½“å‰ç›®å½•ä¸‹æ–‡ä»¶æ—¶éœ€è¦åŠ  `./` å‰ç¼€ï¼ŒWindows å¯ä»¥ä¸åŠ </span></span><br><span class="line">        <span class="built_in">system</span>(<span class="string">&quot;./_generator.exe &gt; task.in&quot;</span>);         <span class="comment">// é€ æ•°æ®</span></span><br><span class="line">        <span class="built_in">system</span>(<span class="string">&quot;./_brute.exe &lt; task.in &gt; task.ans&quot;</span>);  <span class="comment">// è·å¾—æš´åŠ›ç¨‹åºçš„è¾“å‡º</span></span><br><span class="line">        <span class="built_in">system</span>(<span class="string">&quot;./task.exe &lt; task.in &gt; task.out&quot;</span>);    <span class="comment">// è·å¾—å¾…æ£€éªŒç¨‹åºçš„è¾“å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">system</span>(<span class="string">&quot;fc.exe task.out task.ans&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// Windows ä¸‹ä½¿ç”¨ `fc` å‘½ä»¤æ¯”è¾ƒæ–‡ä»¶æ˜¯å¦ç›¸åŒ</span></span><br><span class="line">            <span class="comment">// å¦‚æœç›¸åŒï¼Œ`system` è°ƒç”¨ä¼šè¿”å› 0ï¼Œå¦åˆ™è¿”å› 1 è¡¨ç¤ºä¸åŒ</span></span><br><span class="line">            <span class="comment">// Linux / macOS ä¸‹æ²¡æœ‰ `fc` å‘½ä»¤ï¼Œç”¨ `diff` æ›¿ä»£å¦‚ä¸‹ï¼š</span></span><br><span class="line">            <span class="comment">// system(&quot;diff task.out task.ans&quot;);</span></span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Wrong Answer&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Accepted&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­çš„ <code>_generator.exe</code> æ˜¯æ•°æ®ç”Ÿæˆå™¨çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œ<code>_brute.exe</code> ä¸ºæš´åŠ›å¯æ‰§è¡Œæ–‡ä»¶ï¼Œ<code>task.exe</code> ä¸ºå¾…æ£€éªŒç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸‰ä¸ªæ–‡ä»¶éœ€è¦ä¸å¯¹æ‹ç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæˆ‘ä¸€èˆ¬ç§°ä½œ <code>matcher.exe</code>ï¼‰æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ã€‚</p>
<p>è¿™ç§å¯¹æ‹è™½ç„¶ç®€å•ï¼Œä½†æœ‰æ—¶åœ¨æ¯”èµ›ä¸­ä¸èƒ½è·å¾—å¾ˆå¥½çš„æ•ˆæœï¼Œæ¯”å¦‚åªèƒ½å°†å¾…æ£€éªŒç¨‹åºä¸æš´åŠ›è¿›è¡Œå¯¹æ‹ï¼Œæ— æ³•æ£€æµ‹æ•°ç»„è¶Šç•Œç­‰ã€‚</p>
<p>æœ¬æ–‡å°±æ¥è®²è®²â€œå¯¹æ‹åœ¨OIä¸­çš„å¦™ç”¨â€ï¼Œå³<strong>é«˜é˜¶çš„å¯¹æ‹æŠ€å·§</strong>ã€‚</p>
<hr>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><h2 id="æ•°æ®ç”Ÿæˆå™¨çš„å†™æ³•"><a href="#æ•°æ®ç”Ÿæˆå™¨çš„å†™æ³•" class="headerlink" title="æ•°æ®ç”Ÿæˆå™¨çš„å†™æ³•"></a>æ•°æ®ç”Ÿæˆå™¨çš„å†™æ³•</h2><p>åœ¨è€ƒåœºä¸Šï¼Œæˆ‘ä»¬ä¸ä¼šå»å†™é‚£ç§éå¸¸æ ‡å‡†çš„ <code>generator</code>ï¼ˆæ¯•ç«Ÿè€ƒåœºä¸Šä¹Ÿä¸ä¼šç»™ä½ æä¾› <code>testlib.h</code>ï¼‰ã€‚ä¸ºäº†ä¾¿äºç”Ÿæˆä¸åŒå­ä»»åŠ¡å¯¹åº”çš„æ•°æ®èŒƒå›´ï¼Œæˆ‘ä¸€èˆ¬ä¼šä½¿ç”¨ä¸€ä¸‹æ¡†æ¶ç¼–å†™ç”Ÿæˆå™¨ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¤´æ–‡ä»¶çœç•¥</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// éšæœºæ•°éƒ¨åˆ†ï¼Œä¿è¯æ•°æ®çš„éšæœºæ€§</span></span><br><span class="line">random_device rd;</span><br><span class="line"><span class="function">mt19937 <span class="title">rng</span><span class="params">(rd())</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//// ç”Ÿæˆéšæœºæ•´æ•°ï¼ŒèŒƒå›´ [l, r]</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rand_int</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="function">uniform_int_distribution&lt;<span class="type">int</span>&gt; <span class="title">qwq</span><span class="params">(l, r)</span></span>;    <span class="comment">// C++11 è‡ªå¸¦çš„å‡åŒ€åˆ†å¸ƒ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">qwq</span>(rng);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//// ç”Ÿæˆéšæœºæµ®ç‚¹æ•°ï¼ŒèŒƒå›´ [l, r)</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">rand_double</span><span class="params">(<span class="type">double</span> l, <span class="type">double</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="function">uniform_real_distribution&lt;<span class="type">double</span>&gt; <span class="title">qwq</span><span class="params">(l, r)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">qwq</span>(rng);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹åº”å­ä»»åŠ¡çš„æ•°æ®èŒƒå›´</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨ namespace è¾ƒä¸ºä¼˜é›…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//// å¯¹åº”çš„ç¬¬ä¸€ä¸ª subtask</span></span><br><span class="line"><span class="keyword">namespace</span> subtask1 &#123;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N_MIN = <span class="number">100</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N_MAX = <span class="number">200</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> A_MAX = <span class="number">1e5</span>;</span><br><span class="line">&#125;;  <span class="comment">// namespace subtask1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//// å¯¹åº”çš„ç¬¬äºŒä¸ª subtask</span></span><br><span class="line"><span class="keyword">namespace</span> subtask2 &#123;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N_MIN = <span class="number">1e3</span>;</span><br><span class="line"><span class="comment">//// ......</span></span><br><span class="line">&#125;;  <span class="comment">// namespace subtask2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//// éœ€è¦ä¿®æ”¹æ•°æ®èŒƒå›´æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹ä¸‹é¢è¿™ä¸€å¥å°±è¡Œ</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> subtask1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å˜é‡å‚¨å­˜</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, a[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»å‡½æ•°éƒ¨åˆ†</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//// é€ æ•°æ®</span></span><br><span class="line">    n = <span class="built_in">rand_int</span>(N_MIN, N_MAX);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        a[i] = <span class="built_in">rand_int</span>(<span class="number">1</span>, A_MAX);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//// è¾“å‡ºæ•°æ®</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, a[i], <span class="string">&quot; \n&quot;</span>[i == n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡ªå·±ç ”ç©¶å‡ºæ¥çš„ <code>generator</code> ä¸å¾—ä¸è¯´çœŸçš„æŒºä¼˜é›…ï½</p>
<h3 id="æ•°æ®çš„éšæœºæ€§"><a href="#æ•°æ®çš„éšæœºæ€§" class="headerlink" title="æ•°æ®çš„éšæœºæ€§"></a>æ•°æ®çš„éšæœºæ€§</h3><p>è¿™ä»½ç”Ÿæˆå™¨åœ¨ Linux / macOS ä¸‹å®Œç¾è¿è¡Œå¹¶ä¸”å¯ä»¥ç”Ÿæˆå®Œå…¨éšæœºçš„æ•°æ®ã€‚ä½†æ˜¯å¦‚æœä½ åœ¨ Windows ä¸‹ä½¿ç”¨ MinGW ç¼–è¯‘ï¼Œå°±ä¼šå‘ç°æ¯æ¬¡è¾“å‡ºçš„æ•°æ® !å®Œ!å…¨!ç›¸!åŒ! </p>
<p>è¿™æ˜¯ç”±äº MinGW çš„ <code>random_device</code> å®ç°ä¸å¥½ï¼Œæ²¡æœ‰è°ƒç”¨ç³»ç»Ÿç†µï¼Œä»è€Œä¸èƒ½åšåˆ°çœŸéšæœºã€‚è‡³äºåœ¨ MinGW ä¸‹çš„çœŸéšæœºï¼Œç¬”è€…ä¹Ÿæ²¡æœ‰æ‰¾åˆ°è¾ƒå¥½çš„æ–¹æ³•ã€‚é‰´äºå¤§éƒ¨åˆ† NOI ç³»åˆ—æ¯”èµ›ä¸­éƒ½ä¼šæä¾› NOI Linux <del>ï¼ˆé™¤äº† JSOI è¿™ç§æ¯’ç˜¤ï¼‰</del>ï¼Œè¿˜æ˜¯å»ºè®®å¤§å®¶åœ¨ Linux ä¸‹å¯¹æ‹å§ï¼</p>
<h2 id="å„ç§é”™è¯¯çš„å¤„ç†"><a href="#å„ç§é”™è¯¯çš„å¤„ç†" class="headerlink" title="å„ç§é”™è¯¯çš„å¤„ç†"></a>å„ç§é”™è¯¯çš„å¤„ç†</h2><h3 id="Wrong-Answer-çš„å¤„ç†"><a href="#Wrong-Answer-çš„å¤„ç†" class="headerlink" title="Wrong Answer çš„å¤„ç†"></a>Wrong Answer çš„å¤„ç†</h3><p>å¯¹äºå¸¸è§„æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„ <code>fc</code> æˆ– <code>diff</code> å‘½ä»¤å³å¯æ£€éªŒä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ç›¸åŒã€‚</p>
<h4 id="å¿½ç•¥ç©ºç™½ç¬¦"><a href="#å¿½ç•¥ç©ºç™½ç¬¦" class="headerlink" title="å¿½ç•¥ç©ºç™½ç¬¦"></a>å¿½ç•¥ç©ºç™½ç¬¦</h4><p>ç„¶è€Œæœ‰æ—¶ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µ:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ diff 1.out 1.ans</span><br><span class="line">2d1</span><br><span class="line">&lt;</span><br></pre></td></tr></table></figure>
<p>æ‰“å¼€æ–‡ä»¶ä¸€çœ‹ï¼Œ<code>1.out</code> å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">114514 1919810</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>1.ans</code> å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">114514 1919810</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„è¾“å‡ºè®©ä½ æ„Ÿåˆ°å¥‡æ€ªï¼šæ˜æ˜ä¸¤ä¸ªè¾“å‡ºçš„æ•°å­—éƒ½ä¸€æ ·ï¼Œä¸ºä»€ä¹ˆ <code>diff</code> å‡ºæ¥ä¼šæŠ¥é”™å‘¢ï¼Ÿä»”ç»†çœ‹äº†ä¸€ä¼šå„¿å‘ç° <code>1.out</code> å¤šäº†ä¸€ä¸ªè¡Œæœ«å›è½¦ã€‚è¿™æ˜¯æ¯”è¾ƒå¥½çš„æƒ…å†µï¼Œä¸‡ä¸€ <code>.ans</code> æ–‡ä»¶æ˜¯åœ¨ Windows ä¸‹åˆ¶é€ çš„ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šä½¿å¾— <code>.ans</code> æ–‡ä»¶çš„å›è½¦ç¬¦å…¨éƒ½å˜æˆäº† <code>CRLF</code> è€Œéåœ¨ç±» Unix æ“ä½œç³»ç»Ÿä¸‹çš„ <code>LF</code>ï¼Œæ­¤æ—¶è‚‰çœ¼çœ‹ä¸å‡ºä¸¤ä¸ªæ–‡ä»¶çš„å·®åˆ«ï¼Œ<code>diff</code> å´ä¼šæŠ¥é”™ã€‚</p>
<p>å¦‚ä½•é¿å…è¿™ç§æƒ…å†µå‘¢ï¼Ÿ<code>diff</code> æœ‰ä¸€ä¸ªå¿½ç•¥ç©ºç™½ç¬¦çš„é€‰é¡¹ <code>diff -w</code>ï¼Œæˆ–è€…åœ¨ Windows ä¸‹ä½¿ç”¨ <code>fc.exe /w</code> å¯ä»¥å¿½ç•¥ç©ºç™½ç¬¦ã€‚</p>
<p>åªéœ€è¦åœ¨ä¸Šæ–‡çš„å¯¹æ‹ç¨‹åºä¸­ç¨ä½œä¿®æ”¹å³å¯ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">system</span>(<span class="string">&quot;fc.exe /w task.out task.ans&quot;</span>)) <span class="comment">// æˆ–è€… system(&quot;diff -w task.out task.ans&quot;)</span></span><br></pre></td></tr></table></figure>
<h4 id="Special-Judge"><a href="#Special-Judge" class="headerlink" title="Special Judge"></a>Special Judge</h4><p><a href="https://oi-wiki.org/tools/special-judge/">spjçš„å†™æ³•</a>è¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<p>å¯¹æ‹æ—¶ä¹Ÿåªéœ€è¦ä¿®æ”¹ä¸€ç‚¹ç‚¹ï¼Œå°†åŸæœ¬è°ƒç”¨ <code>fc</code> æˆ– <code>diff</code> æ”¹ä¸ºè°ƒç”¨ <code>_spj.exe</code> å³å¯:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">system</span>(<span class="string">&quot;./_spj.exe task.in task.out task.ans&quot;</span>)) <span class="comment">// éœ€è¦ä¿è¯ `_spj.exe` ä¸å¯¹æ‹ç¨‹åºå¤„äºåŒä¸€ç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure>
<p><strong>å–„æ„çš„æé†’ï¼š</strong> ä¸€å®šè¦å¤šé€ ä¸€äº›æç«¯æ•°æ®ï¼ï¼ï¼</p>
<h3 id="Runtime-Error-çš„å¤„ç†"><a href="#Runtime-Error-çš„å¤„ç†" class="headerlink" title="Runtime Error çš„å¤„ç†"></a>Runtime Error çš„å¤„ç†</h3><p>ç¨‹åºå‡ºç° Runtime Error æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªé $0$ çš„è¿”å›å€¼ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®ç¨‹åºçš„è¿”å›å€¼æ¥åˆ¤æ–­æ˜¯å¦å‡ºç°è¿è¡Œé”™è¯¯ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸‰ä¸ª system æ”¹æˆè¿™æ ·</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">system</span>(<span class="string">&quot;./task.exe &lt; task.in &gt; task.out&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœè¿è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜è¿”å›å€¼é 0ï¼Œå°±æ˜¯è¿è¡Œé”™è¯¯äº†ã€‚</span></span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Runtime Error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Howeverï¼Œæœ‰æ—¶æ•°ç»„è¶Šç•Œäº†ï¼Œå¯ç¨‹åºå´æ­£å¸¸è¿è¡Œè·‘è¿‡å»äº†ï¼Œæ²¡æœ‰å‡ºç° RE çš„æƒ…å†µï¼ˆè¿™æ˜¯æ¯”è¾ƒç„å­¦çš„ï¼‰ï¼Œä¸Šé¢çš„ç¨‹åºä¹Ÿæ— æ³•åˆ¤æ–­ã€‚</p>
<p>è¿™æ—¶å°±è¦è¯·å‡º C++ çš„å¤§æ€å™¨ <strong>Address Sanitizer</strong> äº†ã€‚ï¼ˆå…¶å®æˆ‘ç¬¬ä¸€æ¬¡å¬è¯´è¿˜æ˜¯ä»å¤§æ¯’ç˜¤ JSOI çš„åœ¨çº¿ç³»ç»Ÿé‡Œï¼‰</p>
<p>è¿™ä¸ªä¸œè¥¿æˆ‘ä¹Ÿä¸å¤šä»‹ç»äº†ï¼Œæ€»ä¹‹å°±æ˜¯èƒ½å¤Ÿæœ‰æ•ˆåœ°åˆ¤æ–­æ•°ç»„è¶Šç•Œæˆ–è€…å†…å­˜è®¿é—®è¶Šç•Œé—®é¢˜ã€‚</p>
<p>è‡³äºå¦‚ä½•å¼€å¯ï¼Œå°±è¦æ‰‹åŠ¨ä¿®æ”¹ç¼–è¯‘å‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">g++ -O2 -std=c++14 -fsanitize=address -o task.exe task.cpp <span class="comment"># åªæ˜¯ä¸¾ä¸ªä¾‹å­</span></span><br></pre></td></tr></table></figure>
<p>Dev-Cpp å¦‚ä½•ä¿®æ”¹ç¼–è¯‘å‘½ä»¤è¯·è‡ªè¡Œç™¾åº¦ã€‚</p>
<p>é¡ºå˜´æä¸€å¥ï¼Œ<strong>æ£€æŸ¥REçš„æ—¶å€™ä¸€å®šè¦ç”¨å¤§æ•°æ®æ¥æµ‹ï¼ï¼ï¼</strong></p>
<h3 id="Time-Limit-Exceeded-çš„å¤„ç†"><a href="#Time-Limit-Exceeded-çš„å¤„ç†" class="headerlink" title="Time Limit Exceeded çš„å¤„ç†"></a>Time Limit Exceeded çš„å¤„ç†</h3><p>è¿™å°±æ¶‰åŠåˆ° C++ çš„è®¡æ—¶æ¨¡å—äº†ã€‚ç”±äºæˆ‘ä»¬åªæ˜¯å†™ä¸ªå¯¹æ‹ï¼Œæ²¡å¿…è¦åˆ°æ—¶é—´å°±æŠŠç¨‹åºææ‰ï¼Œåªæ˜¯è®¡ç®—ä¸‹ç¨‹åºè¿è¡Œçš„æ—¶é—´å³å¯ã€‚</p>
<p>å»ºè®®ä½¿ç”¨ C++11 è‡ªå¸¦çš„ <code>std::chrono::steady_clock</code>ï¼Œéœ€è¦æ·»åŠ å¤´æ–‡ä»¶ <code>chrono.h</code>ï¼ˆå·²åŒ…å«åœ¨ä¸‡èƒ½å¤´ä¸­ï¼‰ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono;</span><br><span class="line"><span class="keyword">auto</span> t1 = steady_clock::<span class="built_in">now</span>();</span><br><span class="line"><span class="comment">// do something like `system(&quot;...&quot;)`</span></span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;something&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> t2 = steady_clock::<span class="built_in">now</span>();</span><br><span class="line"><span class="type">double</span> dif = duration_cast&lt;duration&lt;<span class="type">double</span>&gt;&gt;(t2 - t1).<span class="built_in">count</span>();</span><br><span class="line"><span class="comment">// dif å°±æ˜¯è¿è¡Œçš„æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œè¾ƒä¸ºç²¾ç¡®</span></span><br><span class="line"><span class="keyword">if</span> (dif &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Time Limit Exceeded&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ£€æŸ¥TLEçš„æ—¶å€™ä¹Ÿä¸€å®šè¦ç”¨å¤§æ•°æ®æ¥æµ‹ï¼ï¼ï¼</strong></p>
<h3 id="Memory-Limit-Exceeded-çš„å¤„ç†"><a href="#Memory-Limit-Exceeded-çš„å¤„ç†" class="headerlink" title="Memory Limit Exceeded çš„å¤„ç†"></a>Memory Limit Exceeded çš„å¤„ç†</h3><h4 id="é™æ€å†…å­˜ç©ºé—´"><a href="#é™æ€å†…å­˜ç©ºé—´" class="headerlink" title="é™æ€å†…å­˜ç©ºé—´"></a>é™æ€å†…å­˜ç©ºé—´</h4><p>åœ¨ä½ çš„ç¨‹åºä»£ç ä¸­ï¼Œæœ€å¼€å¤´å®šä¹‰ä¸€ä¸ª <code>bool</code> å˜é‡ <code>m_be</code>ï¼Œä¸»å‡½æ•°å‰å®šä¹‰ <code>m_ed</code>ï¼Œå°†ä¸¤è€…åœ°å€åšå·®ï¼Œå°±å¾—åˆ°äº†åŒºé—´å†…å®šä¹‰çš„é™æ€å˜é‡æ€»å¤§å°ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="type">bool</span> m_be;</span><br><span class="line"><span class="type">int</span> arr[MAXN], brr[MAXN]; <span class="comment">// ...</span></span><br><span class="line"><span class="type">bool</span> m_ed;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="built_in">fabs</span>(&amp;m_ed - &amp;m_be) / <span class="number">1024</span> / <span class="number">1024</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// something else</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºçš„æ˜¯ä»¥MBä¸ºå•ä½çš„é™æ€ç©ºé—´å¤§å°ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ <code>fabs</code> å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨ä¸åŒç¼–è¯‘å™¨çš„ä¸åŒå®ç°ä¸­ï¼Œæœ‰å¯èƒ½ä¼šæœ‰ä¸åŒçš„æ•ˆæœã€‚åœ¨æˆ‘çš„ macOS ä¸Šï¼Œä½¿ç”¨ clang ç¼–è¯‘çš„å°±æ˜¯ <code>&amp;m_be &lt; &amp;m_ed</code>ï¼Œg++ åˆ™æ˜¯ <code>&amp;m_ed &lt; &amp;m_be</code>ï¼Œä½†æ˜¯ç»å¯¹å€¼ç›¸åŒã€‚</p>
<p>è‡³äºåŠ¨æ€ç©ºé—´å¤§å°ï¼Œæˆ‘æƒ³åº”è¯¥æ²¡æœ‰äººä¼šæ— èŠåˆ°åœ¨OIä¸­å¼€ä¸€å¤§å † <code>vector</code> ä¹‹ç±»çš„ä¸œè¥¿å§ã€‚ã€‚ã€‚å¥½åƒæš‚æ—¶ä¹Ÿæ²¡çœ‹åˆ°ä»€ä¹ˆæ¯”è¾ƒå¥½çš„æ–¹æ³•æµ‹åŠ¨æ€å†…å­˜ï¼Œå°±è·³è¿‡äº†ã€‚</p>
<hr>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è´´ä¸€ä¸‹æœ€ç»ˆçš„å¯¹æ‹ç¨‹åºä»£ç å§ï¼ˆLinux / macOSç‰ˆï¼‰ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1000</span>;</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;g++ -std=c++14 -O2 -o _generator.exe _generator.cpp&quot;</span>);</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;g++ -std=c++14 -O2 -o _brute_.exe _brute_.cpp&quot;</span>);</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;g++ -std=c++14 -O2 -fsanitize=address -o task.exe task.cpp&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> cas = <span class="number">1</span>; cas &lt;= tot; ++cas) &#123;</span><br><span class="line">        <span class="built_in">system</span>(<span class="string">&quot;./_generator.exe &gt; task.in&quot;</span>);</span><br><span class="line">        <span class="built_in">system</span>(<span class="string">&quot;./_brute.exe &lt; task.in &gt; task.ans&quot;</span>);</span><br><span class="line">        <span class="keyword">auto</span> t1 = steady_clock::<span class="built_in">now</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">system</span>(<span class="string">&quot;./task.exe &lt; task.in &gt; task.out&quot;</span>)) &#123;</span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot;Runtime Error&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">auto</span> t2 = steady_clock::<span class="built_in">now</span>();</span><br><span class="line">        <span class="type">double</span> dif = duration_cast&lt;duration&lt;<span class="type">double</span>&gt;&gt;(t2 - t1).<span class="built_in">count</span>();</span><br><span class="line">        <span class="keyword">if</span> (dif &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot;Time Limit Exceeded&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">system</span>(<span class="string">&quot;diff -w task.out task.ans&quot;</span>)) &#123;</span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot;Wrong Answer&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; cas &lt;&lt; <span class="string">&quot; Passed&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    cerr &lt;&lt; <span class="string">&quot;Accepted&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>P4719 ã€æ¨¡ç‰ˆã€‘åŠ¨æ€DP&amp;åŠ¨æ€æ ‘åˆ†æ²»</title>
    <url>/2022/02/08/sol-p4719/</url>
    <content><![CDATA[<h2 id="P4719-ã€æ¨¡ç‰ˆã€‘åŠ¨æ€DP-amp-åŠ¨æ€æ ‘åˆ†æ²»"><a href="#P4719-ã€æ¨¡ç‰ˆã€‘åŠ¨æ€DP-amp-åŠ¨æ€æ ‘åˆ†æ²»" class="headerlink" title="P4719 ã€æ¨¡ç‰ˆã€‘åŠ¨æ€DP&amp;åŠ¨æ€æ ‘åˆ†æ²»"></a>P4719 ã€æ¨¡ç‰ˆã€‘åŠ¨æ€DP&amp;åŠ¨æ€æ ‘åˆ†æ²»</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4719">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ­¤å¤„è®°å½•ä¸€ä¸‹æ ‘å‰–çš„å†™æ³•ã€‚</p>
<p>é¦–å…ˆæœ‰ç®€å•çš„$dp$æ–¹ç¨‹å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{cases}
dp_{u,0}=\sum \max(dp_{v,0},dp_{v,1}) \\
dp_{u,1}=a_u + \sum dp_{v,0}
\end{cases}</script><p>è€ƒè™‘è¿ç”¨æ ‘å‰–ï¼Œæ¯æ¬¡å°†è½»å„¿å­çš„ç­”æ¡ˆæš´åŠ›è´¡çŒ®åˆ°çˆ¶äº²ä¸Šé¢ï¼Œçˆ¶äº²èŠ‚ç‚¹åªéœ€è¦åŠ ä¸Šé‡å„¿å­çš„è´¡çŒ®ã€‚</p>
<p>è€ƒè™‘ä½¿ç”¨çŸ©é˜µï¼Œæœ‰è¿™æ ·çš„è½¬ç§»çŸ©é˜µï¼š</p>
<script type="math/tex; mode=display">
\begin{pmatrix}
dp_{v,0} & dp_{v,1}
\end{pmatrix}
\times
\begin{pmatrix}
g_{u,0} & g_{u,1} \\
g_{u,0} & -\infty
\end{pmatrix}
=
\begin{pmatrix}
dp_{u,0} & dp_{u,1}
\end{pmatrix}</script><p>å…¶ä¸­$v$æ˜¯$u$çš„é‡å„¿å­ï¼Œ$g<em>{u,0}$è¡¨ç¤ºè½»å„¿å­ä¸­ä¸å–$u$å¯ä»¥å¾—åˆ°çš„æœ€å¤§è´¡çŒ®ï¼Œ$g</em>{u,1}$è¡¨ç¤ºè½»å„¿å­ä¸­å–$u$å¯ä»¥å¾—åˆ°çš„æœ€å¤§è´¡çŒ®ï¼ˆåŒ…æ‹¬$a_u$ï¼‰ã€‚çº¿æ®µæ ‘ç»´æŠ¤çŸ©é˜µï¼Œä¿®æ”¹æ—¶æš´åŠ›è·³è½»é“¾å¹¶ä¿®æ”¹è½»é“¾çš„çˆ¶äº²ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(n\log^2 n)$ï¼Œçœ‹ä¸‹ä»£ç è‡ªå·±æ•²ä¸€ä¸‹å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚</p>
<p>å¬è¯´æ‹¿LCTå†™å¯ä»¥åšåˆ°$O(n\log n)$è€Œä¸”è·‘çš„é£å¿«ï¼Ÿæ”¹å¤©æœ‰ç©ºè¯•è¯•ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4719.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4719</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Matrix</span> &#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">Matrix</span>() &#123; <span class="built_in">memset</span>(a, <span class="number">-0x3f</span>, <span class="built_in">sizeof</span>(a)); &#125;</span><br><span class="line">    Matrix <span class="keyword">operator</span>*(<span class="type">const</span> Matrix&amp; o) <span class="type">const</span> &#123;</span><br><span class="line">        Matrix ret;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; ++j)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">2</span>; ++k)</span><br><span class="line">                    ret.a[i][j] = <span class="built_in">max</span>(ret.a[i][j], a[i][k] + o.a[k][j]);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; mat[MAXN];</span><br><span class="line"><span class="type">int</span> n, q, a[MAXN];</span><br><span class="line"><span class="type">int</span> f[MAXN][<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> fa[MAXN], siz[MAXN], wson[MAXN];</span><br><span class="line"><span class="type">int</span> dfn[MAXN], sfa[MAXN], dwn[MAXN], id[MAXN], dfc;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[MAXN];</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> li (i &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ri (i &lt;&lt; 1 | 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson li, l, mid</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson ri, mid + 1, r</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span> &#123;</span><br><span class="line">    Matrix nd[MAXN * <span class="number">4</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">void</span>(nd[i] = mat[id[l]]);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(lson), <span class="built_in">build</span>(rson);</span><br><span class="line">        nd[i] = nd[ri] * nd[li];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">void</span>(nd[i] = mat[id[l]]);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (q &lt;= mid)</span><br><span class="line">            <span class="built_in">update</span>(lson, q);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">update</span>(rson, q);</span><br><span class="line">        nd[i] = nd[ri] * nd[li];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Matrix <span class="title">query</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> nd[i];</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (qr &lt;= mid)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">query</span>(lson, ql, qr);</span><br><span class="line">        <span class="keyword">if</span> (ql &gt; mid)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">query</span>(rson, ql, qr);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(rson, ql, qr) * <span class="built_in">query</span>(lson, ql, qr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sgt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    fa[u] = f, siz[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        <span class="keyword">if</span> (siz[wson[u]] &lt; siz[v])</span><br><span class="line">            wson[u] = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> sf)</span> </span>&#123;</span><br><span class="line">    dfn[u] = ++dfc, id[dfc] = u;</span><br><span class="line">    sfa[u] = sf, dwn[u] = u;</span><br><span class="line">    f[u][<span class="number">0</span>] = <span class="number">0</span>, f[u][<span class="number">1</span>] = a[u];</span><br><span class="line">    mat[u].a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    mat[u].a[<span class="number">0</span>][<span class="number">1</span>] = a[u];</span><br><span class="line">    mat[u].a[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (wson[u]) &#123;</span><br><span class="line">        <span class="built_in">dfs2</span>(wson[u], sf);</span><br><span class="line">        dwn[u] = dwn[wson[u]];</span><br><span class="line">        f[u][<span class="number">0</span>] += <span class="built_in">max</span>(f[wson[u]][<span class="number">0</span>], f[wson[u]][<span class="number">1</span>]);</span><br><span class="line">        f[u][<span class="number">1</span>] += f[wson[u]][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == fa[u] || v == wson[u])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(v, v);</span><br><span class="line">        f[u][<span class="number">0</span>] += <span class="built_in">max</span>(f[v][<span class="number">0</span>], f[v][<span class="number">1</span>]);</span><br><span class="line">        f[u][<span class="number">1</span>] += f[v][<span class="number">0</span>];</span><br><span class="line">        mat[u].a[<span class="number">0</span>][<span class="number">0</span>] += <span class="built_in">max</span>(f[v][<span class="number">0</span>], f[v][<span class="number">1</span>]);</span><br><span class="line">        mat[u].a[<span class="number">1</span>][<span class="number">0</span>] += <span class="built_in">max</span>(f[v][<span class="number">0</span>], f[v][<span class="number">1</span>]);</span><br><span class="line">        mat[u].a[<span class="number">0</span>][<span class="number">1</span>] += f[v][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    mat[u].a[<span class="number">0</span>][<span class="number">1</span>] += k - a[u], a[u] = k;</span><br><span class="line">    <span class="keyword">while</span> (u) &#123;</span><br><span class="line">        Matrix t1 = sgt.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, dfn[sfa[u]], dfn[dwn[u]]);</span><br><span class="line">        sgt.<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">1</span>, n, dfn[u]);</span><br><span class="line">        Matrix t2 = sgt.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, dfn[sfa[u]], dfn[dwn[u]]);</span><br><span class="line">        u = fa[sfa[u]];</span><br><span class="line">        mat[u].a[<span class="number">0</span>][<span class="number">0</span>] += <span class="built_in">max</span>(t2.a[<span class="number">0</span>][<span class="number">0</span>], t2.a[<span class="number">0</span>][<span class="number">1</span>]) - <span class="built_in">max</span>(t1.a[<span class="number">0</span>][<span class="number">0</span>], t1.a[<span class="number">0</span>][<span class="number">1</span>]);</span><br><span class="line">        mat[u].a[<span class="number">1</span>][<span class="number">0</span>] += <span class="built_in">max</span>(t2.a[<span class="number">0</span>][<span class="number">0</span>], t2.a[<span class="number">0</span>][<span class="number">1</span>]) - <span class="built_in">max</span>(t1.a[<span class="number">0</span>][<span class="number">0</span>], t1.a[<span class="number">0</span>][<span class="number">1</span>]);</span><br><span class="line">        mat[u].a[<span class="number">0</span>][<span class="number">1</span>] += t2.a[<span class="number">0</span>][<span class="number">0</span>] - t1.a[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    Matrix t = sgt.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, dfn[sfa[u]], dfn[dwn[u]]);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(t.a[<span class="number">0</span>][<span class="number">0</span>], t.a[<span class="number">0</span>][<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    sgt.<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="type">int</span> u, k;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(k);</span><br><span class="line">        <span class="built_in">update</span>(u, k);</span><br><span class="line">        <span class="built_in">write</span>(<span class="built_in">query</span>(<span class="number">1</span>)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3203 [HNOI2010] å¼¹é£ç»µç¾Š</title>
    <url>/2022/02/07/sol-p3203/</url>
    <content><![CDATA[<h2 id="P3203-HNOI2010-å¼¹é£ç»µç¾Š"><a href="#P3203-HNOI2010-å¼¹é£ç»µç¾Š" class="headerlink" title="P3203 [HNOI2010] å¼¹é£ç»µç¾Š"></a>P3203 [HNOI2010] å¼¹é£ç»µç¾Š</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3203">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¥½å®¶ä¼™ï¼Œå…¨éƒ½å¾€åå¼¹ä¸å°±å½¢æˆäº†ä¸€æ£µæ ‘çš„ç»“æ„ï¼Œç„¶åè¦æ±‚åŠ¨æ€ç»´æŠ¤ï¼Œé‚£å°±LCTå‘—ï¼Œç„¶åç»´æŠ¤åŠ¨æ€$dep$æ•°ç»„å°±å¯ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3203.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3203</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LCT</span> &#123;</span><br><span class="line">    <span class="type">int</span> fa[MAXN], ch[MAXN][<span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> val[MAXN], siz[MAXN], tag[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; siz[x] = siz[ch[x][<span class="number">0</span>]] + siz[ch[x][<span class="number">1</span>]] + <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> f, <span class="type">int</span> w)</span> </span>&#123; fa[x] = f, (~w) &amp;&amp; (ch[f][w] = x); &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ch[fa[x]][<span class="number">0</span>] == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (ch[fa[x]][<span class="number">1</span>] == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tag[x]) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(ch[x][<span class="number">0</span>], ch[x][<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (ch[x][<span class="number">0</span>])</span><br><span class="line">                tag[ch[x][<span class="number">0</span>]] ^= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (ch[x][<span class="number">1</span>])</span><br><span class="line">                tag[ch[x][<span class="number">1</span>]] ^= <span class="number">1</span>;</span><br><span class="line">            tag[x] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushall</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (~<span class="built_in">get</span>(x))</span><br><span class="line">            <span class="built_in">pushall</span>(fa[x]);</span><br><span class="line">        <span class="built_in">pushdown</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> y = fa[x], z = fa[y], w = <span class="built_in">get</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (~w)</span><br><span class="line">            <span class="built_in">connect</span>(ch[x][w ^ <span class="number">1</span>], y, w);</span><br><span class="line">        <span class="built_in">connect</span>(x, z, <span class="built_in">get</span>(y));</span><br><span class="line">        <span class="built_in">connect</span>(y, x, w ^ <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">pushup</span>(y);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">pushall</span>(x);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> f = fa[x]; f = fa[x], ~<span class="built_in">get</span>(x); <span class="built_in">rotate</span>(x))</span><br><span class="line">            <span class="keyword">if</span> (~<span class="built_in">get</span>(f))</span><br><span class="line">                <span class="built_in">rotate</span>(<span class="built_in">get</span>(f) == <span class="built_in">get</span>(x) ? f : x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> pre = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) &#123;</span><br><span class="line">            <span class="built_in">splay</span>(x);</span><br><span class="line">            ch[x][<span class="number">1</span>] = pre;</span><br><span class="line">            <span class="built_in">pushup</span>(x);</span><br><span class="line">            pre = x;</span><br><span class="line">            x = fa[x];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x);</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        tag[x] ^= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">makeroot</span>(x);</span><br><span class="line">        <span class="built_in">access</span>(y);</span><br><span class="line">        <span class="built_in">splay</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x);</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">while</span> (ch[x][<span class="number">0</span>])</span><br><span class="line">            <span class="built_in">pushdown</span>(x), x = ch[x][<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">makeroot</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">findroot</span>(y) == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        fa[x] = y;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">findroot</span>(x) != <span class="built_in">findroot</span>(y))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">split</span>(x, y);</span><br><span class="line">        <span class="keyword">if</span> (fa[x] != y || ch[x][<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        fa[x] = ch[y][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; lct;</span><br><span class="line"><span class="type">int</span> n, q, a[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]), lct.siz[i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        lct.<span class="built_in">link</span>(i, <span class="built_in">min</span>(n + <span class="number">1</span>, i + a[i]));</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="type">int</span> op, x, y;</span><br><span class="line">        <span class="built_in">read</span>(op), <span class="built_in">read</span>(x)++;</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">1</span>) &#123;</span><br><span class="line">            lct.<span class="built_in">split</span>(x, n + <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">write</span>(lct.siz[n + <span class="number">1</span>] - <span class="number">1</span>), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">read</span>(y);</span><br><span class="line">            lct.<span class="built_in">cut</span>(x, <span class="built_in">min</span>(n + <span class="number">1</span>, x + a[x]));</span><br><span class="line">            a[x] = y;</span><br><span class="line">            lct.<span class="built_in">link</span>(x, <span class="built_in">min</span>(n + <span class="number">1</span>, x + a[x]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>nndç°åœ¨æ•°ç»„è¶Šç•Œå…¨éƒ¨éƒ½å«WAäº†æ˜¯å§ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>NFLSOJ-423B</title>
    <url>/2022/02/06/sol-nflsoj423b/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">
  <script id="hbeData" type="hbeData" data-hmacdigest="930e3b53c868cf6b09be156623ee4c983e18a66529bc92af680a4975a9803b8f">67362a200d4bb0b1cd1ef5f7bb774ffb58a2089a15905f15111606287b2ae8c189eee0c4b7d84ffa1a7174e1da26f1c69ee2d77100c9b604410f259e929e87ba0bff4c648a3a51ce82ea3ba9db0274edf488f9bf9e10a561189142f5ea3834a1b0e32055be167d532b7f6ebdddcbbcb598571144e5ad880b6057d6f61a004e6d8941c3b86c8e97d00b268abdca89045106ec317993a8326f6f526d6874f89d8a949e7d681e3fa7b81dce9bbba8e0a3493b1d820879c7630760b4e47af0e880ec1679f1e037ecd6417a932d966bb2765995d0ba8210ada88eaea4b8b67e1f8541b24cf02f28779896df245d662809b73c9097a78cc2ebbb9a927e8e1f61b7780c3a004897be561728861c60bf49adc8ffe4921d37c768a46f2c5e8315052954581644e51d309a3e6113d234ce105ee98d14c548e361e4abfc35152b55c70d2763f1426e29aad82356c43b20f9b63fcf7082757b529da0515652f8da658d566c81d466a6c6a4d6713d97e0b6110cd61c45ddadea29ede7b9dc1fe084970531471c38a609a2a96c34e71524eb1bb25680aa86f0ad80934034a53c2b69039a0257417df7b0a4716339cbabf88977875d18e50d5b583645b558def5c51f6307fe47c982fa713b353c6e88a5b0fbbe0ecdac38aeaf5de5ac1f58b379effc65d4be6904422b67b9653734e71893759067cf744f86e19f073e778a7703f9375ca97b9c384370e33ee05361e1b01c031e026671ba129b57e447f32f3d9f7de8654183ed300ddb5c013e689b56bdbfb66320709880b9cddb6e68f849d4b9de9b85e906676ad0551e545cfff4b18685ad9ac02c74cf5099251b86a7d6377b3b9a7fb4756890ab7869e5d6ad6bb9b122bce52a3ea2d1a50985ed1170a327ac35528955488429e05d96622ad2aeea53f4dd69404229c6b8b571936f9ef38d40a35f5151e024610c0617212d4a682dcf5c64e8f6fc222aea74902712eac852a9728141818defe6425335e180c0d60ec884a271aacdc7d9b7a6a69dbe5f35f064024a05883a37f39a999a09ca5036c603b35e334cf7370761d615d2afe1203e3744975ea222e174eda402c17346d58eab95fb4efdfea24316c962963b19fe24c02d4adb83cd2a4d66cadf3809ee101d44e328f22bcca4f1f8d31b0d278bb34ee91299bfa180733510154eabfec2ee1d7d0d9ba777781de0d15af25e2a99be417cba209ca0cc349ef50f9f44631792c60bd45bb8aa007c2999008117f4dcd59452accd57f440bdc1155b8d35b08ab45d5ddb19f4f462d6075940f103db437d3cf74890cda31a6fa79a27dfa8db6e7d20ead0436264d5d5fe088e4c89ce736d045b66b4394bf7736d418a4fa08bd540fdb33066c0b79c0b11cfd678d6ee5251bfafac4f971e6e423261a92f8c611993b4d927b993713d43eb732975c248e1ede22fae123a6090c8e7c19887e0e8f39153b97e27ce0ae8d828c6523996fb6cd1254dd8e548926f9166b8ce42a4af7e34a8269df094ce2dc292f7e18e65fbb5a4d05af0a61027d3f2841e5e60264efe75f21a4c346ade00465f079fd74bd4c8b00feef2b89ff2af807b14bedbbaeae7c2083d4d2eee07282d5f44c3b7ac99f5f9ac3fc8fab84f7fad30e01a8c362dc8927dd310f5131de0e0038201fd700a57e69289047c8203c51c668ca21bfa41493b00b1dac42169a83fd6c777bc8a92146ab45e3700be80cb0117d05d8f29567a299199951ee407ade61a7d422633405057b1c98768cbea271fd9c70249bf636117e61f387652caa1883258532ee8658e5b85624ab4be3e8447de1e84711faa3a013a8d05003e86545bfedddf142bba93b551f3eb5ee93631c5048d41c6a96198ce0e18026251f5c28d9ea4da8e69c632d7ebc2f4ff61dda5d934caa070141b45c63f82f8869886f9852ea2b91d6bf63072c2e349de7fd52ea193c305d31096335033a16258a098ec4a21d75c9c00a89f967936aa1717eb821eca5a2511a862a9155c193e89d632c1d0afccea0914d12eca4b3ee8d88d5571dce9c13e8170289ccff0b04c1be4981938f3fd6ea85f8753055e76e0b8e4c87fae81c0aade1c3100f7a660ba3d3d91e99485d499c11853adf086b838597611818a6e7ddf42a400e29aa2df750018c7a1e00f0ce5703fa4669bd0ff89ffae406e3b1f2eb43b448501952a1ea06094a8c15700f1e6db0d977e93c7445801d2715846a3ec430d4f77822f87bf319ad970085376819ca261e21eb48ed55d07dd88ca1a56791ec123d5a5ffbf1a97001935ae86ce6c02b3e4cdfc84493db79c16880984cbe4a969ff80bdd7f5c60ca04c8b7b862d02fb0198db1b1a408b09f569f9076e74e6c07196eb992912d4a21bade008afbbd85fc2b385dddcb3cd0091ba9a91ee05c674b0e008253f74383b62bbe2096f84a8a0c4cc4eb2d777e98e9ec4ffaf3e83adfe4e26eca1124296d09ecc977c3c7d5a8d4b8917801de816843269866d5a980b758664e17c5570457159e1ff38494238625c569f6abc90f69d26554ad1698d07ab7243a747792f9656abd22865ad34546dedd24c7cb0d1e37759b4dd8a509f8cf1b049e56a4d91e7ace5d4c2079d9c8f733dbcaa51e542eb888b2de8fb447dac40e6f548fc4b1a2ce8da0bab95e99023fa543424ac0e1b677bc2f731c46f23c59896f11d52e0a1c847d772185822d9926a3cb4bbd846a188b30ba914e2160f2474bc3125f89fbf4a981f8afc9829744168de74a46a91d5a659302cedcc0524398624a6ad2414d2a77ab2ee22580ff9745447d717626837a1a2dbde063a3dc7b96feb5f66bd8214a1384c2230b1ba25368b9b11490583526bf8d33b249e8fb5821acea9c3d88a582a5a329d84bb7f163e4313561a91180c330c18f12493edaf5a5c42dd489ae7bb1696f13bd08c4c2c11ebd7c76217a6c197a529ee8981696a0d8ed787d93ff7e512a7ad82d377ba96f2281dd5ee4c118b68f0ef15967a97bc8fe5f3683cd3a39f521df08469dbb6a807e80750176d851dcde7ee45d9d945f07fce277672bd7d8aaf2e951d7bca087757d62bdfd34a3b5461947dd1b448f900d8200f5f462cc68238f2a11271f96d993d4d0e519cd9bfe63c81fce961afb1c0325f7bb9382efdf2b332a992dca2b1ae680e3b1e1a74ffb48bff74068c9d9094e486c3e62120ec617960ee0ab34e00e8381056c59b5de52f11afb18de758d0b519a1b74201d2f2140d332092f9f4fa49c0e12753dc88fe117207974f6461726a709eeadab72c77ace153715730abcee354cfc23d0c6f033c584dc5ad80f7ef68e8bf731b2032da345fa1f83fb6200d330de9144fcf4ecec61d6bb204183bd92a68b0addb712d9d4b57c6d81fe4054ad3202f3161f5123742616d34055661df8e6581a7aa6d533ca4f0cc20e086539b4224682593a7f26bcb81d5d8f6b916d8fbaad3392e739f97ba2d9a8d4fe9100584260d54d7c80b0c86bc374085406521a6f36d800867ddbb14e956a584c1cc7c08c90bd285078682045b1f27343763ef1112711ffd41203986cb6575e938452d3c4cf32aa8ca615719acc2c4468efe94666867a58b573c5464c47466b9d45f979bf05249e8ca538e2956b97e21bc59d39e507fc9c6449e4b4e2f3ae82e5207f1f1614251852856d9ed8069b8bf51402b64a2fd1d4b814788a675faa426e488ba0b1844b8c1e90f216e0268b7faebe69c34ce77f1bc917a0614940d0de5232dd2b0827c48d63fac4bbbb0f87a75a75a8eae000f6383f47c181e2bb45af92d225825cc0a3d837fae50352a5c1581621dd83009f8fb46b2316c2516119fafbc7a92cd944bcf879bb99fb8cd0278090a9d0486fac919c9f1983457a7c4d04d6b200140c9083dd287b9578a6d1963835c1bbc19ac96df93bb347d57e60f319e1d1e9dcb65977e4a2c49d122a936dd884f1e22987f28a30ec0baab7db0be83411b39590768b0b13c3b2a0fed5265a45c37b4bb8be813cd30bfa8a4d8d43ee554860b572083c9edd2144e19ed482e32390eb88848491a9f6e5fd8823436415b4d529a3ec72686d445d1d6d43a64ed17e1ff3c366fe50890d784e83ca013f4e1af76f23c97ebd09d5622bd6b6f5b8781582089996a2e306e6f936f9bab0fc261d0494b11bc9c86bcd71d8f0474a37a2a3683bf3557906c3750cc52a55bf7acbb380278482d093d48170928ea5de87ebca8c81450a4014e8fb56726781f87b5227958cc81b7925f96e61e8794b3317f3e8c22e125af6088f086e890f7ec2f543c41d29a937eaf9b6abe0fa1e74135711beca89aad544d9eb004dae5e04af49bd3252263fc1bf64833504abd0114e989cadd56f648b9dfdc5db1a11ada93d385938f85e9ceeb90b65c78d8b5c9e88fb211ebd56089d84c584ed3a4959eb305b76c81fb56e515cc1705fd642bf66ef4f65834ff3a401c0a76c26995e488a0ef563c2eedfb4d61deceae0613eb52b5c6527c0ef206ed813fd26a3fb0b7876d04c0eb6fcd8478b352a56eb7dda05ac2ba524e602f96c90c5a9216ec7ffb8e3d2b60285e1e1ee005aeb17bd2d3ff224c184d3eb527848ecdc1edb467d3899d61153185bd0b9fc6b13f8644f1ea1624632d4ad6b2078241a559b0d083b1ae3b794eafa581f9533cc68e7e7c73f4e8105e27df458b227008e8f63cfd8b2f686df0064425148d45a5bfd8f6a72d52726f274e9591403e0e04e3dd2e4443a9bad990298861833a5cf0ddccca6ebbc2cf24aa1ef37e6561e94d9fa814292bb84a81643528d57d581c4d0e113c38e586845c3e90cc7c001837f77e479d64f7b36c99f6a636f9999b37f0010e2dc5bf1d137b8a8aa2f037e87cbaae759421d95511f840ad7efbf9e46bc60364d45b699e860c684e97a82febfba2d34957ae77cd23ce34487712af715a9ce897d7718e6c3ccd6f65110097ed7266c639c2f4feaafe84259a15b6ae25ba786063d5597ba83796313ed6dc7c91422f7c5be310097f937a9727ead178cb41fec99abf4784dfb553eee88763aa6807691523e183a79be10a8d856e3ef9b25550c5e694f7bbbed6c441988b81d39786baeff8f3cbca4c5d2ccad90c6b3d04cc40ef6e81f37aea8934c4e69f71571e642d2990fefa214f4e7366ad6b247063ccd6ff4403146fb5bab99c3ee6f9c2c21733a491faf110d8038c300f3e8c31dc1fbaacb417245d916f5b041180e52bca9ce1090cd98edf1e7ef06e7b47cd34f5495b591da0734a48835b4857ad5d7df8b998753c3b5b6a92fedfb6e62096ac7c5967a0c28c7cf86fd5a5985bf0bac1e42d3f9d9a1591c2d5874a27dc8815819574309f53b5490bcc3ff068ac101a0361841f1769306ad83ca7514ece1b1f061e5925ca2b5beac59f53e26f16d14ce458980548655544a5e97435fb5ce6eb9324f4b2dc703d8f24390a95ec37b3c20393aa48abd52b39d0d13218d3cf0d71d3eeb51e74efab36a9f0981f88b98e6fc8786f12ceb4be262ad143fd2a3d8fce6fcda3091405aa20559dc677593c45ffc52d4756ccf49bcc30f40a0d6790533cb285d41dfa42d0057498cf97f41cc526c31ddfd787a75693900d87fcad834d67b4b74c399e2835e36c7824316e69116c1fec1583a997c23669730b13ced4b15e905879a37eb52a9b1799b0d2d34985e098bc678838ef67607f91dda34c7c883eede4bc2d8f6bde273e417d68d89474de651d41c1a735dfdfd3d54d1d3a769e8eda10adeaab0e455dd4ffe784fe31d7baf38f4980034dd370be86d7cde14b73a70a0079742c4538495293fad9ec99388f96f4cc3e44ba2d89c8c12fffa7ddcf0d7d3cc2fe8ee4d6e14e42d550fd666832bbd02c24df6fd9217d5eb3ae10da0328f0a1abc9b3be1b9bc019ab6555cafc02c6c903ed2c9c33f47882e43579b9af4802de1b40e131efcb6050bca22796812ec2ec1135744ab03c175d2ed01047956c548329e88a866d18f7080a8725d5fc341a45b3db43ae839e9b575b61c1d2538f0b1de5c65f5a69eb045e1f0562673ac0831226477459b2b9cb60c00c9ce2befcdd86be15eafb0ca485edadfb572c8e435cdb96031ba913ee90df2cdc0e9da2773704320d8a050d90276fa64838378b3d0f53120c12977037ee2a324a0332c101adb8b28c6b385025d60811a8d95d6dea97526541a5a8a2ce4ea5262f3e9d56ff7a7a47499c726e005bea85716a3468e98f89ac3bc4e90b71474f67eed523c028f5a388227c4e98fc74d9eac90f14f90914fc1a365e942924b490c7824bb1954406abadd308eb24b53e5969ada05aed50d4cfaf986aa23cd3ed5837cf1b9cfa4d9988cd25618b5ffe02625f29c5caead3c6d782872e539c02529691bd155516bddd13f67599d9073318eb4ab6986ff415b4be86d761f9cbce19e64178b9d8b22f49119c49030d9e544313336a9bb24e2bd9c2dabd5377cfcca276e542d3a577b27630a41532b11a419a0bd194f506945ef96e7ea7f89e183ea275fae597e495ea4fd441d913de481ff85b1537cbfaa999c29d6e13c52d7395166b56680010b76ef30a079e56001a8e32b0df2ff67a088b9367e730aa1fb9fad702969880f72d99e2237526b836ea10f3a655ad777305ea75c0e5c4d60ab886a2a31ead15d701a2f5a9018ea9018544d861b0ce13ae6ee500b235389d7220ecb456487622c3994cb4debc95eaa3fd68c56444b84826d04d40af45ac5a0e7d2d2f3f5a104356c9b848852cb9e7a39e8f3e3a7d141f44e9de650d435cd21a54a2bdf277d82a53348181c9f0d24e34e4a370e1c6660882c5a1cd760083a16d6113c67c134a648870b048bd3edfe71bfa9936b20c5c4bee42176086624c711ff88b9253882227f24ff5b0a9db0c4a636665796768126a2a88d0c1479538b8c4b34411594cd561f52db9f6b0aa3fa71442393612e06e0869d302f81820a5f656b1a196675085bbf9ae38116a383713c6b682dbe487b56346d9355c2c10a3341b4b5bd7ef840bad46e080c50d642dde8d810cb8247369bbd3f81ecdb7e8ba54664f8dad9650fa207c97659ceb85c9e544b804b272e9bb0fd59bb784da403104b3a51d953bcbce5ad28b7dd5cdca76e41c6376463468fa07b3b445f4140e1b76f58fe592f86ae907cff77f2fb5700a0c3c400a5b1e7f8d723b21115e88bcef44168c84a874329e565dc0778107d6d8290791dfb596e75e13edd6b90daa708357657077c8e65a5ee8fa49f11391962ffe3a9ea3b401db498fd3fe4f06d602544e22c49a13cc33ac7a139b2d2a4fe3d997d3a9624f801d9acc4d3721b4cd34b2261d5e8a81e6e1a98eb4fac6e557a34c5d50c5aa81398898c1a087d26a66510c153af3e3030786ea30b4375ac1cd133a3fd2831692b5f8b65e924a19d1d2a01662179fb9fb698e525613ab4490e42818fd7cf736d770e30f86e0c27939223ee6ac2ae1b8acd6ee02999beecc89e86d18c205b11266740a38a33e6668a83c73aab199a499e7be768d4f5ce2f6fedd52739c4d7aa2d786cb4d0a97a1d84798f8dfd7e7d371169fd2f033782488a1765e32ce2eaa58f2307a1dd674253a4b383a7fa4921ed618e9bd336e5e44d1b301ab78893c065233848d218c364fc1fa6cc3270a98305b9ed89087724a88f7f3256f0ed6e39c30e2fde60080d250e387a438e63bb607e6893c70685583864e28cfdfb4c25eb75f19cf1b6119238fbeb3c4a1aca157e0ddb62e2b741bbd49b4bac7bcc3a20c3cd7fd5439d7171586204065556af21b008c74406d7398cca01ef34f79abc0b1d4d76a08c7e6aae657c709d83b4015d3a9117d0835f8ae9b81d8bb86a7656ec1ace63e698ba8d8952c461a8aed90acfed534ff65e3cf6ee52580d03e83f007dc97ebd82bf413ca89a94f94cb9419469c169d2baf86fd42eea30377b42b7053d3f5e41e4b2330491b69635df145271302f6b41b7fe1c966683d2c8ddeb70474b71a47e98c36709b3c108cc280cbc67f9a360c5fcb8ee0601587dee54e4fa216b397694e3d09d1b44477d3714360de50fb421a97e7c251297a0b81f84a73bdf8e618380f6f773c8910eab6924101734050d0cfbedb15f769312e5a10cbfc2037be7bcc3d4bb181f0402846ba1dffa1ae479d9a5ae693b0b9f29c2a4a91645bdfc64748e54570cb83e45cd2eb613d3911e1c9b200740044ce808e654f7e773c1c8c52d5137c409bd4dd085b320f8ec74ae0bdc0e8f43d829c99d40ea1549db9a8640e8d8a1ced9297eb2c019034d525d8cd9c79464ad4959b898023ef97bc5eb4188dd7ab35f4729397263e09e3ac3df357b8beaf84b48ad8107887ad58f4dbfef258d8c4d78caa724940976cc80f5adb8897fe160e234aebd1f183077d7fefbce869fb1c28100c738ac8f8565069e82b37779cdb482c8cfeb9aae173b2291f2091f2114a2bdab9b1898074938589783c87a6121f454c7fd798658abe3960dcb72545ecd1434bb042135741c9e1cf220de572f05b269030bf5e9983a80ae11a410dc2e3231d3022def36db77a28c695242199a29240d947988fde0cd10a81182f22048fd3ca2d8f46f792f7f83a5f436ce4486559d88f5463a3c998282331e8a6aa27ab2061cf7aed4633f1e42b61e15c59ea1d5e1ca218f85a56ce1b46e4fbfc0fbe11ef6d0a3686a672f3df688d7996202991a46e6db857f43b279d016611c32cf71ea326f6bbd10f74df3edd6a343f1e2c33e60140d3b7339c7085b9d0cc7c2df33ddfe295f05b166158e3375bfcab8dba14b558a083d474a7718ddf8c22d36a4e7d4924d22d8d6d37ebdca57aa4494520f0cea5b171da0ab6789d6943fdc4c864fe7c57ac3266cc4bb295a6400f767712fca7f3ce45b1fc25a2dfd45f5ef3e4a7ec76b7dc40dafc65afde8eb1bcc145df5222acd6e052dfbdfa923b4319a0b263c4b074ae4ca0f9bce9d01d6b6bde115c98d4f0b70872c14ab32f17b2c3db866a94aebd10bcbb65dedd577d6b40064bd3d26d5c261b5ba6279a147c01af8682a542b73f72cbad6345838bfac07ff12859ac7f2a24e434086ee4f133f3707cb5ccdd8ca0eb17a06569e5fa4385a98f458c548b4499eef67656c545c6ea51b0572ed1723e7050b15da92d75dd28a361782a7119e87b2a42a9d24ab680b644a747c77799440ab5e07a566e86c242708f79d744921a93586509460cc7a49dc7932102a720dc2577a9fb31dcd5f5257c3d2abffaebd85bd972dea9af1a854bed3800ca4d28bb356a6579ef74d0cd0431f4338fc188d463685562b15e2d9391c210ecab0c1eb6c09cae1cdc6a167235507f8e92ed3fa2a0b4e192553b8e00a08f29eeec953f1b596ee8309242e13c11ddff7ee8f27a1c439bda8ee065502eb15d12848b741490717506472d22f4cfab752d5753b6fdf4a125aacdb6f47796231552f9933e04e61ee0a663d110f9262ff239d93eaf7e92a85041456fc58d6c7e51a92a77d531df01294c7c40a359d9a814b3996070d9fbf9b20ed660e68e261e3d7fa38c0a6baaf5be4f5c2bbabf716d0e3cc4a9a1105f483193b94de37d483f7b63f5638e9bc357c4cfb2682163d857e620ec99fe5d0c25c84f967882a3b5793a8905be45cbf229056bd1dd53a5df4bada46195aa9e86ded7f756545f50747fe75aa1bca28b6fb0159789640a30bd230f903b9325cd536db32a5bec910b24f6ea8ea00c9a3fe5318b2c304026aca40adbc4cf3bf4d044f99f1e39994d23d1fd1bcd265e412deb7d6ff42af3429250a126e9fd2a111f04ed36138fa5621d882e881990a5a8dc859172724c8276aa5b3798eec918a303866506561ee34df79d292772a55c67efeeca1bcd4211fe6349d85df6468128f23e362cf9d922bb2b8a1f75d8e3fc81b3318c802923a62ccb34c4f76ece1ee8278e51fb724d42900a5ff0a1c3ce4c04f070eaab2ac04399b42e52233da901b323cacf5238cfa861fc2b040fe2d83894519920ee8f9536e97e4ae855f156faec6d86dfb706b62a37ac30a57ad88bee4d8180665de8d879afc7f5f4860f25d845e475c6a703dec4ab64cd2ce6e874437693b26ad2503d10fa3ddc27da880d023bb50e22b4c86227d3f356bd99838976e5f4a582d8b69f48cd9903d9ed259cc1b7d2c628946a70ff7ca76aaab3b759bb8121ceb32cb4dfae05e0e6be902c715ac2eefcbd20c570d1dae7b28ceffa3ed748dd156e4ba9de15acba4c9ec6a6142a7ea9843c63cc9320f0d2d059d40f75b470365747713976131251871fa4757869e0566161533c6413167fb362656a79871068fbacd0d08feddb3cd6fb60995bac0edbce1e70ecb7a9633a9a997d88dfdbaecabeb2072a6454cbaab8d93a4b435b6c014e10554e71e9a1ebd968a43cb121024a94a60d35a3b7ce3e4ed346f1b9190a479b2f788cc9fffd65a9856e90def2b27725f90cb15051afbe7e0b8c5a608e1d49592f4d989271a6f2fa7a1a43d2cfeb4b6f1604f87347b576f20bd790ea5e4329c0f2d1a0dcc9e77382655b5c65ce0a7eb3c3a6ad95f4875c5af9a2ef8ef0070544bbf814351a26acd30f985ea56be343096b3e0df44583a9417c807ab85f0f7d675599b36235472ee5138d032b121535843e908fbe8146ad32358064db21cc320e63abfc9b7d09934ef0cedb7371f72f6a44c8f7aa77eddb789a6f25eabd37c42bfe26e95336fe81fdb467d5b0a0bbf60dcc826d5a3eaa72a995852e6b24b1b9752cd4e1bf8bf401ee934a486e64bb4a6ce0003042eadc8a00c5813a5be97f2d584e291fbcff9e5bfdfa2e12a5c3d02eefe6599af8c93d5cb0f798b63c58ed259df7bf6fde4d39467e7d373fd340cc3f1f3a5e39c0c53521f0d52986c0269252dfb3a25630c01e874430da8dc13b371a95999f8ac63c9baa1b295b27943698624dffc874461081c75159c1bc5dcea2124587b4ef8056f9d2bfd1c431bdbd3ccbb809c16e79f2b0e5f2a23b6390d1d9253dcc7804e5ca707aad1843d66e4c93adcd93c8a6565eb7cf747ec602ab89f79b3116d98569a2d87b926b7c89e95e3010c84036f4ffa3c2d36e8c2fed5efb75f7e22a27ae5ed481f7b9c69d5f08cdea293cd4a47bf1ae4ce0ffd0be88b288fc4fa8789ac0213877ecfabfc325cf6498d4e700682a4e5f7885abd8c333691047e130de6b0e195b1a0943e198feb4df7339cc0f38db50e62ff6aaf30ef09c688bb6ff0cebeb3517df6c8d88b0f92c57731d4b73045f108c2a1509b3145c22bf9b4a7a27680b2e06516915e55bde0111a5c28d58923341d4eb0be4d42e5351c3f9c59337ba51a1cfeab4594e25b1162e2d77e0a09c209d8492189080b5b035bc763a207c189972e9ef73e6a06542e4b966cad0c731996f120885a443745c9ff276521a06c6d6e52a20270975b2a4aa41462e0dcb87903cab154dfa8e1d267d7f572d438cb4644015c5d969fe913e0df4decb7e086ae154764f5357acd50c54953cb8ee3e3720d0f8e74b8e136261d9cb15abcfc7dde5db3f136d67a0e4a639db95a849fa1f0b9ef7873ed34f8a64d51793814b2247ad7d9991c4e979b8b19147b1517923f0a761cfea3aba6987530a599d595a0e5099a2584ada01adea90a5e7be59d38fffc9f54854c694fbd76d75ecae1a5404a40ce1315fef94f6653a52417e63b353e0dfa3d831fd5e66e5acd47178b0f853e318766065cad71db7778c28e1ae1d86f2d648a195b7ac1ac17b9344954d421477fa7357f117eb8b43021a8305f0800e3695a58860e76388e679f79fb8a8657feb87a56d5d3b5e0100a9d004e4af6a517ca28fff26ecc2227f38b56ca42eae1ce4ec9f6361c3668ae690414737aca8e65fb79c5a488598636b041500d6cc06d3812d69814c958c629ba64bff145b0b7cb29092e00399916207fd2892b76debfdef4f677b31afd7b5c01d5e93e75a6056168ae99a7e230d79c317f3ee65a5bcff7c351fbb3f39e4fac553d1b1df06da6824a88225c64bafc03ab76ce24117f0326a71292f63186b8dfd9cb2fd7fe612d3e160d17c32591711425ddd191adc242851b06b1384a1a83a94779827e7034ce63b170b2a55b2af720144c245dee034d1ef2942d7df5e8957a35256b135784cf9e3e75219920b5b2fe6bd6f782943a2c258229a94755c62694e734a60a73e2ce16d58c49e650550601253c78751455c262841894416ed98ab852f1350349b931bc5c94322f1cbcaf828230d2d5f20040728fbf9b84f01c1b2c2284f52fe66815a20965352b0718eb8b62b6802db992051935c5e5b04ddfcc1afa2dde5631ab0d09ec2f22383a64ba572985e88e34ff7a73136abbe53c2616ab1a9de4cf619d6ec1042be1d4c387fb3c5052d7c0117188bf7e3aa580fbdcfc6c4a4b7efccc4da54c6829f6dacf990226554edf34e3e5d94895e61d6980cbeb02e354a9babdbad41c555be0da60c061030c41f77c079ed84d10d622670bfc7c06c1c98150b14076d689f7a23ad15dec26e9d050d6703188b7432dec93843354c5ba6f5b13ddbd32193ecdb8816ba8fccc0d03d2e15b32b593787a973789c4310c946a06cd261b6ef98edf016b994cbe0bca3696d86f768069342933d6b8ae4bf92e487bafae467d3f5cc3d01c86cdddfbaf9aec87fb82ccb7dfdd6c46400bd9ebeddf6ee434f9b716b5cf4dfa68935a177f3671191aa073c533e80c2cce99678c0a20d9fa77aac0fe61caaee4179498b80a149a535463aeea092b248394a2288b930bc24f8cbb1c7de7be0dc84eba71ed63d0246845159f78d79df5ab21994a5e14ededd8033772a6e99028fe7c1c14cf9ae641745ea81c78b26f2eb351c27b0f1a3ffd67ac28b03531da23b5a37f384996d1c1aa8ae70fb26b02149ef2fc6829d1e52330f7c6b1ea499a58c04cfd57fd00bf8c75a03cc22e32c81489e44ff1a5f3f44828214acfb24e0cebfe7a578b738d0df975a710ab32f7cc41cf5c4d5187b446960044a4cd9c83d139862137dee6f47f341fcd7333e7cc279860c6e42470cff3127e7169290aff1543bf5c6347feef2ccc0848262fc124933cc6d77db2beb53824fcfd14967497ecdd32014c291720e28e8ddbc77bbc986491e5c80ee3c883f91d10d97b5e921ba2e0f9ec8a37d37aa58dc9a7503a5ae3532f3e0c795b9e9dbe99a362ac406d28cd908ee2a1da2b50c5f831fce4ebcd5f88657aa4ae39822e0ee3254fa5b013ca8c79d3c0a5af61ae8a08277eacb34875d1309c332b0cb0849fe8bac0d6a92625d71418f2c52e2a00ae3d847593198dd347465c41e6c5fbb3c44053cbb772afa7fd0a820f8822a80b81a5c0c6473537713cb223a67524036d70c469360f3f38192cdea5e7165762f7b72e3de5b84e3f8763fdd0031833806b58d9487972de84f55d26340347c2f302ef4053a988f0a25f7e33cc7488631f0792df9beebc8cdb30ec33339499408ebf643c0add0fc5c2f474d9bd50d0a192155400b84f4ca6cbd6f02a21e0c9a615a2e68f76d7b3c81bcc70c3126430bbd4d30dcecd18df93d42b74e7f90303be12dce2cb87252d3d9d1f49f9fd52da4ae5c52aa08f771c749ec792e2c941b0289e79700407ae04fa1065af220b3584096b230f6787c18d84acc0a6c4ade3338ee58416a4e7646e3d96389ab3b8d0457f534ed89a8d98542ba6d501c2e2a837501e72ebb5cc5c6f31f52282e226080991ecfa886cb9a243602ee293531e086b147b9d6b9bc9ae1e083a38b8c6a2daa1dbf9a6167d07d240f268aa7e99339f3f31a6a58cb9d1f0de008664125702783a94a7f90433394d763584de5d89401d5330c08385356bdbd58c5bc53f3efc92d45e95aecd2e777f3a808c4061bca06c9354abbbce60737439b18fa9557c6d8298b9c6e117fa0ad357055ecc57b384a88eeb00fc6db4fa3e38ea59cae15365333d5e9d9e284d8cf313ca6399c0cb2e179a1bbc669d9938ed4949c36a15690375c6177a8315b8df6136e78a1365e89f12dd34d0de6af779d6cca5dd99309448ca25546c25e9efbf93af7586a24aad152858d87c556bf9b2daeeb61918dfb9ae4f0a0879d71e09192e97a263cc44af70f13a5b6a44b597886e394f3b7cb7cba1505c50b65cd295fd94d23f8daaa66349cd66c1f2e6357b52c41ef18fd85a1e8aa26f29284b986efc9839818a53c20bf6ba58cce524551b157c06642076c064129ee0e80418b3e7e284748806535314517125c5c890ec608f6fb9602b9632e6b6f2defb13ea9b1be1bcb6abfbc3b3adbea3b8ca7c2b90340c973fef00119c747ff1308cdd16da2074da5899f14b8a72c55f9042ba7328d13e1419f080841ca3859031eb583d5b73f267011e21767cc66065497e82823e7459c67e100cd8310dde043f67fbf89f15d7af008eb30889c9f06605e3f1bc21c06697c68dd436455dfe649a7da1bac4fef76a78574e2597f8071dabc23bb78b82c3bd7140189d2794452e9750dc669e7c7829e2c6584653001a10691b2b4c1dd2acba71a441ff2f381d6486db9eff29b0eef9f347f925c7a93d33910654bea8e28748e4cb540840a39db1ce163b51b3613d33566e8b5705632ab459883d15151c192a230d44f398dc694a577df5c9adecc2d9450eaae601f78a62c01fc16a93817c82ee7c04a441678084c99489d337a55885fa577cb3ca09d7f5c81e7aa026adb75c661e1472f84c6769c08569563ce6eb3a0d5f434dbd1676f37616142e2a2ae512e369c8bc4c7923f80beb11b8e888348bcad26954ce442cfc7cbd11818ab6af34b14628be25fc7d6b4811bf096b61ab7434a7e6eeddbf44524e2b4a16c086c42707ebfc6945e22dfc5152bbf4430e5a513a0786e610fbeec618933a29b377b5dbebec2bba662a07424eff9f49be1fb4bd4a2c7f4ecfc43dc754c3b9fe2638c38bae8b8cf4caf524b39d902b777aa58c2ab7217f3f32f9b54112410154d7334497962231d44148914937f69e9eb55d9f40bda90c343091bb97b48c87c879a56f9fd71d17cb0cde11420c0844986d1f780b317a53c687af1b4d910db34636cb003938a92295517dbd3750fb68155ab29e3e4802e63767a40de4519d71ad6e8dd4351a30db052c0f318d4387a96b6191b3b0b43cfccae9ddc579efb0699e5c4c520cf07493878cd5fd9e3a77401240c124273166db70001e720caec2be5446e92bed27d39b2df790649ea5c974788f9b154cf4e5193ae2bbc1b88ae83f515b672b2e834d12e4b4067faec7799d4b8a9ccd2d8cb5b5b41a9a257d49339a676e6c3c542b5dc1a2bdb62b2fabe8df3e2ea0ac4863e78f3a14c4f5303b82837f05b4f7e70fefe595fb3307f64cdf1dcd81cb368fb2c020b10f8354f52e4abe4c8764d6e45f1e71ba88875bc177b1a3237a0f83f75ff7972b54eae030bdc07c394b96b0c50ec0c17e0f2d9e17be94808e23056ef2253220994376733315c400e9dff05a66cb1d3867c74a16ac4cc442bdfbd93234210ce3cc6d66397528b24d4f1697b8ee1ea21103ab1e22b756d296e9eb27e84cf817ccd322d6f28b24ed5fac8fbcee8fafa8504f8bde3e163a77fdcf7787ca1930447af8ffabdf3d8d061f5b000ed8e33316838a43351c69125a971672aafafc8fde111391bb7b8248bf068a07ffc64a2b22a5da1ba1584bd9e4ed198515fc60a054d46757d154cded479b0a73a82125cfed50c32ea01af7b757709be2223f25bbc2ae770ebb74228b3bcb18c2c6f67f96df895e53d0d3244743ad41fac2b0436f3a0c6511ac7d7b143acce48f09eb445d1b4957a34e173ac6c3759236b421265dde07576996ea90ae00dd71560a221283841b3f0a5881d6386cbbca4ce92604375fdaa22c1aac26af0d39b6d3713085975ac67bc772f49196d45fd1e84e044c35fb076e5d759e48c6e75a2de7c2846c6e70495e3157e6fe13441ad8fe57773fb9ac487d7153a97fc186daf98438b5dea17e9e6320ec6303657ff8b5d63da4bd857866ba005b3da14be4e12761473f6034b77cc52f45eaa6b7727d9e288bdbae6a64e46027e6b97ab019ddac37eb50f885e572d4825edca4d2c67bda60c55b52e3ed5acee553e75b268d3a6c8daa51c56c930cdcae8e38e8cc2edc39114d6815e4a1c5fd6622c3e04505bb3372d2bc9c3a9cb0613153eff04624b7650c236d91908598c0b209000ffbfe2a6838ec8d19abf9f38af412eaeb12789538257e288af1eda107736ab7f3bd04518565149dd9cb93778e7ce4d9a1984dba3695bc1859cd580ec01417acb7ee415d00fa65238357cfb3e4a38b9940a20bfab9df9cf9f69a918d88eedd9c4c225483d889cfda4134762d4bd806a0764c8db4687fbafa513192eb63ca9fa6c40b677b033f6542af055f13e6842257f83bde14cb946e1ca7bf4440f0e02671469ab91c5fafca7d66d1153fad242d7b8739559911267bcde2de849329eab55b7595f1bd3f5ccbb98770d596c3d6a617e25e657439aa5874358a2105040c2c0629c12f860307c1b5f968d9171f2bbeb4b5836883307769d9d0842f09d8b84f008f6dcff1daa3f97ac0e5f016cb4182d47a8b9ff2a9e19479c56b3dfc323439422d6701151a79f27421b3d388501a9b7db927844fa68e4c1b6fb8ff1d52e5bbc434b47a8822e3a51c5ccd991b967b657793291d845293e113124dcf3dfbf4aacbd9624f4c756e77ac5d087f937f37584260689a53ad317a24bd8c26833dac2997432be8702834a13f97d07634edd76ff01846dc3737c1912299980e4485e793f7fd4ac57f2b51842879c24e0ca7e606e04978927fa44e057af5b4ece9efff394b92c6fefa21b18ec3d79ff2da97de99b91cd03b053b13e80f33e1f64ba962e30c94a0629923ffed18495e88099b51788b7f5f3708bf26df89354c8e8b3390a550ff959299dcfb6b368a8dc4b1f2215f9c83b5f24cc38e549985e8a8c2eeee9f949d3902e2a317aeefb243441e12b68335cab538ca16693ebcdbc28c7050034213bcbb8c1ddea2154e37e36ecad797c6f5ea9c87052175060fc11211ef61651f69ac752402f060e3c72de5b4e18853c8ed895c3ff9e33bd3bf5b288f49adbf2f839776181e034cadc8121068c7a6059aebdd78eaaf0c64333323da5b3abca99598e1281786cdd9fb73121d2880c107934db2e3a25e83341c0a7c3d08fca37f9b2cf72e02aaff68e4fedb422db192e2ed955041265dfd25d648d0d8d578d53e8a7844e5aacb288cc8f1ddd3fa9c9f5048f5aefc156feb04c83a3c5b485fbe107fe765f3bcc92b2d9cc4376dbed0981da50ceefdefa1fa9248587822c73cea7793a142d73d5c63556f51f5e39967dbc16260411ec6d895f2f9ad86726c749e53059ead176d3e35d2d84538ea064b8195c7083bf41605d8c14e999d4463fecfef8b9522a82556c95e094b7fdb7c42a1ad98760f26c75dfd3a7b941a4042d1eb3331ffcdea7f86da0359e17ec1708fbb90bf58481186569e60a6fbda5f25493eb0aa75c4a980985edcaa78b4f05d6f16ae6ebf54b427dc49e695b1315f71eb2bc049c258e785067f07714aadd3c59392672f3166451947f670182d2bfa9fcefb65b9b8d13bb3476d7318e9b3e076dcdb8608c4d8e132b1e27e2c5cc1d7a059146ebd95e4373dc72de8152888f512679b8335e0baf45ffd7851fb5c06995abbd3d5d46002856c538e00a3c36db666c558ced834d9eee630e76ac6c2e8474a2bdbbb97b17ae36fc45b36824588910ed9646001116fd083834852719c35f8e9a9166404236741febab7c7554bbd8bfa6b19742c7f1d64f5da22699b030e6bfbf1735dc3fbfcf959523ebc6964ec0b06ae25d584e12020ce23449c79e50f9c7daa9ee96725423af4435065724c04fcdcad59ffd021481724cd0e319dbe42fec73bccc739ff814f193bef39f2573d064de2fa3017d497231a11733611a92f0815f915a2a172ba0e79f667c2ed103248656aa8e48a6c5e896239e41436f12f819631eee0c591255a4d3c132b57bb68f3c88a32262b20613688e3e8595d8faf07bb4da9bfa4bd94d64edc1e4ab4870d19c33484b290670a32cbb2a91dcf2a905d11e3d069c563d52ec5778d2851a77d927628024769a9deb6b199a293ae0865507804a1d731b7f30bc9015003da988a013dcc858f7df3ce7889df6e144d5faa071eb848cfdaf4384680eb6560f14610df8512a89831101bca2373177837f0f3d9f1f1567e122561d01b32883abb9e21af4130c3070999d59e4e5ab67a0dd9a9969886e1facb5d49da1886f4410f7c68ed8424636f8f139790d628459a15e3ec30cd88a57959388e567ffa95ee879e1591892de7bdc367531c344dada8e06f028bedbb14d11d8beaee33b5d1df8cc0ccaab7562850b782279e346196f971da340a9a90ceff69dc8419ca484395aa9d8cc84451deed3ff24213a847da3b7b62282eaccf20a8c33abb159bde52710666cbdddc058336464ad815a78c1a4be38342d33a6c1c4068131d8a68a1b6376e6cc3fe4ad9aae60b4dbd5d2801629035e8cdc52c6339889252c3bd485d453a23ba45a0bb82b9dbd71fc6cd35068c699fe9934426914b250568198c67ee98b2ca80684d19cad9f22001fd7e9e41270f8061deaf78dbc9ee8c24386b5e63c52424fee4a7f3907c20ab49d40d994c5c204552435e2e641f04b759465e30740ac7c27783ad66d3cc5b45b429c95a258fa74a0e72e4e98cbf0bd259e09bae88e4459db4d315ddbd9c00ade20864b816c488886280eb29a94e64cb8a0e1691183002fe626a64c4d414f17b6d4f469737c3d59e4bd6f1f3f7ff81963c41ed03b4ea9f5d965436003f794a17e02a902a91d37cb41efab38a9c7e555fb96cc7b9285184e638d0d1189dbc850732b5adcccf6ecfdfd07552e96fbfa7d2a3ef21ce20c82cda341466420fbfa0649f9d75b157e20ca88e7a39ba6f7bbfbcd5d47aa3ffbb7ce95b0256fba87e17def6e1df21a1dcd480098a721cac6321b37423c036ba3decd3beada37b185098e97166ac7058e35dcc41ed338ae8b404e16b805b36a1b8916c0c5cfd544774edca698d48da6c942f8b5e207be9ab9819bcc24443f7e1f4bf6034e5481936dac4f416fbc64baccd8983d5d7f2cd5d82c1c18a5df9600ebaa7b7bea2723b3119a875c7865b5ea58f7ac8e3fc9c1ff76f265b5c238832de9ad1581608dc62cd39f774768e0bc725727e278dcf65339e9e543d5055406852ce3c39615ae2018e8a8b07e7875f9fb826316dbd9d98e2cd2ebe3806bfc74e0adff275deb7fd2cb3f9ded4e24eff4a16531fc72a6beb2cd6f3293c34ea6332544ca1ad0a08962cc15a0dd1e73f3e671f45e7a608be67c510aa91486a03d63526c542a06d92c1aeddd394d5bb3a654608da3c99e6eafec05102aa1ffbeca287653c4c018837b995c3945a8acb6c6d41ac8d1bfd59cd51b488786db70d09420b98acbf3974d65a0cb8b2a0f5509e3846175f6b655200749020b450b2e861a69009b6a5deb5c7e1a8c976b0204e4c566dce57db0393cc161c583b2d6a58401b0a9832ad87e1d33ee8af317a90098fdc87f952a46300ebe190bbdcc23e1281fdb6f4ef4310626961cea9c352cacb0c6b448ad60250a8ce345908a665be6ecd8cba1a4d04f0a39b757812205a2efa75674d490db7fd6686f36997a0be03776cf706f809fd8dd83fee73a6eda67ce7105172be4321dd71a3aaba242c57d273a86961567b0a2d30f469ffcebf751d3b6c9384221284410a3e62f0ffdc9b7e2e645e1968a959763dd97a462eec0e4a8a73f1534b3061f3151557d45a7f32aaacf71b554c09454df18474002d37abbd8d196150e6d39e4970669f3ee3e73ed88a8059fe93654f838423e0e81c15dd2477ebad9f8f8dd6ba82738ce6e9e09627d79fec27710a35e1bf4faab1f4e29dde2600ed916a75b2231601f072c9e1eafd18f63197aaa03c4e9393138a05cbd4a83893360e375985dd0a73354e8190bcb2888622e5af84017f0ce51dad30b3f2a8c4af3cc730bda9b611aa20579c85d9a6888eefcdcda57999dcc4c23a67b9c076b478566492e846cad9baa7665c963e0af468c1e99f391f2a59aabe047e7fb079b5b82d19a2146af93d7eeac332cbacbf06370ab9731ebc50ededd484f43feddd56d9fdcbc3db74af0c1f99be60a152211f304db5f36fb6862b9790923bf0e4f579729a3882cfa38a7378a5f8d2c1dcf77c304336700b642554053ad99fec4571949798e189151627f0a2bb6c447bc3606e490e1da0022cdd93f66a251e2f9306e12fa1c81ed03ffe9e44fd9298c05a90afa375186f4bbc8221c91d0ef82a013d5cc7f83a3c5cb65591fef242688d852e83e0855bccae88fa3f98eb1c95bea892c180ea6f0cd1375f691043a10b1166ecde7259849a5ad01363985903663d815c435a2a6f71c9ee24061cbb9336fd3e31c5d17233edd3cd77b943c38d5436c6f8a68e2d95176dc9d0215074ab2b0b16277c5ae78d3142814b3f463cb8a67e41327d3649aab114a4e48bc6079ad692be5eaa2af5eda9e93bf8eb28a44ebb7b625151654b885ad44f21f019c36fe7be035901083559d2f43aa8c95d53b2def4d227f1c61079b9a17c9f3e96f9429e79b97b1f4a8e2967c79b5b62d6ccd8218839ba8a37312853bf53caeb9bb87560bc7732a69538a9055c35de36572dfc48b2135b0da0689912b16cc74037f42cf8a23df3b667c442c1c161905f0efcc024fe57a353da36650af56175fe147b66dcfdcde46cac2ca75c78eaf5223b502547802a17b8de300345a132d2546c3b80b88cc4560fdb2eefb0b21894b454c863dd94672f2838e3cd59c6b6290d9158900c4930c99a81cf9c466d7219d9aa2aeb3ab7418168db20dbda1a57f55862d4d77fd4e604ba7e74e1552f23145f39138bb2e6ff0f047bb755fdcb07a48c81db245071c8cf24ca6eaf5f84d6c0e2757f2d7ff2e765fa03ffac37763b6621efa18429f06a26e14fa1cd8263a087d289f346436fd676a79cf899ee2d87377dd3c256ae3b1c053dc216af59e7727f1326e96e04a06e0d2d621369a10b4c1a9f3a2e74dde178d75d4aefbc022aac52fad49ace893433c67dbe6053a4c175f76692b1647b7aeafc01e72bddabfaa497d4b6dddcfd043cd50e4cdba9815d95e379bc12cfe105387b48c8766855d0d81b73df49b3b0574976c34553fd5ecad7e426a63bba49f5f2221944796e1f41b6982701a95e71b2d126e5f573fff5d268c3e246095cf2928f8f8b79ba898e44e8340c1f8bfc05daccce96d3908a1b92e23d59d11c5ff5807edfcfe25249ef93d0592c2498cc6f8e8075feaabd8b6b78ebcb6315b74021506c2040d666af9efd799d554ad304d84769daebcd1566eed6eee714684cce5e3f1888efbd1b706b2955d5070bb3ad9a6bac0802347093b6e4ada9d3f8b0a4b9431ce8ec18aa160db498408e1642aa5e9644c94d490e51b90dbecd72d9fa4d609cef2def1b186200cbe8368a283183c3e8b53f7f171b88f025a00c384d1c0bcf0bdbfe5823f899e012875ec4a93c7ed09029c5dd08072bec58c52de880e7bd5a53e9abf78057b6138869bf79030a5ac180443391b755e7e571b2599b8668bf0a394ab35862c141a890f006b154b1e3718971344c58559eeb0cef32a722e25b7c99ef082c1b481d924a4cd023c99cb2f002860c6e3aff04344916e2d6fd9a4a55e0229a072f6a4f8b308bfe76cac21bc87aa7720e45db40e8d01fe59de8669b23bfccd21a50fa4eb2a322fd980a5b0460063747a48e5742914a6c8d5d16c1892b4bc2de6e985c49dcb7188bfe8637469c5bae49c76d7c4966cffc92ceeb055b63120f240c948b84763542c6412777ffa6f9732e1b7d520cf522b60e63eb29671af0b16bbac210b27dfd6b1956292dcbf3cc92f4b36f8b47d94d3d503ecdecd35995c5d17bbddef108894805ce1c375f464df52da532bee1b330dde8203980b41797ba98b1ffeb769edeac3d442be4a210fef797ce4eb0081602af0bdb041b5114f3024c307314b23b74b9855295bbde3ac6993a8310d4c9746231ecea5829c34c5deb6b90c24f3cbfcdec3c8edcf5fca4541509bfdc536e648403f10607908c54c8603368b2b04eff44675560d4d00c3340ecf2322738deb8f161e5ca142324e30f117186d2a857f5ef4b799cafa16234cd9f8b00927d2e46021f6cf1852a12a7826b3203a4384537bcc5643b612af0fddc7bd3827a3c10c53ed5e5dea3671d95e708a5796ea668a7840eeaa958209ee6c686b6b8b43dc5d8bcd904575543396b51541fd7b30e9b935f29c4fb551ee5e62a507c0269c159496ae2402b11959243d63d5ee45e719e97fc2f54d1b36eecc4e6c10c5f5ecbf9476e4488366ff1485ad936725c927b0a249ab0817bf85dd44d80a141280b27d44a3c916a68e7bbff0a0629d82bcf4bbd8e4528de419927822a126bacdcc56f521cacf06a3d4c2af38e257e3b46d82622edbd758ed29e473a65853919f06d090cc08361b256094846212332cd6580ff982b999b8fe88a904f50063d6f4d9f055f1054cc3281d6ef45c88999d15d1f8435792c495166784a2673fb29c6e63fcb07fba24ed0d48b8ef7acd0f00715c2cb8c69fdb6066ae3f22906b44dcaedb9ad9ae26d57f0e53121c86cd9d8e5d00d8d3a32468c31fb799ebeb9b227909ceb68879963928859e2447ba5015f9a9de98a212878610c722e7eff4c8bb03f73cfd5ae14c999f20c0425df3f24d2ac4e9044ff1aca477e49d21f62cb44b15417548f1904657415cb9911f329731955de819e0c0ebabf08fd05a95853f7cd29986d29d2b6c80bd81751750e265dc90f131258d2048c5c425cab1f002581417c01f7690fe7f64c0035f9be5b5d96ca886ed1b5bda755d9350eba89a0356d40a14ca1ed8227a0cc33cb87fdf9e9bcd0fb676098c01b4e1ebb2a9feed7e21281240bfa5fb4a32f283ac2f840903b61c29f919443251faca14d7942762aead8ff160da3e6b9fd336d23e8f9f57e2ca19e104a892742fa7e0d96bfad1e3b220872085fe4301fdf7efc8136d8842c38c414d5a8a8c836a66cc9c363029093b3af4b5e83941eb1e6714562d69c53204488c3d8da161a60dede4d75074386bcb81186cfdabfb2848f8b3b22a2b0072ac4e8ff8014dea1b175d6bc713ea5543036479601db80a1e035cf0922c93f811516a09be296c30928d08f1af1aeaa651625bdd66868c9389cb7ebc9d748dd91aba36e172c2f8914012b91102add0fa11c3b71dbfaef5b8923a13412d55377db31c1f1505b471a7699d2c80d7c3e4e7c6aa000c0cec5f35c426330f094f78efb5064a5083e7c4ebe728accc6f28956d200f1188549fd135748b8c6cb6be937421632ef553c662a7d23026d74bd65c3dd44439c46968dc638fa7015d39fd7aeabc2b0eada1e4535ea04f2abcffd1037b1246d86a2af114a1856b24e5f8d09978f5e1d4e998558286cef85e877b0593512e3248919313234f2410e700d6fddf9b3e3df3e848fdc7fc0158c3a4575e6ec424093a44e03a61d24920a4319a0896db8f79d06d737cd69a54d191aa6ea8e0fa46138ed29675f96823b95c4f65b98b8fe267764e0067c8868dcb8b2725b4740626e21c91f7982064498c0667d8bf27a9efb7b4fb2c3ca14a76bb777d7bdb06167f973fccbf95aad94fa7993afe9496bd473388a17acb2d936dbb9a3cbe94072f5050703c57b44cf28f4b2f1dcdd60a31cfe7fd9e0980b6511d64f8af6da78a199127a2275da8db0e34a3bdcc2fbee900bdc5bd7110192b1c098b4c4401650757fc844562ee890cf2bba1ebd34dedc8c5fd04cd1be1409d6ccf83b03e64ff9880f01ee7bf0339eed01961d64494e87ca872185482cd35823853d083fcda1b921c5e92319a76ed826921ce7ae92316282a29cf50e00458c6f552df5c44878420f1e4e462b5970624fdb38fa87ba51dde4e616bed84ab2ac8b94b4e07222d398720a6f2cf627f05402aca32bf7fdfda046f6762015bdaf7570727a1dbdc945ca846edd38f49402a2ce9bcbea2a09ba3025cc468a3fde20860a6dd35c52421f1cff59d61b8fbe89f7529545725e0c5cfaf884e81d9e6ea83f11ecabc5dd1aecb3be4e769bb9a98bef2c355763e2e959ada6070646875f2db5e36fd4af1d81d6ff4ce7bf86134df7a05ca7d43f2770fcadd719882f1221438685c35869aefcaef45d992556a9894ead3484fbf9014aa676e0569009bcc9daeb0ea43e6adf414c2930c998fc91b19a0208bdd7ef43012bbedb1bc1247050c0c2e35263d71ffd61b2aba3f7a6e6745e745514829fa51251c8411cfef297d1bbb531ee5aac0faba5af6b9692a03cf1fb5f770eda8f65913eaa7e3d6fb5a8e75f374483b66b7c423afaa0d35d944330b7870c6f0ae14487584a155817232595188992ecb4460cfc3832b29bbc312037f929a7bd628ce5ae03a4f31e791d3695785e23302849151d9408140e178d0c1a1cb2eb569096fc5d3f5d3a4073c28bff6e0a82cd021b2e7771b6aca214ff31184547464e55c903123165c91337e1bff1051dc338b0cf3316a0d8e84255272537c16a2c9dd1a0fcbb68b8c6ae740d0ba572e7871994808162fef22c28a9c591cb72426b994fae159c41278c96b0ade3f1f556ffce6377d4fdbee256b9a366e95cd093c391c50a9692b229268fb531e72b7a1b0bdd592a7cb580e7e8aa776ef7ca36956f0f529e92ef876fc2f48bc76be3532050a37aeeed55a1a41ee2adeb8072db1bb01d79c28738919244f46e3db17b7618909cde22996c7a3416d0da5cd3dd5699d4e315d3396ce454a02b734719922982cf798657e5ec9bc0e5e63bc907a071cbdf73d59434e508961ead4b8437b3ce8c313600448c08f0ee87ef7cb95da7df5adbded6be2420154d774f03643dcf7e89331632fe4a3a54d7ef2f0d49f3a6645bcf9f0e1deb4fd63e6cf238954e18e45f8176151f98c62add808623972eef5633ffd43a2cc83004ecb9516fe285451d670ba919b987747acd4d3bb6b13287b1e88e8c26a659e8b9b95794715202dd9c06b921818b00083c87efb5a4c63d73228fe4426ee5570393df3664334c3f6c784c2a12ae6e0ebbdb77d63d9a671907b0c4dfdb2adcea088b194c86e181a55f092976b9306567e807e4a24b3f190696dc6e25a618a3986db1f289d87bdb803ee45cc4117d95f24f683a46842470ff19f2ce16782e835d633e3bd86dcca04c8a5539e032d3740c747b82098f876c49314bc4da6f0c2da5db5295436e47c5919dfe1f1e2cc5428d678888aadf50b8ffc470da46b55a7bea31ee0ad3a7eb73f1dca4d6fee581576eb3ecc99e53d4c81c59c51a39322ef18d9c09887a56d1764c54f8d29a71ee201adf26a28bb3508df5b2957c029b44c72dc1a1b6b45107f8d759fe48ae78957e03bf34abf6034dd29a8da45374ae1babadefdbc6fdf94b78e4de1392859e5ce5118350a364b9155643693f5f88bcad7b5a18129909b2231571c1f4638c8d4a16f288119b63494670ab9cac4aefacb632c8092cc792d24af650535c31a81b323c8ef78b24108f00cdd941bf5772a31517747031e5a3e3e6f4e0075dad7edb2fe70ca2ed32521ed749fb6277fc6b41b703c301e23de43585ab4ea4f1b484e9181717d98b7187addecaab304ea7d5ef8046eb0d7c7b84acb29df17a83a6067b189415b4a5401d2b5e6c64261ee721fee238776eab21ca2386d10a23dc35a267f7c6bf61ae9e16946c76d5c4ae7790ba90435d20396fcd723182f1e032cec9d8ec1b693fafdcc2c2f74a50abe49cb880191dd510736395682cc6b36ccf813bfc188e8a0e02aed66b742d655facb60024898328a153b573394326c5ac8cfc1abe116f724d9426708e09a70b6dc718401463d883b4e5fc37bfb39746867df9f818ae4cdb18a532852fb014f691c46f29692199563dfe47149191ff4a2fd4f2ffb12438254c86ca1392ff2f75afdf5d35cfe9261c12657a4020ef702316dda2ca6b1a8c076fcd9ee52f761074700347b4db93b230481e46f1e73903953e54d314428fcdb743264aebe3d3179b0285de2c14fab9123600c0584f6244be6740e9dc942d988baa09331d5188bfb4d6836a64dedd5f9f0927660ff8521993c35e963323b797510f3cc6286cd38f5ed6e48b7def2d66582054dece47a8d627d1edf8b53da06415ebf562df14d8cbdcb18d75693f310331d59c9b020a8e1bfba6b6f4b12477ac10ded6272511250f8381728162c37b7c79215cb60e591fc836e14a3f8e02df2f224a6e7c00f909dcedfc3159a00994623dbbf7f1589ba3885b2fa531efe651e1b55e3c8d13290a1a17b301885f6bfc998c0a63155fa9acfeb1a75c86a71089ed81114aa21086b54af6b0161842355d4a8e19989c6e1c303db64e613b1d3bb2642dfd3db979c5b2cebd876c33a2dff45cdaa2cad42ad3ceffb0905f27c96e9409f60ddd82fd6c2ffe8595ce6e1c67fe413073e0f8260fb38a955420e9751b9d4f83017f32dc85bba0f76e077c3eb4ae9ddcb68caa31aca50842c4a17e0fcc88280d4becca43d4f8961cf78d98a633ab8316a17abf438e356e0ad744c546e054a04d6649b041f5ee081143e0655789aa2e05abe9abe4a2ec32ede966a7d62ff6704c46d13242d0b0b1dacffcb5b91e3d0e3965921b36d9c526aa7455e88d517c1a6febbc3e7d92c22e53364a9cc8dbf21108ab2ecb6a5ab0e501d542f0d9f1c523ea89722749fb5fac275acefc9dd73289471f2d67e2951a918b4c4e0568b0321f53724890eba83dfa7672b4be1bb989d24ad1321815273717ecedd2079297386afd692f92654f404b94baaeafd361b4f1b18ba018fb73f95a25c8948d74d8e42a3be09ae6972f4afa526d6a6893a234115444ea5c34346bd3109ddd83e81398eaad55f383d0222a7e28f4fe7c44b07cd0e7f75c8863c0fc63512d777b5e05c7f54da04708dea6ef08ed99fb5f5dd283fe8eed557f463cd8074dc609f82c9fc2188b6c580b81352f713f3569b19df0661813a69e50f16958f4a727220b8015ce5fc1d1dc3efee1a760ce98f8ebee5f54efb3d539db87dee4822c205586502e33058daab6d4de56a7de262e5368e774ae8d02a2c8a2895e301c6ad6e1dc66274232e4a361531df3a0c07cc8c14c43f97ca8def5512e165fa4cbeddff31deafb780f7528c5bd5cabbbd755291f62ac9a6a97a432e7665b178e79f39798a6bee2266fd80699a0fc5300b880158b619bf9ece0ac6be33c8f702609befd943cee718648442192691481b27fce7375eeb3bb8b24a2b03ff7066ad8ec00cdc4ed5f8e29eb6d69afb170b3cba7a66fd57e1847baa362f8e6c84e4d7559e3f92a4edcd1d090fac8b3e19df51f6692a62b6ef10b2b809af32ae65167be1dbdbdd5c3a85fb9c333cccfa6a1b4d9828262d5ffc5d691434232615e3f0370faec67940b258abce1ea7fdcd44bba734d768ec1eb7812ca97ff8ea2fee33b57c7af5f789ed4c5b2b9589c7036d32783565c2fe30c8fa7b095a21fbbd1d0173f613c77e4868289c01cad17dea273bd33b8f53df2e1c53fef55b841f8c3517d0c2f0dc0217fd2aca812adea797e4b44c5d0bc05206105090176d285db1162aac75a2b79e423778602809711ca747f55c12306c668c424b81c01fce4575e8317c9e267756bb5864be34fb29b7966704fc53321a0cbe2e465f1774d15f3496f86f3b52f9c80ba1ca5cc342779905a90e5ac5fb180fc5c26276e5066dcd441d8af5c82634d16835bf91011c7f535a789160229e40a3b7ce716ee413b045620d9387f5dfceb55ad523c7c45817cc4c5fdfc381e548bc4f0f493960b8fcc692e907bb7571cea4fb95dd7582cff5a12a01a3afbb582c481d2a86221cbd516604a69d093e05e6b6e4a7483698de44cd5d433d7611a987d88d7037c6cec03036bc60cf29a48df5e4cc20b94e414f1e4cbf72bddba13f293bbc738f25ed48c370901a5e9d8c766ad5af5d472325b20bd31d92170d79501b71d7a414171797bd0743fa33627e75337554b67bfe4a7391e42026c7ab286b108d030c2d22474e892057f5d7c120e6e2a4d2939a97fbc258750fbcfe8e6eb1645633f8be882175148307b9cc0f7ec52296dc080cb5266ae448eaa767cee417d2affa1e85cb15cbf8f08e2133958d7523692ed98af13151f56a27c692160f553a131cb41c4efa2db7cc0f4f388ee794c87b3622ac2256f814d4fdd1d28733c44752829df6b4ca0c7a54258f82f266847ae1ca96c0eb845ea611529541788985f4ff584de3733af7b6f15bfdb90b1cbd8f6bafe345f8b0b6f00bb6b4fec96ff41e8f4e71333341c30c2d45aff89c91337b75face23ac86b6025af9b30b68e31a793c2f3269b0ed66d96e9aedb42a7e1aca12f725c138d04906b55d52a7305bd74664781a4b1ded761d0460251b5c783ec1ac93d1951b448a7db6a315641d2152528b5238495b2afcf6b8af90dac42db916cfea35665149fb7975d89aafa1218cc556e261ca8ed1eb2cb54b4055671a34607baa7059d500f11007c6f498727a8af8e0f08b005538a9d775d47654d9c52c9c453ecef2c8f059e70cbe4a00139e0e47e6e784c9c510f68aa0455eb51c064f9f1368351b24bc1365fc5edbaf9e0c585e8f6463f53610136c338e9e4ac617ca00272545a9fc2aee94189ba2a1ed728bdd718bab1d2b08fd85bc8ac17a4d140a699eeb103e1064779077c8c4eff487ada33df3a0355c7be8d1ec2377c9c0c0e30f52086145a4a0157a1462baa73e59d9bf37591a240dbd53e9d403fdfe0fe27b46506726a30bf8f72e0de7b2136859e162dfd4e4fbe69f3db6b0c962f0a959752f61298500bea22c81107ff0bd549f16d2e6f94634b9b25867d0e0718c7a29bcd8f3f577f6de0a580e616636acab034485648283d53f10c6e2b7052b3e83dd21cc174ed8db9d439453d597145d1f70841444e30c8fd48ce7034302832857c4898bfd5645a972a755b66c59d43c9f92d30ef881b82064a1bddb0a5c0385e64d5cddcde2fd8c4f6c1b4369a0600ca785913a27e6a50d4e9796c92add86049423a356309f7e27546ed97c1c8c62ce66ce3032f677e327185be61b545173cb5f15d88158f37eb4eaacc944694eb4fd54789dc0462050099760b1990c851475e581a1d69dfa035b7bbb8ed1e872693314c8fb3d01a3c3bfcd9ed71f230d7de6793561a8d22edfa2149d173f6d0467cdc70735191ccb0a7b643785dc985d5483d08eb7798cf6c339aa89fbe80cc3e4b724ad2ebedf16f1c6c483bd013432414d0a218eb6f52818fbf71289a7edf8c23f0a8ca87cb8915a368c4b72f056f986888a8242ce838976611fff81c8488a9994cac229e3345b898777a79e1a7203c84e0833fefe97f3ea0d7acb59ab02eead15a877528976fe0c5b5f7a8d97ea1de8bde51b5dd47359b821c528a48c39c06a529f1bb43e0b2f526c6c8d4b32a3e3e4b29705712a8f6ff1d3fca0f6fcbbe066db66bd112d404a07c92385b8644a1a321e8a8b860354b8ab5c167b5e698a8412c713df52118953b5f71ed2177f5c9459926ee9ad29ccbc0d229652ccbf26fd85b24a40cb9cb89bfa0e855ec8e16d93081a1f71118e74c95ea17b34ae26ffa4e3b5d4211f7876b94731f25d9b3936ef675e0ab7d93c4c1de8e436f50f7c94840a1d499132fb761f1df4b3c28b7cd992f89a289eebbee909c884cba5725aa798133eed4d1884dab1e4eaa24ea4603300c5224d84cd4c569b4923d5e25d520de27e3588d56fab5c3e63a2ea9c9e228a7b5f9b8bea4f241e246ec0fd79123b3b156088dc4c432f6fa923f858e034b09e3c3e257f74ea33face0e8d58a70731f3a489128cd0e8efc0792e5a36b280bda10c43e3b7be2c2dae70dcb93c4b7e65adf2bb7d66f40d729c35e10ff94f54fa78a5dbbe398f2e24b0b03df2e015d68e09c4488ab8e41fdbd648df01498bebed5a878390f8d852f450d5026cbabca8878e0ff141fead3a1e3e5b1f4a2e9b8dbe6a9ce888e02235aaf3a101958b865a86ac5239cb247051b9a9666f812c34c76d63182990d0dd34d70bde8cf8ab1f93ee39a36b581f98dc6205db88e787ccbc4403ee6bae01e4ea6d8944b3e08fe107a5749c3f52ab785a831d1f02174476aea7cf076c0f03a122fa6a9e56a899fad7bfc3f47743b54999576187f041bd621284c38f566f016d811e66010d541e0cbd27f0474d1f521f410c18284f5931ce221b22059bfc1f929417b618e5f17ab1ed06bf2377ff6af125eebe346b4792e783fe0289bc253d894ea8d22209a21ba62a19c933b4b47e416a6e54d18055e9babc5bafa1d6e1598e26aafdc8474fb29669f05de4d2be4dda2d50287662c5b4bc44d2a4869c99f25848a0399975c6d63630ff091730966abe3351189d093440e01c9b8f675705770e0168367c8e8eace1a7c068502abca1e5644d39a474fd79ef5f7c0d0dc0bdf0e96e6e9d4863ee4aa86261b3a4ecd197814b3b339540843d970da076b81a97e6a4ad7da4d0729d956b13c1267472bc3e5fa81e2fe7534f93947cfd0646da8378d5f35e053b1835e2332d2a86aed6b9443c5b907e894629c2c700f0967e812657a934203bf48a9f086bae39f059c63e1b27d6b939f5e2680bce5c493a5f65300095ee7f05f4eff12c6da1905b723f6a0f8b97eccb2c095fda974a507d99f2360fb0af12af5bb4ece3921ec3d5a2eadc5ad58c1b85040c3e07f9130e9ffb452a26fb3538609d822f02be73a55a1825f8461df14f620a0694de3a0dd2ba75f216c4b993f8bcda4240db41686206462f1a6c6acd435a408b1fa4e9322d76156b13ffeca95d55310fb10846a7c59b2ef0d26a35c1a0e047677cfac432f730723db7747c63f98c45ae92408aa973272c20246f959987772e77f2f7b0ccb45f2cf2a3c32f055139d4fd247b0c636c478759402d8a0ef477adce5e99b278ddc4905eb0fcd2a03d33d02e85837f0c06aa14814a77317f8a0792f6a6f86291d6978dab029ed2e232320f0ee719108f0d4e09656f7489f40492128d683d0febc0f25a6d02965900482c5152a4256dd2d0c6ecb07a4b4ffc4c8c26e5ec32db92e91f0d062e7723d48f090e9004f83282a8cc93ab1b75a9da981dbaaf90017469f557af6203417c2209635c2c661db79550959ba07bac306d17a5518b5f04287e848f98a86806a81311287a8ff9ea1f0c1a366d5f0a568c3cfbdecd6a88a753af19ea5f1c2b8835b142cab1c5d65871c658611b5d0ce3d8513e8f8e59f45f59c6af0454b1a820784eacd9286a61d0fc806ef4989cf476cb2ab8f5165ac91bff378ca6de0e03c480bf3958f19617ef764f55b03a0a8e7bfad611259c73e861ac36649f163edc3a0661d00540a8091efe2851ffd301d3782d74795ca746b33b41a799e8a5b0572d60b74e8e519bdeb4bfef3b40a8365151ee68084f7d5097ee9df752913fd87f72278553f6f95812a840ed1ae4ecbe34604a092b4188b928a7e51eb549f24184115f971198e8286644a2745b5479dc1aee3ee1f3aa24a5a7934fe28242fe947485b563fd13e8288c4c89b42153f106bd978697537d81e9350343ba77440bcf8d557a281cff88e606721078a8dc3186799c42c41baae809e3622f78031839eae69a86dcb12539ceffc1707825d842cb40cbf0bb7838db63745d535f58e97a799319ff2bf67ab96ad84771a8ea90b20df89905116c67819d008c48c8ee83d7e22062bf6810b2d1c720e475c0e9a18aafc666ed52153edff2979b52086bd63d213f8baa8145cc66abd2d0a25936232d261b5d13a6b50b4e4055dd0138220eac508052bb23524693ea824bc93537a9e91639998a0abc7b1c66e55243e66078f49c2548b804fd40f4ae46af6d572a5bff48afe160ef14822f69c9e273d62c301e0bcd84b2d9317606188441a6b46f2b8ef3a11750a30eb5953aadc9c59b87ad275fa63af674f5811bb6839f1a3be0a9b008448db693d2f36f3866256d6bee05ec92219bb9240220cd670e9a58c5eafccb6a11adc9db889edd8cd5d1851c7febe782b8e777b40d193d0ad4583d2f3a10868b195a07a9d80a2c4945231ea5ef3e38483613f661ed54c6b0da532e0a7076a79644a948af70393ec1f412bfcbeee47cebdcd07b510b5d9f5dff6020c37e6c57261e391bdae583a9e0f6de8d32c7d0fc709b6af7f97887b0c4cd10747a10956f20cf72cc8cc9be6281a26f64135bb94da34f655f3c83b7c1b09ede14edaac8e4440d4a0341ef49346f2c4977c0e12d182c04d63acbabec3fdbd0d7ad15d4d543871a913b774d8a736e791aa9460a97a4a0063b2c14d818ade7da780347d537cd764bcf0edec287ba09b74c6b73529e2d441345ab6c49c305c01ca1b4051c53c8030a3566d3ead83df8ade651eb4586de91b2c0b152e6b19952be0de1678e33ca6a8678ceb40f38ad0e062583b3ac747ad26de1ba4e498c06e36bf6291f77ae166323f5da012ce14bf4748d495b0a65ae2aa1a65d478aaf0c45f8e25e64b50388af1d299eab48b8385bfd7166203a47017ca613b2d944ac66fc2604cb31998f8ab759460c7a5e8e7c6c83366add11de8ccdea05eed303bd891fe1bf0f6212e346557d97f7f5bcae137936f13b3ccafbf9fabe4e9558af71010fd614391e0e79fe339100259d3a8df785d4b0a471e62d8cb3aea3415f7b2a13b61a89f108a7bf7e1fc4068ea63697932c3fa9fee2169c637672c5f1b490ae77d3667d8500f46a442372970fb70c1ba2ed4cac6326935f4d8062c1bc0a2a6ac089b33252fc9ca596f800f7899e2b1ec63a309673c884f894cfb2ad179aeb22af2a1a29225bb06673476dfe1fa9fbb789c6425937b3cd12e29ebc1a02dc96ebfbfbe5bdc9746eb060d5d64cbfe23749c7907849c94662522e4167ddae788ca88d41167a3887c43615de76d23ecad5c0b54c0f2623a5f8fe762d97e107774dd49f3c1465698c9f2464e2e061e27fb2746897bdc3fea91d5c15b6fee753fe7e6a85c1378bd42e33ded4f889be385efe5a3f10c028a458c6afaceed15b62689ca670d9d080ed8eda7c5262554256fb4ea5770b9124774f58ff07f1e6bb1dff0f53bccfc093611b982b859dae21a98ca03b8fd265c5b21d406638c1702a5325226e43c692441be3e793d373d56f472e2a9b8fd3e740eb6045accdbec16ece218fe7785fce7128dd707a74fda0bfdd3834c1a724eb52f8b9632d114b3bbdc90c7ba0900e53ccfa8103f82e272bf9edcb328b8a1382d72a04be810f08f4e46ca9cf0e4799610c411db4c142258b1a15da9fbbe1f772054552af505ec00150ec0ab9e3257f16ffe5f4eb16940531dc115964a3ac1d69a16f731ce20a4c60f9646fe1b818ed7a4b2bf536f074b363c6dd681dd5651397afbd293398f29d21797019c192ecc1b7425a32d6ef581d948ea1239dbbd7882d971a879274781a19fcd561ea3eeb064141b41041b4a332eb00be61c80523c5ddb69b53d773d666411e9f1b14435f21ff0aefb06855d9a3eadf87fee4e7e3c050d722452e6b14b24adfef925ac55ba97fd95f41631806f850e108266d619d9b60c3a5fd7318ab76611fd83ae79282d93e863bb741e9455a548de128c043577f1c510791ff363c96ac261defedcb833c0fc55c3e1451be32f0b03ab5154f4d166f839e7d643a40939bd296931be8b18ad266e1435099ec1d23f09b6ddd2f92ee962480125cbd0cacc04dd4188b1d5f8b73a0e990d5a8cc7b46941530d89f33dd86a2b42b8c1fe3cdc467618001080c826b3337fe9bed834e714f74c9082b6c095bceab32a10889f5793eabbbb277c115974707e19c228db59524c4b02360f7a99685bdee6caf2837f80becd3f16821da6048338e702d6afd0732be92434cdf303252811fa17019daa52cb79001a6600278cea5af9cf826ec4beeb4c98b213cbd7880a9c889c176b0f1de1d170f3b098f4d005ac6d8eeab157f4ce97501b462d8cdfd38da0c7c262aa4d68ddf755f681164840993172568138274004a499007fe02b0d95d1c7b1bb40a73d1817ce2bf58cd4f0faaeb3e437ad980b9af1b59a4ffc5c3210042c2d480ebedfbd1506ea216dcd96cfaf405d0e9bdcc2ad02e839f550feaa105e10c9c9cb5a9454b57543fd23044acd67e9d14ab70cc54b8164e0013937d1ee417c675d73b835cf1f42ed9abfda601aef3a23c67b4fd0988dfd4e3dc7dc4ad2579c31a0f1ffc455f5b346b667647167dd85e9a8bf34af1e2290b7b5656458647a1</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
        <tag>school</tag>
      </tags>
  </entry>
  <entry>
    <title>CF986E Prince&#39;s Problem</title>
    <url>/2022/02/06/sol-cf986e/</url>
    <content><![CDATA[<h2 id="CF986E-Princeâ€™s-Problem"><a href="#CF986E-Princeâ€™s-Problem" class="headerlink" title="CF986E Princeâ€™s Problem"></a>CF986E Princeâ€™s Problem</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF986E">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æˆ‘ä¸ºä½•ç«Ÿç¬¬ä¸€æ—¶é—´æƒ³åˆ°æ ‘å‰–ï¼Ÿ</p>
<p>æ•°æ®ç»“æ„é¢˜åšå¤šäº†å±äºæ˜¯ã€‚å…¶å®æ ¹æœ¬æ²¡æœ‰ä¿®æ”¹æ“ä½œè¦ä¸ªPçš„æ ‘å‰–ï¼Œæ ‘ä¸Šå·®åˆ†ä¸å°±è¡Œäº†ã€‚å¥—è·¯åœ°å°†$(x,y)$æ‹†åˆ†æˆ$\frac{ans(x)\times ans(y)}{ans(lca(x,y))\times ans(fa[lca(x,y)])}$ï¼Œç„¶åå‘ç°å¯ä»¥ç¦»çº¿ä¸‹æ¥ä¸€è¾¹$dfs$ä¸€è¾¹æã€‚</p>
<p>å…·ä½“åœ°ï¼Œç”±äº$10^7$ä»¥å†…çš„è´¨æ•°åªæœ‰ä¸åˆ°$7\times 10^5$ä¸ªï¼Œæ‰€ä»¥åœ¨$dfs$æ—¶è®°å½•æ•°ç»„$num[p][k]$è¡¨ç¤ºæ ¹åˆ°å½“å‰èŠ‚ç‚¹$u$çš„è·¯å¾„ä¸ŠåŒ…å«è´¨å› å­$p$çš„æ¬¡æ•°ä¸º$k$çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚ç„¶åå¤„ç†è¯¢é—®ï¼Œæ˜¾ç„¶å¯ä»¥åšåˆ°åœ¨$O(n\log^2n+\omega)$çš„æ—¶é—´å¤æ‚åº¦å†…å®Œæˆã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF986E.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF986E</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXP = <span class="number">7e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXL = <span class="number">1e7</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">17</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGL = <span class="number">24</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="type">bool</span> m_be;</span><br><span class="line"><span class="type">int</span> n, q, cnt, a[MAXN], ans[MAXN];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x % p;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getinv</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">qpow</span>(x, p - <span class="number">2</span>, p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> cntp, pri[MAXP], fac[MAXL];</span><br><span class="line">bitset&lt;MAXL&gt; mark;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getprime</span><span class="params">(<span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">    mark = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= mx; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mark[i])</span><br><span class="line">            pri[++cntp] = i, fac[i] = cntp;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= cntp; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i * pri[j] &gt; mx)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            mark[i * pri[j]] = <span class="literal">true</span>;</span><br><span class="line">            fac[i * pri[j]] = j;</span><br><span class="line">            <span class="keyword">if</span> (i % pri[j] == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; <span class="built_in">getfactors</span>(<span class="type">int</span> x) &#123;</span><br><span class="line">    vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; result;</span><br><span class="line">    <span class="keyword">while</span> (x &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> p = fac[x], c = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x % pri[p] == <span class="number">0</span>)</span><br><span class="line">            x /= pri[p], ++c;</span><br><span class="line">        result.<span class="built_in">push_back</span>(&#123;p, c&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> dfc, dfn[MAXN], dep[MAXN], fa[MAXN][LOGN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    dfn[u] = ++dfc;</span><br><span class="line">    fa[u][<span class="number">0</span>] = f, dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">build</span>(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="type">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Query</span> &#123;</span><br><span class="line">    <span class="type">int</span> x, w, i, k;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Query&amp; o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dfn[x] &lt; dfn[o.x];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; query[MAXN * <span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> num[MAXP][LOGL];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span>&amp; cur)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> t : <span class="built_in">getfactors</span>(a[u]))</span><br><span class="line">        ++num[t.first][t.second];</span><br><span class="line">    <span class="keyword">while</span> (cur &lt;= cnt &amp;&amp; dfn[query[cur].x] &lt; dfn[u])</span><br><span class="line">        ++cur;</span><br><span class="line">    <span class="keyword">while</span> (cur &lt;= cnt &amp;&amp; query[cur].x == u) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> t : <span class="built_in">getfactors</span>(query[cur].w)) &#123;</span><br><span class="line">            <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; t.second; ++i)</span><br><span class="line">                sum += num[t.first][i] * i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = t.second; i &lt; LOGL; ++i)</span><br><span class="line">                sum += num[t.first][i] * t.second;</span><br><span class="line">            <span class="keyword">if</span> (query[cur].k == <span class="number">1</span>)</span><br><span class="line">                (ans[query[cur].i] *= <span class="built_in">qpow</span>(pri[t.first], sum)) %= MOD;</span><br><span class="line">            <span class="keyword">if</span> (query[cur].k == <span class="number">-1</span>)</span><br><span class="line">                (ans[query[cur].i] *= <span class="built_in">getinv</span>(<span class="built_in">qpow</span>(pri[t.first], sum))) %= MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        ++cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == fa[u][<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(v, cur);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> t : <span class="built_in">getfactors</span>(a[u]))</span><br><span class="line">        --num[t.first][t.second];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> m_ed;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">debug</span>(<span class="string">&quot;Memory used: %.5lfMB.&quot;</span>, (&amp;m_ed - &amp;m_be) / <span class="number">1024.0</span> / <span class="number">1024.0</span>);</span><br><span class="line">    <span class="built_in">getprime</span>(<span class="number">1e7</span>);</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> x, y, w;</span><br><span class="line">        <span class="built_in">read</span>(x), <span class="built_in">read</span>(y), <span class="built_in">read</span>(w);</span><br><span class="line">        <span class="type">int</span> p = <span class="built_in">lca</span>(x, y);</span><br><span class="line">        query[++cnt] = &#123;x, w, i, <span class="number">1</span>&#125;;</span><br><span class="line">        query[++cnt] = &#123;y, w, i, <span class="number">1</span>&#125;;</span><br><span class="line">        query[++cnt] = &#123;p, w, i, <span class="number">-1</span>&#125;;</span><br><span class="line">        query[++cnt] = &#123;fa[p][<span class="number">0</span>], w, i, <span class="number">-1</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(query + <span class="number">1</span>, query + cnt + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">fill</span>(ans + <span class="number">1</span>, ans + q + <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>, *<span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans[i]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P6095 [JSOI2015] ä¸²åˆ†å‰²</title>
    <url>/2022/02/05/sol-p6095/</url>
    <content><![CDATA[<h2 id="P6095-JSOI2015-ä¸²åˆ†å‰²"><a href="#P6095-JSOI2015-ä¸²åˆ†å‰²" class="headerlink" title="P6095 [JSOI2015] ä¸²åˆ†å‰²"></a>P6095 [JSOI2015] ä¸²åˆ†å‰²</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P6095">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ˜¾ç„¶åˆ†å‰²çš„ä¸²é•¿åº¦ä¸æ˜¯$\lceil \frac{n}{k} \rceil$å°±æ˜¯$\lfloor \frac{n}{k} \rfloor$ã€‚</p>
<p>ä¸å¦¨å…ˆç ´ç¯ä¸ºé“¾ï¼Œå»ºç«‹åç¼€æ•°ç»„å¹¶äºŒåˆ†æœ€å¤§å€¼åç¼€çš„æ’å$mx$ï¼Œåˆ¤æ–­æ˜¯å¦èƒ½å°†$n$ä¸ªæ•°åˆ’åˆ†æˆ$k$æ®µä½¿å¾—æ¯æ®µéƒ½$\le mx$ã€‚</p>
<p>é¦–å…ˆæšä¸¾èµ·å§‹ä½ç½®ï¼Œè®¾$len=\lceil \frac{n}{k} \rceil$ï¼Œåˆ™ä¸€å…±æœ€å¤šæœ‰$len$ä¸ªèµ·å§‹ä½ç½®ï¼Œç„¶åæ¯æ¬¡è´ªå¿ƒåœ°åˆ’åˆ†ï¼Œå‡è®¾å½“å‰ä»$cur$ä½ç½®å¼€å§‹åˆ’åˆ†ï¼Œå¦‚æœ$s[curâ€¦cur+len-1]\le mx$åˆ™åˆ’åˆ†$len$ä¸ªï¼Œå¦åˆ™åˆ’åˆ†$len-1$ä¸ªã€‚é‡å¤$k$æ¬¡çœ‹åˆ’åˆ†çš„æ€»é•¿åº¦æ˜¯å¦$\ge n$ã€‚åˆ¤æ–­çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(len \times \frac{n}{len})=O(n)$ã€‚</p>
<p>æ€è€ƒè¿™ç§è´ªå¿ƒçš„æ­£ç¡®æ€§ã€‚å¦‚æœå‰ä¸€æ¬¡åˆ’åˆ†$len$ä¸ªï¼Œåä¸€æ¬¡ç”±äº$\gt mx$å¯¼è‡´åªåˆ’åˆ†äº†$len-1$ä¸ªï¼Œæ€»å…±å°±åˆ’åˆ†äº†$2\times len-1$ä¸ªï¼Œå®¹æ˜“å‘ç°è¿™æ ·å’Œå…ˆåˆ’åˆ†$len-1$ä¸ªå†åˆ’åˆ†$len$ä¸ªæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ­£ç¡®æ€§æ˜¾ç„¶ã€‚æ•…æ­¤é—®é¢˜èƒ½å¤Ÿåœ¨$O(n\log n)$çš„æ—¶é—´å¤æ‚åº¦å†…è§£å†³ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P6095.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P6095</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">6e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">19</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], he[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            he[rk[i]] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa;</span><br><span class="line"><span class="type">int</span> n, k, ln;</span><br><span class="line"><span class="type">int</span> lg2[MAXN], st[MAXN][LOGN];</span><br><span class="line"><span class="type">char</span> str[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getlcp</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt; r)</span><br><span class="line">        <span class="built_in">swap</span>(l, r);</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> INF;</span><br><span class="line">    <span class="type">int</span> k = lg2[r - l];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(st[l + <span class="number">1</span>][k], st[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">comp_lesseq</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> lcp = <span class="built_in">getlcp</span>(x, y);</span><br><span class="line">    <span class="keyword">if</span> (lcp &gt;= len)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> str[sa.sa[x] + lcp] &lt;= str[sa.sa[y] + lcp];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> st = <span class="number">1</span>; st &lt;= ln; ++st) &#123;</span><br><span class="line">        <span class="type">int</span> cur = st;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">comp_lesseq</span>(sa.rk[cur], mx, ln))</span><br><span class="line">                cur += ln;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cur += ln - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cur &gt;= st + n)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(str + <span class="number">1</span>, str + n + <span class="number">1</span>, str + n + <span class="number">1</span>);</span><br><span class="line">    sa.<span class="built_in">init</span>(n + n, str);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n + n; ++i)</span><br><span class="line">        lg2[i] = (i &amp; (i - <span class="number">1</span>)) ? lg2[i - <span class="number">1</span>] : lg2[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n + n; ++i)</span><br><span class="line">        st[i][<span class="number">0</span>] = sa.he[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; LOGN; ++j)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= n + n; ++i)</span><br><span class="line">            st[i][j] = <span class="built_in">min</span>(st[i][j - <span class="number">1</span>], st[i + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">    ln = (n - <span class="number">1</span>) / k + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">1</span>, r = n + n, ans = r;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid))</span><br><span class="line">            r = mid - <span class="number">1</span>, ans = mid;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ln; ++i)</span><br><span class="line">        <span class="built_in">putchar</span>(str[sa.sa[ans] + i]);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4770 [NOI2018] ä½ çš„åå­—</title>
    <url>/2022/02/05/sol-p4770/</url>
    <content><![CDATA[<h2 id="P4770-NOI2018-ä½ çš„åå­—"><a href="#P4770-NOI2018-ä½ çš„åå­—" class="headerlink" title="P4770 [NOI2018] ä½ çš„åå­—"></a>P4770 [NOI2018] ä½ çš„åå­—</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4770">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å®¹æ˜“æƒ³åˆ°ç¦»çº¿åç”¨åç¼€æ•°ç»„è§£å†³ã€‚<del>ï¼ˆå’±å°±æ˜¯è¯´èƒ½ç”¨SAçš„å°±ä¸ç”¨SAMï¼‰</del></p>
<p>ä¹‹åå¯¹äºæ¯ä¸ªè¯¢é—®ä¸²ï¼Œæšä¸¾å…¶æ¯ä¸ªåç¼€$i$ï¼Œæ³¨æ„åˆ°å¯ä»¥äºŒåˆ†ä¸€ä¸ªæœ€å¤§çš„å‡ºç°è¿‡çš„å­ä¸²$lcp$é•¿åº¦$len$ï¼Œåœ¨SAä¸ŠäºŒåˆ†å‡ºå·¦å³ç«¯ç‚¹ï¼Œç„¶ååœ¨ä¸»å¸­æ ‘ä¸Šåˆ¤æ–­åŒºé—´$[l,r-len+1]$ä¸­æ˜¯å¦å­˜åœ¨$lcp\ge len$çš„æ•°å°±å¥½ã€‚è¿™æ ·æ—¶é—´å¤æ‚åº¦æ˜¯$O(n\log^2n)$çš„ã€‚ä½†æ˜¯$10^6$çš„æ•°æ®è‚¯å®šä¸èƒ½é€šè¿‡ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ—¢ç„¶æ˜¯äºŒåˆ†+ä¸»å¸­æ ‘ï¼Œèƒ½å¦åœ¨ä¸»å¸­æ ‘ä¸ŠäºŒåˆ†å‘¢ï¼Ÿäº‹å®ä¸Šæ˜¯å¯ä»¥çš„ã€‚æ‰€ä»¥å¤æ‚åº¦ç¬é—´é™ä¸‹ä¸€ä¸ª$\log n$ï¼ŒåŒæ—¶å†™èµ·æ¥æ›´åŠ éº»çƒ¦äº†ã€‚ç„¶è€Œè¿™ç§æ–¹æ³•è¿‡äºå¤æ‚äº†ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰å®Œå…¨çœ‹æ‡‚ã€‚æœ‰æ²¡æœ‰æ›´åŠ é€šä¿—æ˜“æ‡‚çš„å•$\log$å†™æ³•å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯æœ‰çš„ã€‚æŒ‰é¡ºåºæšä¸¾æ¯ä¸ªåç¼€ã€‚å¦‚æœ$i$ä½ç½®çš„é•¿åº¦ä¸º$len$ï¼Œé‚£ä¹ˆ$i+1$ä½ç½®çš„é•¿åº¦æœ€å°ä¸º$len-1$ï¼ŒåŸç†å’Œåç¼€$height$æ•°ç»„ç›¸åŒã€‚è¿™æ ·æš´åŠ›è‹¥å¹²æ¬¡$+1$å¹¶ç”¨ä¸»å¸­æ ‘åˆ¤æ–­ï¼Œä¸€æ³¢åŠ¿èƒ½åˆ†æä¸‹æ¥å°±æ˜¯$O(n\log n)$çš„ã€‚å°½ç®¡å¦‚æ­¤ä½†å¸¸æ•°å·¨å¤§ï¼Œæ‰€ä»¥èƒ½çœ‹æ‡‚ä¸»å¸­æ ‘äºŒåˆ†çš„å°±å°½é‡å†™ä¸»å¸­æ ‘äºŒåˆ†å§ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4770.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4770</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">21</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], he[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            he[rk[i]] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum, ls, rs;</span><br><span class="line">    &#125; nd[MAXN * <span class="number">25</span>];</span><br><span class="line">    <span class="type">int</span> tot, rt[MAXN];</span><br><span class="line">    <span class="type">int</span> &amp;<span class="keyword">operator</span>[](<span class="type">int</span> i) &#123; <span class="keyword">return</span> rt[i]; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">newnode</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123; <span class="keyword">return</span> nd[++tot] = nd[i], tot; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> &amp;i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> q, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        i = <span class="built_in">newnode</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">void</span>(nd[i].sum += v);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (q &lt;= mid)</span><br><span class="line">            <span class="built_in">update</span>(nd[i].ls, l, mid, q, v);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">update</span>(nd[i].rs, mid + <span class="number">1</span>, r, q, v);</span><br><span class="line">        nd[i].sum = nd[nd[i].ls].sum + nd[nd[i].rs].sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> nd[v].sum - nd[u].sum;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            ret += <span class="built_in">query</span>(nd[u].ls, nd[v].ls, l, mid, ql, qr);</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            ret += <span class="built_in">query</span>(nd[u].rs, nd[v].rs, mid + <span class="number">1</span>, r, ql, qr);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sgt;</span><br><span class="line"><span class="type">int</span> n, m, q;</span><br><span class="line"><span class="type">int</span> typ[MAXN], pre[MAXN], nxt[MAXN], lst[MAXN];</span><br><span class="line"><span class="type">int</span> lg2[MAXN], st[MAXN][LOGN];</span><br><span class="line"><span class="type">int</span> ps[MAXN], ln[MAXN], ls[MAXN], rs[MAXN];</span><br><span class="line"><span class="type">char</span> s[MAXN], buf[MAXN], str[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getlcp</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> INF;</span><br><span class="line">    <span class="type">int</span> k = lg2[r - l];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(st[l + <span class="number">1</span>][k], st[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> lt, <span class="type">int</span> rt, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> l, r, cl, cr;</span><br><span class="line">    l = <span class="number">1</span>, r = p, cl = p;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">getlcp</span>(mid, p) &gt;= len)</span><br><span class="line">            r = mid - <span class="number">1</span>, cl = mid;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    l = p, r = m;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">getlcp</span>(p, mid) &gt;= len)</span><br><span class="line">            l = mid + <span class="number">1</span>, cr = mid;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sgt.<span class="built_in">query</span>(sgt[lt - <span class="number">1</span>], sgt[rt - len + <span class="number">1</span>], <span class="number">1</span>, m, cl, cr) &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">    n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    m = n + <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">copy</span>(s + <span class="number">1</span>, s + n + <span class="number">1</span>, str + <span class="number">1</span>);</span><br><span class="line">    str[n + <span class="number">1</span>] = <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">read</span>(ls[i]), <span class="built_in">read</span>(rs[i]);</span><br><span class="line">        ln[i] = <span class="built_in">strlen</span>(buf);</span><br><span class="line">        <span class="built_in">copy</span>(buf, buf + ln[i], str + m);</span><br><span class="line">        str[m + ln[i]] = <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">        <span class="built_in">fill</span>(typ + m, typ + m + ln[i], i);</span><br><span class="line">        ps[i] = m, m += ln[i] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sa.<span class="built_in">init</span>(m, str);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        sgt.<span class="built_in">update</span>(sgt[i] = sgt[i - <span class="number">1</span>], <span class="number">1</span>, m, sa.rk[i], <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= m; ++i)</span><br><span class="line">        lg2[i] = lg2[i &gt;&gt; <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        st[i][<span class="number">0</span>] = sa.he[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; LOGN; ++j)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= m; ++i)</span><br><span class="line">            st[i][j] = <span class="built_in">min</span>(st[i][j - <span class="number">1</span>], st[i + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        pre[i] = lst[typ[sa.sa[i]]];</span><br><span class="line">        nxt[lst[typ[sa.sa[i]]]] = i;</span><br><span class="line">        lst[typ[sa.sa[i]]] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> tt = <span class="number">1</span>; tt &lt;= q; ++tt) &#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= ln[tt]; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> len = <span class="built_in">min</span>(rs[tt] - ls[tt] + <span class="number">1</span>, ps[tt] + ln[tt] - i);</span><br><span class="line">            <span class="type">int</span> p = sa.rk[i + ps[tt] - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (k &lt; len &amp;&amp; <span class="built_in">check</span>(p, ls[tt], rs[tt], k + <span class="number">1</span>))</span><br><span class="line">                k++;</span><br><span class="line">            ans += ln[tt] - i + <span class="number">1</span> - <span class="built_in">max</span>(k, <span class="built_in">getlcp</span>(pre[p], p));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3900 [æ¹–å—é›†è®­] å›¾æ£®</title>
    <url>/2022/02/05/sol-p3900/</url>
    <content><![CDATA[<h2 id="P3900-æ¹–å—é›†è®­-å›¾æ£®"><a href="#P3900-æ¹–å—é›†è®­-å›¾æ£®" class="headerlink" title="P3900 [æ¹–å—é›†è®­] å›¾æ£®"></a>P3900 [æ¹–å—é›†è®­] å›¾æ£®</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3900">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä»£ç æå…¶æ¶å¿ƒï¼Œæ‰€ä»¥ç®€å•å†™ä¸‹æ€è·¯ã€‚</p>
<p>åŸºæœ¬æ€è·¯æ˜¯$dp$å’Œå»ºå›¾ã€‚é¦–å…ˆå°†æ‰€æœ‰ä¸²æ­£å‘å’Œåå‘ä¸²èµ·æ¥ï¼Œè¿™æ ·$dp[i]$å°±è¡¨ç¤ºå½“å‰å›æ–‡ä¸²çš„å…¶ä¸­ä¸€è¾¹æ‹“å±•åˆ°äº†ç«¯ç‚¹ï¼Œå¦ä¸€è¾¹æ‹“å±•åˆ°$i$çš„ä½ç½®ã€‚å¾€åè½¬ç§»åªè¦æšä¸¾åœ¨å…¶ä¸­ä¸€è¾¹åŠ ä¸Šå“ªä¸ªå°ä¸²ï¼Œç”¨åç¼€æ•°ç»„$O(1)$æ‰¾åˆ°èƒ½æ‹“å±•å‡ ä½ã€‚å°†è¿™ä¸ª$dp$çš„è½¬ç§»å»ºå›¾ï¼Œå¦‚æœä¸æ˜¯DAGåˆ™æ˜¾ç„¶æœ‰æ— é™é•¿åº¦ï¼Œè¾“å‡º<code>Infinity</code>ã€‚å¦åˆ™åœ¨ä¸Šé¢åšDAGæœ€é•¿è·¯å³å¯ã€‚æ—¶é—´å¤æ‚åº¦$O(n^2L)$ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯ç‰¹æ®Šå¤„ç†ã€‚é¦–å…ˆæ˜¯åˆå§‹çŠ¶æ€ï¼Œéœ€è¦æ‰¾å‡ºæ¯ä¸ªå°ä¸²çš„å‰ç¼€å›æ–‡ä¸²å’Œåç¼€å›æ–‡ä¸²ã€‚è¿™ä¸ªç”¨SAä¼¼ä¹å¯ä»¥æš´åŠ›åšã€‚å…¶æ¬¡æ˜¯å›¾çš„è¾¹é›†$E$çš„å¤§å°ï¼Œåº”å½“äºæ—¶é—´å¤æ‚åº¦åŒé˜¶ï¼Œæ˜¾ç„¶ä¸å¯èƒ½å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ¯æ¬¡åšDAGæ—¶æ±‚ä¸€è¾¹è¾¹é›†ï¼Œè¿™æ ·å°±ä¿è¯ç©ºé—´å¤æ‚åº¦ä¸ä¼šå¤ªé«˜ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜éœ€è¦è®¡ç®—æ¯ä¸ªå°ä¸²ä¸­åŒ…å«çš„æœ€é•¿å›æ–‡ä¸²ã€‚ã€‚ã€‚ä¸ç„¶åªæœ‰$90pts$ï¼ˆåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ï¼‰ã€‚æ‰€ä»¥å†å†™ä¸ªmanacherå§ã€‚</p>
<p>ä¸‹é¢æ”¾å‡ºæˆ‘<del>shitä¸€æ ·</del>çš„ä»£ç </p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3900.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3900</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">120</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGM = <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXM], rk[MAXM], tp[MAXM], he[MAXM];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXM];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            he[rk[i]] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa;</span><br><span class="line"><span class="type">int</span> n, m, tot, cnt, ans;</span><br><span class="line"><span class="type">int</span> fr[MAXN], bk[MAXN], ln[MAXN];</span><br><span class="line"><span class="type">int</span> lg2[MAXM], st[MAXM][LOGM];</span><br><span class="line"><span class="type">int</span> id[MAXM], dis[MAXM], deg[MAXM];</span><br><span class="line"><span class="type">char</span> buf[MAXM], str[MAXM];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; palfr[MAXN], palbk[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getlcp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> l = sa.rk[x], r = sa.rk[y];</span><br><span class="line">    <span class="keyword">if</span> (l &gt; r)</span><br><span class="line">        <span class="built_in">swap</span>(l, r);</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> INF;</span><br><span class="line">    <span class="type">int</span> k = lg2[r - l];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(st[l + <span class="number">1</span>][k], st[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">findedges</span><span class="params">(<span class="type">int</span> i, function&lt;<span class="type">void</span>(<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>)&gt; addedge)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> l : palfr[j])</span><br><span class="line">                <span class="built_in">addedge</span>(i, fr[j] + l, l);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> l : palbk[j])</span><br><span class="line">                <span class="built_in">addedge</span>(i, bk[j] + l, l);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; m || str[i] == <span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">upper_bound</span>(fr + <span class="number">1</span>, fr + n + <span class="number">1</span>, i) - fr - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; bk[t]) &#123;</span><br><span class="line">        <span class="type">int</span> len = ln[t] - (i - fr[t]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="type">int</span> lcp = <span class="built_in">min</span>(&#123;len, ln[j], <span class="built_in">getlcp</span>(i, bk[j])&#125;);</span><br><span class="line">            <span class="keyword">if</span> (lcp == len &amp;&amp; lcp == ln[j]) &#123;</span><br><span class="line">                <span class="built_in">addedge</span>(i, <span class="number">0</span>, lcp * <span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lcp == len) &#123;</span><br><span class="line">                <span class="built_in">addedge</span>(i, bk[j] + lcp, lcp * <span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lcp == ln[j]) &#123;</span><br><span class="line">                <span class="built_in">addedge</span>(i, i + lcp, lcp * <span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">addedge</span>(i, m + <span class="number">1</span>, lcp * <span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> len = ln[t] - (i - bk[t]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="type">int</span> lcp = <span class="built_in">min</span>(&#123;len, ln[j], <span class="built_in">getlcp</span>(i, fr[j])&#125;);</span><br><span class="line">            <span class="keyword">if</span> (lcp == len &amp;&amp; lcp == ln[j]) &#123;</span><br><span class="line">                <span class="built_in">addedge</span>(i, <span class="number">0</span>, lcp * <span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lcp == len) &#123;</span><br><span class="line">                <span class="built_in">addedge</span>(i, fr[j] + lcp, lcp * <span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lcp == ln[j]) &#123;</span><br><span class="line">                <span class="built_in">addedge</span>(i, i + lcp, lcp * <span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">addedge</span>(i, m + <span class="number">1</span>, lcp * <span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">manacher</span><span class="params">(<span class="type">char</span>* s, <span class="type">int</span> tlen)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> d[MAXM];</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> t[MAXM];</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= tlen; ++i)</span><br><span class="line">        t[++len] = <span class="string">&#x27;#&#x27;</span>, t[++len] = s[i];</span><br><span class="line">    t[++len] = <span class="string">&#x27;#&#x27;</span>, t[++len] = <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">    <span class="type">int</span> mx = <span class="number">0</span>, id = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i) &#123;</span><br><span class="line">        d[i] = mx &gt; i ? <span class="built_in">min</span>(d[id * <span class="number">2</span> - i], mx - i) : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (t[i + d[i]] == t[i - d[i]])</span><br><span class="line">            ++d[i];</span><br><span class="line">        <span class="keyword">if</span> (i + d[i] &gt; mx)</span><br><span class="line">            mx = i + d[i], id = i;</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, d[i] - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), m = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="type">int</span> t = ln[i] = <span class="built_in">strlen</span>(buf);</span><br><span class="line">        <span class="built_in">copy</span>(buf, buf + t, str + m);</span><br><span class="line">        fr[i] = m, str[m + t] = <span class="string">&#x27;$&#x27;</span>, m += t + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">reverse</span>(buf, buf + t);</span><br><span class="line">        <span class="built_in">copy</span>(buf, buf + t, str + m);</span><br><span class="line">        bk[i] = m, str[m + t] = <span class="string">&#x27;$&#x27;</span>, m += t + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    str[m] = <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">    sa.<span class="built_in">init</span>(m, str);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= m; ++i)</span><br><span class="line">        lg2[i] = (i &amp; (i - <span class="number">1</span>)) ? lg2[i - <span class="number">1</span>] : lg2[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        st[i][<span class="number">0</span>] = sa.he[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; LOGM; ++j) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= m; ++i) &#123;</span><br><span class="line">            st[i][j] = <span class="built_in">min</span>(st[i][j - <span class="number">1</span>], st[i + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        palfr[i].<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        palfr[i].<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j + j &lt;= ln[i]; ++j) &#123;</span><br><span class="line">            <span class="type">int</span> p1 = fr[i] + j, p2 = bk[i] + (ln[i] - j);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">getlcp</span>(p1, p2) &gt;= j)</span><br><span class="line">                palfr[i].<span class="built_in">push_back</span>(j + j);</span><br><span class="line">            <span class="keyword">if</span> (j + j &lt; ln[i]) &#123;</span><br><span class="line">                p1 = fr[i] + j + <span class="number">1</span>, p2 = bk[i] + (ln[i] - j);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">getlcp</span>(p1, p2) &gt;= j)</span><br><span class="line">                    palfr[i].<span class="built_in">push_back</span>(j + j + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        palbk[i].<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        palbk[i].<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j + j &lt;= ln[i]; ++j) &#123;</span><br><span class="line">            <span class="type">int</span> p1 = bk[i] + j, p2 = fr[i] + (ln[i] - j);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">getlcp</span>(p1, p2) &gt;= j)</span><br><span class="line">                palbk[i].<span class="built_in">push_back</span>(j + j);</span><br><span class="line">            <span class="keyword">if</span> (j + j &lt; ln[i]) &#123;</span><br><span class="line">                p1 = bk[i] + j + <span class="number">1</span>, p2 = fr[i] + (ln[i] - j);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">getlcp</span>(p1, p2) &gt;= j)</span><br><span class="line">                    palbk[i].<span class="built_in">push_back</span>(j + j + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">findedges</span>(i, [&amp;](<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">            ++deg[v];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m + <span class="number">1</span>; ++i)</span><br><span class="line">        <span class="keyword">if</span> (!deg[i])</span><br><span class="line">            que.<span class="built_in">push</span>(i);</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> i = que.<span class="built_in">front</span>();</span><br><span class="line">        id[++cnt] = i, que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="built_in">findedges</span>(i, [&amp;](<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (--deg[v] == <span class="number">0</span>)</span><br><span class="line">                que.<span class="built_in">push</span>(v);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m + <span class="number">1</span>; ++i)</span><br><span class="line">        <span class="keyword">if</span> (deg[i])</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Infinity&quot;</span>), <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">-0x3f</span>, <span class="built_in">sizeof</span>(dis));</span><br><span class="line">    dis[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> x = id[i];</span><br><span class="line">        <span class="built_in">findedges</span>(x, [&amp;](<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">            dis[v] = <span class="built_in">max</span>(dis[v], dis[u] + w);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    ans = dis[m + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, <span class="built_in">manacher</span>(str + fr[i] - <span class="number">1</span>, ln[i]));</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P1117 [NOI2016] ä¼˜ç§€çš„æ‹†åˆ†</title>
    <url>/2022/02/04/sol-p1117/</url>
    <content><![CDATA[<h2 id="P1117-NOI2016-ä¼˜ç§€çš„æ‹†åˆ†"><a href="#P1117-NOI2016-ä¼˜ç§€çš„æ‹†åˆ†" class="headerlink" title="P1117 [NOI2016] ä¼˜ç§€çš„æ‹†åˆ†"></a>P1117 [NOI2016] ä¼˜ç§€çš„æ‹†åˆ†</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P1117">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>$O(n^2)$æš´åŠ›+$hash$èƒ½æ‹¿$95pts$ã€‚</p>
<p>ä½†æ˜¾ç„¶æˆ‘ä»¬ä¸æ»¡è¶³äºè¿™$95pts$ï¼Œè€ƒè™‘å¦‚ä½•ä¼˜åŒ–è¿™ä¸ª$O(n^2)$ï¼Œå³æ›´å¿«åœ°æ±‚å‡ºæ¯ä¸ªä½ç½®å¯¹åº”çš„<code>AA</code>ä¸²æ•°é‡ã€‚</p>
<p>è€ƒè™‘æšä¸¾<code>A</code>ä¸²çš„é•¿åº¦$len$ï¼Œå¹¶ä¸”æ¯éš”$len$ä¸ªå­—ç¬¦åˆ†å‰²ä¸€æ¬¡ï¼Œè¿™æ ·æ¯ä¸€æ¡é•¿åº¦ä¸º$len\times 2$çš„<code>AA</code>ä¸²éƒ½ç»è¿‡äº†è‡³å°‘$2$ä¸ªåˆ†éš”ç¬¦ï¼Œäºæ˜¯è€ƒè™‘ä»åˆ†éš”ç¬¦å‘ä¸¤è¾¹æ‹“å±•å³å¯ï¼Œç”¨åç¼€æ•°ç»„è®¡ç®—ã€‚æ—¶é—´å¤æ‚åº¦$O(n\log n)$ã€‚</p>
<p>é¬¼çŸ¥é“æˆ‘è°ƒäº†å¤šä¹…ï¼ˆå…·ä½“çœ‹ä»£ç å§ï¼‰ã€‚<strong>SAå¤šæ¬¡ä½¿ç”¨ä¸€å®šè¦æ¸…ç©ºï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚</strong></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P1117.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P1117</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">3e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">16</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], he[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(sa, sa + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(rk, rk + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(tp, tp + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(he, he + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        n = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            he[rk[i]] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa, pa;</span><br><span class="line"><span class="type">int</span> n, a[MAXN], b[MAXN], lg2[MAXN];</span><br><span class="line"><span class="type">int</span> smn[MAXN][LOGN], pmn[MAXN][LOGN];</span><br><span class="line"><span class="type">char</span> s[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getlcs</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt; r)</span><br><span class="line">        <span class="built_in">swap</span>(l, r);</span><br><span class="line">    <span class="type">int</span> k = lg2[r - l];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(smn[l + <span class="number">1</span>][k], smn[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getlcp</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt; r)</span><br><span class="line">        <span class="built_in">swap</span>(l, r);</span><br><span class="line">    <span class="type">int</span> k = lg2[r - l];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(pmn[l + <span class="number">1</span>][k], pmn[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> tt;</span><br><span class="line">    <span class="built_in">read</span>(tt);</span><br><span class="line">    <span class="keyword">while</span> (tt--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">        n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">        sa.<span class="built_in">init</span>(n, s);</span><br><span class="line">        <span class="built_in">reverse</span>(s + <span class="number">1</span>, s + n + <span class="number">1</span>);</span><br><span class="line">        pa.<span class="built_in">init</span>(n, s);</span><br><span class="line">        <span class="built_in">reverse</span>(s + <span class="number">1</span>, s + n + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">fill</span>(a, a + n + <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(b, b + n + <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i)</span><br><span class="line">            lg2[i] = (i &amp; (i - <span class="number">1</span>)) ? lg2[i - <span class="number">1</span>] : lg2[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            smn[i][<span class="number">0</span>] = sa.he[i];</span><br><span class="line">            pmn[i][<span class="number">0</span>] = pa.he[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; LOGN; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= n; ++i) &#123;</span><br><span class="line">                smn[i][j] = <span class="built_in">min</span>(smn[i][j - <span class="number">1</span>], smn[i + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">                pmn[i][j] = <span class="built_in">min</span>(pmn[i][j - <span class="number">1</span>], pmn[i + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x + x &lt;= n; ++x) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> sr = x + <span class="number">1</span>; sr &lt;= n; sr += x) &#123;</span><br><span class="line">                <span class="type">int</span> sl = sr - x;</span><br><span class="line">                <span class="type">int</span> pl = n - sr + <span class="number">1</span>, pr = n - sl + <span class="number">1</span>;</span><br><span class="line">                <span class="type">int</span> pre = <span class="built_in">getlcp</span>(pa.rk[pl], pa.rk[pr]);</span><br><span class="line">                <span class="type">int</span> nxt = <span class="built_in">getlcs</span>(sa.rk[sl], sa.rk[sr]);</span><br><span class="line">                pre = <span class="built_in">min</span>(pre, x), nxt = <span class="built_in">min</span>(nxt, x);</span><br><span class="line">                <span class="keyword">if</span> (pre + nxt &gt; x) &#123;</span><br><span class="line">                    a[sr - pre + x]++, a[sr + nxt]--;</span><br><span class="line">                    b[sl - pre]--, b[sl + nxt - x]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            a[i] += a[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            b[i] += b[i + <span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">            ans += a[i] * b[i + <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        sa.<span class="built_in">clear</span>(), pa.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4094 [HEOI2016/TJOI2016] å­—ç¬¦ä¸²</title>
    <url>/2022/02/04/sol-p4094/</url>
    <content><![CDATA[<h2 id="P4094-HEOI2016-TJOI2016-å­—ç¬¦ä¸²"><a href="#P4094-HEOI2016-TJOI2016-å­—ç¬¦ä¸²" class="headerlink" title="P4094 [HEOI2016/TJOI2016] å­—ç¬¦ä¸²"></a>P4094 [HEOI2016/TJOI2016] å­—ç¬¦ä¸²</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4094">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ç­”æ¡ˆå…·æœ‰äºŒåˆ†æ€§ï¼Œè€ƒè™‘å…ˆäºŒåˆ†ç­”æ¡ˆ$len$å¹¶åˆ¤æ–­ã€‚</p>
<p>åˆ¤æ–­æ—¶åœ¨$height$æ•°ç»„ä¸ŠäºŒåˆ†å‡º$cl \le rk[c] \le cr$ä¸¤ä¸ªç«¯ç‚¹ï¼Œä½¿å¾—$lcp(cl, cr) \ge len$ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æœ‰$i$ä½¿å¾—$i \in [a, b - len + 1]$ä¸”$rk[i] \in [cl, cr]$ï¼Œæ˜¾ç„¶å¯ä»¥ç”¨ä¸»å¸­æ ‘ç»´æŠ¤æŸ¥è¯¢ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log^2 n)$ï¼Œå¸¸æ•°å¹¶ä¸å°ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4094.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4094</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">19</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN], he[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = he[rk[i]] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum, ls, rs;</span><br><span class="line">    &#125; nd[MAXN * <span class="number">25</span>];</span><br><span class="line">    <span class="type">int</span> tot, rt[MAXN];</span><br><span class="line">    <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i) &#123; <span class="keyword">return</span> rt[i]; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">newnode</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123; <span class="keyword">return</span> nd[++tot] = nd[i], tot; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span>&amp; i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> q, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        i = <span class="built_in">newnode</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">void</span>(nd[i].sum += v);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (q &lt;= mid)</span><br><span class="line">            <span class="built_in">update</span>(nd[i].ls, l, mid, q, v);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">update</span>(nd[i].rs, mid + <span class="number">1</span>, r, q, v);</span><br><span class="line">        nd[i].sum = nd[nd[i].ls].sum + nd[nd[i].rs].sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> nd[v].sum - nd[u].sum;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            ret += <span class="built_in">query</span>(nd[u].ls, nd[v].ls, l, mid, ql, qr);</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            ret += <span class="built_in">query</span>(nd[u].rs, nd[v].rs, mid + <span class="number">1</span>, r, ql, qr);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sgt;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> lg2[MAXN], st[MAXN][LOGN];</span><br><span class="line"><span class="type">char</span> str[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lcp</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> INF;</span><br><span class="line">    <span class="type">int</span> k = lg2[r - l];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(st[l + <span class="number">1</span>][k], st[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> d, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> l, r, cl, cr;</span><br><span class="line">    l = <span class="number">1</span>, r = sa.rk[c], cl = r;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">lcp</span>(mid, sa.rk[c]) &gt;= len)</span><br><span class="line">            r = mid - <span class="number">1</span>, cl = mid;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    l = sa.rk[c], r = n, cr = l;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">lcp</span>(sa.rk[c], mid) &gt;= len)</span><br><span class="line">            l = mid + <span class="number">1</span>, cr = mid;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sgt.<span class="built_in">query</span>(sgt[a - <span class="number">1</span>], sgt[b - len + <span class="number">1</span>], <span class="number">1</span>, n, cl, cr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str + <span class="number">1</span>);</span><br><span class="line">    sa.<span class="built_in">init</span>(n, str);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i)</span><br><span class="line">        lg2[i] = (i &amp; (i - <span class="number">1</span>)) ? lg2[i - <span class="number">1</span>] : lg2[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        st[i][<span class="number">0</span>] = sa.he[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; LOGN; ++j) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= n; ++i) &#123;</span><br><span class="line">            st[i][j] = <span class="built_in">min</span>(st[i][j - <span class="number">1</span>], st[i + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        sgt.<span class="built_in">update</span>(sgt[i] = sgt[i - <span class="number">1</span>], <span class="number">1</span>, n, sa.rk[i], <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="type">int</span> a, b, c, d;</span><br><span class="line">        <span class="built_in">read</span>(a), <span class="built_in">read</span>(b), <span class="built_in">read</span>(c), <span class="built_in">read</span>(d);</span><br><span class="line">        <span class="type">int</span> l = <span class="number">1</span>, r = <span class="built_in">min</span>(b - a + <span class="number">1</span>, d - c + <span class="number">1</span>), ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">check</span>(a, b, c, d, mid))</span><br><span class="line">                l = mid + <span class="number">1</span>, ans = mid;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4081 [USACO17DEC] Standing Out from the Herd P</title>
    <url>/2022/02/03/sol-p4081/</url>
    <content><![CDATA[<h2 id="P4081-USACO17DEC-Standing-Out-from-the-Herd-P"><a href="#P4081-USACO17DEC-Standing-Out-from-the-Herd-P" class="headerlink" title="P4081 [USACO17DEC] Standing Out from the Herd P"></a>P4081 [USACO17DEC] Standing Out from the Herd P</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4081">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¦–å…ˆæ„å»ºåç¼€æ•°ç»„ã€‚ä»ç„¶å¥—è·¯åœ°æšä¸¾å¤§ä¸²çš„ä½ç½®$sa[i]$ã€‚é¦–å…ˆè€ƒè™‘çš„æ˜¯ä¸èƒ½åœ¨åˆ«çš„å°ä¸²ä¸­å‡ºç°ï¼Œè®°å½•å…¶å‰åç¬¬ä¸€ä¸ªåœ¨ä¸åŒä¸²ä¸­å‡ºç°çš„åç¼€ä½ç½®ï¼Œåˆ†åˆ«ä¸º$pre_i$å’Œ$nxt_i$ï¼Œåˆ™ä»¥$sa[i]$å¼€å¤´çš„åç¼€å¯¹ç­”æ¡ˆè´¡çŒ®çš„æœ€å°é•¿åº¦ä¸º$\max(lcs(pre_i, i), lcs(i, nxt_i))$ï¼›æ¥ä¸‹æ¥è€ƒè™‘åªåœ¨å½“å‰å°ä¸²ä¸­å‡ºç°ä¸€æ¬¡æ˜¯ï¼Œåˆ™å¯¹ç­”æ¡ˆè´¡çŒ®çš„æœ€å°é•¿åº¦ä¸º$\max(lcs(i,i+1))$ã€‚ä¸¤è€…å–$\max$å³å¯ã€‚æ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(n \log n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4081.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4081</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN], he[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            he[i] = ht[sa[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa;</span><br><span class="line"><span class="type">int</span> n, m, id[MAXN], ed[MAXN], len[MAXN], ans[MAXN];</span><br><span class="line"><span class="type">char</span> buf[MAXN], str[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), m = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        len[i] = <span class="built_in">strlen</span>(buf);</span><br><span class="line">        <span class="built_in">copy</span>(buf, buf + len[i], str + m);</span><br><span class="line">        str[m + len[i]] = <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">        <span class="built_in">fill</span>(id + m, id + m + len[i], i);</span><br><span class="line">        ed[i] = m + len[i];</span><br><span class="line">        m += len[i] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sa.<span class="built_in">init</span>(m, str);</span><br><span class="line">    <span class="type">int</span> pre = <span class="number">0</span>, mn = INF;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (id[sa.sa[i]] != id[sa.sa[i - <span class="number">1</span>]]) &#123;</span><br><span class="line">            <span class="type">int</span> p = id[sa.sa[i - <span class="number">1</span>]];</span><br><span class="line">            pre = i - <span class="number">1</span>, mn = ed[p] - sa.sa[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        mn = <span class="built_in">min</span>(mn, sa.he[i]);</span><br><span class="line">        <span class="type">int</span> p = id[sa.sa[i]];</span><br><span class="line">        <span class="type">int</span> cur = <span class="built_in">max</span>(<span class="number">0ll</span>, ed[p] - sa.sa[i] - <span class="built_in">max</span>(mn, sa.he[i + <span class="number">1</span>]));</span><br><span class="line">        ans[p] += cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans[i]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P5028 Annihilate</title>
    <url>/2022/02/03/sol-p5028/</url>
    <content><![CDATA[<h2 id="P5028-Annihilate"><a href="#P5028-Annihilate" class="headerlink" title="P5028 Annihilate"></a>P5028 Annihilate</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P5028">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¢˜æ„å¾ˆ<del>ç®€æ´</del>ï¼Œè®©æ±‚$n$ä¸ªä¸²ä¸¤ä¸¤ä¹‹é—´çš„LCSã€‚</p>
<p>æ—¢ç„¶ä¸èƒ½$O(len^2)$çš„$dp$ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨åç¼€æ•°ç»„å§ã€‚</p>
<p>æ³¨æ„åˆ°å¯ä»¥å¥—è·¯åœ°å°†ä¸²æ‹¼æ¥ï¼Œç›´æ¥æšä¸¾å¤§ä¸²ä½ç½®$i$ï¼Œè®°å½•ä¸‹æ¯ä¸ªå°ä¸²çš„æœ€è¿‘çš„ä¸Šä¸€ä¸ªå­—ç¬¦ä½ç½®$pre_j$ï¼Œç”¨LCSæ›´æ–°ç­”æ¡ˆï¼Œ$O(n\times len)$ã€‚</p>
<p>æ³¨æ„åˆ°å†…å­˜é™åˆ¶ä¸º$64M$ï¼Œæ— æ³•ä½¿ç”¨STè¡¨ï¼Œäºæ˜¯åœ¨æ›´æ–°$pre$æ•°ç»„æ—¶è®°å½•å¦ä¸€ä¸ª$mn$æ•°ç»„ä¿å­˜ä»$pre$åˆ°$i$çš„LCSï¼Œç©ºé—´å¤æ‚åº¦å˜æˆ$O(n^2 + len)$ï¼Œå¯ä»¥é€šè¿‡ã€‚</p>
<p>æ³¨æ„åˆ°æœ€åçš„$40pts$å…¶å®æœ‰è€ƒå¯Ÿé€‰æ‰‹çš„ç»†å¿ƒç¨‹åº¦ï¼ŒLCSä¸èƒ½å¤§äºä¸²çš„é•¿åº¦ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P5028.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P5028</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">55</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1.1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXM], rk[MAXM], tp[MAXM], ht[MAXM], he[MAXM];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXM];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            he[i] = ht[sa[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> mn[MAXN], ed[MAXN], len[MAXN], pre[MAXN];</span><br><span class="line"><span class="type">int</span> id[MAXM], ans[MAXN][MAXN];</span><br><span class="line"><span class="type">char</span> buf[MAXM], str[MAXM];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), m = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        len[i] = <span class="built_in">strlen</span>(buf);</span><br><span class="line">        <span class="built_in">copy</span>(buf, buf + len[i], str + m);</span><br><span class="line">        str[m + len[i]] = <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">        <span class="built_in">fill</span>(id + m, id + m + len[i], i);</span><br><span class="line">        ed[i] = m + len[i];</span><br><span class="line">        m += len[i] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sa.<span class="built_in">init</span>(m, str);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            mn[j] = <span class="built_in">min</span>(mn[j], sa.he[i]);</span><br><span class="line">        <span class="type">int</span> p = id[sa.sa[i]];</span><br><span class="line">        <span class="type">int</span> clen = ed[p] - sa.sa[i];</span><br><span class="line">        pre[p] = i, mn[p] = clen;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pre[j]) &#123;</span><br><span class="line">                ans[j][p] = <span class="built_in">max</span>(ans[j][p], <span class="built_in">min</span>(mn[j], clen));</span><br><span class="line">                ans[p][j] = <span class="built_in">max</span>(ans[p][j], <span class="built_in">min</span>(mn[j], clen));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == j)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">write</span>(ans[i][j]), <span class="built_in">putchar</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4070 [SDOI2016] ç”Ÿæˆé­”å’’</title>
    <url>/2022/02/03/sol-p4070/</url>
    <content><![CDATA[<h2 id="P4070-SDOI2016-ç”Ÿæˆé­”å’’"><a href="#P4070-SDOI2016-ç”Ÿæˆé­”å’’" class="headerlink" title="P4070 [SDOI2016] ç”Ÿæˆé­”å’’"></a>P4070 [SDOI2016] ç”Ÿæˆé­”å’’</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4070">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ³¨æ„åˆ°æ¯æ¬¡åŠ å…¥ä¸€ä¸ªå­—ç¬¦$s[i]$åï¼Œå¢åŠ çš„ä¸åŒå­ä¸²æ•°é‡å°±æ˜¯$i-lcs$ï¼Œå…¶ä¸­$lcs$æ˜¯å­ä¸²$s[1\cdots i]$å’ŒåŠ å…¥å‰$s$ä¸­ä»»æ„å­ä¸²æœ€é•¿çš„æœ€é•¿å…¬å…±åç¼€é•¿åº¦ã€‚</p>
<p>è¦æ±‚å‡ºæ¯ä¸ªå‰ç¼€å’Œå…¶ä»–å­ä¸²çš„lcsï¼Œå®¹æ˜“æƒ³åˆ°å°†ä¸²åè½¬åä½¿ç”¨åç¼€æ•°ç»„ã€‚ç°åœ¨é—®é¢˜è½¬åŒ–ä¸ºå¯¹æ¯ä¸ª$i$æ±‚å‡ºå¯¹åº”çš„$p \lt i$ä½¿å¾—$\min\limits_{k\in(rk[p],rk[i]]\bigcup(rk[i],rk[p]]}{height[k]}$æœ€å¤§ï¼Œæ˜¾ç„¶è¿™ä¸ª$rk[p]$æ˜¯$rk[i]$çš„å‰é©±æˆ–è€…åç»§ã€‚</p>
<p>æŒ‰é¡ºåºæšä¸¾$i$ï¼Œç”¨<del>å¹³è¡¡æ ‘</del>ä¸¤æ£µçº¿æ®µæ ‘ç»´æŠ¤å‰é©±åç»§ï¼Œæ±‚å‡ºlcså–maxï¼Œå¾—åˆ°æ¯æ¬¡å¢åŠ çš„ä¸åŒå­ä¸²æ•°é‡ï¼Œå¾—åˆ°æœ€ç»ˆç­”æ¡ˆã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4070.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4070</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">19</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN], he[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">1e5</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i], tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            he[i] = ht[sa[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> li (i &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ri (i &lt;&lt; 1) | 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson li, l, mid</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson ri, mid + 1, r</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Update</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span> &#123;</span><br><span class="line">    _Update upd;</span><br><span class="line">    <span class="type">int</span> nd[MAXN * <span class="number">4</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        nd[i] = x;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(lson, x), <span class="built_in">build</span>(rson, x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> q, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">void</span>(nd[i] = <span class="built_in">upd</span>(nd[i], v));</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (q &lt;= mid)</span><br><span class="line">            <span class="built_in">update</span>(lson, q, v);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">update</span>(rson, q, v);</span><br><span class="line">        nd[i] = <span class="built_in">upd</span>(nd[li], nd[ri]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &gt; qr)</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> nd[i];</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ret = x;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            ret = <span class="built_in">upd</span>(ret, <span class="built_in">query</span>(lson, ql, qr, x));</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            ret = <span class="built_in">upd</span>(ret, <span class="built_in">query</span>(rson, ql, qr, x));</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MaxUpdate</span> &#123; <span class="function"><span class="type">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">max</span>(x, y); &#125; &#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MinUpdate</span> &#123; <span class="function"><span class="type">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">min</span>(x, y); &#125; &#125;;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> a[MAXN], b[MAXN], rev[MAXN], lg2[MAXN], st[MAXN][LOGN];</span><br><span class="line">SegmentTree&lt;MaxUpdate&gt; sgtpre;</span><br><span class="line">SegmentTree&lt;MinUpdate&gt; sgtnxt;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lcs</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> INF;</span><br><span class="line">    <span class="type">int</span> k = lg2[r - l];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(st[l + <span class="number">1</span>][k], st[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), m = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]), b[i] = a[i];</span><br><span class="line">    <span class="built_in">sort</span>(b + <span class="number">1</span>, b + m + <span class="number">1</span>);</span><br><span class="line">    m = <span class="built_in">unique</span>(b + <span class="number">1</span>, b + m + <span class="number">1</span>) - b - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        a[i] = <span class="built_in">lower_bound</span>(b + <span class="number">1</span>, b + m + <span class="number">1</span>, a[i]) - b;</span><br><span class="line">    <span class="built_in">copy</span>(a + <span class="number">1</span>, a + n + <span class="number">1</span>, rev + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">reverse</span>(rev + <span class="number">1</span>, rev + n + <span class="number">1</span>);</span><br><span class="line">    sa.<span class="built_in">init</span>(n, rev);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i)</span><br><span class="line">        lg2[i] = (i &amp; (i - <span class="number">1</span>)) ? lg2[i - <span class="number">1</span>] : lg2[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        st[i][<span class="number">0</span>] = sa.he[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; LOGN; ++j) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= n; ++i) &#123;</span><br><span class="line">            st[i][j] = <span class="built_in">min</span>(st[i][j - <span class="number">1</span>], st[i + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sgtpre.<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n, <span class="number">0</span>);</span><br><span class="line">    sgtnxt.<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n, n + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> cur = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> t = sa.rk[n - i + <span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> p1 = sgtpre.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, <span class="number">1</span>, t, <span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> p2 = sgtnxt.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, t, n, n + <span class="number">1</span>);</span><br><span class="line">        cur += i - <span class="built_in">max</span>(<span class="built_in">lcs</span>(p1, t), <span class="built_in">lcs</span>(t, p2));</span><br><span class="line">        sgtpre.<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">1</span>, n, t, t);</span><br><span class="line">        sgtnxt.<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">1</span>, n, t, t);</span><br><span class="line">        <span class="built_in">write</span>(cur), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4341 [BJWC2010] å¤–æ˜Ÿè”ç»œ</title>
    <url>/2022/02/03/sol-p4341/</url>
    <content><![CDATA[<h2 id="P4341-BJWC2010-å¤–æ˜Ÿè”ç»œ"><a href="#P4341-BJWC2010-å¤–æ˜Ÿè”ç»œ" class="headerlink" title="P4341 [BJWC2010] å¤–æ˜Ÿè”ç»œ"></a>P4341 [BJWC2010] å¤–æ˜Ÿè”ç»œ</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4341">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ²¡åˆå§‹åŒ–$log_2$æ•°ç»„ï¼Œä½†è¿‡äº†æ ·ä¾‹ã€‚</p>
<p>æ³¨æ„åˆ°ä½¿ç”¨åç¼€æ•°ç»„æ’åºåï¼Œå¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°æŒ‰ç…§å­—å…¸åºæšä¸¾å­ä¸²ã€‚å…·ä½“åœ°ï¼Œå¯¹äºåç¼€$s[sa[i]â€¦n]$ï¼ŒæŒ‰ç…§é¡ºåºæšä¸¾å­ä¸²$s[sa[i]+he[i]â€¦n]$å³å¯ã€‚</p>
<p>æ³¨æ„åˆ°å¯ä»¥STè¡¨ç»´æŠ¤LCSï¼Œå¹¶äºŒåˆ†å‡ºæ¯ä¸ªå­ä¸²çš„å‡ºç°æ¬¡æ•°ã€‚äºæ˜¯è¿™é¢˜å˜æˆäº†SAæ¨¡ç‰ˆé¢˜ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4341.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4341</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">3e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">15</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN], he[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] - <span class="string">&#x27;0&#x27;</span> + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            he[i] = ht[sa[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa;</span><br><span class="line"><span class="type">int</span> n, lg2[MAXN], st[MAXN][LOGN];</span><br><span class="line"><span class="type">char</span> str[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lcs</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> INF;</span><br><span class="line">    <span class="type">int</span> k = lg2[r - l];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(st[l + <span class="number">1</span>][k], st[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str + <span class="number">1</span>);</span><br><span class="line">    sa.<span class="built_in">init</span>(n, str);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i)</span><br><span class="line">        lg2[i] = (i &amp; (i - <span class="number">1</span>)) ? lg2[i - <span class="number">1</span>] : lg2[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        st[i][<span class="number">0</span>] = sa.he[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; LOGN; ++j) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= n; ++i) &#123;</span><br><span class="line">            st[i][j] = <span class="built_in">min</span>(st[i][j - <span class="number">1</span>], st[i + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> mn = sa.he[i] + <span class="number">1</span>, mx = n - sa.sa[i] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = mn; j &lt;= mx; ++j) &#123;</span><br><span class="line">            <span class="type">int</span> l = i, r = n, x = i;</span><br><span class="line">            <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">                <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">lcs</span>(i, mid) &gt;= j)</span><br><span class="line">                    l = mid + <span class="number">1</span>, x = mid;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (x != i)</span><br><span class="line">                <span class="built_in">write</span>(x - i + <span class="number">1</span>), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3649 [APIO2014] å›æ–‡ä¸²</title>
    <url>/2022/02/02/sol-p3649/</url>
    <content><![CDATA[<h2 id="P3649-APIO2014-å›æ–‡ä¸²"><a href="#P3649-APIO2014-å›æ–‡ä¸²" class="headerlink" title="P3649 [APIO2014] å›æ–‡ä¸²"></a>P3649 [APIO2014] å›æ–‡ä¸²</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3649">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ‰€ä»¥è¯´APIO2014è€ƒäº†é“æ¨¡ç‰ˆé¢˜ï¼Ÿ</p>
<p>è¿™æ˜¾ç„¶å°±æ˜¯PAMæ¨¡ç‰ˆï¼Œä½†æ—¢ç„¶ç¢°åˆ°äº†å°±è¿˜æ˜¯å†™ä¸€ä¸‹ï¼ˆåæ­£æˆ‘ä¹Ÿå¿˜äº†ï¼‰ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3649.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3649</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">3e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PAM</span> &#123;</span><br><span class="line">    <span class="type">int</span> siz, tot, last;</span><br><span class="line">    <span class="type">int</span> cnt[MAXN], len[MAXN], fail[MAXN], nxt[MAXN][<span class="number">26</span>];</span><br><span class="line">    <span class="type">char</span> str[MAXN];</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">newnode</span><span class="params">(<span class="type">int</span> l)</span> </span>&#123; <span class="keyword">return</span> len[++siz] = l, siz; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = <span class="number">-1</span>, last = <span class="number">0</span>;</span><br><span class="line">        str[tot = <span class="number">0</span>] = <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">        <span class="built_in">newnode</span>(<span class="number">0</span>), <span class="built_in">newnode</span>(<span class="number">-1</span>);</span><br><span class="line">        fail[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getfail</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (str[tot - len[x] - <span class="number">1</span>] != str[tot])</span><br><span class="line">            x = fail[x];</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">        str[++tot] = c;</span><br><span class="line">        <span class="type">int</span> now = <span class="built_in">getfail</span>(last);</span><br><span class="line">        <span class="keyword">if</span> (!nxt[now][c - <span class="string">&#x27;a&#x27;</span>]) &#123;</span><br><span class="line">            <span class="type">int</span> x = <span class="built_in">newnode</span>(len[now] + <span class="number">2</span>);</span><br><span class="line">            fail[x] = nxt[<span class="built_in">getfail</span>(fail[now])][c - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">            nxt[now][c - <span class="string">&#x27;a&#x27;</span>] = x;</span><br><span class="line">        &#125;</span><br><span class="line">        last = nxt[now][c - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        ++cnt[last];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; pam;</span><br><span class="line"><span class="type">char</span> s[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">    pam.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; s[i]; ++i)</span><br><span class="line">        pam.<span class="built_in">insert</span>(s[i]);</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = pam.siz; ~i; --i)</span><br><span class="line">        pam.cnt[pam.fail[i]] += pam.cnt[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= pam.siz; ++i)</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, pam.cnt[i] * pam.len[i]);</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2336 [SCOI2012] å–µæ˜Ÿçƒä¸Šçš„ç‚¹å</title>
    <url>/2022/02/02/sol-p2336/</url>
    <content><![CDATA[<h2 id="P2336-SCOI2012-å–µæ˜Ÿçƒä¸Šçš„ç‚¹å"><a href="#P2336-SCOI2012-å–µæ˜Ÿçƒä¸Šçš„ç‚¹å" class="headerlink" title="P2336 [SCOI2012] å–µæ˜Ÿçƒä¸Šçš„ç‚¹å"></a>P2336 [SCOI2012] å–µæ˜Ÿçƒä¸Šçš„ç‚¹å</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2336">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æœ¬ä»¥ä¸ºè‡ªå·±çš„$O(n\log n)$å‡åšæ³•èƒ½ddé¢˜è§£ï¼Œæ²¡æƒ³åˆ°è¿˜æ˜¯è¦ç”¨è«é˜Ÿâ€¦â€¦</p>
<p>æ—¢ç„¶èƒ½ç”¨åç¼€æ•°ç»„è§£å†³çš„é¢˜ï¼Œå°±ä¸€å®šä¸è¦å»å†™è‡ªåŠ¨æœºå•Šï½</p>
<p>å…ˆå¥—è·¯åœ°å°†ä¸²ä¹‹é—´ç”¨åˆ†éš”ç¬¦è¿æ¥ï¼Œä¸ºäº†ä¿è¯åç¼€æ’åºåçš„é¡ºåºæ˜¯ç›¸åŒåç¼€æ—¶å§“ååœ¨å‰ç‚¹ååœ¨åï¼Œåˆ™å°†å§“åä¹‹é—´çš„åˆ†éš”ç¬¦ASCIIç $\lt$ç‚¹åä¹‹é—´çš„åˆ†éš”ç¬¦ASCIIç ã€‚</p>
<p>åœ¨åç¼€æ•°ç»„ä¸Šæ‰«æå¹¶ç»´æŠ¤å•è°ƒæ ˆï¼Œå½“æ‰«æåˆ°ç‚¹åä¸²çš„å¼€å¤´æ—¶ï¼Œåœ¨å•è°ƒæ ˆä¸ŠäºŒåˆ†å¾—åˆ°ç¬¬ä¸€ä¸ªå¯ä»¥ä½¿å¾—åç¼€$sa[t\cdots i]$çš„å‰$len$ä¸ªæ•°å­—ç›¸åŒçš„$t$ï¼ˆå…¶ä¸­$len$æ˜¯è¯¥ç‚¹åä¸²çš„é•¿åº¦ï¼‰ï¼Œå½¢å¼åŒ–åœ°ï¼ŒäºŒåˆ†å‡ºæœ€å°çš„$t$ä½¿å¾—$\forall j \in (t,i] \quad height[j] \le len$ã€‚æ³¨æ„åˆ°$t$åˆ°$i$ä¹‹é—´çš„ä¸åŒå§“åä¸²æ•°é‡å°±æ˜¯ç­”æ¡ˆã€‚</p>
<p>æ‰€ä»¥å¯ä»¥ç¦»çº¿ä¸‹æ¥ï¼Œç”¨è«é˜Ÿæ±‚åŒºé—´ä¸åŒæ•°çš„ä¸ªæ•°ã€‚</p>
<p>æ€è€ƒå¦‚ä½•æ±‚å‡ºç¬¬äºŒä¸ªç­”æ¡ˆã€‚è¿ç”¨è«é˜Ÿçš„å°æŠ€å·§æˆ‘ä»¬çŸ¥é“å¯ä»¥åœ¨ç§»åŠ¨æŒ‡é’ˆæ—¶å·®åˆ†ç®—å‡ºæ¯æ¬¡åŠ å…¥æ–°çš„å§“åä¸²åˆ°ä¸‹ä¸€æ¬¡åˆ é™¤è¯¥å§“åä¸²ä¹‹é—´çš„æ­¥æ•°çš„æ€»å’Œï¼ŒåŠ èµ·æ¥å°±æ˜¯ç¬¬äºŒä¸ªç­”æ¡ˆã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \sqrt n)$ï¼Œè¢«è‡ªåŠ¨æœºåŠæ‰“<del>ä½†èƒ½è¿‡</del>ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2336.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2336</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN], he[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXN] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">5e5</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            he[i] = ht[sa[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Query</span> &#123;</span><br><span class="line">    <span class="type">int</span> l, r, i;</span><br><span class="line">&#125; query[MAXN];</span><br><span class="line"><span class="type">int</span> n, m, l, len, top, block;</span><br><span class="line"><span class="type">int</span> lb[MAXN], ta[MAXN], tb[MAXN], buf[MAXN], str[MAXN];</span><br><span class="line"><span class="type">int</span> sta[MAXN], hta[MAXN], typ[MAXN], cnt[MAXN];</span><br><span class="line"><span class="type">int</span> ans1[MAXN], ans2[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    ta[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> l1, l2;</span><br><span class="line">        <span class="built_in">read</span>(l1);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= l1; ++j)</span><br><span class="line">            <span class="built_in">read</span>(buf[j]);</span><br><span class="line">        buf[l1 + <span class="number">1</span>] = <span class="number">1e5</span>;</span><br><span class="line">        <span class="built_in">read</span>(l2);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= l2; ++j)</span><br><span class="line">            <span class="built_in">read</span>(buf[j + l1 + <span class="number">1</span>]);</span><br><span class="line">        l = l1 + l2 + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">copy</span>(buf + <span class="number">1</span>, buf + l + <span class="number">1</span>, str + ta[i]);</span><br><span class="line">        str[ta[i] + l] = <span class="number">1e5</span>;</span><br><span class="line">        ta[i + <span class="number">1</span>] = ta[i] + l + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    tb[<span class="number">1</span>] = ta[n + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(l), lb[i] = l;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= l; ++j)</span><br><span class="line">            <span class="built_in">read</span>(buf[j]);</span><br><span class="line">        <span class="built_in">copy</span>(buf + <span class="number">1</span>, buf + l + <span class="number">1</span>, str + tb[i]);</span><br><span class="line">        str[tb[i] + l] = <span class="number">2e5</span>;</span><br><span class="line">        tb[i + <span class="number">1</span>] = tb[i] + l + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    len = tb[m + <span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">    sa.<span class="built_in">init</span>(len, str);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = ta[i]; j &lt; ta[i + <span class="number">1</span>]; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (str[j] &lt; <span class="number">1e5</span>)</span><br><span class="line">                typ[sa.rk[j]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (top &amp;&amp; hta[top] &gt; sa.he[i])</span><br><span class="line">            --top;</span><br><span class="line">        ++top, sta[top] = i, hta[top] = sa.he[i];</span><br><span class="line">        <span class="keyword">if</span> (sa.sa[i] &gt;= tb[<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="type">int</span> p = sa.sa[i];</span><br><span class="line">            <span class="type">int</span> x = <span class="built_in">lower_bound</span>(tb + <span class="number">1</span>, tb + m + <span class="number">1</span>, p) - tb;</span><br><span class="line">            <span class="keyword">if</span> (tb[x] != p)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> t = <span class="built_in">lower_bound</span>(hta + <span class="number">1</span>, hta + top + <span class="number">1</span>, lb[x]) - hta - <span class="number">1</span>;</span><br><span class="line">            query[x] = &#123;t &lt;= top ? sta[t] : i + <span class="number">1</span>, i, x&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    block = <span class="built_in">ceil</span>(<span class="built_in">sqrt</span>(len + <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">auto</span> comp_query = [=](<span class="type">const</span> Query&amp; lhs, <span class="type">const</span> Query&amp; rhs) &#123;</span><br><span class="line">        <span class="type">int</span> bl = lhs.l / block, br = rhs.l / block;</span><br><span class="line">        <span class="keyword">return</span> bl == br ? ((bl &amp; <span class="number">1</span>) ? lhs.r &lt; rhs.r : lhs.r &gt; rhs.r)</span><br><span class="line">                        : bl &lt; br;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">sort</span>(query + <span class="number">1</span>, query + m + <span class="number">1</span>, comp_query);</span><br><span class="line">    <span class="type">int</span> cur = <span class="number">0</span>, cl = <span class="number">0</span>, cr = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (cl &lt; query[i].l) &#123;</span><br><span class="line">            <span class="keyword">if</span> (typ[cl] &amp;&amp; --cnt[typ[cl]] == <span class="number">0</span>)</span><br><span class="line">                --cur, ans2[typ[cl]] -= m - i + <span class="number">1</span>;</span><br><span class="line">            ++cl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (cl &gt; query[i].l) &#123;</span><br><span class="line">            --cl;</span><br><span class="line">            <span class="keyword">if</span> (typ[cl] &amp;&amp; cnt[typ[cl]]++ == <span class="number">0</span>)</span><br><span class="line">                ++cur, ans2[typ[cl]] += m - i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (cr &lt; query[i].r) &#123;</span><br><span class="line">            ++cr;</span><br><span class="line">            <span class="keyword">if</span> (typ[cr] &amp;&amp; cnt[typ[cr]]++ == <span class="number">0</span>)</span><br><span class="line">                ++cur, ans2[typ[cr]] += m - i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (cr &gt; query[i].r) &#123;</span><br><span class="line">            <span class="keyword">if</span> (typ[cr] &amp;&amp; --cnt[typ[cr]] == <span class="number">0</span>)</span><br><span class="line">                --cur, ans2[typ[cr]] -= m - i + <span class="number">1</span>;</span><br><span class="line">            --cr;</span><br><span class="line">        &#125;</span><br><span class="line">        ans1[query[i].i] = cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans1[i]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans2[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>WC2022æ¸¸å¯„</title>
    <url>/2022/01/27/trip-wc2022/</url>
    <content><![CDATA[<h2 id="WC2022æ¸¸å¯„"><a href="#WC2022æ¸¸å¯„" class="headerlink" title="WC2022æ¸¸å¯„"></a>WC2022æ¸¸å¯„</h2><p><del>å†»é›¶</del>å†¬çœ è¥å‡ æ—¥æ¸¸ï¼Œ<del>å­¦ä¹ äº†LCTç­‰ç®—æ³•</del></p>
<span id="more"></span>
<p>$8:15$ å·¦å³æŠŠæœºæˆ¿ç”µè„‘æ‰“å¼€äº†ï¼ˆå±…ç„¶è¦å…ˆæŒ‰<code>esc</code>ç„¶åç”¨é¼ æ ‡ç‚¹å¼€ç³»ç»Ÿï¼‰ï¼Œçœ‹åˆ°æ¡Œé¢ä¸Šæœ‰vscodeï¼Œæ²¡æ‰¾åˆ°NOI-Linuxï¼ˆJSä¼ ç»Ÿï¼Œäº‹å®è¯æ˜åªæ˜¯æˆ‘æ²¡çœ‹åˆ°ï¼‰ï¼Œå°±<del>è¶ç€è¿˜æ²¡æ–­ç½‘</del>å¿«é€Ÿä¸‹äº†ä¸‹æ’ä»¶ï¼Œé…ç½®äº†ä¸‹C++ï¼Œæ•²äº†ä¸‹æ¿å­ï¼Œè¿è¡Œçš„æ—¶å€™exeè¢«è«åå…¶å¦™å¡åˆ°åå°äº†ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰ï¼Œä»»åŠ¡ç®¡ç†å™¨è¿˜æ²¡æœ‰æƒé™è°ƒå‡ºæ¥ï¼ˆç¦»å¤§è°±ï¼‰ï¼Œæ‰€ä»¥åªå¥½æŠŠ<code>template.cpp</code>æ”¹æˆ<code>template2.cpp</code>ã€‚ï¼ˆç„¶åè€ƒè¯•è‡³å§‹è‡³ç»ˆæ²¡æ‰“å¼€vscä¸€ç›´ç”¨çš„devï¼‰</p>
<p>$8:30$ æ‹¿åˆ°é¢˜ç›®çœ‹äº†çœ¼ï¼Œä¸€æ„é€ ä¸€ä¼ ç»Ÿä¸€äº¤äº’çœ‹çš„äººå¤´æ™•ï¼ˆçœŸå°±å’Œpyè€å¸ˆè¯´çš„é‚£æ ·è®²çš„å’Œè€ƒçš„æ²¡æœ‰ä»»ä½•å…³ç³»ï¼‰ã€‚</p>
<p>å…ˆçœ‹çœ‹T1ï¼Œæ˜¯ä¸ªæ„é€ +æ‹¬å·åºåˆ—ï¼Œæ“ä½œ$1$~$4$éƒ½æ˜¯å°†ä¸åŒçš„åºåˆ—æ”¹ä¸ºåŒæ ·çš„åºåˆ—ï¼Œæƒ³ç€ä¼¼ä¹å¯ä»¥å€’è¿‡æ¥åšæ¯”è¾ƒæ–¹ä¾¿ã€‚ç„¶åå¼€å§‹çæƒ³ï¼Œæ„Ÿè§‰å…ˆåœ¨åºåˆ—æœ«å°¾åŠ ä¸Šä¸€ä¸ª<code>()</code>ç„¶åå°±æ¯”è¾ƒå®¹æ˜“æ»¡è¶³$1$~$4$æ“ä½œçš„æ ¼å¼ï¼Œæœ€åå†æŠŠæœ«å°¾<code>()</code>åˆ æ‰ï¼Œæ€»ä¹‹æƒ³åˆ°çš„éƒ½æ˜¯ä¹±æã€‚æ­¤æ—¶å·²ç»è¿‡å»$1h$ï¼Œä¸€åˆ†æ²¡æœ‰ä¸¢æ‰T1å»çœ‹T2.</p>
<p>çœ‹ä¸€çœ¼T2å‘ç°æˆ‘ä¼šè«é˜Ÿï¼Œäºæ˜¯$O(n \sqrt{n \log n})$çš„åšæ³•ç›´æ¥æ˜¾ç„¶ã€‚ä½†æ˜¯ä¸€çœ‹æ•°æ®$5\times 10^5$ä¼¼ä¹å¹¶ä¸æƒ³æ”¾è«é˜Ÿè¿‡å»ã€‚ç»§ç»­æ€è€ƒå‘ç°åˆ é™¤å…ƒç´ ä¼¼ä¹å¯ä»¥$O(1)$æå®šï¼Œçœ‹åˆ°æ—¶é™$5s$ï¼Œå°±å¼€å¿ƒåœ°å†™èµ·äº†å›æ»šè«é˜Ÿï¼ˆæ­¤æ—¶æˆ‘è¿˜æ²¡æœ‰æ„è¯†åˆ°å›æ»šè«é˜Ÿçš„å·¨å¤§å¸¸æ•°ï¼‰ã€‚å¤§æ¦‚$30min$å†™å®Œè°ƒå®Œå°æ ·ä¾‹ï¼Œæ„Ÿè§‰å¤ªæ°´äº†å°±è¿…é€Ÿå†™äº†ä¸ªå¯¹æ‹ï¼ˆå¬è¯´åæ¥å‘äº†å¤§æ ·ä¾‹ï¼Œä¸è¿‡æˆ‘ä¹Ÿæ²¡çœ‹è§ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™é¢˜ï¼‰ï¼Œä¸€çœ‹$n=1000$å¥½åƒæ²¡å•¥é—®é¢˜ï¼Œé€ äº†ä¸ª<code>5e5</code>çš„æ•°æ®è·‘äº†$15s$ï¼Œç«‹é©¬æ„Ÿè§‰å±ï¼Œæƒ³åŠæ³•å¼€å§‹å¡å¸¸æ•°ï¼Œç»“æœå‘ç°å†™çš„å¥½åƒæŒºä¼˜é›…çš„ï¼Œåªå¥½ç»™å„ä¸ªå‡½æ•°åŠ äº†ä¸‹<code>inline</code>å°±ä¸¢æ‰å¼€æ‘†ï½</p>
<p>T3æ˜¾ç„¶ä¸å¯åšï¼Œæˆ‘èŠ±äº†å¤§é‡æ—¶é—´åœ¨è¿™é¢˜è€Œä¸æ˜¯æƒ³åŠæ³•ä¼˜åŒ–T2åº”è¯¥è¯´æ˜¯è¿™åœºæ¯”èµ›æœ€å¤§çš„å¤±è¯¯ã€‚è¿™é¢˜å‡ºçš„å°±å¾ˆç„å­¦ï¼Œç„¶åPDFé¢˜é¢ä¸­æ²¡å¼€<code>c++14</code>ä¸”äº¤äº’åº“ç”¨äº†<code>srand(0)</code>æå¾—æˆ‘æ—¢ä¸æ•¢ç”¨<code>rand</code>åˆä¸æ•¢ç”¨<code>mt19937</code>ï¼Œç¦»è°±å°±ç¦»è°±åœ¨é¢˜ç›®è¯´æ˜¯æœ‰$5$æ¬¡guessçš„æœºä¼šä½†æ˜¯æŒ‰ç…§è¿™ä¸ªäº¤äº’åº“çš„å†™æ³•ç›¸å½“äºæ˜¯ä½ é—®$4$æ¬¡è¿”å›$5$æ¬¡è€Œä¸æ˜¯è®©ä½ é—®$5$æ¬¡ï¼Œäºæ˜¯æˆ‘éå¸¸sbåœ°æƒ³åˆ°ç”¨$5$æ¬¡é—®å‡º$25$ä¸ªå­—æ¯æ˜¯å¦å‡ºç°ç„¶åæ ¹æ®å·²æœ‰ä¿¡æ¯åŸºæœ¬é”å®šç›®æ ‡ä¸²éšæœºé€‰å–çš„åšæ³•ï¼Œæµªè´¹äº†å¤§é‡æ—¶é—´åœ¨å†™meet in the middleï¼ˆä¼¼ä¹æ—¶é™$60$ç§’çš„è¯$2^{26}\times 26$çdpéƒ½èƒ½é¢„å¤„ç†å‡ºæ¥ï¼Ÿä¸æ€•æœ‰äººå¡è¯„æµ‹æœºå—ï¼Ÿï¼‰å†™å®Œå‘ç°ç™½å¹²äº†ï¼Œæœ€åäº¤äº†ä¸ªéšæœºç¨‹åºä¸Šå»ï¼ŒæœŸæœ›å¾—åˆ†$0$ã€‚ï¼ˆé¡ºä¾¿è¯´å¥å…¶å®æˆ‘è›®å–œæ¬¢Cé£æ ¼çš„stringçš„ï¼Œä¸çŸ¥é“ç®—ä¸ç®—é‚ªæ•™ï¼‰</p>
<p>æœ€åå¤§æ¦‚åŠä¸ªå¤šå°æ—¶å¼€å§‹å†™T1çš„æš´åŠ›ã€‚æš´åŠ›å¥½çƒ¦ï¼Œåˆè¦çŠ¶å‹åˆè¦åˆ¤æ–­æ‹¬å·åºåˆ—ï¼Œè€Œä¸”åªèƒ½æ‹¿$15$åˆ†ï¼Œæ„Ÿè§‰ä¸€ç‚¹ä¹Ÿä¸å€¼ã€‚çªç„¶å‘ç°ä¸é™åˆ¶$5$å’Œ$6$æ“ä½œçš„$25$åˆ†ä¼¼ä¹ç™½ç»™å°±è¿…é€Ÿå†™å®Œäº¤ä¸Šå»ã€‚è¿™æ—¶å€™é«˜ä¸‰å­¦é•¿å·²ç»åˆ°æœºæˆ¿é‡Œå‡†å¤‡ç»™æˆ‘ä»¬è®²è¯¾äº†ï¼Œå‘¨å›´ä¹±å“„å“„çš„ï¼Œä¹Ÿæ²¡å¿ƒæ€å†å†™äº†ï¼Œå°±$3min$æ¢$25pts$æ„Ÿè§‰<del>è¿˜æŒºå€¼</del>ã€‚</p>
<p>äºæ˜¯æœŸæœ›å¾—åˆ†åªæœ‰$25+60/100+0=85/125$ï¼Œå¿«ä¹æ‰“é“ï½</p>
<p>ç²—æ¥äº¤æµä¸‹å‘ç°jcyå’Œjthçš„T2éƒ½æ˜¯æ™®é€šè«é˜Ÿå†™çš„ï¼Œjcyæ‹¿åˆ°äº†T1çš„æš´åŠ›$50$åˆ†ï¼Œjthä¼¼ä¹æ²¡æ‹¿åˆ°T1çš„ç™½ç»™åˆ†ä½†æ˜¯T3éª—äº†$22$åˆ†ï¼ˆæˆ‘è¿™æ‰å‘ç°è‡ªå·±æ ¹æœ¬æ²¡æœ‰ç”¨<code>grader.cpp</code>ä¼°åˆ†ï¼‰ã€‚è€ƒå®Œzcæ¥é—®æœ‰æ²¡æœ‰äºº$160$ä»¥ä¸Šä¼¼ä¹æ²¡æœ‰äººä¸¾æ‰‹ã€‚</p>
<p>å¬jcyè¯´T1ä¼¼ä¹æ˜¯æŠŠæ‹¬å·è½¬æˆæ ‘ä¸Šé—®é¢˜ï¼ˆæˆ‘å±…ç„¶è¿æ ‘éƒ½æ²¡æœ‰æƒ³åˆ°ï¼Œä¸è¿‡ä¼°è®¡æƒ³åˆ°äº†ä¹Ÿä¸ä¼šåšï¼‰</p>
<p>ä¸‹åˆåœ¨å­¦æ ¡ç­¾äº†åœè¯¾ä¿è¯ä¹¦ï¼Œ$2:30$ä»¥åå»åƒäº†ä¸­<del>ä¸‹åˆ</del>é¥­ã€‚ä¸å¾—ä¸è¯´æ¤°æ ‘ç‰Œæ¤°æ±è¿˜è›®å¥½å–çš„ï¼ˆé€ƒ</p>
<p>æ™šä¸Šè®²é¢˜äº¤æµï¼Œå¤§å®¶çš„å›æ»šè«é˜Ÿéƒ½æ˜¯$9s$åªæœ‰æˆ‘å¤§å¸¸æ•°é€‰æ‰‹æ˜¯$15s$ã€‚</p>
<p>ç­‰æ˜å¤©å‡ºåˆ†å§ï¼ˆè¯´ä¸å®šT3è¿˜èƒ½éª—åˆ°ä¸ª$1pt$å‘¢ï¼‰</p>
<p>æœ€ç»ˆå¾—åˆ†åªæœ‰$90$ï¼Œæ»šCuäº†â€¦</p>
<p><img src="bee.png" alt="bee"></p>
]]></content>
      <categories>
        <category>æ¸¸è®°</category>
      </categories>
      <tags>
        <tag>trip</tag>
      </tags>
  </entry>
  <entry>
    <title>UVA11107 Life Forms</title>
    <url>/2022/01/26/sol-uva11107/</url>
    <content><![CDATA[<h2 id="UVA11107-Life-Forms"><a href="#UVA11107-Life-Forms" class="headerlink" title="UVA11107 Life Forms"></a>UVA11107 Life Forms</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/UVA11107">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ç›¸åŒå­ä¸²æƒ³åˆ°ç”¨åç¼€æ•°ç»„ã€‚</p>
<p>è€ƒè™‘å°†æ‰€æœ‰ä¸²ç”¨<code>$</code>è¿æ¥ã€‚è¿™æ ·åœ¨$height$æ•°ç»„ä¸Šç”¨STè¡¨ç»´æŠ¤åŒºé—´æœ€å°å€¼ï¼ˆå³åŒºé—´LCSï¼‰ï¼Œç¬¬ä¸€éæ‰«æç”¨åŒæŒ‡é’ˆå–$\left\lfloor\dfrac n 2\right\rfloor+1$ä¸ªä¸åŒä¸²ä¸­çš„æ•°å­—ï¼Œæ±‚å‡ºç­”æ¡ˆçš„é•¿åº¦ï¼Œç¬¬äºŒéæ‰«æå‡ºé•¿åº¦ä¸º$ans$çš„å­ä¸²ï¼Œç»è¿‡$hash$å»é‡åè¾“å‡ºå³å¯ã€‚æˆ‘çš„å†™æ³•éœ€è¦ç‰¹åˆ¤$n=1$ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(m \log m)$ï¼Œå…¶ä¸­$m=\sum |S|$ã€‚</p>
<p><del>ä»£ç å†™çš„æä¸‘æä¸ä¼˜é›…</del></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           UVA11107.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/UVA11107</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">120</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK = <span class="number">1e5</span> + <span class="number">150</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGK = <span class="number">19</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXK], rk[MAXK], tp[MAXK], ht[MAXK], he[MAXK];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXK];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">128</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i], tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            he[i] = ht[sa[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, lg2[MAXK], mn[MAXK][LOGK];</span><br><span class="line"><span class="type">int</span> li[MAXN], ri[MAXN], id[MAXK], sz[MAXK], cnt[MAXN];</span><br><span class="line"><span class="type">char</span> s[MAXN][MAXM], str[MAXK];</span><br><span class="line"><span class="type">bool</span> vis[MAXN];</span><br><span class="line">unordered_map&lt;<span class="type">int</span>, <span class="type">bool</span>&gt; outed;</span><br><span class="line">SuffixArray sa;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k = lg2[r - l];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(mn[l + <span class="number">1</span>][k], mn[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; MAXK; ++i)</span><br><span class="line">        lg2[i] = (i &amp; (i - <span class="number">1</span>)) ? lg2[i - <span class="number">1</span>] : lg2[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">read</span>(n) == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (tot++)</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s[i]);</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, s[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> t = <span class="built_in">strlen</span>(s[i]);</span><br><span class="line">            li[i] = len;</span><br><span class="line">            ri[i] = len + t - <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">copy</span>(s[i], s[i] + t, str + len);</span><br><span class="line">            str[len + t] = <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">            len += t + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        str[--len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        sa.<span class="built_in">init</span>(len, str);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> p = <span class="built_in">upper_bound</span>(li + <span class="number">1</span>, li + n + <span class="number">1</span>, sa.sa[i]) - li - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (li[p] &lt;= sa.sa[i] &amp;&amp; sa.sa[i] &lt;= ri[p])</span><br><span class="line">                id[i] = p, sz[i] = ri[p] - sa.sa[i] + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                id[i] = <span class="number">0</span>, sz[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">            mn[i][<span class="number">0</span>] = <span class="built_in">min</span>(&#123;sa.he[i], sz[i - <span class="number">1</span>], sz[i]&#125;);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; LOGK; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= len; ++i) &#123;</span><br><span class="line">                mn[i][j] = <span class="built_in">min</span>(mn[i][j - <span class="number">1</span>], mn[i + (<span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> cur = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fill</span>(cnt, cnt + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">1</span>; r &lt;= len; ++r) &#123;</span><br><span class="line">            <span class="keyword">while</span> (id[l] == <span class="number">0</span>)</span><br><span class="line">                ++l;</span><br><span class="line">            <span class="keyword">while</span> (id[r] == <span class="number">0</span>)</span><br><span class="line">                ++r;</span><br><span class="line">            <span class="keyword">if</span> (cnt[id[r]]++ == <span class="number">0</span>)</span><br><span class="line">                ++cur;</span><br><span class="line">            <span class="keyword">while</span> (cur &gt; n / <span class="number">2</span> + <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (--cnt[id[l]] == <span class="number">0</span>)</span><br><span class="line">                    --cur;</span><br><span class="line">                ++l;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (l &lt; r &amp;&amp; cnt[id[l]] &gt; <span class="number">1</span>)</span><br><span class="line">                --cnt[id[l]], ++l;</span><br><span class="line">            <span class="keyword">if</span> (cur == n / <span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line">                ans = <span class="built_in">max</span>(ans, <span class="built_in">query</span>(l, r));</span><br><span class="line">        &#125;</span><br><span class="line">        cur = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fill</span>(cnt, cnt + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (ans == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            outed.<span class="built_in">clear</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">1</span>; r &lt;= len; ++r) &#123;</span><br><span class="line">                <span class="keyword">while</span> (id[l] == <span class="number">0</span>)</span><br><span class="line">                    ++l;</span><br><span class="line">                <span class="keyword">while</span> (id[r] == <span class="number">0</span>)</span><br><span class="line">                    ++r;</span><br><span class="line">                <span class="keyword">if</span> (cnt[id[r]]++ == <span class="number">0</span>)</span><br><span class="line">                    ++cur;</span><br><span class="line">                <span class="keyword">while</span> (cur &gt; n / <span class="number">2</span> + <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (--cnt[id[l]] == <span class="number">0</span>)</span><br><span class="line">                        --cur;</span><br><span class="line">                    ++l;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span> (l &lt; r &amp;&amp; cnt[id[l]] &gt; <span class="number">1</span>)</span><br><span class="line">                    --cnt[id[l]], ++l;</span><br><span class="line">                <span class="keyword">if</span> (cur == n / <span class="number">2</span> + <span class="number">1</span> &amp;&amp; <span class="built_in">query</span>(l, r) == ans) &#123;</span><br><span class="line">                    <span class="type">int</span> h = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ans; ++i)</span><br><span class="line">                        h = (h * <span class="number">12345</span> + str[sa.sa[r] + i]) % <span class="number">19260817</span>;</span><br><span class="line">                    <span class="keyword">if</span> (outed[h])</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    outed[h] = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ans; ++i)</span><br><span class="line">                        <span class="built_in">putchar</span>(str[sa.sa[r] + i]);</span><br><span class="line">                    <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">debug</span>(<span class="string">&quot;%lld&quot;</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4491 [HAOI] æŸ“è‰²</title>
    <url>/2022/01/25/sol-p4491/</url>
    <content><![CDATA[<h2 id="P4491-HAOI-æŸ“è‰²"><a href="#P4491-HAOI-æŸ“è‰²" class="headerlink" title="P4491 [HAOI] æŸ“è‰²"></a>P4491 [HAOI] æŸ“è‰²</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4491">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è€ƒè™‘æœ´ç´ çš„åšæ³•ã€‚å®¹æ˜“æƒ³åˆ°é’¦å®š$k$ä¸ªé¢œè‰²å‡ºç°æ¬¡æ•°æ°å¥½ä¸º$S$ï¼Œå…¶ä»–é¢œè‰²éšä¾¿å¡«å¹¶å®¹æ–¥ã€‚æ±‚å‡º$k \in [0, \min(m,n/2)]$å³å¯ã€‚</p>
<script type="math/tex; mode=display">
F[k]=\binom{m}{k}\binom{n}{ks}\frac{(ks)!}{(s!)^k}(m-k)^{n-ks}</script><p>æ€è€ƒè¿™æ ·é‡å¤è®¡ç®—åˆ°çš„éƒ¨åˆ†ã€‚è®¾$G[i]$ä¸ºçœŸæ­£çš„ç­”æ¡ˆï¼Œé‚£ä¹ˆæœ‰</p>
<script type="math/tex; mode=display">
F[k]=\sum_{i=k}^n\binom{i}{k}G[i]</script><p>ä½¿ç”¨äºŒé¡¹å¼åæ¼”ï¼Œå¾—åˆ°</p>
<script type="math/tex; mode=display">
G[k]=\sum_{i=k}^n(-1)^{i-k}\binom{i}{k}F[i]</script><p>å°†ç»„åˆæ•°å±•å¼€</p>
<script type="math/tex; mode=display">
G[k]=\sum_{i=k}^n(-1)^{i-k}\frac{i!}{k!(i-k)!}F[i]</script><p>å¯¹$1004535809$å–æ¨¡ï¼Œä½ æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿ</p>
<script type="math/tex; mode=display">
G[k]=\frac{1}{k!}\sum_{i=k}^ni!F[i]\times\frac{(-1)^{i-k}}{(i-k)!}</script><p>äºæ˜¯$O(n+m\log m)$ç®—å‡º$F[0\cdots m]$ï¼Œç„¶åNTTåšå·ç§¯å·®æ±‚å‡º$G[0\cdots m]$å³å¯ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4491.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4491</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1e7</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1004535809</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x -= y;</span><br><span class="line">    <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x % p;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> rev[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span>* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                f[k] = <span class="built_in">add</span>(u, t), f[k + h / <span class="number">2</span>] = <span class="built_in">sub</span>(u, t);</span><br><span class="line">                g = g * gn % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] = f[i] * inv % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;  <span class="comment">// namespace maths</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="type">int</span> n, m, s, w[MAXN];</span><br><span class="line"><span class="type">int</span> a[MAXN], b[MAXN], f[MAXN], g[MAXN];</span><br><span class="line"><span class="type">int</span> fac[MAXM], inv[MAXM];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">binom</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fac[x] * inv[y] % MOD * inv[x - y] % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">read</span>(w[i]);</span><br><span class="line">    fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; MAXM; ++i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    inv[MAXM - <span class="number">1</span>] = <span class="built_in">qpow</span>(fac[MAXM - <span class="number">1</span>], MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXM - <span class="number">2</span>; ~i; --i)</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">    <span class="type">int</span> mx = <span class="built_in">min</span>(m, n / s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= mx; ++i) &#123;</span><br><span class="line">        f[i] = <span class="built_in">binom</span>(m, i) * <span class="built_in">binom</span>(n, i * s) % MOD * fac[i * s] % MOD</span><br><span class="line">             * <span class="built_in">qpow</span>(inv[s], i) % MOD * <span class="built_in">qpow</span>(m - i, n - i * s) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= mx; ++i) &#123;</span><br><span class="line">        a[i] = fac[i] * f[i] % MOD;</span><br><span class="line">        b[i] = (i &amp; <span class="number">1</span>) ? <span class="built_in">sub</span>(MOD, inv[i]) : inv[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">reverse</span>(a, a + mx + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt;= mx + mx + <span class="number">1</span>)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">ntt</span>(a, len, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(b, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        g[i] = a[i] * b[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(g, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">reverse</span>(g, g + mx + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= mx; ++i)</span><br><span class="line">        g[i] = g[i] * inv[i] % MOD;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= mx; ++i)</span><br><span class="line">        ans = <span class="built_in">add</span>(ans, g[i] * w[i] % MOD);</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P1501 [å›½å®¶é›†è®­é˜Ÿ] Tree II</title>
    <url>/2022/01/23/sol-p1501/</url>
    <content><![CDATA[<h2 id="P1501-å›½å®¶é›†è®­é˜Ÿ-Tree-II"><a href="#P1501-å›½å®¶é›†è®­é˜Ÿ-Tree-II" class="headerlink" title="P1501 [å›½å®¶é›†è®­é˜Ÿ] Tree II"></a>P1501 [å›½å®¶é›†è®­é˜Ÿ] Tree II</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P1501">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸€é“LCTçš„æ¨¡ç‰ˆé¢˜ã€‚</p>
<p>ä½†æ˜¯æˆ‘ç«Ÿç„¶é”™äº†$2$æ¬¡ï¼ï¼ï¼</p>
<p>$4$ç§æ“ä½œå®¹æ˜“è¿›è¡Œä¸å¤šè¯´ï¼Œè€ƒè™‘ç»´æŠ¤<code>add</code>å’Œ<code>mul</code>æ“ä½œï¼Œéœ€è¦ç»´æŠ¤å­æ ‘$size$ï¼Œä¿®æ”¹çš„æ—¶å€™è¦è®°å¾—ä¿®æ”¹<code>val</code>è€Œä¸æ˜¯åªä¿®æ”¹<code>sum</code>ï¼Œå…¶ä»–å°±å’Œçº¿æ®µæ ‘æ²¡å•¥åŒºåˆ«äº†ã€‚</p>
<p>ç›¸æ¯”LCTçš„æ¨¡ç‰ˆï¼Œåªæ˜¯ä¿®æ”¹äº†<code>pushdown</code>å’Œ<code>getdown</code>ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P1501.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P1501</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">51061</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LCT</span> &#123;</span><br><span class="line">    <span class="type">int</span> fa[MAXN], ch[MAXN][<span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> val[MAXN], sum[MAXN], siz[MAXN];</span><br><span class="line">    <span class="type">int</span> tag[MAXN], add[MAXN], mul[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> f, <span class="type">int</span> w)</span> </span>&#123; fa[x] = f, (~w) &amp;&amp; (ch[f][w] = x); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        val[x] = sum[x] = siz[x] = mul[x] = <span class="number">1</span>;</span><br><span class="line">        tag[x] = add[x] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        siz[x] = siz[ch[x][<span class="number">0</span>]] + siz[ch[x][<span class="number">1</span>]] + <span class="number">1</span>;</span><br><span class="line">        sum[x] = (sum[ch[x][<span class="number">0</span>]] + sum[ch[x][<span class="number">1</span>]] + val[x]) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ch[fa[x]][<span class="number">0</span>] == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (ch[fa[x]][<span class="number">1</span>] == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getdown</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> vm, <span class="type">int</span> va)</span> </span>&#123;</span><br><span class="line">        mul[x] = mul[x] * vm % MOD;</span><br><span class="line">        add[x] = (add[x] * vm + va) % MOD;</span><br><span class="line">        val[x] = (val[x] * vm + va) % MOD;</span><br><span class="line">        sum[x] = (sum[x] * vm + va * siz[x]) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mul[x] != <span class="number">1</span> || add[x] != <span class="number">0</span> || tag[x]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (tag[x])</span><br><span class="line">                <span class="built_in">swap</span>(ch[x][<span class="number">0</span>], ch[x][<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (ch[x][<span class="number">0</span>])</span><br><span class="line">                <span class="built_in">getdown</span>(ch[x][<span class="number">0</span>], mul[x], add[x]), tag[ch[x][<span class="number">0</span>]] ^= tag[x];</span><br><span class="line">            <span class="keyword">if</span> (ch[x][<span class="number">1</span>])</span><br><span class="line">                <span class="built_in">getdown</span>(ch[x][<span class="number">1</span>], mul[x], add[x]), tag[ch[x][<span class="number">1</span>]] ^= tag[x];</span><br><span class="line">            mul[x] = <span class="number">1</span>, add[x] = tag[x] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushall</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (~<span class="built_in">get</span>(x))</span><br><span class="line">            <span class="built_in">pushall</span>(fa[x]);</span><br><span class="line">        <span class="built_in">pushdown</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> y = fa[x], z = fa[y], w = <span class="built_in">get</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (~w)</span><br><span class="line">            <span class="built_in">connect</span>(ch[x][w ^ <span class="number">1</span>], y, w);</span><br><span class="line">        <span class="built_in">connect</span>(x, z, <span class="built_in">get</span>(y));</span><br><span class="line">        <span class="built_in">connect</span>(y, x, w ^ <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">pushup</span>(y);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">pushall</span>(x);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> f = fa[x]; f = fa[x], ~<span class="built_in">get</span>(x); <span class="built_in">rotate</span>(x))</span><br><span class="line">            <span class="keyword">if</span> (~<span class="built_in">get</span>(f))</span><br><span class="line">                <span class="built_in">rotate</span>(<span class="built_in">get</span>(f) == <span class="built_in">get</span>(x) ? f : x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> pre = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) &#123;</span><br><span class="line">            <span class="built_in">splay</span>(x);</span><br><span class="line">            ch[x][<span class="number">1</span>] = pre;</span><br><span class="line">            <span class="built_in">pushup</span>(x);</span><br><span class="line">            pre = x;</span><br><span class="line">            x = fa[x];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x);</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        tag[x] ^= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x);</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">while</span> (ch[x][<span class="number">0</span>])</span><br><span class="line">            <span class="built_in">pushdown</span>(x), x = ch[x][<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">makeroot</span>(x);</span><br><span class="line">        <span class="built_in">access</span>(y);</span><br><span class="line">        <span class="built_in">splay</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">makeroot</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">findroot</span>(y) == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        fa[x] = y;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">findroot</span>(x) != <span class="built_in">findroot</span>(y))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">split</span>(x, y);</span><br><span class="line">        <span class="keyword">if</span> (fa[x] != y || ch[x][<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        fa[x] = ch[y][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, q;</span><br><span class="line">LCT lct;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        lct.<span class="built_in">clear</span>(i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        lct.<span class="built_in">link</span>(u, v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="type">char</span> op = <span class="built_in">getchar</span>();</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="string">&#x27;+&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> u, v, c;</span><br><span class="line">            <span class="built_in">read</span>(u), <span class="built_in">read</span>(v), <span class="built_in">read</span>(c);</span><br><span class="line">            lct.<span class="built_in">split</span>(u, v);</span><br><span class="line">            lct.<span class="built_in">getdown</span>(v, <span class="number">1</span>, c);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> u1, v1, u2, v2;</span><br><span class="line">            <span class="built_in">read</span>(u1), <span class="built_in">read</span>(v1), <span class="built_in">read</span>(u2), <span class="built_in">read</span>(v2);</span><br><span class="line">            lct.<span class="built_in">cut</span>(u1, v1);</span><br><span class="line">            lct.<span class="built_in">link</span>(u2, v2);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">            <span class="type">int</span> u, v, c;</span><br><span class="line">            <span class="built_in">read</span>(u), <span class="built_in">read</span>(v), <span class="built_in">read</span>(c);</span><br><span class="line">            lct.<span class="built_in">split</span>(u, v);</span><br><span class="line">            lct.<span class="built_in">getdown</span>(v, c, <span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> u, v;</span><br><span class="line">            <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">            lct.<span class="built_in">split</span>(u, v);</span><br><span class="line">            <span class="built_in">write</span>(lct.sum[v]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3690 ã€æ¨¡ç‰ˆã€‘åŠ¨æ€æ ‘ï¼ˆLink Cut Treeï¼‰</title>
    <url>/2022/01/23/sol-p3690/</url>
    <content><![CDATA[<h2 id="P3690-ã€æ¨¡ç‰ˆã€‘åŠ¨æ€æ ‘ï¼ˆLink-Cut-Treeï¼‰"><a href="#P3690-ã€æ¨¡ç‰ˆã€‘åŠ¨æ€æ ‘ï¼ˆLink-Cut-Treeï¼‰" class="headerlink" title="P3690 ã€æ¨¡ç‰ˆã€‘åŠ¨æ€æ ‘ï¼ˆLink Cut Treeï¼‰"></a>P3690 ã€æ¨¡ç‰ˆã€‘åŠ¨æ€æ ‘ï¼ˆLink Cut Treeï¼‰</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3690">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p><del>WCå®åœ¨æ˜¯å¤ªæ— èŠå­</del></p>
<p>ä»Šå¤©æ˜¯å†¬ä»¤è¥çš„ç¬¬ä¸€å¤©ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹LCTå§ï¼ˆé›¾</p>
<h4 id="å¼•å…¥-amp-å®šä¹‰"><a href="#å¼•å…¥-amp-å®šä¹‰" class="headerlink" title="å¼•å…¥&amp;å®šä¹‰"></a>å¼•å…¥&amp;å®šä¹‰</h4><p>Link Cut Treeï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¯ä»¥åŠ¨æ€ç»´æŠ¤æ ‘ä¸Šè·¯å¾„æƒå€¼å’Œã€æ ‘ä¸Šè¿è¾¹ä¸æ–­è¾¹æ“ä½œçš„ä¸€ç§æ•°æ®ç»“æ„ã€‚</p>
<p>è¯´åˆ°ç»´æŠ¤æ ‘ä¸Šè·¯å¾„æƒå€¼å’Œï¼Œé¦–å…ˆæƒ³åˆ°çš„åº”è¯¥å°±æ˜¯æ ‘é“¾å‰–åˆ†äº†ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šé€‰æ‹©ç”¨$O(n \log n)$çš„é‡é“¾å‰–åˆ†ã€‚ä½†æ˜¯åœ¨åŠ¨æ€æ ‘ä¸Šï¼Œé‡é“¾éšæ—¶ä¼šæ”¹å˜ï¼Œä½¿ç”¨é‡é“¾å‰–åˆ†å°±ä¸è¡Œäº†ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¾—ä¸é‡‡ç”¨æ›´ä¸ºæš´åŠ›çš„å®é“¾å‰–åˆ†ã€‚ä¸è€ƒè™‘å„å„¿å­çš„å­æ ‘å¤§å°ï¼Œç›´æ¥éšä¾¿å–ä¸€ä¸ªå„¿å­ä¸çˆ¶äº²è¿æ¥æˆä¸€æ¡é“¾ã€‚äºæ˜¯æ ‘çš„å½¢æ€å˜åŒ–å°±ä¸ä¼šå½±å“å¤æ‚åº¦ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(n^2)$çš„ã€‚</p>
<p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆæ•°æ®ç»“æ„å¯ä»¥å¾ˆå¥½åœ°ç»´æŠ¤è¿™æ ·çš„å®é“¾å‘¢ï¼Ÿè€ƒè™‘åˆ°ä¸€æ¡é“¾ä¸Šçš„èŠ‚ç‚¹æ·±åº¦éƒ½æ˜¯é€’å¢çš„ï¼Œä¸å¦¨ç”¨Splayæ¥ç»´æŠ¤æ¯æ¡é“¾ï¼Œè€ŒSplayçš„ä¸­åºéå†å°±æ˜¯æ•´æ¡é“¾ä»å¤´åˆ°å°¾çš„éå†ã€‚</p>
<p>å¦‚æ­¤æˆ‘ä»¬å¯ä»¥å°†ä¸€æ£µæ ‘ï¼ˆæ£®æ—ï¼‰è½¬åŒ–ä¸ºè‹¥å¹²æ¡é“¾ï¼Œæ¯æ¡é“¾ç”¨Splayæ¥ç»´æŠ¤ï¼Œæˆ‘ä»¬ç§°è¿™æ ·å½¢æˆçš„æ ‘å«åšè¾…åŠ©æ ‘ï¼ˆæ£®æ—ï¼‰ã€‚å¦‚ä¸‹å›¾ä¸­çš„ä¾‹å­ï¼ˆåŸæ ‘ï¼‰ï¼š</p>
<p><img src="tree-origin.png" alt="åŸæ ‘"></p>
<p>å…¶ä¸­å®çº¿è¡¨ç¤ºçš„æ˜¯éšæœºåˆ†é…çš„å®è¾¹ã€‚</p>
<p>å®ƒçš„è¾…åŠ©æ ‘å½¢æ€å¦‚ä¸‹ï¼š</p>
<p><img src="tree-aux.png" alt="è¾…åŠ©æ ‘"></p>
<p>åŸæ ‘ä¸­çš„å®é“¾éƒ½åœ¨åŒä¸€æ£µSplayä¸­ï¼Œè€ŒåŸæ ‘ä¸­çš„è™šé“¾åªæœ‰å„¿å­æŒ‡å‘çˆ¶äº²ï¼Œæ²¡æœ‰çˆ¶äº²æŒ‡å‘å„¿å­ã€‚</p>
<p>æ³¨æ„ï¼šè¾…åŠ©æ ‘çš„æŒ‡å‘ä¸ç­‰äºåŸæ ‘ä¸­çš„æŒ‡å‘ï¼Œè¾…åŠ©æ ‘çš„æ ¹ä¹Ÿä¸ç­‰äºåŸæ ‘çš„æ ¹ï¼</p>
<h4 id="æ•°ç»„-amp-å‡½æ•°"><a href="#æ•°ç»„-amp-å‡½æ•°" class="headerlink" title="æ•°ç»„&amp;å‡½æ•°"></a>æ•°ç»„&amp;å‡½æ•°</h4><p>é¦–å…ˆå®šä¹‰è¦ç”¨çš„æ•°ç»„ï¼š</p>
<ul>
<li><code>fa[x]</code> $x$åœ¨<strong>è¾…åŠ©æ ‘</strong>ä¸Šçš„çˆ¶èŠ‚ç‚¹</li>
<li><code>ch[x][0/1]</code> $x$åœ¨<strong>Splay</strong>ä¸­çš„å·¦å³å„¿å­</li>
<li><code>val[x]</code> $x$çš„æƒå€¼</li>
<li><code>sum[x]</code> $x$æ‰€åœ¨<strong>Splay</strong>çš„å­æ ‘ä¸­çš„æƒå€¼å’Œ</li>
<li><code>tag[x]</code> $x$èŠ‚ç‚¹çš„ç¿»è½¬æ ‡è®°ï¼ˆåé¢ä¼šæåˆ°ï¼‰</li>
</ul>
<p>éœ€è¦çš„å‡½æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>pushup(x)</code> æ›´æ–°èŠ‚ç‚¹æƒå€¼ï¼Œä¸å¤šè¯´äº†</li>
<li><code>pushdown(x)</code> ä¸‹ä¼ ç¿»è½¬æ ‡è®°</li>
<li><code>pushall(x)</code> å°†$x$åœ¨Splayä¸­åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„å…¨éƒ¨ä¸‹ä¼ æ ‡è®°</li>
<li><code>connect(x, f, w)</code> Splayæ“ä½œï¼šè¿æ¥$x$ä¸º$f$çš„$w$å„¿å­ï¼ˆ$w=-1$è¡¨ç¤ºè™šè¾¹ä¸Šçš„å„¿å­ï¼‰</li>
<li><code>get(x)</code> è·å–$x$æ˜¯å“ªç§å„¿å­</li>
<li><code>rotate(x)</code> Splayæ“ä½œï¼šæ—‹è½¬</li>
<li><code>splay(x)</code> Splayæ“ä½œï¼šæ—‹è½¬åˆ°æ ¹</li>
<li><code>access(x)</code> LCTçš„æ ¸å¿ƒï¼šå°†$x$ä¸æ ¹æ”¾åˆ°åŒä¸€æ¡å®é“¾ä¸­</li>
<li><code>makeroot(x)</code> å°†$x$å˜æˆåŸæ ‘çš„æ ¹</li>
<li><code>split(x, y)</code> å°†$x$åˆ°$y$çš„è·¯å¾„æ”¾åˆ°åŒä¸€æ¡å®é“¾ä¸­</li>
<li><code>findroot(x)</code> æ‰¾åˆ°$x$æ‰€åœ¨å®é“¾çš„é“¾å¤´</li>
<li><code>link(x, y)</code> è¿æ¥$x$åˆ°$y$</li>
<li><code>cut(x, y)</code> æ–­å¼€$x$åˆ°$y$</li>
</ul>
<h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><h5 id="pushup-x"><a href="#pushup-x" class="headerlink" title="pushup(x)"></a>pushup(x)</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ›´æ–°sum</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è§†æƒ…å†µè€Œå®šï¼Œæœ¬é¢˜ä¸ºå¼‚æˆ–å’Œ</span></span><br><span class="line">    sum[x] = sum[ch[x][<span class="number">0</span>]] ^ sum[ch[x][<span class="number">1</span>]] ^ val[x];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="pushdown-x"><a href="#pushdown-x" class="headerlink" title="pushdown(x)"></a>pushdown(x)</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ ‡è®°ä¸‹ä¼ </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tag[x]) &#123;</span><br><span class="line">        <span class="built_in">swap</span>(ch[x][<span class="number">0</span>], ch[x][<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (ch[x][<span class="number">0</span>])</span><br><span class="line">            tag[ch[x][<span class="number">0</span>]] ^= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (ch[x][<span class="number">1</span>])</span><br><span class="line">            tag[ch[x][<span class="number">1</span>]] ^= <span class="number">1</span>;</span><br><span class="line">        tag[x] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="pushall-x"><a href="#pushall-x" class="headerlink" title="pushall(x)"></a>pushall(x)</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å®ç°å³å¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushall</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (~<span class="built_in">get</span>(x))</span><br><span class="line">        <span class="built_in">pushall</span>(fa[x]);</span><br><span class="line">    <span class="built_in">pushdown</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="connect-x-f-w"><a href="#connect-x-f-w" class="headerlink" title="connect(x, f, w)"></a>connect(x, f, w)</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‹åˆ°ä¸€è¡Œ</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> f, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">    fa[x] = f, (~w) &amp;&amp; (ch[f][w] = x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="get-x"><a href="#get-x" class="headerlink" title="get(x)"></a>get(x)</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªå‹ä¸äº†</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ch[fa[x]][<span class="number">0</span>] == x)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (ch[fa[x]][<span class="number">1</span>] == x)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="rotate-x"><a href="#rotate-x" class="headerlink" title="rotate(x)"></a>rotate(x)</h5><p>å’Œæ™®é€šçš„splayä¸ä¸€æ ·äº†ï¼Œè¦åˆ¤æ–­è™šè¾¹</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> y = fa[x], z = fa[y], w = <span class="built_in">get</span>(x);</span><br><span class="line">    <span class="keyword">if</span> (~w)</span><br><span class="line">        <span class="built_in">connect</span>(ch[x][w ^ <span class="number">1</span>], y, w);</span><br><span class="line">    <span class="built_in">connect</span>(x, z, <span class="built_in">get</span>(y));</span><br><span class="line">    <span class="built_in">connect</span>(y, x, w ^ <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">pushup</span>(y);</span><br><span class="line">    <span class="built_in">pushup</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="splay-x"><a href="#splay-x" class="headerlink" title="splay(x)"></a>splay(x)</h5><p>ç¬¬ä¸€è¡Œè¦å…ˆå°†ä¸Šæ–¹çš„æ ‡è®°éƒ½ä¸‹ä¼ </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">pushall</span>(x);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> f = fa[x]; f = fa[x], ~<span class="built_in">get</span>(x); <span class="built_in">rotate</span>(x))</span><br><span class="line">        <span class="keyword">if</span> (~<span class="built_in">get</span>(f))</span><br><span class="line">            <span class="built_in">rotate</span>(<span class="built_in">get</span>(f) == <span class="built_in">get</span>(x) ? f : x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="access-x"><a href="#access-x" class="headerlink" title="access(x)"></a>access(x)</h5><p><img src="tree-aux.png" alt="è¾…åŠ©æ ‘"></p>
<p>è€ƒè™‘å°†ä¸Šå›¾çš„èŠ‚ç‚¹$9$ä¸æ ¹èŠ‚ç‚¹$1$æ‰“é€šã€‚</p>
<p>å› æ­¤è¦å…ˆå°†$9$è½¬åˆ°å½“å‰splayçš„æ ¹ï¼ˆå¦‚å›¾ï¼‰ã€‚</p>
<p><img src="tree-splayed.png" alt="splayåçš„è¾…åŠ©æ ‘"></p>
<p>è€Œæ ¹æ®è¾…åŠ©æ ‘ä¸Šé“¾çš„æ€§è´¨ï¼Œ$9$ã€$13$å’Œ$10$ä¸åº”è¯¥åœ¨ä¸€æ¡é“¾ä¸Šï¼Œäºæ˜¯å°†$9$ä¸$13$æ–­å¼€æˆè™šé“¾ï¼ˆä»çˆ¶äº²ä¸­ç§»é™¤æŒ‡å‘å³å¯ï¼‰ï¼ŒåŒæ—¶å°†ä¸‹æ–¹ä¸$x$è¿æ¥çš„å¦ä¸€æ£µsplayè¿æ¥ï¼ˆ<code>ch[x][1]:=pre</code>ï¼‰ã€‚</p>
<p>ä»¥æ­¤ç±»æ¨ï¼Œä¸€ç›´å¾€ä¸Šé‡å¤æ­¤æ“ä½œç›´åˆ°æ ¹ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> pre = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (x) &#123;</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        ch[x][<span class="number">1</span>] = pre;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">        pre = x;</span><br><span class="line">        x = fa[x];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="makeroot-x"><a href="#makeroot-x" class="headerlink" title="makeroot(x)"></a>makeroot(x)</h5><p>è®©$x$æˆä¸ºæ–°çš„åŸæ ‘çš„æ ¹ã€‚å°†$x$è½¬åˆ°æ ¹èŠ‚ç‚¹çš„splayä¸­ï¼Œç„¶åè®©$x$æˆä¸ºæ ¹èŠ‚ç‚¹ã€‚</p>
<p>ä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œ$x$æ‰€åœ¨çš„splayæ ‘å°±ä¹±æ‰äº†ï¼Œå› ä¸ºæ— æ³•å†ä¿è¯æ·±åº¦é€’å¢ã€‚åŒæ—¶å‘ç°ç”±äºåœ¨<code>access(x)</code>ä¹‹å$x$çš„å³å„¿å­è¢«æ¸…ç©ºäº†ï¼Œæ‰€ä»¥å°†è¯¥splayç¿»è½¬å°±å¾—åˆ°æ–°çš„æŒ‰æ·±åº¦é€’å¢çš„splayï¼ˆä»”ç»†æƒ³æƒ³æ˜¯ä¸æ˜¯ï¼‰ã€‚äºæ˜¯ä»£ç å°±å‡ºæ¥äº†ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">access</span>(x);</span><br><span class="line">    <span class="built_in">splay</span>(x);</span><br><span class="line">    tag[x] ^= <span class="number">1</span>; <span class="comment">// è¿™æ˜¯ç¿»è½¬çš„æ ‡è®°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="split-x-y"><a href="#split-x-y" class="headerlink" title="split(x, y)"></a>split(x, y)</h5><p>å°†$x$æˆä¸ºåŸæ ‘çš„æ ¹ï¼ˆåŒæ—¶æ˜¯è¯¥splayçš„æ·±åº¦æœ€å°èŠ‚ç‚¹ï¼‰ï¼Œå†å°†$y$ä¸$x$æ‰“é€šï¼Œæ—‹è½¬$y$åˆ°è¯¥splayçš„æ ¹ï¼Œæ˜¾ç„¶$y$çš„å½“å‰$sum$å€¼å°±æ˜¯$x$åˆ°$y$è·¯å¾„çš„$sum$ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="built_in">access</span>(y);</span><br><span class="line">    <span class="built_in">splay</span>(y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="findroot-x"><a href="#findroot-x" class="headerlink" title="findroot(x)"></a>findroot(x)</h5><p>å°†$x$ä¸æ ¹æ‰“é€šï¼ˆ<code>access(x)</code>ï¼‰ï¼Œæ˜¾ç„¶splayæœ€å·¦è¾¹çš„èŠ‚ç‚¹å°±æ˜¯æ ¹äº†ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">access</span>(x);</span><br><span class="line">    <span class="built_in">splay</span>(x);</span><br><span class="line">    <span class="keyword">while</span> (ch[x][<span class="number">0</span>])</span><br><span class="line">        <span class="built_in">pushdown</span>(x), x = ch[x][<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">splay</span>(x);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="link-x-y"><a href="#link-x-y" class="headerlink" title="link(x, y)"></a>link(x, y)</h5><p>å…ˆåˆ¤æ–­$x$ä¸$y$æ˜¯å¦è”é€šï¼Œç±»ä¼¼å¹¶æŸ¥é›†çš„æ–¹æ³•ã€‚</p>
<p>ç„¶å$y$è½¬åˆ°æ ¹ï¼Œå°†$x$æŒ‡å‘$y$ï¼ˆæ³¨æ„ä¸è¦è®©çˆ¶äº²$y$æŒ‡å‘å„¿å­$x$ï¼‰ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">findroot</span>(y) == x)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    fa[x] = y;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="cut-x-y"><a href="#cut-x-y" class="headerlink" title="cut(x, y)"></a>cut(x, y)</h5><p>è¿˜æ˜¯å…ˆåˆ¤æ–­$x$ä¸$y$åœ¨åŒä¸€ä¸ªè”é€šå—ã€‚</p>
<p>å°†$x$åˆ°$y$çš„è·¯å¾„å–å‡ºï¼Œå¹¶åˆ¤æ–­$x$ä¸$y$æ˜¯å¦ç›´æ¥è¿æ¥ã€‚</p>
<p>å¦‚æœç›´æ¥è¿æ¥ï¼Œç›´æ¥æ–­å¼€å³å¯ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">findroot</span>(x) != <span class="built_in">findroot</span>(y))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">split</span>(x, y);</span><br><span class="line">    <span class="keyword">if</span> (fa[x] != y || ch[x][<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    fa[x] = ch[y][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼ŒLCTçš„å„å‡½æ•°å®ç°å°±è®²å®Œäº†ï¼Œä¸‹é¢æ”¾å‡ºä¸€ä¸ªå°è£…å¥½çš„æ¨¡ç‰ˆï¼š</p>
<h4 id="æ¨¡ç‰ˆ"><a href="#æ¨¡ç‰ˆ" class="headerlink" title="æ¨¡ç‰ˆ"></a>æ¨¡ç‰ˆ</h4><p>ç†è®ºæ—¶é—´å¤æ‚åº¦æ˜¯$O(n \log n)$ï¼ˆæˆ‘ä¹Ÿä¸ä¼šè¯æ˜ï¼‰ï¼Œä½†æ˜¯<strong>å¸¸æ•°æå¤§</strong>ï¼ˆå¬è¯´èƒ½æœ‰$20$ï¼Ÿï¼‰ï¼Œæ…ç”¨ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LCT</span> &#123;</span><br><span class="line">    <span class="type">int</span> fa[MAXN], ch[MAXN][<span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> val[MAXN], sum[MAXN], tag[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; sum[x] = sum[ch[x][<span class="number">0</span>]] ^ sum[ch[x][<span class="number">1</span>]] ^ val[x]; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> f, <span class="type">int</span> w)</span> </span>&#123; fa[x] = f, (~w) &amp;&amp; (ch[f][w] = x); &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ch[fa[x]][<span class="number">0</span>] == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (ch[fa[x]][<span class="number">1</span>] == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tag[x]) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(ch[x][<span class="number">0</span>], ch[x][<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (ch[x][<span class="number">0</span>])</span><br><span class="line">                tag[ch[x][<span class="number">0</span>]] ^= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (ch[x][<span class="number">1</span>])</span><br><span class="line">                tag[ch[x][<span class="number">1</span>]] ^= <span class="number">1</span>;</span><br><span class="line">            tag[x] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushall</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (~<span class="built_in">get</span>(x))</span><br><span class="line">            <span class="built_in">pushall</span>(fa[x]);</span><br><span class="line">        <span class="built_in">pushdown</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> y = fa[x], z = fa[y], w = <span class="built_in">get</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (~w)</span><br><span class="line">            <span class="built_in">connect</span>(ch[x][w ^ <span class="number">1</span>], y, w);</span><br><span class="line">        <span class="built_in">connect</span>(x, z, <span class="built_in">get</span>(y));</span><br><span class="line">        <span class="built_in">connect</span>(y, x, w ^ <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">pushup</span>(y);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">pushall</span>(x);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> f = fa[x]; f = fa[x], ~<span class="built_in">get</span>(x); <span class="built_in">rotate</span>(x))</span><br><span class="line">            <span class="keyword">if</span> (~<span class="built_in">get</span>(f))</span><br><span class="line">                <span class="built_in">rotate</span>(<span class="built_in">get</span>(f) == <span class="built_in">get</span>(x) ? f : x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> pre = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) &#123;</span><br><span class="line">            <span class="built_in">splay</span>(x);</span><br><span class="line">            ch[x][<span class="number">1</span>] = pre;</span><br><span class="line">            <span class="built_in">pushup</span>(x);</span><br><span class="line">            pre = x;</span><br><span class="line">            x = fa[x];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x);</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        tag[x] ^= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">makeroot</span>(x);</span><br><span class="line">        <span class="built_in">access</span>(y);</span><br><span class="line">        <span class="built_in">splay</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x);</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">while</span> (ch[x][<span class="number">0</span>])</span><br><span class="line">            <span class="built_in">pushdown</span>(x), x = ch[x][<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">makeroot</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">findroot</span>(y) == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        fa[x] = y;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">findroot</span>(x) != <span class="built_in">findroot</span>(y))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">split</span>(x, y);</span><br><span class="line">        <span class="keyword">if</span> (fa[x] != y || ch[x][<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        fa[x] = ch[y][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3690.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3690</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LCT</span> &#123;</span><br><span class="line">    <span class="type">int</span> fa[MAXN], ch[MAXN][<span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> val[MAXN], sum[MAXN], tag[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; sum[x] = sum[ch[x][<span class="number">0</span>]] ^ sum[ch[x][<span class="number">1</span>]] ^ val[x]; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> f, <span class="type">int</span> w)</span> </span>&#123; fa[x] = f, (~w) &amp;&amp; (ch[f][w] = x); &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ch[fa[x]][<span class="number">0</span>] == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (ch[fa[x]][<span class="number">1</span>] == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tag[x]) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(ch[x][<span class="number">0</span>], ch[x][<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (ch[x][<span class="number">0</span>])</span><br><span class="line">                tag[ch[x][<span class="number">0</span>]] ^= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (ch[x][<span class="number">1</span>])</span><br><span class="line">                tag[ch[x][<span class="number">1</span>]] ^= <span class="number">1</span>;</span><br><span class="line">            tag[x] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushall</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (~<span class="built_in">get</span>(x))</span><br><span class="line">            <span class="built_in">pushall</span>(fa[x]);</span><br><span class="line">        <span class="built_in">pushdown</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> y = fa[x], z = fa[y], w = <span class="built_in">get</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (~w)</span><br><span class="line">            <span class="built_in">connect</span>(ch[x][w ^ <span class="number">1</span>], y, w);</span><br><span class="line">        <span class="built_in">connect</span>(x, z, <span class="built_in">get</span>(y));</span><br><span class="line">        <span class="built_in">connect</span>(y, x, w ^ <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">pushup</span>(y);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">pushall</span>(x);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> f = fa[x]; f = fa[x], ~<span class="built_in">get</span>(x); <span class="built_in">rotate</span>(x))</span><br><span class="line">            <span class="keyword">if</span> (~<span class="built_in">get</span>(f))</span><br><span class="line">                <span class="built_in">rotate</span>(<span class="built_in">get</span>(f) == <span class="built_in">get</span>(x) ? f : x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> pre = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) &#123;</span><br><span class="line">            <span class="built_in">splay</span>(x);</span><br><span class="line">            ch[x][<span class="number">1</span>] = pre;</span><br><span class="line">            <span class="built_in">pushup</span>(x);</span><br><span class="line">            pre = x;</span><br><span class="line">            x = fa[x];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x);</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        tag[x] ^= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">makeroot</span>(x);</span><br><span class="line">        <span class="built_in">access</span>(y);</span><br><span class="line">        <span class="built_in">splay</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x);</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">while</span> (ch[x][<span class="number">0</span>])</span><br><span class="line">            <span class="built_in">pushdown</span>(x), x = ch[x][<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">makeroot</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">findroot</span>(y) == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        fa[x] = y;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">findroot</span>(x) != <span class="built_in">findroot</span>(y))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">split</span>(x, y);</span><br><span class="line">        <span class="keyword">if</span> (fa[x] != y || ch[x][<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        fa[x] = ch[y][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, q;</span><br><span class="line">LCT lct;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(lct.val[i]);</span><br><span class="line">        lct.sum[i] = lct.val[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="type">int</span> op, x, y;</span><br><span class="line">        <span class="built_in">read</span>(op), <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">0</span>) &#123;</span><br><span class="line">            lct.<span class="built_in">split</span>(x, y);</span><br><span class="line">            <span class="built_in">write</span>(lct.sum[y]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="number">1</span>) &#123;</span><br><span class="line">            lct.<span class="built_in">link</span>(x, y);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="number">2</span>) &#123;</span><br><span class="line">            lct.<span class="built_in">cut</span>(x, y);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            lct.val[x] = y;</span><br><span class="line">            lct.<span class="built_in">splay</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF297E Mystic Carvings</title>
    <url>/2022/01/21/sol-cf297e/</url>
    <content><![CDATA[<h2 id="CF297E-Mystic-Carvings"><a href="#CF297E-Mystic-Carvings" class="headerlink" title="CF297E Mystic Carvings"></a>CF297E Mystic Carvings</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF297E">é¢˜ç›®é“¾æ¥</a></p>
<p><del>å·æ¥hbçš„é¢˜ï¼ˆå¼ºçƒˆå®‰åˆ©codeforcesçš„friendsåŠŸèƒ½ï¼‰</del></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>åœ¨åœ†ä¸­è¿æ¥$3$æ¡ä¸åœ¨ç«¯ç‚¹å¤„ç›¸äº¤çš„å¼¦ï¼Œå…±æœ‰ä»¥ä¸‹$5$ç§æƒ…å†µï¼š</p>
<p><img src="add.png" alt="add"></p>
<p><img src="sub.png" alt="sub"></p>
<p>é‚£ä¹ˆç¬¬ä¸€è¡Œçš„$2$ç§æ˜¯åˆæ³•çš„ï¼Œç¬¬äºŒè¡Œçš„$3$ç§ä¸åˆæ³•ã€‚å‘ç°ç¬¬äºŒè¡Œçš„$3$ç§æ›´åŠ ä¾¿äºè®¡ç®—ï¼Œäºæ˜¯æƒ³åˆ°ç”¨æ€»æ•°$\binom{n}{3}$å‡å»ä¸åˆæ³•çš„ã€‚</p>
<p>ç¬¬äºŒè¡Œç¬¬ä¸€ç§æƒ…å†µï¼Œæšä¸¾ä¸­é—´çš„ä¸€æ¡å¼¦ï¼Œé¢„å¤„ç†å‡ºæ¯æ¡å¼¦çš„ä¸¤ä¾§ä¸ä¸å…¶ç›¸äº¤çš„å¼¦çš„æ•°é‡ï¼Œè®¡ä¸º$ls_i$å’Œ$rs_i$ï¼Œç¬¬ä¸€ç§æƒ…å†µçš„è´¡çŒ®ä¸º</p>
<script type="math/tex; mode=display">
\sum_{i=1}^n ls_i \times rs_i</script><p>ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æƒ…å†µå¯ä»¥ä¸€èµ·è€ƒè™‘ã€‚è¿˜æ˜¯å…ˆæšä¸¾ä¸€æ¡å¼¦ï¼Œä¹‹åè¿˜éœ€è¦ä¸€æ¡ä¸å…¶ç›¸äº¤çš„å’Œä¸€æ¡ä¸å…¶ä¸ç›¸äº¤çš„å°±å¯ä»¥æ„é€ å‡ºç¬¬äºŒç§æˆ–ç¬¬ä¸‰ç§æƒ…å†µã€‚åŒæ—¶æ¯ç§æƒ…å†µä¼šè¢«è®¡ç®—$2$æ¬¡ï¼Œæ‰€ä»¥ç¬¬äºŒã€ä¸‰ç§æƒ…å†µçš„è´¡çŒ®ä¸º</p>
<script type="math/tex; mode=display">
\sum_{i=1}^n \frac{1}{2}(n-ls_i-rs_i-1)(ls_i+rs_i)</script><p>è‡³äºå¦‚ä½•æ±‚å‡º$ls_i$å’Œ$rs_i$ï¼Œç”¨æ ‘çŠ¶æ•°ç»„å’ŒCDQåˆ†æ²»éƒ½å¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF297E.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF297E</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">line</span> &#123;</span><br><span class="line">    <span class="type">int</span> l, r, id;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> line&amp; o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id &lt; o.id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, ls[MAXN], rs[MAXN], cnt[MAXN];</span><br><span class="line">line ln[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve1</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve1</span>(l, mid);</span><br><span class="line">    <span class="built_in">solve1</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="type">int</span> pos = l;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = mid + <span class="number">1</span>; i &lt;= r; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (pos &lt;= mid &amp;&amp; ln[pos].r &lt; ln[i].r)</span><br><span class="line">            pos++;</span><br><span class="line">        ls[ln[i].id] += pos - l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">inplace_merge</span>(ln + l, ln + mid + <span class="number">1</span>, ln + r + <span class="number">1</span>, [](<span class="type">const</span> line&amp; lhs, <span class="type">const</span> line&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.r &lt; rhs.r;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve2</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve2</span>(l, mid);</span><br><span class="line">    <span class="built_in">solve2</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="type">int</span> pos = l;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = mid + <span class="number">1</span>; i &lt;= r; ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (pos &lt;= mid &amp;&amp; ln[pos].r &gt; ln[i].r)</span><br><span class="line">            pos++;</span><br><span class="line">        rs[ln[i].id] += pos - l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">inplace_merge</span>(ln + l, ln + mid + <span class="number">1</span>, ln + r + <span class="number">1</span>, [](<span class="type">const</span> line&amp; lhs, <span class="type">const</span> line&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.r &gt; rhs.r;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(ln[i].l), <span class="built_in">read</span>(ln[i].r);</span><br><span class="line">        <span class="keyword">if</span> (ln[i].l &gt; ln[i].r)</span><br><span class="line">            <span class="built_in">swap</span>(ln[i].l, ln[i].r);</span><br><span class="line">        ln[i].id = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(ln + <span class="number">1</span>, ln + n + <span class="number">1</span>, [](<span class="type">const</span> line&amp; lhs, <span class="type">const</span> line&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.l &gt; rhs.l;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">solve1</span>(<span class="number">1</span>, n);</span><br><span class="line">    <span class="built_in">sort</span>(ln + <span class="number">1</span>, ln + n + <span class="number">1</span>, [](<span class="type">const</span> line&amp; lhs, <span class="type">const</span> line&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.l &lt; rhs.l;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">solve2</span>(<span class="number">1</span>, n);</span><br><span class="line">    <span class="built_in">fill</span>(cnt + <span class="number">1</span>, cnt + n + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ++cnt[ln[i].r];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n + n; ++i)</span><br><span class="line">        cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        rs[ln[i].id] += cnt[ln[i].l];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fill</span>(cnt + <span class="number">1</span>, cnt + n + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ++cnt[ln[i].l];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n + n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">        cnt[i] += cnt[i + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        rs[ln[i].id] += cnt[ln[i].r];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(ln + <span class="number">1</span>, ln + n + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        ans += ls[i] * rs[i] * <span class="number">2</span>;</span><br><span class="line">        ans += (n - ls[i] - rs[i] - <span class="number">1</span>) * (ls[i] + rs[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    ans = n * (n - <span class="number">1</span>) * (n - <span class="number">2</span>) / <span class="number">6</span> - ans / <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å¹´å¤´OJæ•°ç»„è¶Šç•Œéƒ½ä¸æŠ¥REæŠ¥WAçš„å—ï¼Ÿ</p>
]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4223 æœŸæœ›é€†åºå¯¹</title>
    <url>/2022/01/20/sol-p4223/</url>
    <content><![CDATA[<h2 id="P4223-æœŸæœ›é€†åºå¯¹"><a href="#P4223-æœŸæœ›é€†åºå¯¹" class="headerlink" title="P4223 æœŸæœ›é€†åºå¯¹"></a>P4223 æœŸæœ›é€†åºå¯¹</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4223">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æœŸæœ›ä¹˜ä¸Š$\binom{n}{2}^k$åï¼Œå°±å˜æˆäº†æ±‚æ‰€æœ‰æƒ…å†µçš„é€†åºå¯¹æ•°é‡çš„æ€»å’Œã€‚</p>
<p>è€ƒè™‘è®¡ç®—è´¡çŒ®ã€‚å‡è®¾æšä¸¾äº†ä¸¤ä¸ªä½ç½®$i$å’Œ$j$ï¼Œå…¶å˜æ¢å‰çš„åºåˆ—ä¸­å¯¹åº”çš„æ•°å­—ä¸º$x$å’Œ$y$ï¼Œé‚£ä¹ˆç»è¿‡$k$æ¬¡å˜æ¢ï¼Œåœ¨è¿™ä¸¤ä¸ªä½ç½®ä¸Šçš„æ•°å­—æœ‰$7$ä¸­å¯èƒ½çš„æƒ…å†µï¼š</p>
<script type="math/tex; mode=display">
\begin{matrix}
(x,y) & (y,x) & (x,t) & (y,t) & (t,x) & (t,y) & (t,t)
\end{matrix}</script><p>è€Œè¿™$7$ç§çŠ¶æ€ä¹‹é—´å¯ä»¥åœ¨$1$æ¬¡å˜æ¢ä¹‹ä¸­ç›¸äº’è½¬åŒ–ï¼Œæ‰€ä»¥è€ƒè™‘çŸ©é˜µå¿«é€Ÿå¹‚ã€‚</p>
<p>å…ˆåˆ—å‡ºè½¬ç§»çŸ©é˜µå¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{bmatrix}
f_i(x,y) & f_i(y,x) & f_i(x,t) & f_i(y,t) & f_i(t,x) & f_i(t,y) & f_i(t,t)
\end{bmatrix} \\
\times \\
\begin{bmatrix}
\binom{n-2}{2} & 1 & n-2 & 0 & 0 & n-2 & 0 \\
1 & \binom{n-2}{2} & 0 & n-2 & n-2 & 0 & 0 \\
1 & 0 & \binom{n-2}{2}+n-3 & 1 & 1 & 0 & n-3 \\
0 & 1 & 1 & \binom{n-2}{2}+n-3 & 0 & 1 & n-3 \\
0 & 1 & 1 & 0 & \binom{n-2}{2}+n-3 & 1 & n-3 \\
1 & 0 & 0 & 1 & 1 & \binom{n-2}{2}+n-3 & n-3 \\
0 & 0 & 1 & 1 & 1 & 1 & \binom{n}{2}-4 \\
\end{bmatrix} \\
= \\
\begin{bmatrix}
f_{i+1}(x,y) & f_{i+1}(y,x) & f_{i+1}(x,t) & f_{i+1}(y,t) & f_{i+1}(t,x) & f_{i+1}(t,y) & f_{i+1}(t,t)
\end{bmatrix} \\</script><p>ç®—å‡ºäº†æ¯ç§æƒ…å†µçš„æ•°é‡åï¼Œå¯ä»¥å¼€å§‹ç»Ÿè®¡ç­”æ¡ˆäº†ã€‚</p>
<p>è€ƒè™‘æšä¸¾å³ç«¯ç‚¹$a_j=y$ï¼Œé€šè¿‡æ ‘çŠ¶æ•°ç»„ç»Ÿè®¡å‡º$i<j$ä¸­$a_i<a_j$çš„æ•°å­—ä¸ªæ•°ã€æ¯ä¸ª$i-1$çš„å’Œä»¥åŠæ¯ä¸ª$n-i-1$çš„å’Œï¼Œåˆ†åˆ«è®¡ä¸º$lt_0$ï¼Œ$lt_1$å’Œ$lt_2$ï¼Œ$i<j$ä¸­$a_i>a_j$çš„é€šè¿‡è®¡ç®—æ±‚å‡ºå¹¶è®¡ä¸º$gt_0$ï¼Œ$gt_1$å’Œ$gt_2$ã€‚</p>
<ul>
<li>$(x,y)$: $p_0 \times gt_0$</li>
<li>$(y,x)$: $p_1 \times lt_0$</li>
<li>$(x,t)$: $p_2 \times \frac{gt_2+lt_1}{n-2}$</li>
<li>$(y,t)$: $p_3 \times \frac{lt_0(i-2)+gt_0(n-i)}{n-2}$</li>
<li>$(t,x)$: $p_4 \times \frac{gt_1+lt_2}{n-2}$</li>
<li>$(t,y)$: $p_5 \times \frac{gt_0(i-2)+lt_0(n-i)}{n-2}$</li>
</ul>
<p>$(t,t)$è¿™ç§æƒ…å†µæ”¾åœ¨æœ€åä¸€èµ·è€ƒè™‘ï¼Œè´¡çŒ®ä¸º$p_6 \times \frac{1}{2}\binom{n}{2}$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4223.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4223</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">binom2</span><span class="params">(<span class="type">int</span> x)</span></span>;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">MatrixType</span> &#123;</span><br><span class="line">    XY, YX, XT, YT, TX, TY, TT</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Matrix</span> &#123;</span><br><span class="line">    <span class="built_in">int</span> (*a)[<span class="number">7</span>];</span><br><span class="line">    <span class="built_in">Matrix</span>() &#123; a = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">7</span>][<span class="number">7</span>] &#123;&#125;; &#125;</span><br><span class="line">    <span class="built_in">Matrix</span>(<span class="type">int</span> n) &#123;</span><br><span class="line">        a = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">7</span>][<span class="number">7</span>] &#123;</span><br><span class="line">            &#123; <span class="built_in">binom2</span>(n - <span class="number">2</span>), <span class="number">1</span>, n - <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, n - <span class="number">2</span>, <span class="number">0</span> &#125;,</span><br><span class="line">            &#123; <span class="number">1</span>, <span class="built_in">binom2</span>(n - <span class="number">2</span>), <span class="number">0</span>, n - <span class="number">2</span>, n - <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span> &#125;,</span><br><span class="line">            &#123; <span class="number">1</span>, <span class="number">0</span>, <span class="built_in">binom2</span>(n - <span class="number">2</span>) + n - <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, n - <span class="number">3</span> &#125;,</span><br><span class="line">            &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="built_in">binom2</span>(n - <span class="number">2</span>) + n - <span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>, n - <span class="number">3</span> &#125;,</span><br><span class="line">            &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="built_in">binom2</span>(n - <span class="number">2</span>) + n - <span class="number">3</span>, <span class="number">1</span>, n - <span class="number">3</span> &#125;,</span><br><span class="line">            &#123; <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="built_in">binom2</span>(n - <span class="number">2</span>) + n - <span class="number">3</span>, n - <span class="number">3</span> &#125;,</span><br><span class="line">            &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="built_in">binom2</span>(n) - <span class="number">4</span> &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">7</span>; ++j)</span><br><span class="line">                a[i][j] %= MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span>* <span class="keyword">operator</span>[](<span class="type">int</span> i) &#123; <span class="keyword">return</span> a[i]; &#125;</span><br><span class="line">    <span class="keyword">friend</span> Matrix <span class="keyword">operator</span>*(<span class="type">const</span> Matrix&amp; lhs, <span class="type">const</span> Matrix&amp; rhs) &#123;</span><br><span class="line">        Matrix ret;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">7</span>; ++j)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">7</span>; ++k)</span><br><span class="line">                    ret.a[i][j] = <span class="built_in">add</span>(ret.a[i][j], lhs.a[i][k] * rhs.a[k][j] % MOD);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BinaryIndexTree</span> &#123;</span><br><span class="line">    <span class="type">int</span> c[MAXN], n;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123; n = m; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = x; i &lt;= n; i += (i &amp; -i))</span><br><span class="line">            c[i] = ::<span class="built_in">add</span>(c[i], v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = x; i; i -= (i &amp; -i))</span><br><span class="line">            ret = ::<span class="built_in">add</span>(ret, c[i]);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, k, a[MAXN], p[<span class="number">7</span>], lt[<span class="number">3</span>], gt[<span class="number">3</span>], sum[<span class="number">3</span>];</span><br><span class="line">BinaryIndexTree ltr[<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">mul</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * y % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">binom2</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * (x - <span class="number">1</span>) / <span class="number">2</span> % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x % MOD;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Matrix <span class="title">qpow</span><span class="params">(Matrix x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    Matrix ret;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; ++i)</span><br><span class="line">        ret.a[i][i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="function">Matrix <span class="title">base</span><span class="params">(n)</span>, ret</span>;</span><br><span class="line">    ret[<span class="number">0</span>][XY] = <span class="number">1</span>;</span><br><span class="line">    ret = ret * <span class="built_in">qpow</span>(base, k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; ++i)</span><br><span class="line">        p[i] = ret[<span class="number">0</span>][i];</span><br><span class="line">    ltr[<span class="number">0</span>].<span class="built_in">init</span>(n);</span><br><span class="line">    ltr[<span class="number">1</span>].<span class="built_in">init</span>(n);</span><br><span class="line">    ltr[<span class="number">2</span>].<span class="built_in">init</span>(n);</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>, inv = <span class="built_in">qpow</span>(n - <span class="number">2</span>, MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; ++j) &#123;</span><br><span class="line">            lt[j] = ltr[j].<span class="built_in">sum</span>(a[i]);</span><br><span class="line">            gt[j] = sum[j] - lt[j];</span><br><span class="line">        &#125;</span><br><span class="line">        ans = <span class="built_in">add</span>(ans, <span class="built_in">mul</span>(p[<span class="number">0</span>], gt[<span class="number">0</span>]));</span><br><span class="line">        ans = <span class="built_in">add</span>(ans, <span class="built_in">mul</span>(p[<span class="number">1</span>], lt[<span class="number">0</span>]));</span><br><span class="line">        ans = <span class="built_in">add</span>(ans, <span class="built_in">mul</span>(p[<span class="number">2</span>], <span class="built_in">add</span>(<span class="built_in">mul</span>(gt[<span class="number">2</span>], inv), <span class="built_in">mul</span>(lt[<span class="number">1</span>], inv))));</span><br><span class="line">        ans = <span class="built_in">add</span>(ans, <span class="built_in">mul</span>(p[<span class="number">3</span>], <span class="built_in">add</span>(<span class="built_in">mul</span>(lt[<span class="number">0</span>], <span class="built_in">mul</span>(i - <span class="number">2</span>, inv)), <span class="built_in">mul</span>(gt[<span class="number">0</span>], <span class="built_in">mul</span>(n - i, inv)))));</span><br><span class="line">        ans = <span class="built_in">add</span>(ans, <span class="built_in">mul</span>(p[<span class="number">4</span>], <span class="built_in">add</span>(<span class="built_in">mul</span>(gt[<span class="number">1</span>], inv), <span class="built_in">mul</span>(lt[<span class="number">2</span>], inv))));</span><br><span class="line">        ans = <span class="built_in">add</span>(ans, <span class="built_in">mul</span>(p[<span class="number">5</span>], <span class="built_in">add</span>(<span class="built_in">mul</span>(gt[<span class="number">0</span>], <span class="built_in">mul</span>(i - <span class="number">2</span>, inv)), <span class="built_in">mul</span>(lt[<span class="number">0</span>], <span class="built_in">mul</span>(n - i, inv)))));</span><br><span class="line">        ltr[<span class="number">0</span>].<span class="built_in">add</span>(a[i], <span class="number">1</span>);</span><br><span class="line">        ltr[<span class="number">1</span>].<span class="built_in">add</span>(a[i], i - <span class="number">1</span>);</span><br><span class="line">        ltr[<span class="number">2</span>].<span class="built_in">add</span>(a[i], n - i - <span class="number">1</span>);</span><br><span class="line">        sum[<span class="number">0</span>] = <span class="built_in">add</span>(sum[<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">        sum[<span class="number">1</span>] = <span class="built_in">add</span>(sum[<span class="number">1</span>], i - <span class="number">1</span>);</span><br><span class="line">        sum[<span class="number">2</span>] = <span class="built_in">add</span>(sum[<span class="number">2</span>], n - i - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ans = <span class="built_in">add</span>(ans, <span class="built_in">mul</span>(p[<span class="number">6</span>], <span class="built_in">mul</span>(<span class="built_in">binom2</span>(n), <span class="built_in">qpow</span>(<span class="number">2</span>, MOD - <span class="number">2</span>))));</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P5850 calc</title>
    <url>/2022/01/20/sol-p5850/</url>
    <content><![CDATA[<h2 id="P5850-calc"><a href="#P5850-calc" class="headerlink" title="P5850 calc"></a>P5850 calc</h2><span id="more"></span>
<p><del>åˆ«åšP4463ï¼Œæ¥åšP5850ï¼Œå¯ä»¥å°‘å†™ä¸€ä¸ªMTT</del></p>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P5850">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¦–å…ˆæƒ³åˆ°èƒ½æ„é€ ç”Ÿæˆå‡½æ•°ã€‚</p>
<script type="math/tex; mode=display">
F(x) = \prod_{t=1}^k (1 + tx)</script><p>ç­”æ¡ˆå°±æ˜¯$n! [x^n]F(x)$ï¼Œæ­£ç¡®æ€§æ˜¾ç„¶ã€‚</p>
<p>$k$å·¨å¤§ï¼ˆ$10^9$çº§åˆ«ï¼‰ï¼Œå¥—è·¯åœ°å°†$\prod$åŒ–ä¸º$\sum$ï¼š</p>
<script type="math/tex; mode=display">
F(x) = \exp \sum_{t=1}^k \ln(1+tx)</script><p>ä½¿ç”¨éº¦å…‹åŠ³æ—çº§æ•°å°†$\ln$åŒ–ç®€ï¼š</p>
<script type="math/tex; mode=display">
F(x) = \exp \sum_{t=1}^k {\sum_{j=1}^{+\infty}(-1)^{j-1}\frac{t^jx^j}{j}} \\
\ln F(x) = \sum_{t=1}^k {\sum_{j=1}^{+\infty}(-1)^{j-1}\frac{t^jx^j}{j}} \\
[x^n] \ln F(x) = (-1)^{n-1} \frac{1}{n} \sum_{t=1}^k t^n</script><p>å°†$\ln F(x)$æ¯é¡¹ç³»æ•°æ±‚å‡ºå†è¿›è¡Œå¤šé¡¹å¼$\exp$å¾—åˆ°$F(x)$ã€‚$\sum$å·¦è¾¹çš„éƒ¨åˆ†å¯ä»¥$O(1)$æ±‚å‡ºï¼Œå³è¾¹æ˜¯ä¸ªè‡ªç„¶æ•°å¹‚å’Œçš„å½¢å¼ã€‚ä»¤è‡ªç„¶æ•°å¹‚å’Œçš„<strong>æŒ‡æ•°ç”Ÿæˆå‡½æ•°</strong>ä¸º$S(x)$ï¼Œåˆ™æœ‰</p>
<script type="math/tex; mode=display">
[x^n] \ln F(x) = (-1)^{n-1} \frac{n!}{n} S(n) = (-1)^{n-1} (n-1)! S(n)</script><script type="math/tex; mode=display">
S(x) = \sum_{j=0}^{+\infty} \frac{x^j}{j!} \sum_{i=1}^k i^j
= \sum_{i=1}^k \sum_{j=0}^{+\infty} \frac{i^jx^j}{j!}</script><p>å‘ç°å³è¾¹ä¸€å¤§ä¸²å…¶å®æ˜¯$e^{ix}$çš„æ³°å‹’å±•å¼€å¼ã€‚</p>
<script type="math/tex; mode=display">
S(x) = \sum_{i=1}^k e^{ix}</script><p>è€Œä¸”æ˜¯ä¸ªç­‰æ¯”æ•°åˆ—æ±‚å’Œã€‚</p>
<script type="math/tex; mode=display">
S(x) = \frac{e^{(k+1)x}-e^x}{e^x-1} = \frac{\exp ((k+1)x) - \exp x}{\exp x - 1}</script><p>ä¼šå‘ç°åˆ†å­å’Œåˆ†æ¯çš„å¸¸æ•°é¡¹éƒ½æ˜¯$0$ï¼Œè€Œå¸¸æ•°é¡¹ä¸º$0$çš„å¤šé¡¹å¼æ²¡æœ‰é€†ï¼Œæ‰€ä»¥åˆ†å­åˆ†æ¯åŒæ—¶ä¹˜ä¸Š$\frac{1}{x}$å³å¯ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P5850.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P5850</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">namespace</span> fastio &#123;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> BUFFSIZ = <span class="number">1</span> &lt;&lt; <span class="number">21</span>;</span><br><span class="line"><span class="type">char</span> pbuf[BUFFSIZ], *pp = pbuf;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">flush</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fwrite</span>(pbuf, <span class="number">1</span>, BUFFSIZ, stdout), pp = pbuf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pc</span><span class="params">(<span class="type">char</span> ch)</span> </span>&#123;</span><br><span class="line">    (pp == pbuf + BUFFSIZ) ? <span class="built_in">flush</span>() : <span class="built_in">void</span>();</span><br><span class="line">    *pp++ = ch;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;  <span class="comment">// namespace fastio</span></span><br><span class="line"><span class="keyword">using</span> fastio::pc;</span><br><span class="line"><span class="keyword">using</span> fastio::flush;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">pc</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">pc</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> polynomial &#123;</span><br><span class="line"><span class="type">int</span> inv[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x -= y;</span><br><span class="line">    <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = <span class="number">1ll</span> * x * x % p)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = <span class="number">1ll</span> * ret * x % p;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span>* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                <span class="type">int</span> u = f[k], t = <span class="number">1ll</span> * g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                f[k] = <span class="built_in">add</span>(u, t), f[k + h / <span class="number">2</span>] = <span class="built_in">sub</span>(u, t);</span><br><span class="line">                g = <span class="number">1ll</span> * g * gn % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] = <span class="number">1ll</span> * f[i] * inv % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">polymul</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">const</span> <span class="type">int</span>* g, <span class="type">int</span> m, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tf[MAXN], tg[MAXN];</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n + m - <span class="number">1</span>)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">copy</span>(f, f + n, tf);</span><br><span class="line">    <span class="built_in">fill</span>(tf + n, tf + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">copy</span>(g, g + m, tg);</span><br><span class="line">    <span class="built_in">fill</span>(tg + m, tg + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(tf, len, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(tg, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        tf[i] = <span class="number">1ll</span> * tf[i] * tg[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(tf, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(tf, tf + n + m - <span class="number">1</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> n + m - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">polyinv</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tmp[MAXN];</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">fill</span>(ans, ans + len + len, <span class="number">0</span>);</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="built_in">qpow</span>(f[<span class="number">0</span>], MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">copy</span>(f, f + h, tmp);</span><br><span class="line">        <span class="built_in">fill</span>(tmp + h, tmp + h + h, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">ntt</span>(tmp, h + h, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">ntt</span>(ans, h + h, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; h + h; ++i)</span><br><span class="line">            ans[i] = <span class="number">1ll</span> * ans[i] * (<span class="number">2</span> - <span class="number">1ll</span> * ans[i] * tmp[i] % MOD + MOD) % MOD;</span><br><span class="line">        <span class="built_in">ntt</span>(ans, h + h, <span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">fill</span>(ans + h, ans + h + h, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">derivation</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i)</span><br><span class="line">        ans[i] = <span class="number">1ll</span> * f[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">    <span class="keyword">return</span> ans[n - <span class="number">1</span>] = <span class="number">0</span>, n - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">integral</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">        ans[i] = <span class="number">1ll</span> * f[i - <span class="number">1</span>] * inv[i] % MOD;</span><br><span class="line">    <span class="keyword">return</span> ans[<span class="number">0</span>] = <span class="number">0</span>, n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ln</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tf[MAXN], tg[MAXN];</span><br><span class="line">    <span class="built_in">derivation</span>(f, n, tf);</span><br><span class="line">    <span class="built_in">polyinv</span>(f, n, tg);</span><br><span class="line">    <span class="built_in">polymul</span>(tf, n - <span class="number">1</span>, tg, n, ans);</span><br><span class="line">    <span class="built_in">integral</span>(ans, n - <span class="number">1</span>, ans);</span><br><span class="line">    <span class="built_in">fill</span>(ans + n, ans + n + n, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">exp</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tmp[MAXN];</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">1</span>, ans[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= (n &lt;&lt; <span class="number">1</span>); h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">ln</span>(ans, h, tmp);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; h; ++i)</span><br><span class="line">            tmp[i] = <span class="built_in">add</span>(i == <span class="number">0</span>, <span class="built_in">sub</span>(f[i], tmp[i]));</span><br><span class="line">        <span class="built_in">polymul</span>(ans, h, tmp, h, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;  <span class="comment">// namespace polynomial</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> polynomial;</span><br><span class="line"><span class="type">int</span> k, m, ta[MAXN], tb[MAXN], tc[MAXN], ts[MAXN], fac[MAXN], ans[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(k), <span class="built_in">read</span>(m);</span><br><span class="line">    fac[<span class="number">0</span>] = inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        fac[i] = <span class="number">1ll</span> * fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; MAXN; ++i)</span><br><span class="line">        inv[i] = <span class="number">1ll</span> * (MOD - MOD / i) * inv[MOD % i] % MOD;</span><br><span class="line">    tc[<span class="number">1</span>] = (k + <span class="number">1</span>) % MOD;</span><br><span class="line">    <span class="built_in">exp</span>(tc, m + <span class="number">2</span>, ta);</span><br><span class="line">    tc[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">exp</span>(tc, m + <span class="number">2</span>, tb);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m + <span class="number">2</span>; ++i)</span><br><span class="line">        ta[i] = <span class="built_in">sub</span>(ta[i], tb[i]);</span><br><span class="line">    tb[<span class="number">0</span>] = <span class="built_in">sub</span>(tb[<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">        ta[i] = ta[i + <span class="number">1</span>], tb[i] = tb[i + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">polyinv</span>(tb, m + <span class="number">1</span>, tc);</span><br><span class="line">    <span class="built_in">polymul</span>(ta, m + <span class="number">1</span>, tc, m + <span class="number">1</span>, ts);</span><br><span class="line">    ts[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            ts[i] = <span class="built_in">add</span>(<span class="number">0</span>, <span class="number">1ll</span> * fac[i - <span class="number">1</span>] * ts[i] % MOD);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ts[i] = <span class="built_in">sub</span>(<span class="number">0</span>, <span class="number">1ll</span> * fac[i - <span class="number">1</span>] * ts[i] % MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exp</span>(ts, m + <span class="number">1</span>, ans);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">write</span>(<span class="number">1ll</span> * ans[i] * fac[i] % MOD), <span class="built_in">pc</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">flush</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>subtask1è¿‡äº†ï¼Œsubtask2ä¸€ç›´å¡å¸¸ï¼Œå¥½åƒå¸¸æ•°å¡åˆ°ç°åœ¨çš„$\frac{1}{4}$å€ï¼Œæ‰€ä»¥ä¸å¡äº†ï¼Œä»£ç è´´å‡ºæ¥ä½œä¸ºå‚è€ƒã€‚</p>
]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4726 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æŒ‡æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼expï¼‰</title>
    <url>/2022/01/18/sol-p4726/</url>
    <content><![CDATA[<h2 id="P4726-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æŒ‡æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼expï¼‰"><a href="#P4726-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æŒ‡æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼expï¼‰" class="headerlink" title="P4726 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æŒ‡æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼expï¼‰"></a>P4726 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æŒ‡æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼expï¼‰</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4726">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å®šä¹‰ï¼šç»™å®šå¤šé¡¹å¼$A(x)$ï¼Œæ±‚$B(x)$ä½¿å¾—$B(x) \equiv e^{A(x)} \pmod{x^n}$ã€‚</p>
<p>æ ¹æ®é¢˜ç›®æœ‰$B(x) = e^{A(x)}$ï¼Œä¸¤è¾¹åŒæ—¶æ±‚å¯¼ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
B'(x) =& e^{A(x)} \times A'(x) \\
B'(x) =& B(x) \times A'(x) \\
B(x) =& \int B(x) \times A'(x)
\end{aligned}</script><p>ä½¿ç”¨åˆ†æ²»NTTæš´åŠ›æï¼Œ$O(n \log^2 n)$ï¼ˆä»£ç ä¸è´´äº†ï¼Œæ¯•ç«Ÿä¸æ˜¯æœ€ä¼˜ï¼‰ã€‚</p>
<h4 id="ç‰›é¡¿è¿­ä»£æ³•"><a href="#ç‰›é¡¿è¿­ä»£æ³•" class="headerlink" title="ç‰›é¡¿è¿­ä»£æ³•"></a>ç‰›é¡¿è¿­ä»£æ³•</h4><p>è®¾æƒ³æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæ•°$a$ï¼Œè¦æ±‚$\sqrt{a}$ç²¾ç¡®åˆ°æ•´æ•°ã€‚</p>
<p>é¦–å…ˆèƒ½æƒ³åˆ°äºŒåˆ†ï¼Œä½†æ˜¯å½“$a$éå¸¸å¤§ï¼Œéœ€è¦äºŒåˆ†çš„æ¬¡æ•°å°±éœ€è¦$\log_2 n$æ¬¡ã€‚</p>
<p>äºæ˜¯ä½¿ç”¨ç‰›é¡¿è¿­ä»£æ³•æ±‚è§£ã€‚è®¾$f(x)=x^2-a$ï¼Œè¦æ±‚çš„å°±æ˜¯$f(x)$çš„é›¶ç‚¹ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æ±‚å‡ºäº†ä¸€ä¸ªè¿‘ä¼¼å€¼$x_0$ï¼Œå°±å¯ä»¥è¿‡$(x_0,f(x_0))$ä½œ$f(x)$çš„åˆ‡çº¿ï¼Œå–åˆ‡çº¿ä¸$x$è½´çš„äº¤ç‚¹ä½œä¸ºæ–°çš„$x_0$ã€‚è¿™æ ·éœ€è¦çš„æ¬¡æ•°æ˜¯è¿œå°äºç›´æ¥äºŒåˆ†çš„ã€‚</p>
<p>å…·ä½“åœ°ï¼Œå½“æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿‘ä¼¼å€¼$x_0$ï¼Œå…¶å…³äº$f(x)$çš„åˆ‡çº¿æ–¹ç¨‹å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
y=f'(x_0)(x-x_0)+f(x_0)</script><p>æ±‚å‡ºåˆ‡çº¿ä¸$x$è½´çš„äº¤ç‚¹$x$ï¼š</p>
<script type="math/tex; mode=display">
x=x_0-\frac{f(x_0)}{f'(x_0)}</script><p>ä»¥ä¸Šæ˜¯äºŒç»´åæ ‡ç³»ä¸­çš„ç‰›é¡¿è¿­ä»£ï¼Œè€Œå¤šé¡¹å¼å¯ä»¥çœ‹æˆæ˜¯å¤šç»´åæ ‡ç³»ä¸­çš„ç‚¹ï¼Œæ€»ä¹‹ç‰›é¡¿è¿­ä»£ä»ç„¶ä½¿ç”¨ã€‚</p>
<p>æƒ³è¦æ±‚ä¸€ä¸ªå‡½æ•°$G(x)$ä½¿å¾—$F(G(x))\equiv 0$ã€‚</p>
<p>ä½¿ç”¨ä¸Šé¢çš„å¼å­ï¼Œæˆ‘ä»¬å‘¢æ¯æ¬¡ä»¤</p>
<script type="math/tex; mode=display">
G(x)=G_0(x)-\frac{F(G_0(x))}{F'(G_0(x))}</script><p>ç»è¿‡ä¸¥è°¨çš„è¯æ˜ï¼ˆæˆ‘ä¸ä¼šè¯ï¼‰ï¼Œæ¯æ¬¡è¿­ä»£å¯ä»¥ä½¿ç²¾åº¦ç¿»å€ï¼Œå³å½“$F(G_0(x))\equiv 0 \pmod{x^\frac{n}{2}}$ï¼Œè¿­ä»£å$F(G(x))\equiv 0 \pmod{x^n}$ã€‚</p>
<p>å¸¦åˆ°è¿™é“é¢˜ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆç”±</p>
<script type="math/tex; mode=display">
\begin{aligned}
B(x) \equiv e^{A(x)} &\pmod{x^n} \\
\ln B(x) \equiv A(x) &\pmod{x^n} \\
\ln B(x) - A(x) \equiv 0 &\pmod{x^n} \\
\end{aligned}</script><p>æˆ‘ä»¬è®©$F(G(x))=\ln G(x) - A(x) \equiv 0$å³å¯ã€‚</p>
<p>å°†$F(G(x))$æ±‚å¯¼ï¼Œå¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
F'(G(x)) = \frac{1}{G(x)}</script><p>å› ä¸ºå¯¹äºå‡½æ•°$F(G(x))$è€Œè¨€ï¼Œè‡ªå˜é‡æ˜¯$G(x)$è€Œä¸æ˜¯$x$ï¼Œå…¶ä¸­çš„$A(x)$ç›¸å½“äºæ˜¯å¸¸æ•°ï¼Œå› è€Œç›´æ¥è¢«å¿½ç•¥ã€‚</p>
<p>å°†å¯¼æ•°å¸¦è¿›ä¸Šå¼å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
G(x) =& G_0(x) - \frac{\ln G_0(x) - A(x)}{\frac{1}{G_0(x)}} \\
=& G_0(x)(1 + A(x) - \ln G_0(x))
\end{aligned}</script><p>é€’å½’è®¡ç®—ï¼Œè¾¹ç•Œæ¡ä»¶æ˜¯$[x^0]B(x)=1$ã€‚</p>
<p>æ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸º</p>
<script type="math/tex; mode=display">
T(n) = T(\frac{n}{2}) + O(n \log n) = O(n \log n)</script><h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4726.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4726</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">19</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x -= y;</span><br><span class="line">    <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x % p;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> rev[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span>* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                f[k] = <span class="built_in">add</span>(u, t), f[k + h / <span class="number">2</span>] = <span class="built_in">sub</span>(u, t);</span><br><span class="line">                g = g * gn % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] = f[i] * inv % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_multiply</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">const</span> <span class="type">int</span>* g, <span class="type">int</span> m, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tf[MAXN] = &#123;&#125;, tg[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n + m - <span class="number">1</span>)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">fill</span>(ans, ans + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">copy</span>(f, f + n, tf);</span><br><span class="line">    <span class="built_in">fill</span>(tf + n, tf + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">copy</span>(g, g + m, tg);</span><br><span class="line">    <span class="built_in">fill</span>(tg + m, tg + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(tf, len, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(tg, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        tf[i] = tf[i] * tg[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(tf, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(tf, tf + n + m - <span class="number">1</span>, ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_inverse</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tmp[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">fill</span>(ans, ans + len + len, <span class="number">0</span>);</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="built_in">qpow</span>(f[<span class="number">0</span>], MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">copy</span>(f, f + h, tmp);</span><br><span class="line">        <span class="built_in">fill</span>(tmp + h, tmp + h + h, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">ntt</span>(tmp, h + h, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">ntt</span>(ans, h + h, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; h + h; ++i)</span><br><span class="line">            ans[i] = ans[i] * (<span class="number">2</span> - ans[i] * tmp[i] % MOD + MOD) % MOD;</span><br><span class="line">        <span class="built_in">ntt</span>(ans, h + h, <span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">fill</span>(ans + h, ans + h + h, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_derivation</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i)</span><br><span class="line">        ans[i] = f[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">    ans[n - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_integral</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">        ans[i] = f[i - <span class="number">1</span>] * <span class="built_in">qpow</span>(i, MOD - <span class="number">2</span>) % MOD;</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_ln</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tf[MAXN] = &#123;&#125;, tg[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="built_in">poly_derivation</span>(f, n, tf);</span><br><span class="line">    <span class="built_in">poly_inverse</span>(f, n, tg);</span><br><span class="line">    <span class="built_in">poly_multiply</span>(tf, n - <span class="number">1</span>, tg, n, ans);</span><br><span class="line">    <span class="built_in">poly_integral</span>(ans, n - <span class="number">1</span>, ans);</span><br><span class="line">    <span class="built_in">fill</span>(ans + n, ans + n + n, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_exp</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tf[MAXN] = &#123;&#125;, tg[MAXN] = &#123;&#125;;</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">1</span>, ans[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= (n &lt;&lt; <span class="number">1</span>); h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">poly_ln</span>(ans, h, tf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; h; ++i)</span><br><span class="line">            tf[i] = <span class="built_in">add</span>((i == <span class="number">0</span>), <span class="built_in">sub</span>(f[i], tf[i]));</span><br><span class="line">        <span class="built_in">copy</span>(ans, ans + h, tg);</span><br><span class="line">        <span class="built_in">poly_multiply</span>(tf, h, tg, h, ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;  <span class="comment">// namespace maths</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="type">int</span> n, a[MAXN], b[MAXN], c[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="built_in">poly_exp</span>(a, n, b);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(b[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤åï¼Œæˆ‘å†³å®šä¸€æ”¹å°è£…å¤šé¡¹å¼çš„åä¹ æƒ¯ï¼Œè½¬è€Œä½¿ç”¨é¢å‘è¿‡ç¨‹çš„å‡½æ•°å¼ç¼–ç¨‹ï¼Œä»¥é˜²æ­¢å¤šé¡¹å¼ä¼ é€’æ—¶é¢å¤–çš„å†…å­˜å¼€é”€ã€‚</p>
<p>åŒæ—¶ï¼Œè¿‘ä¸€ä¸ªæœˆçš„å¤šé¡¹å¼å­¦ä¹ ï¼Œè®©æˆ‘æ·±åˆ»è®¤è¯†åˆ°è‡ªå·±æ•°å­¦çŸ¥è¯†çš„ä¸è¶³ã€‚å› æ­¤ï¼Œè¿™ä¸ªå¯’å‡éœ€è¦åšçš„äº‹ä¸è¨€è€Œå–»ã€‚</p>
]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4725 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼å¯¹æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼lnï¼‰</title>
    <url>/2022/01/18/sol-p4725/</url>
    <content><![CDATA[<h2 id="P4725-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼å¯¹æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼lnï¼‰"><a href="#P4725-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼å¯¹æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼lnï¼‰" class="headerlink" title="P4725 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼å¯¹æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼lnï¼‰"></a>P4725 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼å¯¹æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼lnï¼‰</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4725">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å®šä¹‰ï¼šç»™å®šå¤šé¡¹å¼$A(x)$ï¼Œæ±‚å¤šé¡¹å¼$B(x) \equiv \ln(A(x)) \pmod{x^n}$ã€‚</p>
<p>æ ¹æ®é¢˜ç›®æœ‰$B(x) = \ln(A(x))$ï¼Œä¸¤è¾¹åŒæ—¶æ±‚å¯¼ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
B'(x) =& \ln'(A(x)) \times A'(x) \\
=& \frac{1}{A(x)} \times A'(x) \\
=& \frac{A'(x)}{A(x)}
\end{aligned}</script><p>äºæ˜¯å°†$A(x)$æ±‚å¯¼ï¼Œå†ä¹˜ä¸Š$A(x)$çš„é€†ï¼Œæœ€ååšç§¯åˆ†ï¼Œå°±å¾—åˆ°äº†$B(x)$ã€‚</p>
<p>æ±‚å¯¼å’Œç§¯åˆ†å¤æ‚åº¦ä¸º$O(n)$ï¼Œå¤šé¡¹å¼æ±‚é€†å’ŒNTTéƒ½æ˜¯$O(n \log n)$ï¼Œæ€»æ—¶é—´å¤æ‚åº¦$O(n \log n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4726.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4726</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">19</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x -= y;</span><br><span class="line">    <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x % p;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inverse</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">qpow</span>(x, p - <span class="number">2</span>, p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> rev[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span>* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                f[k] = <span class="built_in">add</span>(u, t), f[k + h / <span class="number">2</span>] = <span class="built_in">sub</span>(u, t);</span><br><span class="line">                g = g * gn % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="type">int</span> inv = <span class="built_in">inverse</span>(len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] = f[i] * inv % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">polynomial</span> &#123;</span><br><span class="line">    <span class="type">int</span> a[MAXN], len;</span><br><span class="line">    <span class="built_in">polynomial</span>() &#123; <span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="built_in">sizeof</span>(a)); &#125;</span><br><span class="line">    <span class="built_in">polynomial</span>(<span class="type">int</span> len) : <span class="built_in">len</span>(len) &#123; <span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="built_in">sizeof</span>(a)); &#125;</span><br><span class="line">    <span class="type">int</span> <span class="keyword">operator</span>[](<span class="type">int</span> i) <span class="type">const</span> &#123; <span class="keyword">return</span> a[i]; &#125;</span><br><span class="line">    <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i) &#123; <span class="keyword">return</span> a[i]; &#125;</span><br><span class="line">    polynomial <span class="keyword">operator</span>*(<span class="type">const</span> polynomial&amp; o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> f[MAXN], g[MAXN];</span><br><span class="line">        <span class="function">polynomial <span class="title">ret</span><span class="params">(len + o.len - <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="type">int</span> slen = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (slen &lt; ret.len)</span><br><span class="line">            slen &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">copy</span>(a, a + slen, f);</span><br><span class="line">        <span class="built_in">copy</span>(o.a, o.a + slen, g);</span><br><span class="line">        <span class="built_in">ntt</span>(f, slen, <span class="number">1</span>), <span class="built_in">ntt</span>(g, slen, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; slen; ++i)</span><br><span class="line">            f[i] = f[i] * g[i] % MOD;</span><br><span class="line">        <span class="built_in">ntt</span>(f, slen, <span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">copy</span>(f, f + slen, ret.a);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">polynomial <span class="title">inverse</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> tmp[MAXN] = &#123;&#125;;</span><br><span class="line">        <span class="type">int</span> slen = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (slen &lt; len)</span><br><span class="line">            slen &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="function">polynomial <span class="title">ret</span><span class="params">(slen)</span></span>;</span><br><span class="line">        ret[<span class="number">0</span>] = maths::<span class="built_in">inverse</span>(a[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= slen; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(a, a + h, tmp);</span><br><span class="line">            <span class="built_in">fill</span>(tmp + h, tmp + h + h, <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">ntt</span>(tmp, h + h, <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">ntt</span>(ret.a, h + h, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; h + h; ++i)</span><br><span class="line">                ret[i] = ret[i] * (<span class="number">2</span> - tmp[i] * ret[i] % MOD + MOD) % MOD;</span><br><span class="line">            <span class="built_in">ntt</span>(ret.a, h + h, <span class="number">-1</span>);</span><br><span class="line">            <span class="built_in">fill</span>(ret.a + h, ret.a + h + h, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">polynomial <span class="title">derivation</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="function">polynomial <span class="title">ret</span><span class="params">(len - <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; ++i)</span><br><span class="line">            ret[i] = a[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">polynomial <span class="title">integral</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="function">polynomial <span class="title">ret</span><span class="params">(len + <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">            ret[i] = a[i - <span class="number">1</span>] * maths::<span class="built_in">inverse</span>(i) % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">polynomial <span class="title">ln</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">derivation</span>() * <span class="built_in">inverse</span>()).<span class="built_in">integral</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;  <span class="comment">// namespace maths</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">polynomial a;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    a.len = n;</span><br><span class="line">    a = a.<span class="built_in">ln</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(a[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4002 ç”Ÿæˆæ ‘è®¡æ•°</title>
    <url>/2022/01/17/sol-p4002/</url>
    <content><![CDATA[<h2 id="P4002-ç”Ÿæˆæ ‘è®¡æ•°"><a href="#P4002-ç”Ÿæˆæ ‘è®¡æ•°" class="headerlink" title="P4002 ç”Ÿæˆæ ‘è®¡æ•°"></a>P4002 ç”Ÿæˆæ ‘è®¡æ•°</h2><p><del>é»‘ï¼ŒçœŸ$^{\text{TM}}$çš„é»‘å•Šï¼ˆæŒ‡é¢˜ç›®çš„é¢œè‰²ï¼‰</del></p>
<span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4002">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="å‰ç½®çŸ¥è¯†ï¼šæ±‚æ•°åˆ—å¹‚å’Œ"><a href="#å‰ç½®çŸ¥è¯†ï¼šæ±‚æ•°åˆ—å¹‚å’Œ" class="headerlink" title="å‰ç½®çŸ¥è¯†ï¼šæ±‚æ•°åˆ—å¹‚å’Œ"></a>å‰ç½®çŸ¥è¯†ï¼šæ±‚æ•°åˆ—å¹‚å’Œ</h3><p>ç»™å®šåºåˆ—${a<em>n}$ï¼Œå¯¹äº$0\le t \le k$ï¼Œæ±‚$\sum\limits</em>{i=1}^n a_i^t$ã€‚</p>
<p>å…ˆå†™å‡ºå¹‚æ¬¡å’Œæ‰€æ±‚å€¼ä¹‹é—´çš„ç”Ÿæˆå‡½æ•°ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
F(x) =& \sum_{t=0}{\sum_{i=1}^{n}{a_i^t x^t}} \\
=& \sum_{i=1}^{n}{\frac{1}{1-a_ix}}
\end{aligned}</script><p>ä¸å¦¨è®¾$G(x)=\sum\limits_{i=1}^{n}(\lnâ€™(1-a_ix))$ï¼Œåˆ™æœ‰</p>
<script type="math/tex; mode=display">
\begin{aligned}
G(x) =& \sum_{i=1}^n(\ln'(1-a_ix)) \\
=& -\sum_{i=1}^n\frac{a_i}{1-a_ix}
\end{aligned}</script><p>äºæ˜¯æ±‚å‡º$G(x)$åå¯ä»¥å¾ˆå®¹æ˜“åœ°æ±‚å‡º$F(x)$ã€‚æ€è€ƒå¦‚ä½•æ±‚$G(x)$ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
G(x) =& \sum_{i=1}^n(\ln'(1-a_ix)) \\
=& \left(\sum_{i=1}^n\ln(1-a_ix)\right)' \\
=& \left(\ln(\prod_{i=1}^n(1-a_ix))\right)'
\end{aligned}</script><p>ä½¿ç”¨åˆ†æ²»FFTæ±‚å‡º$\prod\limits_{i=1}^n(1-a_ix)$ï¼Œå†$\ln$å’Œæ±‚å¯¼ï¼Œæ±‚å‡º$G(x)$å’Œ$F(x)$ï¼Œæ—¶é—´å¤æ‚åº¦$O(n \log^2 n)$ã€‚</p>
<h3 id="å¤šé¡¹å¼-ln-mid-exp"><a href="#å¤šé¡¹å¼-ln-mid-exp" class="headerlink" title="å¤šé¡¹å¼$\ln \mid \exp$"></a>å¤šé¡¹å¼$\ln \mid \exp$</h3><p>è§<a href="/2022/01/18/sol-p4725/" title="P4725 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼å¯¹æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼lnï¼‰">P4725 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼å¯¹æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼lnï¼‰</a>å’Œ<a href="/2022/01/18/sol-p4726/" title="P4726 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æŒ‡æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼expï¼‰">P4726 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æŒ‡æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼expï¼‰</a>ã€‚</p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¦–å…ˆï¼Œä½ éœ€è¦æƒ³åˆ°ä½¿ç”¨<a href="https://oi-wiki.org/graph/prufer/">pruferåºåˆ—</a>æ¥è¿›è¡Œæ ‘å½¢æ€çš„æšä¸¾å¹¶è®¡ç®—è´¡çŒ®ã€‚</p>
<p>æ ¹æ®pruferåºåˆ—çš„å®šä¹‰ï¼Œä¸€æ£µ$n$ä¸ªèŠ‚ç‚¹çš„æ ‘å…±æœ‰$n^{n-2}$ç§ä¸åŒçš„å½¢æ€ã€‚</p>
<p>æˆ‘ä»¬è®¡ç®—ç­”æ¡ˆæ—¶éœ€è¦çš„æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„åº¦$deg_u$ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿è®¾$d_u=deg_u-1$ï¼Œ$d_u$çš„å®é™…æ„ä¹‰æ˜¯$u$åœ¨pruferåºåˆ—ä¸­çš„å‡ºç°æ¬¡æ•°ã€‚</p>
<p>æ‰€ä»¥æšä¸¾$\sum d_i=n-2$ï¼Œç„¶åpruferåºåˆ—çš„$n-2$ä¸ªæ•°å­—æ’åˆ—å…±$(n-2)!$ç§æƒ…å†µã€‚äºæ˜¯ä¹</p>
<script type="math/tex; mode=display">
\begin{aligned}
ans =& \sum_T val(T) \\
=& \sum_T \left(\prod_{i=1}^ndeg_i^m\right) \left(\sum_{i=1}^ndeg_i^m\right) \\
=& \sum_{\sum d_i=n-2}(n-2)!\left(\prod_{i=1}^n(d_i+1)^m\right) \left(\sum_{i=1}^n(d_i+1)^m\right) \left(\prod_{i=1}^n\frac{a_i^{d_i+1}}{d_i!}\right) \\
=& (n-2)! \prod_{i=1}^na_i \sum_{\sum d_i=n-2} \left(\prod_{i=1}^n\frac{a_i^{d_i}}{d_i!}(d_i+1)^m\right) \left(\sum_{i=1}^n(d_i+1)^m\right)
\end{aligned}</script><p>å·¦è¾¹ä¸¤é¡¹å®šå€¼å…ˆä¸ç®¡ï¼Œå³è¾¹å‡ é¡¹å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\sum_{\sum d_i=n-2} \sum_{i=1}^{n}{\frac{a_i^{d_i}}{d_i!}(d_i+1)^{2m} \prod_{j \neq i}{\frac{a_j^{d_j}}{d_j!}(d_j+1)^m}}</script><p>æ„é€ ä¸¤ä¸ªå¤šé¡¹å¼$A(x)$å’Œ$B(x)$ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
A(x)=\sum_i\frac{(i+1)^{2m}x^i}{i!} \\
B(x)=\sum_i\frac{(i+1)^mx^i}{i!}
\end{aligned}</script><p>åˆ™æœ‰</p>
<script type="math/tex; mode=display">
\begin{aligned}
F(x) =& \sum_{i=1}^{n}{A(a_ix) \prod_{j\neq i}B(a_jx)} \\
=& \sum_{i=1}^{n}{\frac{A(a_ix)}{B(a_ix)} \prod_{j=1}^{n}B(a_jx)} \\
=& \sum_{i=1}^{n}{\frac{A(a_ix)}{B(a_ix)} \exp\left(\sum_{j=1}^{n}\ln(B(a_jx))\right)}
\end{aligned}</script><p>å½“æˆ‘ä»¬æ±‚å‡º$\frac{A(x)}{B(x)}$å’Œ$\ln(B(x))$ä»¥åï¼Œè¦æƒ³æ±‚å‡º$\sum\limits<em>i \frac{A(a_ix)}{B(a_ix)}$å’Œ$\sum\limits_i \ln(B(a_ix))$ï¼Œåˆ™éœ€è¦å°†æ¯é¡¹ç³»æ•°ä¹˜ä¸Š$\sum\limits</em>{i=1}^na_i^k$ï¼Œç”¨å‰ç½®çŸ¥è¯†ä¸­çš„æ–¹æ³•åˆ†æ²»è®¡ç®—ã€‚</p>
<p>æ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(n \log^2 n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4002.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4002</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">17</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x -= y;</span><br><span class="line">    <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x % p;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> rev[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span>* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                f[k] = <span class="built_in">add</span>(u, t), f[k + h / <span class="number">2</span>] = <span class="built_in">sub</span>(u, t);</span><br><span class="line">                g = g * gn % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] = f[i] * inv % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_multiply</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">const</span> <span class="type">int</span>* g, <span class="type">int</span> m, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tf[MAXN] = &#123;&#125;, tg[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n + m - <span class="number">1</span>)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">copy</span>(f, f + n, tf);</span><br><span class="line">    <span class="built_in">fill</span>(tf + n, tf + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">copy</span>(g, g + m, tg);</span><br><span class="line">    <span class="built_in">fill</span>(tg + m, tg + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">fill</span>(ans, ans + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(tf, len, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(tg, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        tf[i] = tf[i] * tg[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(tf, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(tf, tf + n + m - <span class="number">1</span>, ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_inverse</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tmp[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">fill</span>(ans, ans + len + len, <span class="number">0</span>);</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="built_in">qpow</span>(f[<span class="number">0</span>], MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">copy</span>(f, f + h, tmp);</span><br><span class="line">        <span class="built_in">fill</span>(tmp + h, tmp + h + h, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">ntt</span>(tmp, h + h, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">ntt</span>(ans, h + h, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; h + h; ++i)</span><br><span class="line">            ans[i] = ans[i] * (<span class="number">2</span> - ans[i] * tmp[i] % MOD + MOD) % MOD;</span><br><span class="line">        <span class="built_in">ntt</span>(ans, h + h, <span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">fill</span>(ans + h, ans + h + h, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_derivation</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i)</span><br><span class="line">        ans[i] = f[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">    ans[n - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_integral</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">        ans[i] = f[i - <span class="number">1</span>] * <span class="built_in">qpow</span>(i, MOD - <span class="number">2</span>) % MOD;</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_ln</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tf[MAXN] = &#123;&#125;, tg[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="built_in">poly_derivation</span>(f, n, tf);</span><br><span class="line">    <span class="built_in">poly_inverse</span>(f, n, tg);</span><br><span class="line">    <span class="built_in">poly_multiply</span>(tf, n - <span class="number">1</span>, tg, n, ans);</span><br><span class="line">    <span class="built_in">poly_integral</span>(ans, n - <span class="number">1</span>, ans);</span><br><span class="line">    <span class="built_in">fill</span>(ans + n, ans + n + n, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poly_exp</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tf[MAXN] = &#123;&#125;, tg[MAXN] = &#123;&#125;;</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">1</span>, ans[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= (n &lt;&lt; <span class="number">1</span>); h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">poly_ln</span>(ans, h, tf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; h; ++i)</span><br><span class="line">            tf[i] = <span class="built_in">add</span>((i == <span class="number">0</span>), <span class="built_in">sub</span>(f[i], tf[i]));</span><br><span class="line">        <span class="built_in">copy</span>(ans, ans + h, tg);</span><br><span class="line">        <span class="built_in">poly_multiply</span>(tf, h, tg, h, ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;  <span class="comment">// namespace maths</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="type">int</span> n, m, a[MAXN], ta[MAXN], tb[MAXN], tc[MAXN], ts[MAXN];</span><br><span class="line"><span class="type">int</span> fac[MAXN], inv[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> cl, <span class="type">int</span> cr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l + <span class="number">1</span> == r) &#123;</span><br><span class="line">        ts[cl] = <span class="number">1</span>, ts[cl + <span class="number">1</span>] = <span class="built_in">sub</span>(<span class="number">0</span>, a[l]);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, cmid = (cl + cr) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve</span>(l, mid, cl, cmid);</span><br><span class="line">    <span class="built_in">solve</span>(mid, r, cmid, cr);</span><br><span class="line">    <span class="built_in">poly_multiply</span>(ts + cl, cmid - cl, ts + cmid, cr - cmid, ts + cl);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    inv[n] = <span class="built_in">qpow</span>(fac[n], MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt;= n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        ta[i] = <span class="built_in">qpow</span>(i + <span class="number">1</span>, m + m) * inv[i] % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        tb[i] = <span class="built_in">qpow</span>(i + <span class="number">1</span>, m) * inv[i] % MOD;</span><br><span class="line">    <span class="built_in">poly_inverse</span>(tb, len, tc);</span><br><span class="line">    <span class="built_in">poly_multiply</span>(ta, len, tc, len, ta);</span><br><span class="line">    <span class="built_in">poly_ln</span>(tb, len, tc);</span><br><span class="line">    <span class="built_in">copy</span>(tc, tc + len, tb);</span><br><span class="line">    <span class="built_in">solve</span>(<span class="number">0</span>, len, <span class="number">0</span>, len &lt;&lt; <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">poly_ln</span>(ts, len, ts);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ts[i] = <span class="built_in">sub</span>(<span class="number">0</span>, ts[i] * i % MOD);</span><br><span class="line">    ts[<span class="number">0</span>] = n;</span><br><span class="line">    <span class="built_in">fill</span>(ts + n, ts + len, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        ta[i] = ta[i] * ts[i] % MOD;</span><br><span class="line">        tb[i] = tb[i] * ts[i] % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">poly_exp</span>(tb, len, tc);</span><br><span class="line">    <span class="built_in">poly_multiply</span>(ta, len, tc, len, ta);</span><br><span class="line">    <span class="type">int</span> ans = fac[n - <span class="number">2</span>] * ta[n - <span class="number">2</span>] % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ans = ans * a[i] % MOD;</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>Live2D æ­å»º</title>
    <url>/2022/01/15/extra-blog-live2d/</url>
    <content><![CDATA[<h2 id="Live2D-æ­å»º"><a href="#Live2D-æ­å»º" class="headerlink" title="Live2D æ­å»º"></a>Live2D æ­å»º</h2><p>ä¸€æ—¥é—²æ¥æ— äº‹ï¼Œå¿½è§‰Live2Dã€‚ç½‘ä¸Šæ‰¾æ•™ç¨‹ï¼Œå´å«Œä¸å¤Ÿè¯¦ç»†ã€‚å¥ˆä½•ï¼Ÿå¥ˆä½•ï¼Ÿåªå¾—è‡ªå·±æ‘¸ç´¢ã€‚</p>
<span id="more"></span>
<p><del>å†™çš„ä»€ä¹ˆçƒ‚è¯—</del></p>
<hr>
<h3 id="åˆçº§"><a href="#åˆçº§" class="headerlink" title="åˆçº§"></a>åˆçº§</h3><h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>è¿™æ˜¯æœ€åŸºç¡€çš„Live2Dï¼Œå®Œæˆååªæœ‰ä¸€ä¸ªäººç‰©åœ¨ç½‘é¡µä¸Šï¼Œæ²¡æœ‰å¯¹è¯åŠŸèƒ½ã€‚</p>
<p>ä¸”<strong>åˆçº§ä¸ä¸­çº§ã€é«˜çº§ä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»</strong>ï¼Œå¦‚æœæƒ³è¦æ›´å¥½çš„æ•ˆæœï¼Œè¯·<strong>è·³è¿‡åˆçº§æ•™ç¨‹</strong>ã€‚</p>
<h4 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h4><p>å…ˆå®‰è£…<code>hexo-helper-live2d</code>æ’ä»¶ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install --save hexo-helper-live2d</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ°<a href="https://github.com/xiazeyu/live2d-widget-models">è¿™é‡Œ</a>æ‰¾ä¸€ä¸ªä½ å–œæ¬¢çš„Live2Dæ¨¡å‹è¿›è¡Œå®‰è£…ã€‚å¦‚é€‰æ‹©äº†<code>live2d-widget-model-wanko</code>ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install live2d-widget-model-wanko <span class="comment"># æ²¡æœ‰ --save</span></span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ°<strong>æ ¹ç›®å½•</strong>çš„<code>_config.yml</code>ä¸­æ·»åŠ é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Live2D</span></span><br><span class="line"><span class="comment">## https://github.com/EYHN/hexo-helper-live2d</span></span><br><span class="line"><span class="comment">## https://l2dwidget.js.org/docs/class/src/index.js~L2Dwidget.html#instance-method-init</span></span><br><span class="line"><span class="attr">live2d:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#enable: false</span></span><br><span class="line">  <span class="attr">scriptFrom:</span> <span class="string">local</span> <span class="comment"># é»˜è®¤</span></span><br><span class="line">  <span class="attr">pluginRootPath:</span> <span class="string">live2dw/</span> <span class="comment"># æ’ä»¶åœ¨ç«™ç‚¹ä¸Šçš„æ ¹ç›®å½•(ç›¸å¯¹è·¯å¾„)</span></span><br><span class="line">  <span class="attr">pluginJsPath:</span> <span class="string">lib/</span> <span class="comment"># è„šæœ¬æ–‡ä»¶ç›¸å¯¹ä¸æ’ä»¶æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">  <span class="attr">pluginModelPath:</span> <span class="string">assets/</span> <span class="comment"># æ¨¡å‹æ–‡ä»¶ç›¸å¯¹ä¸æ’ä»¶æ ¹ç›®å½•è·¯å¾„</span></span><br><span class="line">  <span class="comment"># scriptFrom: jsdelivr # jsdelivr CDN</span></span><br><span class="line">  <span class="comment"># scriptFrom: unpkg # unpkg CDN</span></span><br><span class="line">  <span class="comment"># scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # ä½ çš„è‡ªå®šä¹‰ url</span></span><br><span class="line">  <span class="attr">tagMode:</span> <span class="literal">false</span> <span class="comment"># æ ‡ç­¾æ¨¡å¼, æ˜¯å¦ä»…æ›¿æ¢ live2d tagæ ‡ç­¾è€Œéæ’å…¥åˆ°æ‰€æœ‰é¡µé¢ä¸­</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">false</span> <span class="comment"># è°ƒè¯•, æ˜¯å¦åœ¨æ§åˆ¶å°è¾“å‡ºæ—¥å¿—</span></span><br><span class="line">  <span class="string">model</span></span><br><span class="line">    <span class="attr">use:</span> <span class="string">live2d-widget-model-wanko</span> <span class="comment"># æ›¿æ¢æˆä½ çš„æ¨¡å‹å</span></span><br><span class="line">    <span class="comment"># use: live2d-widget-model-wanko # npm-module package name</span></span><br><span class="line">    <span class="comment"># use: wanko # åšå®¢æ ¹ç›®å½•/live2d_models/ ä¸‹çš„ç›®å½•å</span></span><br><span class="line">    <span class="comment"># use: ./wives/wanko # ç›¸å¯¹äºåšå®¢æ ¹ç›®å½•çš„è·¯å¾„</span></span><br><span class="line">    <span class="comment"># use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # ä½ çš„è‡ªå®šä¹‰ url</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">position:</span> <span class="string">right</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">145</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">315</span></span><br><span class="line">  <span class="attr">mobile:</span></span><br><span class="line">    <span class="attr">show:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤º</span></span><br><span class="line">    <span class="attr">scale:</span> <span class="number">0.5</span> <span class="comment"># ç§»åŠ¨è®¾å¤‡ä¸Šçš„ç¼©æ”¾       </span></span><br><span class="line">  <span class="attr">react:</span></span><br><span class="line">    <span class="attr">opacityDefault:</span> <span class="number">0.7</span></span><br><span class="line">    <span class="attr">opacityOnHover:</span> <span class="number">0.8</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ<code>hexo c &amp;&amp; hexo g &amp;&amp; hexo s</code>ï¼Œå°±å¯ä»¥åœ¨æœ¬åœ°çœ‹åˆ°Live2Dæ¨¡å‹äº†ã€‚</p>
<hr>
<h3 id="ä¸­çº§"><a href="#ä¸­çº§" class="headerlink" title="ä¸­çº§"></a>ä¸­çº§</h3><h4 id="è¯´æ˜-1"><a href="#è¯´æ˜-1" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>é˜…è¯»é«˜çº§æ•™ç¨‹ä¹‹å‰ï¼Œè¯·å…ˆé˜…è¯»ä¸­çº§æ•™ç¨‹ã€‚</p>
<h4 id="æ“ä½œ-1"><a href="#æ“ä½œ-1" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h4><p>å…ˆå…³é—­<code>hexo-helper-live2d</code>ï¼ˆå¦‚æœå·²ç»æŒ‰ç…§åˆçº§æ•™ç¨‹å¼€å¯è¿‡çš„è¯ï¼‰ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm uninstall hexo-helper-live2d</span><br><span class="line">npm uninstall live2d-widget-model-wanko <span class="comment"># æ›¿æ¢æˆä½ çš„æ¨¡å‹å</span></span><br></pre></td></tr></table></figure>
<p>å…‹éš†<a href="https://github.com/stevenjoezhang/live2d-widget">live2d-widget</a>åˆ°æœ¬åœ°<code>themes/next/live2d-widget</code>ï¼ˆæˆ‘è¿™é‡Œæ˜¯<code>next</code>ä¸»é¢˜ï¼‰ä¸­ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> themes/next</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/stevenjoezhang/live2d-widget.git</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>next</code>ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼š</p>
<p>æ‰“å¼€<code>themes/next/layout/_layout.swig</code>ï¼Œåœ¨<code>&lt;footer&gt;</code>æ ‡ç­¾ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Live2D --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/live2d-widget/autoload.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¹¶åœ¨æ–‡ä»¶çš„<code>&lt;head&gt;</code>æ ‡ç­¾ä¸­æ·»åŠ </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åé‡æ–°ç”Ÿæˆå¹¶è¿è¡Œã€‚</p>
<hr>
<h3 id="é«˜çº§"><a href="#é«˜çº§" class="headerlink" title="é«˜çº§"></a>é«˜çº§</h3><h3 id="è¯´æ˜-2"><a href="#è¯´æ˜-2" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>ç›¸æ¯”ä¸­çº§ï¼Œå¢åŠ äº†æ¢è£…åŠŸèƒ½ã€‚</p>
<h3 id="æ“ä½œ-2"><a href="#æ“ä½œ-2" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h3><p><strong>å…ˆæŒ‰ç…§ä¸­çº§å®Œæˆæ“ä½œ</strong></p>
<p>æ‰“å¼€<code>themes/next/layout/_layout.swig</code>ï¼Œåœ¨<code>&lt;footer&gt;</code>æ ‡ç­¾ä¸­çš„<code>&lt;script src=&quot;/live2d-widget/autoload.js&gt;</code>ä¹‹å‰çš„éƒ¨åˆ†æ·»åŠ <code>jquery</code>å’Œ<code>jquery-ui</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.12.1/jquery-ui.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>themes/next/live2d-widget/autoload.js</code>ï¼Œåˆ æ‰åŸæœ‰å†…å®¹æ›¿æ¢å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ è½½ CSS</span></span><br><span class="line">$(<span class="string">&quot;&lt;link&gt;&quot;</span>).<span class="title function_">attr</span>(&#123;<span class="attr">href</span>: <span class="string">&quot;/live2d-widget/waifu.css&quot;</span>, <span class="attr">rel</span>: <span class="string">&quot;stylesheet&quot;</span>, <span class="attr">type</span>: <span class="string">&quot;text/css&quot;</span>&#125;).<span class="title function_">appendTo</span>(<span class="string">&#x27;head&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥ DIV</span></span><br><span class="line">$(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;div class=&quot;waifu&quot;&gt;&lt;div class=&quot;waifu-tips&quot;&gt;&lt;/div&gt;&lt;canvas id=&quot;live2d&quot; class=&quot;live2d&quot;&gt;&lt;/canvas&gt;&lt;div class=&quot;waifu-tool&quot;&gt;&lt;span class=&quot;fui-home&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-chat&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-eye&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-user&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-photo&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-info-circle&quot;&gt;&lt;/span&gt; &lt;span class=&quot;fui-cross&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ è½½ JS</span></span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">	<span class="attr">url</span>: <span class="string">&#x27;/live2d-widget/waifu-tips.js&#x27;</span>,</span><br><span class="line">	<span class="attr">dataType</span>:<span class="string">&quot;script&quot;</span>,</span><br><span class="line">	<span class="attr">cache</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">async</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">	<span class="attr">url</span>: <span class="string">&#x27;/live2d-widget/live2d.min.js&#x27;</span>,</span><br><span class="line">	<span class="attr">dataType</span>:<span class="string">&quot;script&quot;</span>,</span><br><span class="line">	<span class="attr">cache</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">async</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–çœ‹æ¿å¨˜ï¼ŒåŠ è½½ waifu-tips.json</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¯ç›´æ¥ä¿®æ”¹éƒ¨åˆ†å‚æ•° */</span></span><br><span class="line">live2d_settings[<span class="string">&#x27;modelId&#x27;</span>] = <span class="number">1</span>;                  <span class="comment">// é»˜è®¤æ¨¡å‹ ID</span></span><br><span class="line">live2d_settings[<span class="string">&#x27;modelTexturesId&#x27;</span>] = <span class="number">88</span>;          <span class="comment">// é»˜è®¤æè´¨ ID</span></span><br><span class="line"><span class="comment">/* åœ¨ initModel å‰æ·»åŠ  */</span></span><br><span class="line"><span class="title function_">initModel</span>(<span class="string">&#x27;/live2d-widget/waifu-tips.json&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>themes/next/live2d-widget/waifu-tips.js</code>ï¼Œåˆ æ‰åŸæœ‰å†…å®¹æ›¿æ¢å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">live2d_settings</span> = <span class="title class_">Array</span>(); <span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        ã__,.ãƒ˜ãƒ½.ã€€ã€€ã€€ã€€/ã€€,ãƒ¼ï½¤ ã€‰</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ï¼¼ &#x27;, !-â”€â€-iã€€/ã€€/Â´</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ ã€€ ï¼ï½€ï½°&#x27;ã€€ã€€ã€€ L/ï¼ï½€ãƒ½ï½¤            Live2D çœ‹æ¿å¨˜ å‚æ•°è®¾ç½®</span></span><br><span class="line"><span class="comment">        ã€€ã€€ ã€€ /ã€€ ï¼,ã€€ /|ã€€ ,ã€€ ,ã€€ã€€ã€€ &#x27;,          Version 1.4.2</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ï½² ã€€/ /-â€/ã€€ï½‰ã€€L_ ï¾Š ãƒ½!ã€€ i             Update 2018.11.12</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ ï¾š ï¾ 7ï½²ï½€ï¾„ã€€ ï¾š&#x27;ï½§-ï¾„ï½¤!ãƒ|ã€€ |  </span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ !,/7 &#x27;0&#x27;ã€€ã€€ Â´0iã‚½| ã€€ |ã€€ã€€ã€€</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ |.ä»&quot;ã€€ã€€_ã€€ã€€ ,,,, / |./ ã€€ |    ç½‘é¡µæ·»åŠ  Live2D çœ‹æ¿å¨˜</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ ï¾š&#x27;| iï¼.ï½¤,,__ã€€_,.ã‚¤ / ã€€.i ã€€|       https://yaoxi-std.github.io/2022/01/15/extra-blog-live2d/</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ ï¾š&#x27;| | / k_ï¼—_/ï¾š&#x27;ãƒ½,ã€€ï¾Š.ã€€|           </span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ã€€ | |/i ã€ˆ|/ã€€ iã€€,.ï¾ |ã€€iã€€|    Thanks</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ã€€.|/ /ã€€ï½‰ï¼š ã€€ ï¾!ã€€ã€€ï¼¼ã€€|          journey-ad / https://github.com/journey-ad/live2d_src</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ ã€€ ã€€ kãƒ½&gt;ï½¤ï¾Š ã€€ _,.ï¾ï½¤ ã€€ /ï½¤!            xiazeyu / https://github.com/xiazeyu/live2d-widget.js</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ã€€ !&#x27;ã€ˆ//ï½€ï¼´Â´&#x27;, ï¼¼ ï½€&#x27;7&#x27;ï½°r&#x27;         Live2d Cubism SDK WebGL 2.1 Projrct &amp; All model authors.</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ã€€ ï¾š&#x27;ãƒ½L__|___i,___,ãƒ³ï¾š|ãƒ           fghrsh / https://github.com/fghrsh/live2d_api</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ ã€€ã€€ã€€ï¾„-,/ã€€|___./</span></span><br><span class="line"><span class="comment">        ã€€ã€€ã€€ã€€ã€€ ã€€ã€€ã€€&#x27;ï½°&#x27;ã€€ã€€!_,.:*********************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åç«¯æ¥å£</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelAPI&quot;</span>] = <span class="string">&quot;//live2d.fghrsh.net/api/&quot;</span>; <span class="comment">// è‡ªå»º API ä¿®æ”¹è¿™é‡Œ</span></span><br><span class="line">live2d_settings[<span class="string">&quot;tipsMessage&quot;</span>] = <span class="string">&quot;waifu-tips.json&quot;</span>; <span class="comment">// åŒç›®å½•ä¸‹å¯çœç•¥è·¯å¾„</span></span><br><span class="line">live2d_settings[<span class="string">&quot;hitokotoAPI&quot;</span>] = <span class="string">&quot;hitokoto.cn&quot;</span>; <span class="comment">// ä¸€è¨€ APIï¼Œå¯é€‰ &#x27;lwl12.com&#x27;, &#x27;hitokoto.cn&#x27;, &#x27;jinrishici.com&#x27;(å¤è¯—è¯)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤æ¨¡å‹</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelId&quot;</span>] = <span class="number">1</span>; <span class="comment">// é»˜è®¤æ¨¡å‹ IDï¼Œå¯åœ¨ F12 æ§åˆ¶å°æ‰¾åˆ°</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelTexturesId&quot;</span>] = <span class="number">88</span>; <span class="comment">// é»˜è®¤æè´¨ IDï¼Œå¯åœ¨ F12 æ§åˆ¶å°æ‰¾åˆ°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å…·æ è®¾ç½®</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showToolMenu&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º å·¥å…·æ           ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canCloseLive2d&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º å…³é—­çœ‹æ¿å¨˜  æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canSwitchModel&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º æ¨¡å‹åˆ‡æ¢    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canSwitchTextures&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º æè´¨åˆ‡æ¢    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canSwitchHitokoto&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º ä¸€è¨€åˆ‡æ¢    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canTakeScreenshot&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º çœ‹æ¿å¨˜æˆªå›¾  æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canTurnToHomePage&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º è¿”å›é¦–é¡µ    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;canTurnToAboutPage&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º è·³è½¬å…³äºé¡µ  æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å‹åˆ‡æ¢æ¨¡å¼</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelStorage&quot;</span>] = <span class="literal">true</span>; <span class="comment">// è®°å½• ID (åˆ·æ–°åæ¢å¤)ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelRandMode&quot;</span>] = <span class="string">&quot;switch&quot;</span>; <span class="comment">// æ¨¡å‹åˆ‡æ¢ï¼Œå¯é€‰ &#x27;rand&#x27;(éšæœº), &#x27;switch&#x27;(é¡ºåº)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;modelTexturesRandMode&quot;</span>] = <span class="string">&quot;rand&quot;</span>; <span class="comment">// æè´¨åˆ‡æ¢ï¼Œå¯é€‰ &#x27;rand&#x27;(éšæœº), &#x27;switch&#x27;(é¡ºåº)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æç¤ºæ¶ˆæ¯é€‰é¡¹</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showHitokoto&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤ºä¸€è¨€</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showF12Status&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤ºåŠ è½½çŠ¶æ€</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showF12Message&quot;</span>] = <span class="literal">false</span>; <span class="comment">// æ˜¾ç¤ºçœ‹æ¿å¨˜æ¶ˆæ¯</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showF12OpenMsg&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤ºæ§åˆ¶å°æ‰“å¼€æç¤º</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showCopyMessage&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤º å¤åˆ¶å†…å®¹ æç¤º</span></span><br><span class="line">live2d_settings[<span class="string">&quot;showWelcomeMessage&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ˜¾ç¤ºè¿›å…¥é¢é¡µæ¬¢è¿è¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//çœ‹æ¿å¨˜æ ·å¼è®¾ç½®</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuSize&quot;</span>] = <span class="string">&quot;800x800&quot;</span>; <span class="comment">// çœ‹æ¿å¨˜å¤§å°ï¼Œä¾‹å¦‚ &#x27;280x250&#x27;, &#x27;600x535&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuTipsSize&quot;</span>] = <span class="string">&quot;250x70&quot;</span>; <span class="comment">// æç¤ºæ¡†å¤§å°ï¼Œä¾‹å¦‚ &#x27;250x70&#x27;, &#x27;570x150&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuFontSize&quot;</span>] = <span class="string">&quot;14px&quot;</span>; <span class="comment">// æç¤ºæ¡†å­—ä½“ï¼Œä¾‹å¦‚ &#x27;12px&#x27;, &#x27;30px&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuToolFont&quot;</span>] = <span class="string">&quot;14px&quot;</span>; <span class="comment">// å·¥å…·æ å­—ä½“ï¼Œä¾‹å¦‚ &#x27;14px&#x27;, &#x27;36px&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuToolLine&quot;</span>] = <span class="string">&quot;20px&quot;</span>; <span class="comment">// å·¥å…·æ è¡Œé«˜ï¼Œä¾‹å¦‚ &#x27;20px&#x27;, &#x27;36px&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuToolTop&quot;</span>] = <span class="string">&quot;0px&quot;</span>; <span class="comment">// å·¥å…·æ é¡¶éƒ¨è¾¹è·ï¼Œä¾‹å¦‚ &#x27;0px&#x27;, &#x27;-60px&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuMinWidth&quot;</span>] = <span class="string">&quot;768px&quot;</span>; <span class="comment">// é¢é¡µå°äº æŒ‡å®šå®½åº¦ éšè—çœ‹æ¿å¨˜ï¼Œä¾‹å¦‚ &#x27;disable&#x27;(ç¦ç”¨), &#x27;768px&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuEdgeSide&quot;</span>] = <span class="string">&quot;left:0&quot;</span>; <span class="comment">// çœ‹æ¿å¨˜è´´è¾¹æ–¹å‘ï¼Œä¾‹å¦‚ &#x27;left:0&#x27;(é å·¦ 0px), &#x27;right:30&#x27;(é å³ 30px)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuDraggable&quot;</span>] = <span class="string">&quot;disable&quot;</span>; <span class="comment">// æ‹–æ‹½æ ·å¼ï¼Œä¾‹å¦‚ &#x27;disable&#x27;(ç¦ç”¨), &#x27;axis-x&#x27;(åªèƒ½æ°´å¹³æ‹–æ‹½), &#x27;unlimited&#x27;(è‡ªç”±æ‹–æ‹½)</span></span><br><span class="line">live2d_settings[<span class="string">&quot;waifuDraggableRevert&quot;</span>] = <span class="literal">true</span>; <span class="comment">// æ¾å¼€é¼ æ ‡è¿˜åŸæ‹–æ‹½ä½ç½®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä»–æ‚é¡¹è®¾ç½®</span></span><br><span class="line">live2d_settings[<span class="string">&quot;l2dVersion&quot;</span>] = <span class="string">&quot;1.4.2&quot;</span>; <span class="comment">// å½“å‰ç‰ˆæœ¬</span></span><br><span class="line">live2d_settings[<span class="string">&quot;l2dVerDate&quot;</span>] = <span class="string">&quot;2018.11.12&quot;</span>; <span class="comment">// ç‰ˆæœ¬æ›´æ–°æ—¥æœŸ</span></span><br><span class="line">live2d_settings[<span class="string">&quot;homePageUrl&quot;</span>] = <span class="string">&quot;auto&quot;</span>; <span class="comment">// ä¸»é¡µåœ°å€ï¼Œå¯é€‰ &#x27;auto&#x27;(è‡ªåŠ¨), &#x27;&#123;URL ç½‘å€&#125;&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;aboutPageUrl&quot;</span>] =</span><br><span class="line">    <span class="string">&quot;https://yaoxi-std.github.io/2022/01/15/extra-blog-live2d/&quot;</span>; <span class="comment">// å…³äºé¡µåœ°å€, &#x27;&#123;URL ç½‘å€&#125;&#x27;</span></span><br><span class="line">live2d_settings[<span class="string">&quot;screenshotCaptureName&quot;</span>] = <span class="string">&quot;live2d.png&quot;</span>; <span class="comment">// çœ‹æ¿å¨˜æˆªå›¾æ–‡ä»¶åï¼Œä¾‹å¦‚ &#x27;live2d.png&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">render</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> tokenReg = <span class="regexp">/(\\)?\&#123;([^\&#123;\&#125;\\]+)(\\)?\&#125;/g</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">replace</span>(tokenReg, <span class="keyword">function</span> (<span class="params">word, slash1, token, slash2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (slash1 || slash2) &#123;</span><br><span class="line">            <span class="keyword">return</span> word.<span class="title function_">replace</span>(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> variables = token.<span class="title function_">replace</span>(<span class="regexp">/\s/g</span>, <span class="string">&quot;&quot;</span>).<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> currentObject = context;</span><br><span class="line">        <span class="keyword">var</span> i, length, variable;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>, length = variables.<span class="property">length</span>; i &lt; length; ++i) &#123;</span><br><span class="line">            variable = variables[i];</span><br><span class="line">            currentObject = currentObject[variable];</span><br><span class="line">            <span class="keyword">if</span> (currentObject === <span class="literal">undefined</span> || currentObject === <span class="literal">null</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> currentObject;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> re = <span class="regexp">/x/</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(re);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">empty</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> obj == <span class="string">&quot;undefined&quot;</span> || obj == <span class="literal">null</span> || obj == <span class="string">&quot;&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRandText</span>(<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(text)</span><br><span class="line">        ? text[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * text.<span class="property">length</span> + <span class="number">1</span>) - <span class="number">1</span>]</span><br><span class="line">        : text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showMessage</span>(<span class="params">text, timeout, flag</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        flag ||</span><br><span class="line">        sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;waifu-text&quot;</span>) === <span class="string">&quot;&quot;</span> ||</span><br><span class="line">        sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;waifu-text&quot;</span>) === <span class="literal">null</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(text))</span><br><span class="line">            text = text[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * text.<span class="property">length</span> + <span class="number">1</span>) - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (live2d_settings.<span class="property">showF12Message</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Message]&quot;</span>, text.<span class="title function_">replace</span>(<span class="regexp">/&lt;[^&lt;&gt;]+&gt;/g</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (flag) sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;waifu-text&quot;</span>, text);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&quot;.waifu-tips&quot;</span>).<span class="title function_">stop</span>();</span><br><span class="line">        $(<span class="string">&quot;.waifu-tips&quot;</span>).<span class="title function_">html</span>(text).<span class="title function_">fadeTo</span>(<span class="number">200</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (timeout === <span class="literal">undefined</span>) timeout = <span class="number">5000</span>;</span><br><span class="line">        <span class="title function_">hideMessage</span>(timeout);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hideMessage</span>(<span class="params">timeout</span>) &#123;</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).<span class="title function_">stop</span>().<span class="title function_">css</span>(<span class="string">&quot;opacity&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (timeout === <span class="literal">undefined</span>) timeout = <span class="number">5000</span>;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        sessionStorage.<span class="title function_">removeItem</span>(<span class="string">&quot;waifu-text&quot;</span>);</span><br><span class="line">    &#125;, timeout);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).<span class="title function_">delay</span>(timeout).<span class="title function_">fadeTo</span>(<span class="number">200</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initModel</span>(<span class="params">waifuPath, type</span>) &#123;</span><br><span class="line">    <span class="comment">/* console welcome message */</span></span><br><span class="line">    <span class="built_in">eval</span>(</span><br><span class="line">        (<span class="keyword">function</span> (<span class="params">p, a, c, k, e, r</span>) &#123;</span><br><span class="line">            e = <span class="keyword">function</span> (<span class="params">c</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> (</span><br><span class="line">                    (c &lt; a ? <span class="string">&quot;&quot;</span> : <span class="title function_">e</span>(<span class="built_in">parseInt</span>(c / a))) +</span><br><span class="line">                    ((c = c % a) &gt; <span class="number">35</span> ? <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(c + <span class="number">29</span>) : c.<span class="title function_">toString</span>(<span class="number">36</span>))</span><br><span class="line">                );</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.<span class="title function_">replace</span>(<span class="regexp">/^/</span>, <span class="title class_">String</span>)) &#123;</span><br><span class="line">                <span class="keyword">while</span> (c--) r[<span class="title function_">e</span>(c)] = k[c] || <span class="title function_">e</span>(c);</span><br><span class="line">                k = [</span><br><span class="line">                    <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> r[e];</span><br><span class="line">                    &#125;,</span><br><span class="line">                ];</span><br><span class="line">                e = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;\\w+&quot;</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                c = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (c--)</span><br><span class="line">                <span class="keyword">if</span> (k[c]) p = p.<span class="title function_">replace</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;\\b&quot;</span> + <span class="title function_">e</span>(c) + <span class="string">&quot;\\b&quot;</span>, <span class="string">&quot;g&quot;</span>), k[c]);</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        &#125;)(</span><br><span class="line">            <span class="string">&quot;8.d(\&quot; \&quot;);8.d(\&quot;\\U,.\\y\\5.\\1\\1\\1\\1/\\1,\\u\\2 \\H\\n\\1\\1\\1\\1\\1\\b &#x27;, !-\\r\\j-i\\1/\\1/\\g\\n\\1\\1\\1 \\1 \\a\\4\\f&#x27;\\1\\1\\1 L/\\a\\4\\5\\2\\n\\1\\1 \\1 /\\1 \\a,\\1 /|\\1 ,\\1 ,\\1\\1\\1 &#x27;,\\n\\1\\1\\1\\q \\1/ /-\\j/\\1\\h\\E \\9 \\5!\\1 i\\n\\1\\1\\1 \\3 \\6 7\\q\\4\\c\\1 \\3&#x27;\\s-\\c\\2!\\t|\\1 |\\n\\1\\1\\1\\1 !,/7 &#x27;0&#x27;\\1\\1 \\X\\w| \\1 |\\1\\1\\1\\n\\1\\1\\1\\1 |.\\x\\\&quot;\\1\\l\\1\\1 ,,,, / |./ \\1 |\\n\\1\\1\\1\\1 \\3&#x27;| i\\z.\\2,,A\\l,.\\B / \\1.i \\1|\\n\\1\\1\\1\\1\\1 \\3&#x27;| | / C\\D/\\3&#x27;\\5,\\1\\9.\\1|\\n\\1\\1\\1\\1\\1\\1 | |/i \\m|/\\1 i\\1,.\\6 |\\F\\1|\\n\\1\\1\\1\\1\\1\\1.|/ /\\1\\h\\G \\1 \\6!\\1\\1\\b\\1|\\n\\1\\1\\1 \\1 \\1 k\\5&gt;\\2\\9 \\1 o,.\\6\\2 \\1 /\\2!\\n\\1\\1\\1\\1\\1\\1 !&#x27;\\m//\\4\\I\\g&#x27;, \\b \\4&#x27;7&#x27;\\J&#x27;\\n\\1\\1\\1\\1\\1\\1 \\3&#x27;\\K|M,p,\\O\\3|\\P\\n\\1\\1\\1\\1\\1 \\1\\1\\1\\c-,/\\1|p./\\n\\1\\1\\1\\1\\1 \\1\\1\\1&#x27;\\f&#x27;\\1\\1!o,.:\\Q \\R\\S\\T v\&quot;+e.V+\&quot; / W \&quot;+e.N);8.d(\&quot; \&quot;);&quot;</span>,</span><br><span class="line">            <span class="number">60</span>,</span><br><span class="line">            <span class="number">60</span>,</span><br><span class="line">            <span class="string">&quot;|u3000|uff64|uff9a|uff40|u30fd|uff8d||console|uff8a|uff0f|uff3c|uff84|log|live2d_settings|uff70|u00b4|uff49||u2010||u3000_|u3008||_|___|uff72|u2500|uff67|u30cf|u30fc||u30bd|u4ece|u30d8|uff1e|__|u30a4|k_|uff17_|u3000L_|u3000i|uff1a|u3009|uff34|uff70r|u30fdL__||___i|l2dVerDate|u30f3|u30ce|nLive2D|u770b|u677f|u5a18|u304f__|l2dVersion|FGHRSH|u00b40i&quot;</span>.<span class="title function_">split</span>(</span><br><span class="line">                <span class="string">&quot;|&quot;</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            &#123;&#125;</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* åˆ¤æ–­ JQuery */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> $.ajax != <span class="string">&quot;function&quot;</span>)</span><br><span class="line">        <span class="keyword">typeof</span> jQuery.<span class="property">ajax</span> == <span class="string">&quot;function&quot;</span></span><br><span class="line">            ? (<span class="variable language_">window</span>.<span class="property">$</span> = jQuery)</span><br><span class="line">            : <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Error] JQuery is not defined.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* åŠ è½½çœ‹æ¿å¨˜æ ·å¼ */</span></span><br><span class="line">    live2d_settings.<span class="property">waifuSize</span> = live2d_settings.<span class="property">waifuSize</span>.<span class="title function_">split</span>(<span class="string">&quot;x&quot;</span>);</span><br><span class="line">    live2d_settings.<span class="property">waifuTipsSize</span> = live2d_settings.<span class="property">waifuTipsSize</span>.<span class="title function_">split</span>(<span class="string">&quot;x&quot;</span>);</span><br><span class="line">    live2d_settings.<span class="property">waifuEdgeSide</span> = live2d_settings.<span class="property">waifuEdgeSide</span>.<span class="title function_">split</span>(<span class="string">&quot;:&quot;</span>);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#live2d&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, live2d_settings.<span class="property">waifuSize</span>[<span class="number">0</span>]);</span><br><span class="line">    $(<span class="string">&quot;#live2d&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, live2d_settings.<span class="property">waifuSize</span>[<span class="number">1</span>]);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).<span class="title function_">width</span>(live2d_settings.<span class="property">waifuTipsSize</span>[<span class="number">0</span>]);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).<span class="title function_">height</span>(live2d_settings.<span class="property">waifuTipsSize</span>[<span class="number">1</span>]);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;top&quot;</span>, live2d_settings.<span class="property">waifuToolTop</span>);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tips&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;font-size&quot;</span>, live2d_settings.<span class="property">waifuFontSize</span>);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tool&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;font-size&quot;</span>, live2d_settings.<span class="property">waifuToolFont</span>);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tool span&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;line-height&quot;</span>, live2d_settings.<span class="property">waifuToolLine</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.<span class="property">waifuEdgeSide</span>[<span class="number">0</span>] == <span class="string">&quot;left&quot;</span>)</span><br><span class="line">        $(<span class="string">&quot;.waifu&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;left&quot;</span>, live2d_settings.<span class="property">waifuEdgeSide</span>[<span class="number">1</span>] + <span class="string">&quot;px&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (live2d_settings.<span class="property">waifuEdgeSide</span>[<span class="number">0</span>] == <span class="string">&quot;right&quot;</span>)</span><br><span class="line">        $(<span class="string">&quot;.waifu&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;right&quot;</span>, live2d_settings.<span class="property">waifuEdgeSide</span>[<span class="number">1</span>] + <span class="string">&quot;px&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">waifuResize</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $(<span class="variable language_">window</span>).<span class="title function_">width</span>() &lt;= <span class="title class_">Number</span>(live2d_settings.<span class="property">waifuMinWidth</span>.<span class="title function_">replace</span>(<span class="string">&quot;px&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">            ? $(<span class="string">&quot;.waifu&quot;</span>).<span class="title function_">hide</span>()</span><br><span class="line">            : $(<span class="string">&quot;.waifu&quot;</span>).<span class="title function_">show</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.<span class="property">waifuMinWidth</span> != <span class="string">&quot;disable&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">waifuResize</span>();</span><br><span class="line">        $(<span class="variable language_">window</span>).<span class="title function_">resize</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">waifuResize</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (live2d_settings.<span class="property">waifuDraggable</span> == <span class="string">&quot;axis-x&quot;</span>)</span><br><span class="line">            $(<span class="string">&quot;.waifu&quot;</span>).<span class="title function_">draggable</span>(&#123;</span><br><span class="line">                <span class="attr">axis</span>: <span class="string">&quot;x&quot;</span>,</span><br><span class="line">                <span class="attr">revert</span>: live2d_settings.<span class="property">waifuDraggableRevert</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (live2d_settings.<span class="property">waifuDraggable</span> == <span class="string">&quot;unlimited&quot;</span>)</span><br><span class="line">            $(<span class="string">&quot;.waifu&quot;</span>).<span class="title function_">draggable</span>(&#123; <span class="attr">revert</span>: live2d_settings.<span class="property">waifuDraggableRevert</span> &#125;);</span><br><span class="line">        <span class="keyword">else</span> $(<span class="string">&quot;.waifu&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;transition&quot;</span>, <span class="string">&quot;all .3s ease-in-out&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Error] JQuery UI is not defined.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    live2d_settings.<span class="property">homePageUrl</span> =</span><br><span class="line">        live2d_settings.<span class="property">homePageUrl</span> == <span class="string">&quot;auto&quot;</span></span><br><span class="line">            ? <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">protocol</span> + <span class="string">&quot;//&quot;</span> + <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hostname</span> + (<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">port</span> ? <span class="string">&#x27;:&#x27;</span> + <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">port</span> : <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;/&quot;</span></span><br><span class="line">            : live2d_settings.<span class="property">homePageUrl</span>;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">protocol</span> == <span class="string">&quot;file:&quot;</span> &amp;&amp;</span><br><span class="line">        live2d_settings.<span class="property">modelAPI</span>.<span class="title function_">substr</span>(<span class="number">0</span>, <span class="number">2</span>) == <span class="string">&quot;//&quot;</span></span><br><span class="line">    )</span><br><span class="line">        live2d_settings.<span class="property">modelAPI</span> = <span class="string">&quot;http:&quot;</span> + live2d_settings.<span class="property">modelAPI</span>;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-home&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">//window.location = &#x27;https://www.fghrsh.net/&#x27;;</span></span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span> = live2d_settings.<span class="property">homePageUrl</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-info-circle&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">//window.open(&#x27;https://imjad.cn/archives/lab/add-dynamic-poster-girl-with-live2d-to-your-blog-02&#x27;);</span></span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">open</span>(live2d_settings.<span class="property">aboutPageUrl</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> waifuPath == <span class="string">&quot;object&quot;</span>) <span class="title function_">loadTipsMessage</span>(waifuPath);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">cache</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">url</span>:</span><br><span class="line">                waifuPath == <span class="string">&quot;&quot;</span></span><br><span class="line">                    ? live2d_settings.<span class="property">tipsMessage</span></span><br><span class="line">                    : waifuPath.<span class="title function_">substr</span>(waifuPath.<span class="property">length</span> - <span class="number">15</span>) == <span class="string">&quot;waifu-tips.json&quot;</span></span><br><span class="line">                    ? waifuPath</span><br><span class="line">                    : waifuPath + <span class="string">&quot;waifu-tips.json&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">                <span class="title function_">loadTipsMessage</span>(result);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.<span class="property">showToolMenu</span>) $(<span class="string">&quot;.waifu-tool&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.<span class="property">canCloseLive2d</span>) $(<span class="string">&quot;.waifu-tool .fui-cross&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.<span class="property">canSwitchModel</span>) $(<span class="string">&quot;.waifu-tool .fui-eye&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.<span class="property">canSwitchTextures</span>) $(<span class="string">&quot;.waifu-tool .fui-user&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.<span class="property">canSwitchHitokoto</span>) $(<span class="string">&quot;.waifu-tool .fui-chat&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.<span class="property">canTakeScreenshot</span>) $(<span class="string">&quot;.waifu-tool .fui-photo&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.<span class="property">canTurnToHomePage</span>) $(<span class="string">&quot;.waifu-tool .fui-home&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.<span class="property">canTurnToAboutPage</span>)</span><br><span class="line">        $(<span class="string">&quot;.waifu-tool .fui-info-circle&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (waifuPath === <span class="literal">undefined</span>) waifuPath = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> modelId = sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;modelId&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> modelTexturesId = sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;modelTexturesId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!live2d_settings.<span class="property">modelStorage</span> || modelId == <span class="literal">null</span>) &#123;</span><br><span class="line">        modelId = live2d_settings.<span class="property">modelId</span>;</span><br><span class="line">        modelTexturesId = live2d_settings.<span class="property">modelTexturesId</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">loadModel</span>(modelId, modelTexturesId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadModel</span>(<span class="params">modelId, modelTexturesId = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.<span class="property">modelStorage</span>) &#123;</span><br><span class="line">        sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;modelId&quot;</span>, modelId);</span><br><span class="line">        sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;modelTexturesId&quot;</span>, modelTexturesId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        live2d_settings[<span class="string">&quot;modelId&quot;</span>] = modelId;</span><br><span class="line">        live2d_settings[<span class="string">&quot;modelTexturesId&quot;</span>] = modelTexturesId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">loadlive2d</span>(</span><br><span class="line">        <span class="string">&quot;live2d&quot;</span>,</span><br><span class="line">        live2d_settings.<span class="property">modelAPI</span> + <span class="string">&quot;get/?id=&quot;</span> + modelId + <span class="string">&quot;-&quot;</span> + modelTexturesId,</span><br><span class="line">        live2d_settings.<span class="property">showF12Status</span></span><br><span class="line">            ? <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">                    <span class="string">&quot;[Status]&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;live2d&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;æ¨¡å‹&quot;</span>,</span><br><span class="line">                    modelId + <span class="string">&quot;-&quot;</span> + modelTexturesId,</span><br><span class="line">                    <span class="string">&quot;åŠ è½½å®Œæˆ&quot;</span></span><br><span class="line">                )</span><br><span class="line">            : <span class="literal">null</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadTipsMessage</span>(<span class="params">result</span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">waifu_tips</span> = result;</span><br><span class="line"></span><br><span class="line">    $.<span class="title function_">each</span>(result.<span class="property">mouseover</span>, <span class="keyword">function</span> (<span class="params">index, tips</span>) &#123;</span><br><span class="line">        $(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&quot;mouseover&quot;</span>, tips.<span class="property">selector</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> text = <span class="title function_">getRandText</span>(tips.<span class="property">text</span>);</span><br><span class="line">            text = text.<span class="title function_">render</span>(&#123; <span class="attr">text</span>: $(<span class="variable language_">this</span>).<span class="title function_">text</span>() &#125;);</span><br><span class="line">            <span class="title function_">showMessage</span>(text, <span class="number">3000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    $.<span class="title function_">each</span>(result.<span class="property">click</span>, <span class="keyword">function</span> (<span class="params">index, tips</span>) &#123;</span><br><span class="line">        $(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&quot;click&quot;</span>, tips.<span class="property">selector</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> text = <span class="title function_">getRandText</span>(tips.<span class="property">text</span>);</span><br><span class="line">            text = text.<span class="title function_">render</span>(&#123; <span class="attr">text</span>: $(<span class="variable language_">this</span>).<span class="title function_">text</span>() &#125;);</span><br><span class="line">            <span class="title function_">showMessage</span>(text, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    $.<span class="title function_">each</span>(result.<span class="property">seasons</span>, <span class="keyword">function</span> (<span class="params">index, tips</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="keyword">var</span> after = tips.<span class="property">date</span>.<span class="title function_">split</span>(<span class="string">&quot;-&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">var</span> before = tips.<span class="property">date</span>.<span class="title function_">split</span>(<span class="string">&quot;-&quot;</span>)[<span class="number">1</span>] || after;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            after.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>)[<span class="number">0</span>] &lt;= now.<span class="title function_">getMonth</span>() + <span class="number">1</span> &amp;&amp;</span><br><span class="line">            now.<span class="title function_">getMonth</span>() + <span class="number">1</span> &lt;= before.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>)[<span class="number">0</span>] &amp;&amp;</span><br><span class="line">            after.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>)[<span class="number">1</span>] &lt;= now.<span class="title function_">getDate</span>() &amp;&amp;</span><br><span class="line">            now.<span class="title function_">getDate</span>() &lt;= before.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="keyword">var</span> text = <span class="title function_">getRandText</span>(tips.<span class="property">text</span>);</span><br><span class="line">            text = text.<span class="title function_">render</span>(&#123; <span class="attr">year</span>: now.<span class="title function_">getFullYear</span>() &#125;);</span><br><span class="line">            <span class="title function_">showMessage</span>(text, <span class="number">6000</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.<span class="property">showF12OpenMsg</span>) &#123;</span><br><span class="line">        re.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">showMessage</span>(<span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">console_open_msg</span>), <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.<span class="property">showCopyMessage</span>) &#123;</span><br><span class="line">        $(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&quot;copy&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">showMessage</span>(<span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">copy_message</span>), <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-photo&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">showMessage</span>(<span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">screenshot_message</span>), <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">Live2D</span>.<span class="property">captureName</span> = live2d_settings.<span class="property">screenshotCaptureName</span>;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">Live2D</span>.<span class="property">captureFrame</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-cross&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;waifu-dsiplay&quot;</span>, <span class="string">&quot;none&quot;</span>);</span><br><span class="line">        <span class="title function_">showMessage</span>(<span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">hidden_message</span>), <span class="number">1300</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            $(<span class="string">&quot;.waifu&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">        &#125;, <span class="number">1300</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">showWelcomeMessage</span> = <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> text;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> == live2d_settings.<span class="property">homePageUrl</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getHours</span>();</span><br><span class="line">            <span class="keyword">if</span> (now &gt; <span class="number">23</span> || now &lt;= <span class="number">5</span>)</span><br><span class="line">                text = <span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">hour_tips</span>.<span class="property">t23</span> - <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">5</span> &amp;&amp; now &lt;= <span class="number">7</span>)</span><br><span class="line">                text = <span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">hour_tips</span>.<span class="property">t5</span> - <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">7</span> &amp;&amp; now &lt;= <span class="number">11</span>)</span><br><span class="line">                text = <span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">hour_tips</span>.<span class="property">t7</span> - <span class="number">11</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">11</span> &amp;&amp; now &lt;= <span class="number">14</span>)</span><br><span class="line">                text = <span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">hour_tips</span>.<span class="property">t11</span> - <span class="number">14</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">14</span> &amp;&amp; now &lt;= <span class="number">17</span>)</span><br><span class="line">                text = <span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">hour_tips</span>.<span class="property">t14</span> - <span class="number">17</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">17</span> &amp;&amp; now &lt;= <span class="number">19</span>)</span><br><span class="line">                text = <span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">hour_tips</span>.<span class="property">t17</span> - <span class="number">19</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">19</span> &amp;&amp; now &lt;= <span class="number">21</span>)</span><br><span class="line">                text = <span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">hour_tips</span>.<span class="property">t19</span> - <span class="number">21</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (now &gt; <span class="number">21</span> &amp;&amp; now &lt;= <span class="number">23</span>)</span><br><span class="line">                text = <span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">hour_tips</span>.<span class="property">t21</span> - <span class="number">23</span>);</span><br><span class="line">            <span class="keyword">else</span> text = <span class="title function_">getRandText</span>(result.<span class="property">waifu</span>.<span class="property">hour_tips</span>.<span class="property">default</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> referrer_message = result.<span class="property">waifu</span>.<span class="property">referrer_message</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">referrer</span> !== <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> referrer = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                referrer.<span class="property">href</span> = <span class="variable language_">document</span>.<span class="property">referrer</span>;</span><br><span class="line">                <span class="keyword">var</span> domain = referrer.<span class="property">hostname</span>.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hostname</span> == referrer.<span class="property">hostname</span>)</span><br><span class="line">                    text =</span><br><span class="line">                        referrer_message.<span class="property">localhost</span>[<span class="number">0</span>] +</span><br><span class="line">                        <span class="variable language_">document</span>.<span class="property">title</span>.<span class="title function_">split</span>(referrer_message.<span class="property">localhost</span>[<span class="number">2</span>])[<span class="number">0</span>] +</span><br><span class="line">                        referrer_message.<span class="property">localhost</span>[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (domain == <span class="string">&quot;baidu&quot;</span>)</span><br><span class="line">                    text =</span><br><span class="line">                        referrer_message.<span class="property">baidu</span>[<span class="number">0</span>] +</span><br><span class="line">                        referrer.<span class="property">search</span>.<span class="title function_">split</span>(<span class="string">&quot;&amp;wd=&quot;</span>)[<span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>)[<span class="number">0</span>] +</span><br><span class="line">                        referrer_message.<span class="property">baidu</span>[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (domain == <span class="string">&quot;so&quot;</span>)</span><br><span class="line">                    text =</span><br><span class="line">                        referrer_message.<span class="property">so</span>[<span class="number">0</span>] +</span><br><span class="line">                        referrer.<span class="property">search</span>.<span class="title function_">split</span>(<span class="string">&quot;&amp;q=&quot;</span>)[<span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>)[<span class="number">0</span>] +</span><br><span class="line">                        referrer_message.<span class="property">so</span>[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (domain == <span class="string">&quot;google&quot;</span>)</span><br><span class="line">                    text =</span><br><span class="line">                        referrer_message.<span class="property">google</span>[<span class="number">0</span>] +</span><br><span class="line">                        <span class="variable language_">document</span>.<span class="property">title</span>.<span class="title function_">split</span>(referrer_message.<span class="property">google</span>[<span class="number">2</span>])[<span class="number">0</span>] +</span><br><span class="line">                        referrer_message.<span class="property">google</span>[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    $.<span class="title function_">each</span>(result.<span class="property">waifu</span>.<span class="property">referrer_hostname</span>, <span class="keyword">function</span> (<span class="params">i, val</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (i == referrer.<span class="property">hostname</span>) referrer.<span class="property">hostname</span> = <span class="title function_">getRandText</span>(val);</span><br><span class="line">                    &#125;);</span><br><span class="line">                    text =</span><br><span class="line">                        referrer_message.<span class="property">default</span>[<span class="number">0</span>] +</span><br><span class="line">                        referrer.<span class="property">hostname</span> +</span><br><span class="line">                        referrer_message.<span class="property">default</span>[<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">                text =</span><br><span class="line">                    referrer_message.<span class="property">none</span>[<span class="number">0</span>] +</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="property">title</span>.<span class="title function_">split</span>(referrer_message.<span class="property">none</span>[<span class="number">2</span>])[<span class="number">0</span>] +</span><br><span class="line">                    referrer_message.<span class="property">none</span>[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">showMessage</span>(text, <span class="number">6000</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.<span class="property">showWelcomeMessage</span>) <span class="title function_">showWelcomeMessage</span>(result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> waifu_tips = result.<span class="property">waifu</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">loadOtherModel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> modelId = <span class="title function_">modelStorageGetItem</span>(<span class="string">&quot;modelId&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> modelRandMode = live2d_settings.<span class="property">modelRandMode</span>;</span><br><span class="line"></span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">cache</span>: modelRandMode == <span class="string">&quot;switch&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">url</span>: live2d_settings.<span class="property">modelAPI</span> + modelRandMode + <span class="string">&quot;/?id=&quot;</span> + modelId,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">                <span class="title function_">loadModel</span>(result.<span class="property">model</span>[<span class="string">&quot;id&quot;</span>]);</span><br><span class="line">                <span class="keyword">var</span> message = result.<span class="property">model</span>[<span class="string">&quot;message&quot;</span>];</span><br><span class="line">                $.<span class="title function_">each</span>(waifu_tips.<span class="property">model_message</span>, <span class="keyword">function</span> (<span class="params">i, val</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (i == result.<span class="property">model</span>[<span class="string">&quot;id&quot;</span>]) message = <span class="title function_">getRandText</span>(val);</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="title function_">showMessage</span>(message, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">loadRandTextures</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> modelId = <span class="title function_">modelStorageGetItem</span>(<span class="string">&quot;modelId&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> modelTexturesId = <span class="title function_">modelStorageGetItem</span>(<span class="string">&quot;modelTexturesId&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> modelTexturesRandMode = live2d_settings.<span class="property">modelTexturesRandMode</span>;</span><br><span class="line"></span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">cache</span>: modelTexturesRandMode == <span class="string">&quot;switch&quot;</span> ? <span class="literal">true</span> : <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">url</span>:</span><br><span class="line">                live2d_settings.<span class="property">modelAPI</span> +</span><br><span class="line">                modelTexturesRandMode +</span><br><span class="line">                <span class="string">&quot;_textures/?id=&quot;</span> +</span><br><span class="line">                modelId +</span><br><span class="line">                <span class="string">&quot;-&quot;</span> +</span><br><span class="line">                modelTexturesId,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (</span><br><span class="line">                    result.<span class="property">textures</span>[<span class="string">&quot;id&quot;</span>] == <span class="number">1</span> &amp;&amp;</span><br><span class="line">                    (modelTexturesId == <span class="number">1</span> || modelTexturesId == <span class="number">0</span>)</span><br><span class="line">                )</span><br><span class="line">                    <span class="title function_">showMessage</span>(waifu_tips.<span class="property">load_rand_textures</span>[<span class="number">0</span>], <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="title function_">showMessage</span>(waifu_tips.<span class="property">load_rand_textures</span>[<span class="number">1</span>], <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">                <span class="title function_">loadModel</span>(modelId, result.<span class="property">textures</span>[<span class="string">&quot;id&quot;</span>]);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">modelStorageGetItem</span>(<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> live2d_settings.<span class="property">modelStorage</span></span><br><span class="line">            ? sessionStorage.<span class="title function_">getItem</span>(key)</span><br><span class="line">            : live2d_settings[key];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ£€æµ‹ç”¨æˆ·æ´»åŠ¨çŠ¶æ€ï¼Œå¹¶åœ¨ç©ºé—²æ—¶æ˜¾ç¤ºä¸€è¨€ */</span></span><br><span class="line">    <span class="keyword">if</span> (live2d_settings.<span class="property">showHitokoto</span>) &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">getActed</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">hitokotoTimer</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">hitokotoInterval</span> = <span class="literal">false</span>;</span><br><span class="line">        $(<span class="variable language_">document</span>)</span><br><span class="line">            .<span class="title function_">mousemove</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">                getActed = <span class="literal">true</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">keydown</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                getActed = <span class="literal">true</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!getActed) <span class="title function_">ifActed</span>();</span><br><span class="line">            <span class="keyword">else</span> <span class="title function_">elseActed</span>();</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">ifActed</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!hitokotoInterval) &#123;</span><br><span class="line">            hitokotoInterval = <span class="literal">true</span>;</span><br><span class="line">            hitokotoTimer = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(showHitokotoActed, <span class="number">30000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">elseActed</span>(<span class="params"></span>) &#123;</span><br><span class="line">        getActed = hitokotoInterval = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="built_in">clearInterval</span>(hitokotoTimer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showHitokotoActed</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($(<span class="variable language_">document</span>)[<span class="number">0</span>].<span class="property">visibilityState</span> == <span class="string">&quot;visible&quot;</span>) <span class="title function_">showHitokoto</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showHitokoto</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (live2d_settings.<span class="property">hitokotoAPI</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;lwl12.com&quot;</span>:</span><br><span class="line">                $.<span class="title function_">getJSON</span>(</span><br><span class="line">                    <span class="string">&quot;https://api.lwl12.com/hitokoto/v1?encode=realjson&quot;</span>,</span><br><span class="line">                    <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!<span class="title function_">empty</span>(result.<span class="property">source</span>)) &#123;</span><br><span class="line">                            <span class="keyword">var</span> text = waifu_tips.<span class="property">hitokoto_api_message</span>[<span class="string">&quot;lwl12.com&quot;</span>][<span class="number">0</span>];</span><br><span class="line">                            <span class="keyword">if</span> (!<span class="title function_">empty</span>(result.<span class="property">author</span>))</span><br><span class="line">                                text += waifu_tips.<span class="property">hitokoto_api_message</span>[<span class="string">&quot;lwl12.com&quot;</span>][<span class="number">1</span>];</span><br><span class="line">                            text = text.<span class="title function_">render</span>(&#123;</span><br><span class="line">                                <span class="attr">source</span>: result.<span class="property">source</span>,</span><br><span class="line">                                <span class="attr">creator</span>: result.<span class="property">author</span>,</span><br><span class="line">                            &#125;);</span><br><span class="line">                            <span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                                <span class="title function_">showMessage</span>(</span><br><span class="line">                                    text + waifu_tips.<span class="property">hitokoto_api_message</span>[<span class="string">&quot;lwl12.com&quot;</span>][<span class="number">2</span>],</span><br><span class="line">                                    <span class="number">3000</span>,</span><br><span class="line">                                    <span class="literal">true</span></span><br><span class="line">                                );</span><br><span class="line">                            &#125;, <span class="number">5000</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="title function_">showMessage</span>(result.<span class="property">text</span>, <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;fghrsh.net&quot;</span>:</span><br><span class="line">                $.<span class="title function_">getJSON</span>(</span><br><span class="line">                    <span class="string">&quot;https://api.fghrsh.net/hitokoto/rand/?encode=jsc&amp;uid=3335&quot;</span>,</span><br><span class="line">                    <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!<span class="title function_">empty</span>(result.<span class="property">source</span>)) &#123;</span><br><span class="line">                            <span class="keyword">var</span> text = waifu_tips.<span class="property">hitokoto_api_message</span>[<span class="string">&quot;fghrsh.net&quot;</span>][<span class="number">0</span>];</span><br><span class="line">                            text = text.<span class="title function_">render</span>(&#123; <span class="attr">source</span>: result.<span class="property">source</span>, <span class="attr">date</span>: result.<span class="property">date</span> &#125;);</span><br><span class="line">                            <span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                                <span class="title function_">showMessage</span>(text, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">                            &#125;, <span class="number">5000</span>);</span><br><span class="line">                            <span class="title function_">showMessage</span>(result.<span class="property">hitokoto</span>, <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;jinrishici.com&quot;</span>:</span><br><span class="line">                $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">&quot;https://v2.jinrishici.com/one.json&quot;</span>,</span><br><span class="line">                    <span class="attr">xhrFields</span>: &#123; <span class="attr">withCredentials</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">                    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result, status</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!<span class="title function_">empty</span>(result.<span class="property">data</span>.<span class="property">origin</span>.<span class="property">title</span>)) &#123;</span><br><span class="line">                            <span class="keyword">var</span> text = waifu_tips.<span class="property">hitokoto_api_message</span>[<span class="string">&quot;jinrishici.com&quot;</span>][<span class="number">0</span>];</span><br><span class="line">                            text = text.<span class="title function_">render</span>(&#123;</span><br><span class="line">                                <span class="attr">title</span>: result.<span class="property">data</span>.<span class="property">origin</span>.<span class="property">title</span>,</span><br><span class="line">                                <span class="attr">dynasty</span>: result.<span class="property">data</span>.<span class="property">origin</span>.<span class="property">dynasty</span>,</span><br><span class="line">                                <span class="attr">author</span>: result.<span class="property">data</span>.<span class="property">origin</span>.<span class="property">author</span>,</span><br><span class="line">                            &#125;);</span><br><span class="line">                            <span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                                <span class="title function_">showMessage</span>(text, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">                            &#125;, <span class="number">5000</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="title function_">showMessage</span>(result.<span class="property">data</span>.<span class="property">content</span>, <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                $.<span class="title function_">getJSON</span>(<span class="string">&quot;https://v1.hitokoto.cn&quot;</span>, <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="title function_">empty</span>(result.<span class="property">from</span>)) &#123;</span><br><span class="line">                        <span class="keyword">var</span> text = waifu_tips.<span class="property">hitokoto_api_message</span>[<span class="string">&quot;hitokoto.cn&quot;</span>][<span class="number">0</span>];</span><br><span class="line">                        text = text.<span class="title function_">render</span>(&#123;</span><br><span class="line">                            <span class="attr">source</span>: result.<span class="property">from</span>,</span><br><span class="line">                            <span class="attr">creator</span>: result.<span class="property">creator</span>,</span><br><span class="line">                        &#125;);</span><br><span class="line">                        <span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                            <span class="title function_">showMessage</span>(text, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">                        &#125;, <span class="number">5000</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title function_">showMessage</span>(result.<span class="property">hitokoto</span>, <span class="number">5000</span>, <span class="literal">true</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-eye&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">loadOtherModel</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-user&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">loadRandTextures</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;.waifu-tool .fui-chat&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">showHitokoto</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>themes/next/live2d-widget/waifu-tips.json</code>ï¼Œåˆ æ‰åŸæœ‰å†…å®¹æ›¿æ¢å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;waifu&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;console_open_msg&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å“ˆå“ˆï¼Œä½ æ‰“å¼€äº†æ§åˆ¶å°ï¼Œæ˜¯æƒ³è¦çœ‹çœ‹æˆ‘çš„ç§˜å¯†å—ï¼Ÿ&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_message&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä½ éƒ½å¤åˆ¶äº†äº›ä»€ä¹ˆå‘€ï¼Œè½¬è½½è¦è®°å¾—åŠ ä¸Šå‡ºå¤„å“¦&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;screenshot_message&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ç…§å¥½äº†å˜›ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¯çˆ±å‘¢ï¼Ÿ&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hidden_message&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æˆ‘ä»¬è¿˜èƒ½å†è§é¢çš„å§â€¦&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;load_rand_textures&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æˆ‘è¿˜æ²¡æœ‰å…¶ä»–è¡£æœå‘¢&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æˆ‘çš„æ–°è¡£æœå¥½çœ‹å˜›&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hour_tips&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;t5-7&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ—©ä¸Šå¥½ï¼ä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨ï¼Œç¾å¥½çš„ä¸€å¤©å°±è¦å¼€å§‹äº†&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;t7-11&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä¸Šåˆå¥½ï¼å·¥ä½œé¡ºåˆ©å˜›ï¼Œä¸è¦ä¹…åï¼Œå¤šèµ·æ¥èµ°åŠ¨èµ°åŠ¨å“¦ï¼&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;t11-14&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä¸­åˆäº†ï¼Œå·¥ä½œäº†ä¸€ä¸ªä¸Šåˆï¼Œç°åœ¨æ˜¯åˆé¤æ—¶é—´ï¼&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;t14-17&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;åˆåå¾ˆå®¹æ˜“çŠ¯å›°å‘¢ï¼Œä»Šå¤©çš„è¿åŠ¨ç›®æ ‡å®Œæˆäº†å—ï¼Ÿ&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;t17-19&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å‚æ™šäº†ï¼çª—å¤–å¤•é˜³çš„æ™¯è‰²å¾ˆç¾ä¸½å‘¢ï¼Œæœ€ç¾ä¸è¿‡å¤•é˜³çº¢~&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;t19-21&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ™šä¸Šå¥½ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;t21-23&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å·²ç»è¿™ä¹ˆæ™šäº†å‘€ï¼Œæ—©ç‚¹ä¼‘æ¯å§ï¼Œæ™šå®‰~&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;t23-5&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä½ æ˜¯å¤œçŒ«å­å‘€ï¼Ÿè¿™ä¹ˆæ™šè¿˜ä¸ç¡è§‰ï¼Œæ˜å¤©èµ·çš„æ¥å˜›&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å—¨~ å¿«æ¥é€—æˆ‘ç©å§ï¼&quot;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;referrer_message&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;localhost&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ¬¢è¿é˜…è¯»&lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ã€&lt;/span&gt;&quot;</span><span class="punctuation">,</span> <span class="string">&quot; - &quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;baidu&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Hello! æ¥è‡ª ç™¾åº¦æœç´¢ çš„æœ‹å‹&lt;br&gt;ä½ æ˜¯æœç´¢ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&lt;/span&gt; æ‰¾åˆ°çš„æˆ‘å—ï¼Ÿ&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;so&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Hello! æ¥è‡ª 360æœç´¢ çš„æœ‹å‹&lt;br&gt;ä½ æ˜¯æœç´¢ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&lt;/span&gt; æ‰¾åˆ°çš„æˆ‘å—ï¼Ÿ&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;google&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Hello! æ¥è‡ª è°·æ­Œæœç´¢ çš„æœ‹å‹&lt;br&gt;æ¬¢è¿é˜…è¯»&lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ã€&lt;/span&gt;&quot;</span><span class="punctuation">,</span> <span class="string">&quot; - &quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Hello! æ¥è‡ª &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&lt;/span&gt; çš„æœ‹å‹&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;none&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ¬¢è¿é˜…è¯»&lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ã€&lt;/span&gt;&quot;</span><span class="punctuation">,</span> <span class="string">&quot; - &quot;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;referrer_hostname&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;yaoxi-std.github.io&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;yaoxi-std&quot;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;model_message&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ¥è‡ª Potion Maker çš„ Pio é…± ~&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ¥è‡ª Potion Maker çš„ Tia é…± ~&quot;</span><span class="punctuation">]</span>  </span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hitokoto_api_message&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;lwl12.com&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿™å¥ä¸€è¨€æ¥è‡ª &lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&#123;source&#125;ã€&lt;/span&gt;&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ï¼Œæ˜¯ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&#123;creator&#125;&lt;/span&gt; æŠ•ç¨¿çš„&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ã€‚&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fghrsh.net&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿™å¥ä¸€è¨€å‡ºå¤„æ˜¯ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&#123;source&#125;ã€&lt;/span&gt;ï¼Œæ˜¯ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;FGHRSH&lt;/span&gt; åœ¨ &#123;date&#125; æ”¶è—çš„ï¼&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;jinrishici.com&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿™å¥è¯—è¯å‡ºè‡ª &lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€Š&#123;title&#125;ã€‹&lt;/span&gt;ï¼Œæ˜¯ &#123;dynasty&#125;è¯—äºº &#123;author&#125; åˆ›ä½œçš„ï¼&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;hitokoto.cn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿™å¥ä¸€è¨€æ¥è‡ª &lt;span style=\&quot;color:#0099cc;\&quot;&gt;ã€&#123;source&#125;ã€&lt;/span&gt;ï¼Œæ˜¯ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&#123;creator&#125;&lt;/span&gt; åœ¨ hitokoto.cn æŠ•ç¨¿çš„ã€‚&quot;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mouseover&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.container a[href^=&#x27;http&#x27;]&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¦çœ‹çœ‹ &lt;span style=\&quot;color:#0099cc;\&quot;&gt;&#123;text&#125;&lt;/span&gt; ä¹ˆï¼Ÿ&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.fui-home&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ç‚¹å‡»å‰å¾€é¦–é¡µï¼Œæƒ³å›åˆ°ä¸Šä¸€é¡µå¯ä»¥ä½¿ç”¨æµè§ˆå™¨çš„åé€€åŠŸèƒ½å“¦&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.fui-chat&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä¸€è¨€ä¸€è¯­ï¼Œä¸€é¢¦ä¸€ç¬‘ã€‚ä¸€å­—ä¸€å¥ï¼Œä¸€é¢—èµ›è‰‡ã€‚&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.fui-eye&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å—¯Â·Â·Â· è¦åˆ‡æ¢ çœ‹æ¿å¨˜ å—ï¼Ÿ&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.fui-user&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å–œæ¬¢æ¢è£… Play å—ï¼Ÿ&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.fui-photo&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¦æ‹å¼ çºªå¿µç…§ç‰‡å—ï¼Ÿ&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.fui-info-circle&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿™é‡Œæœ‰å…³äºæˆ‘çš„ä¿¡æ¯å‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.fui-cross&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä½ ä¸å–œæ¬¢æˆ‘äº†å—...&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#tor_show&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ç¿»é¡µæ¯”è¾ƒéº»çƒ¦å—ï¼Œç‚¹å‡»å¯ä»¥æ˜¾ç¤ºè¿™ç¯‡æ–‡ç« çš„ç›®å½•å‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#comment_go&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æƒ³è¦å»è¯„è®ºäº›ä»€ä¹ˆå—ï¼Ÿ&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#night_mode&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ·±å¤œæ—¶è¦çˆ±æŠ¤çœ¼ç›å‘€&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#qrcode&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ‰‹æœºæ‰«ä¸€ä¸‹å°±èƒ½ç»§ç»­çœ‹ï¼Œå¾ˆæ–¹ä¾¿å‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.comment_reply&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¦åæ§½äº›ä»€ä¹ˆå‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#back-to-top&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å›åˆ°å¼€å§‹çš„åœ°æ–¹å§&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#author&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¯¥æ€ä¹ˆç§°å‘¼ä½ å‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#mail&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ç•™ä¸‹ä½ çš„é‚®ç®±ï¼Œä¸ç„¶å°±æ˜¯æ— å¤´åƒäººå£«äº†&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#url&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä½ çš„å®¶åœ¨å“ªé‡Œå‘¢ï¼Œå¥½è®©æˆ‘å»å‚è§‚å‚è§‚&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#textarea&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è®¤çœŸå¡«å†™å“¦ï¼Œåƒåœ¾è¯„è®ºæ˜¯ç¦æ­¢äº‹é¡¹&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.OwO-logo&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¦æ’å…¥ä¸€ä¸ªè¡¨æƒ…å—&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#csubmit&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¦[æäº¤]^(Commit)äº†å—ï¼Œé¦–æ¬¡è¯„è®ºéœ€è¦å®¡æ ¸ï¼Œè¯·è€å¿ƒç­‰å¾…~&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.ImageBox&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ç‚¹å‡»å›¾ç‰‡å¯ä»¥æ”¾å¤§å‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;input[name=s]&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ‰¾ä¸åˆ°æƒ³çœ‹çš„å†…å®¹ï¼Ÿæœç´¢çœ‹çœ‹å§&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.previous&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å»ä¸Šä¸€é¡µçœ‹çœ‹å§&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.next&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å»ä¸‹ä¸€é¡µçœ‹çœ‹å§&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.dropdown-toggle&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿™é‡Œæ˜¯èœå•&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c-player a.play-icon&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æƒ³è¦å¬ç‚¹éŸ³ä¹å—&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c-player div.time&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;åœ¨è¿™é‡Œå¯ä»¥è°ƒæ•´&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æ’­æ”¾è¿›åº¦&lt;/span&gt;å‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c-player div.volume&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;åœ¨è¿™é‡Œå¯ä»¥è°ƒæ•´&lt;span style=\&quot;color:#0099cc;\&quot;&gt;éŸ³é‡&lt;/span&gt;å‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c-player div.list-button&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æ’­æ”¾åˆ—è¡¨&lt;/span&gt;é‡Œéƒ½æœ‰ä»€ä¹ˆå‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c-player div.lyric-button&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æœ‰&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æ­Œè¯&lt;/span&gt;çš„è¯å°±èƒ½è·Ÿç€ä¸€èµ·å”±å‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.waifu #live2d&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;å¹²å˜›å‘¢ä½ ï¼Œå¿«æŠŠæ‰‹æ‹¿å¼€&quot;</span><span class="punctuation">,</span> <span class="string">&quot;é¼ â€¦é¼ æ ‡æ”¾é”™åœ°æ–¹äº†ï¼&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;click&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.waifu #live2d&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;æ˜¯â€¦æ˜¯ä¸å°å¿ƒç¢°åˆ°äº†å§&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;èè‰æ§æ˜¯ä»€ä¹ˆå‘€&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;ä½ çœ‹åˆ°æˆ‘çš„å°ç†Šäº†å—&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;å†æ‘¸çš„è¯æˆ‘å¯è¦æŠ¥è­¦äº†ï¼âŒ‡â—ï¹â—âŒ‡&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;110å—ï¼Œè¿™é‡Œæœ‰ä¸ªå˜æ€ä¸€ç›´åœ¨æ‘¸æˆ‘(Ã³ï¹Ã²ï½¡)&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;seasons&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;01/01&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;å…ƒæ—¦&lt;/span&gt;äº†å‘¢ï¼Œæ–°çš„ä¸€å¹´åˆå¼€å§‹äº†ï¼Œä»Šå¹´æ˜¯&#123;year&#125;å¹´~&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;02/14&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;åˆæ˜¯ä¸€å¹´&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æƒ…äººèŠ‚&lt;/span&gt;ï¼Œ&#123;year&#125;å¹´æ‰¾åˆ°å¯¹è±¡äº†å˜›~&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;03/08&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä»Šå¤©æ˜¯&lt;span style=\&quot;color:#0099cc;\&quot;&gt;å¦‡å¥³èŠ‚&lt;/span&gt;ï¼&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;03/12&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä»Šå¤©æ˜¯&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æ¤æ ‘èŠ‚&lt;/span&gt;ï¼Œè¦ä¿æŠ¤ç¯å¢ƒå‘€&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;04/01&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;æ‚„æ‚„å‘Šè¯‰ä½ ä¸€ä¸ªç§˜å¯†~&lt;span style=\&quot;background-color:#34495e;\&quot;&gt;ä»Šå¤©æ˜¯æ„šäººèŠ‚ï¼Œä¸è¦è¢«éª—äº†å“¦~&lt;/span&gt;&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;05/01&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä»Šå¤©æ˜¯&lt;span style=\&quot;color:#0099cc;\&quot;&gt;äº”ä¸€åŠ³åŠ¨èŠ‚&lt;/span&gt;ï¼Œè®¡åˆ’å¥½å‡æœŸå»å“ªé‡Œäº†å—~&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;06/01&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;å„¿ç«¥èŠ‚&lt;/span&gt;äº†å‘¢ï¼Œå¿«æ´»çš„æ—¶å…‰æ€»æ˜¯çŸ­æš‚ï¼Œè¦æ˜¯æ°¸è¿œé•¿ä¸å¤§è¯¥å¤šå¥½å•Šâ€¦&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;09/03&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;ä¸­å›½äººæ°‘æŠ—æ—¥æˆ˜äº‰èƒœåˆ©çºªå¿µæ—¥&lt;/span&gt;ï¼Œé“­è®°å†å²ã€ç¼…æ€€å…ˆçƒˆã€ççˆ±å’Œå¹³ã€å¼€åˆ›æœªæ¥ã€‚&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;09/10&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;æ•™å¸ˆèŠ‚&lt;/span&gt;ï¼Œåœ¨å­¦æ ¡è¦ç»™è€å¸ˆé—®å£°å¥½å‘€~&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10/01&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;span style=\&quot;color:#0099cc;\&quot;&gt;å›½åº†èŠ‚&lt;/span&gt;ï¼Œæ–°ä¸­å›½å·²ç»æˆç«‹äº†å‘¢&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11/05-11/12&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ä»Šå¹´çš„&lt;span style=\&quot;color:#0099cc;\&quot;&gt;åŒåä¸€&lt;/span&gt;æ˜¯å’Œè°ä¸€èµ·è¿‡çš„å‘¢~&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;12/20-12/31&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿™å‡ å¤©æ˜¯&lt;span style=\&quot;color:#0099cc;\&quot;&gt;åœ£è¯èŠ‚&lt;/span&gt;ï¼Œä¸»äººè‚¯å®šåˆå»å‰æ‰‹ä¹°ä¹°ä¹°äº†~&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>themes/next/live2d-widget/waifu-tips.css</code>ï¼Œ<strong>ä¸è¦åˆ æ‰</strong>åŸæœ‰å†…å®¹ï¼Œåœ¨æ–‡æ¡£æœ«å°¾æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.waifu</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">20px</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">20px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">15px</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">15px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu-tips</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: -<span class="number">20px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">rgba</span>(<span class="number">224</span>, <span class="number">186</span>, <span class="number">140</span>, <span class="number">0.62</span>);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">236</span>, <span class="number">217</span>, <span class="number">188</span>, <span class="number">0.5</span>);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">3px</span> <span class="number">15px</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">191</span>, <span class="number">158</span>, <span class="number">118</span>, <span class="number">0.2</span>);</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">animation-delay</span>: <span class="number">5s</span>;</span><br><span class="line">    <span class="attribute">animation-duration</span>: <span class="number">50s</span>;</span><br><span class="line">    <span class="attribute">animation-iteration-count</span>: infinite;</span><br><span class="line">    <span class="attribute">animation-name</span>: shake;</span><br><span class="line">    <span class="attribute">animation-timing-function</span>: ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu-tool</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#aaa</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.waifu-tool</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu-tool</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#5b6c7d</span>;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">0.2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu-tool</span> <span class="selector-tag">span</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#34495e</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.waifu</span> <span class="selector-id">#live2d</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> shake &#123;</span><br><span class="line">    <span class="number">2%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">4%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">6%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">8%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">10%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">12%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">14%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">16%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">18%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">20%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">22%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">24%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">26%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">1.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">28%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">0.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">30%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">1.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">32%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">34%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">36%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">38%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">40%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">0.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">42%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">44%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">46%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">1.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">48%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">50%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">52%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">0.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">54%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">56%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">58%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">60%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">62%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">64%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">66%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">68%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">70%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">72%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">0.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">74%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">76%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">78%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">2.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">80%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">82%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">84%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">0.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">86%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, <span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">88%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">90%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">92%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(<span class="number">1.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">94%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0.5px</span>, <span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">96%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">2.5px</span>, -<span class="number">0.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">98%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">1.5px</span>, -<span class="number">1.5px</span>) <span class="built_in">rotate</span>(-<span class="number">0.5deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">0%</span>, <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>) <span class="built_in">rotate</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;Flat-UI-Icons&#x27;</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;flat-ui-icons-regular.eot&#x27;</span>);</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;flat-ui-icons-regular.eot?#iefix&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;embedded-opentype&#x27;</span>), <span class="built_in">url</span>(<span class="string">&#x27;flat-ui-icons-regular.woff&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff&#x27;</span>), <span class="built_in">url</span>(<span class="string">&#x27;flat-ui-icons-regular.ttf&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;truetype&#x27;</span>), <span class="built_in">url</span>(<span class="string">&#x27;flat-ui-icons-regular.svg#flat-ui-icons-regular&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;svg&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[class^=<span class="string">&quot;fui-&quot;</span>]</span>,</span><br><span class="line"><span class="selector-attr">[class*=<span class="string">&quot;fui-&quot;</span>]</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;Flat-UI-Icons&#x27;</span>;</span><br><span class="line">  <span class="attribute">speak</span>: none;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">font-variant</span>: normal;</span><br><span class="line">  <span class="attribute">text-transform</span>: none;</span><br><span class="line">  -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span><br><span class="line">  -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-cross</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\e609&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-info-circle</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\e60f&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-photo</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\e62a&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-eye</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\e62c&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-chat</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\e62d&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-home</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\e62e&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fui-user</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\e631&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ°<a href="https://github.com/fghrsh/live2d_demo">è¿™é‡Œ</a>ä¸‹è½½ä»¥<code>flat-ui-icons</code>å¼€å¤´çš„$4$ä¸ªå›¾æ ‡æ–‡ä»¶ï¼Œæ”¾åœ¨<code>themes/next/live2d-widget/</code>æ–‡ä»¶å¤¹ä¸­ã€‚</p>
<p>è‡³æ­¤å·¥ä½œå…¨éƒ¨å®Œæˆï¼Œæ¸…ç†ç›®å½•å¹¶é‡æ–°ç”Ÿæˆ<code>html</code>æ–‡ä»¶ï¼Œæ‰“å¼€<code>localhost</code>ï¼Œä½ ä¼šå‘ç°è§’è‰²å¯ä»¥æ­£å¸¸æ¢è£…äº†ã€‚</p>
<p>æˆ‘ä¸€ç›´å¼€ç€ä¸€è¨€ç›´åˆ°æŸå¤©è¹¦å‡ºäº†ä¸€å¥â€œè¿™ç“œå¤šå°‘é’±ä¸€æ–¤â€ï¼ˆï¼Ÿï¼Ÿï¼Ÿ</p>
]]></content>
      <tags>
        <tag>blog</tag>
      </tags>
  </entry>
  <entry>
    <title>CF553E Kyoya and Train</title>
    <url>/2022/01/09/sol-cf553e/</url>
    <content><![CDATA[<h2 id="CF553E-Kyoya-and-Train"><a href="#CF553E-Kyoya-and-Train" class="headerlink" title="CF553E Kyoya and Train"></a>CF553E Kyoya and Train</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF553E">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è€ƒè™‘dpã€‚$dp_{u,i}$è¡¨ç¤ºç‚¹$u$å¤„å·²èŠ±è´¹æ—¶é—´$i$çš„æœ€å°ä»£ä»·ã€‚</p>
<script type="math/tex; mode=display">
dp_{u,i} = 
\begin{cases}
0 & (u = n, i \lt t) \\
x & (u = n, i \ge t) \\
\min\limits_{e:u \to v,w}{w+\sum\limits_{k=1}^{t}{p_{e,k} dp_{v,i+k}}} & (u \neq n, i \lt t) \\
dist(u, n) & (u \neq n, i \ge t) \\
\end{cases}</script><p>æš´åŠ›è§£dpï¼Œå¤æ‚åº¦$O(mt^2)$ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦çš„ç“¶é¢ˆåœ¨äºç¬¬ä¸‰è¡Œçš„æ±‚å’Œï¼Œè€ƒè™‘ä¼˜åŒ–å®ƒã€‚</p>
<p>è®¾$g<em>{e,i} = w_e + \sum\limits</em>{k=1}^{t}{p<em>{e,k} dp</em>{v<em>e,i+k}}$ï¼Œå†è®¾$f</em>{e,i+t} = g_{e,i}$ï¼Œå°±æœ‰äº†</p>
<script type="math/tex; mode=display">
f_{e,i+t} = w_e + \sum_{k=1}^{t}{p_{e,k} dp_{v_e,i+k}}</script><p>è®¾$pâ€™<em>k=p</em>{t-k}$ï¼ˆç¿»è½¬ï¼‰ï¼Œè¿™ä¸ªæ±‚å’Œå°±å˜æˆäº†å·ç§¯ï¼š</p>
<script type="math/tex; mode=display">
f_{e,i+t} = w_e + \sum_{k=1}^{t}{p'_{e,t-k} dp_{v_e,i+k}}</script><p>é€šè¿‡åˆ†æ²»FFTè½¬ç§»ï¼Œå¤æ‚åº¦é™åˆ°$O(mt \log^2 t)$ï¼Œå¯ä»¥æ¥å—ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF553E.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF553E</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">55</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">120</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK = <span class="number">1</span> &lt;&lt; <span class="number">17</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> EPS = <span class="number">1e-6</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line"><span class="keyword">using</span> comp = complex&lt;<span class="type">double</span>&gt;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> rev[MAXK] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fft</span><span class="params">(comp* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * PI / h), sin(<span class="number">2</span> * PI / h))</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                f[k] = u + t, f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                w *= wn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] /= len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;  <span class="comment">// namespace maths</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> u, v, w;</span><br><span class="line">    <span class="type">double</span> p[MAXK];</span><br><span class="line">    <span class="built_in">Edge</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Edge</span>(<span class="type">int</span> _u, <span class="type">int</span> _v, <span class="type">int</span> _w) : <span class="built_in">u</span>(_u), <span class="built_in">v</span>(_v), <span class="built_in">w</span>(_w) &#123;&#125;</span><br><span class="line">&#125; edge[MAXM];</span><br><span class="line"><span class="type">int</span> n, m, t, x;</span><br><span class="line"><span class="type">int</span> dis[MAXN][MAXN];</span><br><span class="line"><span class="type">double</span> f[MAXM][MAXK], dp[MAXN][MAXK];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> comp tf[MAXK], tg[MAXK];</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> lx = r - mid, rx = r - l, len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt;= lx + rx)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> e = <span class="number">1</span>; e &lt;= m; ++e) &#123;</span><br><span class="line">        Edge&amp; ed = edge[e];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            tf[i] = tg[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lx; ++i)</span><br><span class="line">            tf[i] = dp[ed.v][i + mid + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; rx; ++i)</span><br><span class="line">            tg[i] = ed.p[rx - i];</span><br><span class="line">        <span class="built_in">fft</span>(tf, len, <span class="number">1</span>), <span class="built_in">fft</span>(tg, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            tf[i] *= tg[i];</span><br><span class="line">        <span class="built_in">fft</span>(tf, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= mid; ++i)</span><br><span class="line">            f[e][i] += tf[i + rx - mid - <span class="number">1</span>].<span class="built_in">real</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> comp tf[MAXK], tg[MAXK];</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            dp[edge[i].u][l] = <span class="built_in">min</span>(dp[edge[i].u][l], f[i][l] + edge[i].w);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">calc</span>(l, r);</span><br><span class="line">    <span class="built_in">solve</span>(l, mid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(t), <span class="built_in">read</span>(x);</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(dis));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        dis[i][i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        Edge&amp; ed = edge[i];</span><br><span class="line">        <span class="built_in">read</span>(ed.u), <span class="built_in">read</span>(ed.v), <span class="built_in">read</span>(ed.w);</span><br><span class="line">        dis[ed.u][ed.v] = <span class="built_in">min</span>(dis[ed.u][ed.v], ed.w);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= t; ++j)</span><br><span class="line">            <span class="built_in">read</span>(ed.p[j]) /= <span class="number">1e5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; ++k)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">                <span class="keyword">if</span> (dis[i][j] &gt; dis[i][k] + dis[k][j])</span><br><span class="line">                    dis[i][j] = dis[i][k] + dis[k][j];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= t; ++j)</span><br><span class="line">            dp[i][j] = INF;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = t + <span class="number">1</span>; j &lt;= t + t; ++j)</span><br><span class="line">            dp[i][j] = dis[i][n] + x;</span><br><span class="line">    <span class="built_in">calc</span>(<span class="number">0</span>, t + t);</span><br><span class="line">    <span class="built_in">solve</span>(<span class="number">0</span>, t);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.10lf\n&quot;</span>, dp[<span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF773F Test Data Generation</title>
    <url>/2022/01/07/sol-cf773f/</url>
    <content><![CDATA[<h2 id="CF773F-Test-Data-Generation"><a href="#CF773F-Test-Data-Generation" class="headerlink" title="CF773F Test Data Generation"></a>CF773F Test Data Generation</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF773F">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>update: å‘ç°<a href="https://www.luogu.com.cn/discuss/396583">FFTä¸åŒå†™æ³•ä¼šè¾“å‡ºä¸åŒçš„ç­”æ¡ˆ</a></p>
<p>ç¬¬ä¸€ç§è§£æ³•å‡ºé”™ï¼Œæ˜¾ç„¶$n$è¦æ˜¯å¥‡æ•°ã€‚</p>
<p>ç¬¬äºŒç§è§£æ³•å‡ºé”™ï¼Œåˆ™$a_n$å’Œ$\frac{a_n}{g}$å¥‡å¶æ€§ä¸åŒï¼Œåªæœ‰$a_n$ä¸ºå¶æ•°ï¼Œ$\frac{a_n}{g}$ä¸ºå¥‡æ•°ã€‚è¿™æ—¶$a_n$ä¸­å› æ•°$2$çš„ä¸ªæ•°ä¸$g$ä¸­çš„ç›¸åŒã€‚</p>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥æšä¸¾$g$ä¸­å› æ•°$2$çš„ä¸ªæ•°$k$ï¼Œå°†åºåˆ—$a$çš„æ‰€æœ‰æ•°é™¤ä»¥$2^k$ï¼Œç­”æ¡ˆå°±æ˜¯$1 \le a_i \le \frac{max_a}{2^k}$ä¸”$a_n$ä¸ºå¥‡æ•°çš„ä¸ªæ•°ã€‚</p>
<p>ä»¤$f_{a,n}$è¡¨ç¤ºæ‰€æœ‰æ•°$\in [1,a]$ï¼Œé•¿åº¦ä¸º$n$ï¼Œæœ€åä¸€ä½ä¸ºå¥‡æ•°çš„æ–¹æ¡ˆæ•°ã€‚</p>
<p>ä»¤$g_{a,n}$è¡¨ç¤ºæ‰€æœ‰æ•°$\in [1,a]$ï¼Œé•¿åº¦ä¸º$n$ï¼Œæœ€åä¸€ä½ä¸ºå¶æ•°çš„æ–¹æ¡ˆæ•°ã€‚</p>
<p>ç­”æ¡ˆæ˜¯</p>
<script type="math/tex; mode=display">\sum\limits_{i \equiv 1 \pmod{2}} f_{\lfloor\frac{max_a}{2^k}\rfloor,i}</script><p>ç”±äºè¦è®¡ç®—æ¯ä¸ª$f<em>{\lfloor\frac{max_a}{2^k}\rfloor}$ï¼Œå¦‚æœå¯ä»¥ä»$f</em>{\lfloor\frac{max_a}{2^{k+1}}\rfloor}$è½¬ç§»å°±å¯ä»¥ä¸ç”¨æ¯æ¬¡éƒ½é‡æ–°è®¡ç®—ã€‚</p>
<p>æ‰€ä»¥åˆ†ä¸º$f<em>{a} \to f</em>{2a}$å’Œ$f<em>{a-1} \to f</em>{a}$ä¸¤ç§æƒ…å†µè½¬ç§»ã€‚</p>
<p>ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œå½“$a$ä¸ºå¥‡æ•°æ—¶ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f_{2a,k} &= \sum_{i+j=k}{(f_{a,i}+g_{a,i})g_{a,j}}-g_{a,k}g_{a,0}[k \neq 0] \\
g_{2a,k} &= \sum_{i+j=k}{(f_{a,i}+g_{a,i})f_{a,j}}-f_{a,k}f_{a,0}[k \neq 0] \\
\end{aligned}</script><p>ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œå½“$a$ä¸ºå¶æ•°æ—¶ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f_{2a,k} &= \sum_{i+j=k}{(f_{a,i}+g_{a,i})f_{a,j}}-g_{a,k}f_{a,0}[k \neq 0] \\
g_{2a,k} &= \sum_{i+j=k}{(f_{a,i}+g_{a,i})g_{a,j}}-f_{a,k}g_{a,0}[k \neq 0] \\
\end{aligned}</script><p>ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œå¾ˆå®¹æ˜“è½¬ç§»ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f_{a,k} &= f_{a-1,k} + (f_{a-1,k-1} + g_{a-1,k-1})[a \equiv 1 \pmod{2}] \\
g_{a,k} &= g_{a-1,k} + (f_{a-1,k-1} + g_{a-1,k-1})[a \equiv 0 \pmod{2}] \\
\end{aligned}</script><p>æ—¶é—´å¤æ‚åº¦$O(max_n \log max_n \log max_a)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF773F.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF773F</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">16</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">long</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line"><span class="type">int</span> mod;</span><br><span class="line"><span class="keyword">using</span> comp = complex&lt;<span class="type">long</span> <span class="type">double</span>&gt;;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= mod ? x - mod : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fft</span><span class="params">(comp* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * PI / h), sin(<span class="number">2</span> * PI / h))</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                f[k] = u + t, f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                w *= wn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] /= len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">polymul</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>* lhs, <span class="type">int</span>* rhs, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> comp f1[MAXN], f2[MAXN];</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt;= n + n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        f1[i] = f2[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">        f1[i] = lhs[i], f2[i] = rhs[i];</span><br><span class="line">    <span class="built_in">fft</span>(f1, len, <span class="number">1</span>), <span class="built_in">fft</span>(f2, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        f1[i] *= f2[i];</span><br><span class="line">    <span class="built_in">fft</span>(f1, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">        ans[i] = (<span class="type">int</span>)(f1[i].<span class="built_in">real</span>() + <span class="number">0.5</span>) % mod;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;  <span class="comment">// namespace maths</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="type">int</span> n, m, ans;</span><br><span class="line"><span class="type">int</span> f[MAXN], g[MAXN], tf[MAXN], tg[MAXN], sum[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">void</span>(f[<span class="number">0</span>] = <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> y = x &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve</span>(y);</span><br><span class="line">    <span class="keyword">if</span> (y &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">            sum[i] = <span class="built_in">add</span>(f[i], g[i]);</span><br><span class="line">        f[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">polymul</span>(n, sum, f, tg);</span><br><span class="line">        <span class="built_in">polymul</span>(n, sum, g, tf);</span><br><span class="line">        f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            f[i] = <span class="built_in">add</span>(f[i], tf[i]);</span><br><span class="line">            g[i] = <span class="built_in">add</span>(g[i], tg[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">            sum[i] = <span class="built_in">add</span>(f[i], g[i]);</span><br><span class="line">        f[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">polymul</span>(n, sum, f, tf);</span><br><span class="line">        <span class="built_in">polymul</span>(n, sum, g, tg);</span><br><span class="line">        f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            f[i] = <span class="built_in">add</span>(f[i], tf[i]);</span><br><span class="line">            g[i] = <span class="built_in">add</span>(g[i], tg[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i; --i)</span><br><span class="line">            f[i] = <span class="built_in">add</span>(f[i], <span class="built_in">add</span>(f[i - <span class="number">1</span>], g[i - <span class="number">1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i += <span class="number">2</span>)</span><br><span class="line">        ans = <span class="built_in">add</span>(ans, f[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(mod);</span><br><span class="line">    <span class="built_in">solve</span>(m &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF623E Transforming Sequence</title>
    <url>/2022/01/05/sol-cf623e/</url>
    <content><![CDATA[<h2 id="CF623E-Transforming-Sequence"><a href="#CF623E-Transforming-Sequence" class="headerlink" title="CF623E Transforming Sequence"></a>CF623E Transforming Sequence</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF623E">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>åºåˆ—$a$çš„å‰ç¼€æˆ–ä¸¥æ ¼å•è°ƒé€’å¢ï¼Œè€ƒè™‘åˆ°$b<em>n$äºŒè¿›åˆ¶è¡¨ç¤ºä¸­åŒ…å«$k$ä¸ª$1$çš„æƒ…å†µæœ¬è´¨ç›¸åŒè€Œé¡ºåºä¸é‡è¦ï¼Œæ‰€ä»¥è®¾$dp</em>{n,k}$è¡¨ç¤ºé•¿åº¦ä¸º$n$çš„åºåˆ—$a$ä¸­ï¼Œ$b_n$äºŒè¿›åˆ¶è¡¨ç¤ºä¸­åŒ…å«$k$ä¸ª$1$ã€‚åˆ™æœ‰</p>
<script type="math/tex; mode=display">
\begin{aligned}
dp_{n+m,k} &= \sum_{i+j=k}{dp_{n,i} \times dp_{m,j} \times \binom{k}{i} \times 2^{m \times i}} \\
&= \sum_{i+j=k}{dp_{n,i} \times dp_{m,j} \times \frac{k!}{i!j!} \times 2^{m \times i}} \\
&= k! \times \sum_{i+j=k}{(dp_{n,i} \times \frac{1}{i!} \times 2^{m \times i}) \times (dp_{m,j} \times \frac{1}{j!})} \\
\end{aligned}</script><p>ä»¤$n=m$ï¼Œå€å¢NTTæ±‚è§£ã€‚</p>
<p>éœ€è¦æ³¨æ„ï¼Œé‡Œé¢çš„$(dp_{n,i} \times i!)$å’Œç±»ä¼¼çš„ä¸æ˜¯å·ç§¯è€Œæ˜¯æŒ‰ä½å°†ç³»æ•°ç›¸ä¹˜ï¼Œåªæœ‰$i$å’Œ$j$ä¸åŒæ—¶æ‰æ˜¯å·ç§¯è¿ç®—ã€‚äºæ˜¯é˜¶ä¹˜å’Œé€†å…ƒä¸éœ€è¦å‚ä¸å·ç§¯è¿ç®—çš„ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿ï¼Œä»£ç ä¸­çš„<code>operator*()</code>æ˜¯æŒ‰ä½ä¹˜ç³»æ•°ï¼Œ<code>operator^()</code>æ˜¯å·ç§¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(k \log n \log k)$ã€‚</p>
<p>æ³¨æ„æ¨¡æ•°æ˜¯$10^9+7$è¦ç”¨<a href="/2021/12/05/sol-p4245/" title="ä»»æ„æ¨¡æ•°NTT">ä»»æ„æ¨¡æ•°NTT</a>ã€‚</p>
<p>PS: MTTå¸¦ä¸ª$5$çš„å¸¸æ•°ï¼Œè¿™é‡Œ$\log_2n=60$ï¼Œ$k=3\times 10^4$ï¼ŒFFTé•¿åº¦å–$2^{16}$ï¼Œå¯¼è‡´ç†è®ºä¸Šçš„è¿ç®—æ¬¡æ•°å·²ç»å¡æ»¡äº†$10^9$ï¼Œæœ¬åœ°å°æ ·ä¾‹éƒ½è¦è·‘$7$ç§’ï¼Œä½†è°å«CFè¯„æµ‹æœºå¿«å‘¢ï½</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF623E.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF623E</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">16</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">60</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> BLOC = <span class="number">1</span> &lt;&lt; <span class="number">15</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">long</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="keyword">using</span> comp = complex&lt;<span class="type">long</span> <span class="type">double</span>&gt;;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        x += y;</span><br><span class="line">        <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        x -= y;</span><br><span class="line">        <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % p;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fft</span><span class="params">(comp* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * PI / h), sin(<span class="number">2</span> * PI / h))</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                    f[k] = u + t, f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                    w *= wn;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] /= len;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">poly</span> &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">static</span> <span class="type">int</span> len = <span class="number">1</span> &lt;&lt; <span class="number">16</span>;</span><br><span class="line">        <span class="type">int</span> a[MAXN];</span><br><span class="line">        <span class="type">int</span> <span class="keyword">operator</span>[](<span class="type">int</span> i) <span class="type">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i) &#123;</span><br><span class="line">            <span class="keyword">return</span> a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        poly <span class="keyword">operator</span>*(<span class="type">const</span> poly&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">            poly ret;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                ret[i] = a[i] * rhs[i] % MOD;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        poly <span class="keyword">operator</span>^(<span class="type">const</span> poly&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">            <span class="type">static</span> comp f1[MAXN], f2[MAXN], f3[MAXN];</span><br><span class="line">            poly ret;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">                f1[i] = <span class="built_in">comp</span>(a[i] / BLOC, a[i] % BLOC);</span><br><span class="line">                f2[i] = <span class="built_in">comp</span>(a[i] / BLOC, -a[i] % BLOC);</span><br><span class="line">                f3[i] = <span class="built_in">comp</span>(rhs[i] / BLOC, rhs[i] % BLOC);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">fft</span>(f1, len, <span class="number">1</span>), <span class="built_in">fft</span>(f2, len, <span class="number">1</span>), <span class="built_in">fft</span>(f3, len, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">                f1[i] *= f3[i];</span><br><span class="line">                f2[i] *= f3[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">fft</span>(f1, len, <span class="number">-1</span>), <span class="built_in">fft</span>(f2, len, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">                <span class="type">int</span> axay = (<span class="type">int</span>)<span class="built_in">round</span>((f1[i].<span class="built_in">real</span>() + f2[i].<span class="built_in">real</span>()) / <span class="number">2</span>) % MOD;</span><br><span class="line">                <span class="type">int</span> bxby = (<span class="type">int</span>)<span class="built_in">round</span>((f2[i].<span class="built_in">real</span>() - f1[i].<span class="built_in">real</span>()) / <span class="number">2</span>) % MOD;</span><br><span class="line">                <span class="type">int</span> axby = (<span class="type">int</span>)<span class="built_in">round</span>((f1[i].<span class="built_in">imag</span>() + f2[i].<span class="built_in">imag</span>()) / <span class="number">2</span>) % MOD;</span><br><span class="line">                <span class="type">int</span> aybx = (<span class="type">int</span>)<span class="built_in">round</span>((f1[i].<span class="built_in">imag</span>() - f2[i].<span class="built_in">imag</span>()) / <span class="number">2</span>) % MOD;</span><br><span class="line">                ret[i] = (axay * BLOC % MOD * BLOC + (axby + aybx) * BLOC % MOD + bxby) % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="type">int</span> n, k;</span><br><span class="line">poly fac, inv, lhs, rhs, ans;</span><br><span class="line">poly pw2[LOGN], dp[LOGN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">binom</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fac[x] * inv[y] % MOD * inv[x - y] % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = fac[<span class="number">0</span>] = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    inv[k] = <span class="built_in">qpow</span>(fac[k], MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = pw2[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">        pw2[<span class="number">0</span>][i] = pw2[<span class="number">0</span>][i - <span class="number">1</span>] * <span class="number">2</span> % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">        dp[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i) &#123;</span><br><span class="line">        pw2[i] = pw2[i - <span class="number">1</span>] * pw2[i - <span class="number">1</span>];</span><br><span class="line">        lhs = dp[i - <span class="number">1</span>] * inv * pw2[i - <span class="number">1</span>];</span><br><span class="line">        rhs = dp[i - <span class="number">1</span>] * inv;</span><br><span class="line">        dp[i] = (lhs ^ rhs) * fac;</span><br><span class="line">    &#125;</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; LOGN; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!((n &gt;&gt; i) &amp; <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        lhs = ans * inv * pw2[i];</span><br><span class="line">        rhs = dp[i] * inv;</span><br><span class="line">        ans = (lhs ^ rhs) * fac;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= k; ++i)</span><br><span class="line">        tot = <span class="built_in">add</span>(tot, ans[i] * <span class="built_in">binom</span>(k, i) % MOD);</span><br><span class="line">    <span class="built_in">write</span>(tot), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF755G PolandBall and Many Other Balls</title>
    <url>/2022/01/03/sol-cf755g/</url>
    <content><![CDATA[<h2 id="CF755G-PolandBall-and-Many-Other-Balls"><a href="#CF755G-PolandBall-and-Many-Other-Balls" class="headerlink" title="CF755G PolandBall and Many Other Balls"></a>CF755G PolandBall and Many Other Balls</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF755G">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¦–å…ˆæƒ³åˆ°æœ´ç´ çš„dpã€‚ä»¤$dp_{n,k}$è¡¨ç¤º$n$ä¸ªæ•°å–$k$ä¸ªï¼Œåˆ™</p>
<script type="math/tex; mode=display">dp_{x+y,k} = \sum_{i+j=k}{dp_{x,i} \times dp_{y,j}} + \sum_{i+j=k-1}{dp_{x-1,i} \times dp_{y-1,j}}</script><p>å‘ç°å·¦å³ä¸¤ä¸ªæ±‚å’Œç¬¦å·éƒ½å®¹æ˜“å†™æˆå·ç§¯çš„å½¢å¼ï¼Œä¸å¦¨å¯¹äºæ¯ä¸ª$x+y$å–$x=y$ä»£å…¥è®¡ç®—ï¼Œè¿™æ ·ç”¨å€å¢NTTå°±å¯ä»¥ã€‚</p>
<p>ä½†æ˜¯æ±‚$dp<em>{x+y}$æ—¶è¿˜è¦çŸ¥é“$dp</em>{x-1}$å’Œ$dp<em>{y-1}$ï¼Œæ‰€ä»¥å†è®¾$F</em>{t,0 \le l \le 2}(x)$è¡¨ç¤ºåŸæ¥çš„$dp_{2^t-l,x}$çš„ç”Ÿæˆå‡½æ•°ï¼Œæœ‰ä»¥ä¸‹è½¬ç§»æ–¹ç¨‹</p>
<script type="math/tex; mode=display">
\begin{aligned}
F_{t,0}(x) &= F_{t-1,0}(x) \times F_{t-1,0}(x) + F_{t-1,1}(x) \times F_{t-1,1}(x) \\
F_{t,1}(x) &= F_{t-1,0}(x) \times F_{t-1,1}(x) + F_{t-1,1}(x) \times F_{t-1,2}(x) \\
F_{t,2}(x) &= F_{t-1,1}(x) \times F_{t-1,1}(x) + F_{t-1,2}(x) \times F_{t-1,2}(x)
\end{aligned}</script><p>æ—¶é—´å¤æ‚åº¦$O(k \log n \log k)$ï¼Œå¯é€šè¿‡ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF755G.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF755G</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK = <span class="number">1</span> &lt;&lt; <span class="number">17</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">30</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        x += y;</span><br><span class="line">        <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        x -= y;</span><br><span class="line">        <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % p;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> rev[MAXK];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span>* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = <span class="built_in">add</span>(u, t), f[k + h / <span class="number">2</span>] = <span class="built_in">sub</span>(u, t);</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="type">int</span> n, k;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">knap</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">        <span class="type">int</span> dp[MAXK];</span><br><span class="line">        <span class="built_in">node</span>() &#123; <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="built_in">sizeof</span>(dp)); &#125;</span><br><span class="line">        <span class="built_in">node</span>(<span class="type">const</span> node&amp; o) &#123; <span class="built_in">memcpy</span>(dp, o.dp, <span class="built_in">sizeof</span>(dp)); &#125;</span><br><span class="line">        node <span class="keyword">operator</span>+(<span class="type">const</span> node&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">            node ret;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= k; ++i)</span><br><span class="line">                ret.dp[i] = <span class="built_in">add</span>(dp[i], rhs.dp[i]);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        node <span class="keyword">operator</span>*(<span class="type">const</span> node&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">            <span class="type">static</span> <span class="type">int</span> f1[MAXK], f2[MAXK];</span><br><span class="line">            node ret;</span><br><span class="line">            <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (len &lt; k + k + <span class="number">2</span>)</span><br><span class="line">                len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f1[i] = dp[i], f2[i] = rhs.dp[i];</span><br><span class="line">            <span class="built_in">ntt</span>(f1, len, <span class="number">1</span>), <span class="built_in">ntt</span>(f2, len, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f1[i] = f1[i] * f2[i] % MOD;</span><br><span class="line">            <span class="built_in">ntt</span>(f1, len, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= k; ++i)</span><br><span class="line">                ret.dp[i] = f1[i];</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        node <span class="keyword">operator</span>&lt;&lt;(<span class="type">int</span> rhs) <span class="type">const</span> &#123;</span><br><span class="line">            node ret;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = rhs; i &lt;= k; ++i)</span><br><span class="line">                ret.dp[i] = dp[i - rhs];</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; dp[<span class="number">3</span>];</span><br><span class="line">    knap <span class="keyword">operator</span>*(<span class="type">const</span> knap&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">        knap ret;</span><br><span class="line">        ret.dp[<span class="number">0</span>] = dp[<span class="number">0</span>] * rhs.dp[<span class="number">0</span>] + ((dp[<span class="number">1</span>] * rhs.dp[<span class="number">1</span>]) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        ret.dp[<span class="number">1</span>] = dp[<span class="number">0</span>] * rhs.dp[<span class="number">1</span>] + ((dp[<span class="number">1</span>] * rhs.dp[<span class="number">2</span>]) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        ret.dp[<span class="number">2</span>] = dp[<span class="number">1</span>] * rhs.dp[<span class="number">1</span>] + ((dp[<span class="number">2</span>] * rhs.dp[<span class="number">2</span>]) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">knap dp[LOGN], ans;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    ans.dp[<span class="number">0</span>].dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">0</span>].dp[<span class="number">0</span>].dp[<span class="number">0</span>] = dp[<span class="number">0</span>].dp[<span class="number">0</span>].dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">0</span>].dp[<span class="number">1</span>].dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        dp[i] = dp[i - <span class="number">1</span>] * dp[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; LOGN; ++i)</span><br><span class="line">        <span class="keyword">if</span>  ((n &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            ans = ans * dp[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans.dp[<span class="number">0</span>].dp[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == k]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF1613F Tree Coloring</title>
    <url>/2022/01/03/sol-cf1613f/</url>
    <content><![CDATA[<h2 id="CF1613F-Tree-Coloring"><a href="#CF1613F-Tree-Coloring" class="headerlink" title="CF1613F Tree Coloring"></a>CF1613F Tree Coloring</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF1613F">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸æ˜“ç›´æ¥è®¡ç®—ç¬¦åˆæ¡ä»¶çš„æ–¹æ¡ˆæ•°ï¼Œæ‰€ä»¥åˆ©ç”¨å®¹æ–¥è®¡ç®—ä¸ç¬¦åˆæ¡ä»¶çš„æ–¹æ¡ˆæ•°ã€‚å‡è®¾æœ‰$i$ä¸ªç‚¹çš„$c<em>k=c</em>{fa<em>k}-1$ï¼Œæ•´æ£µæ ‘å°±è¢«åˆ†æˆäº†$n-i$æ¡é“¾ï¼Œæ¯æ¡é“¾åªè¦æœ‰ä¸€ä¸ªç‚¹ç¡®å®šäº†åˆ™å…¶ä»–ç‚¹éƒ½èƒ½ç¡®å®šï¼Œæ’åˆ—æ•°ä¸º$(n-i)!$ã€‚è®¾æœ‰$i$ä¸ªç‚¹çš„$c_k=c</em>{fa_k}-1$å…±æœ‰$f(i)$ç§æ–¹æ¡ˆï¼Œåˆ™</p>
<script type="math/tex; mode=display">ans=\sum_{i=0}^{n-1}{(-1)^i(n-i)!f(i)}</script><p>è€ƒè™‘å¦‚ä½•è®¡ç®—$f(i)$ã€‚å¯¹äºèŠ‚ç‚¹$u$ï¼Œè¦ä¹ˆä¸å’Œå­èŠ‚ç‚¹ç›¸å·®ä¸º$1$ï¼Œè¦ä¹ˆåªèƒ½å’Œå…¶ä¸­ä¸€ä¸ªå­èŠ‚ç‚¹ç›¸å·®ä¸º$1$ï¼Œæ‰€ä»¥å…¶ç”Ÿæˆå‡½æ•°ä¸º</p>
<script type="math/tex; mode=display">F_u(x) = deg_ux + 1</script><p>$f(i)$çš„ç”Ÿæˆå‡½æ•°æ˜¾ç„¶æ˜¯æ¯ä¸ª$u$çš„ç”Ÿæˆå‡½æ•°ä¹˜èµ·æ¥ï¼š</p>
<script type="math/tex; mode=display">F(x) = \prod_{u=1}^{n}{(deg_ux + 1)}</script><p>æ‰€ä»¥æ±‚å‡º$f(i)$å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">f(i) = [x^i]\prod_{u=1}^{n}{(deg_ux + 1)}</script><p>ä½¿ç”¨åˆ†æ²»NTTè®¡ç®—ï¼Œæ—¶é—´å¤æ‚åº¦$O(n \log^2 n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF1613F.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF1613F</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">19</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        x += y;</span><br><span class="line">        <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        x -= y;</span><br><span class="line">        <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % p;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span>* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = <span class="built_in">add</span>(u, t), f[k + h / <span class="number">2</span>] = <span class="built_in">sub</span>(u, t);</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="type">int</span> n, fa[MAXN], deg[MAXN], fac[MAXN];</span><br><span class="line"><span class="type">int</span> f[MAXN], f1[MAXN], f2[MAXN];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    fa[u] = f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u])</span><br><span class="line">        <span class="keyword">if</span> (v != f)</span><br><span class="line">            <span class="built_in">build</span>(v, u), ++deg[u];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (r - l == <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, len = r - l;</span><br><span class="line">    <span class="built_in">solve</span>(l, mid), <span class="built_in">solve</span>(mid, r);</span><br><span class="line">    <span class="built_in">copy</span>(f + l, f + mid, f1);</span><br><span class="line">    <span class="built_in">fill</span>(f1 + len / <span class="number">2</span>, f1 + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">copy</span>(f + mid, f + r, f2);</span><br><span class="line">    <span class="built_in">fill</span>(f2 + len / <span class="number">2</span>, f2 + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(f1, len, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(f2, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        f1[i] = f1[i] * f2[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(f1, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(f1, f1 + len, f + l);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt;= n + n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i += <span class="number">2</span>)</span><br><span class="line">        f[i] = <span class="number">1</span>, f[i + <span class="number">1</span>] = deg[i &gt;&gt; <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">solve</span>(<span class="number">0</span>, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = fac[<span class="number">0</span>] = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            ans = <span class="built_in">sub</span>(ans, fac[n - i] * f[i] % MOD);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ans = <span class="built_in">add</span>(ans, fac[n - i] * f[i] % MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF986D Perfect Encoding</title>
    <url>/2022/01/02/sol-cf986d/</url>
    <content><![CDATA[<h2 id="CF986D-Perfect-Encoding"><a href="#CF986D-Perfect-Encoding" class="headerlink" title="CF986D Perfect Encoding"></a>CF986D Perfect Encoding</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF986D">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸€é“æ€ç»´éš¾åº¦ä½ä½†ç é‡æå¤§ä¸”åŠå…¶å¡å¸¸çš„çƒ‚é¢˜ã€‚</p>
<p>é¦–å…ˆæ ¹æ®å°å­¦å¥¥æ•°å­¦è¿‡çš„ä¸œè¥¿ï¼Œå¯ä»¥çŸ¥é“åˆ†è§£å‡ºè®¸å¤š$3$ï¼Œå‰©ä¸‹æ— æ³•åˆ†è§£çš„å‡‘æˆ$1$åˆ°$2$ä¸ª$2$ï¼Œè¿™æ ·å¾—åˆ°çš„ç§¯ä¸€å®šæ˜¯æœ€å¤§çš„ã€‚</p>
<p>ç­”æ¡ˆæ˜æ˜¾æ˜¯å•è°ƒçš„ï¼Œå¯ä»¥è€ƒè™‘äºŒåˆ†+åˆ¤æ–­ã€‚$n$çš„èŒƒå›´å·¨å¤§ï¼Œéœ€è¦ç”¨é«˜ç²¾åº¦+FFT+å¿«é€Ÿå¹‚ï¼Œæ—¶é—´å¤æ‚åº¦ä¸€ä¸‹å­$O(n \log^3 n)$çº§åˆ«ï¼Œæ— æ³•é€šè¿‡ã€‚</p>
<p>è¿›ä¸€æ­¥æ€è€ƒï¼Œç­”æ¡ˆåº”è¯¥æ¥è¿‘$\log_3n$ï¼Œä¸å¦¨ä»$\lfloor \log_3n \rfloor$å¼€å§‹æšä¸¾ç­”æ¡ˆï¼Œåªéœ€è¦æšä¸¾å¤§çº¦$6$ä¸ªå°±å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆï¼Œä¼˜åŒ–æˆ$O(n \log^2 n)$ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦æ— æ³•è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œäºæ˜¯è®¾æ³•å¼€å§‹å¡å¸¸ã€‚é¦–å…ˆè¿™ä¸ªé«˜ç²¾åº¦å¿…é¡»å¾—å‹ä½ï¼Œè€Œä¸”ä¸ºäº†é˜²æ­¢MLEåˆä¸èƒ½å¼€<code>long long</code>ï¼Œæ‰€ä»¥å‡è®¾å‹$x$ä½ï¼Œå°±è¦æ±‚FFTæ—¶$(10^x)^2 \times \frac{1.5 \times 10^6}{10^x} \le$ <code>INT_MAX</code>ï¼Œäºæ˜¯$x$æœ€å¤§å–åˆ°$3$ï¼Œå‹$3$ä½ã€‚</p>
<p>å…¶æ¬¡åœ¨è¿›è¡Œå¿«é€Ÿå¹‚æ—¶ï¼Œå˜é‡$x$éœ€è¦ä¸€ç›´ä¹˜ä¸Šè‡ªå·±ï¼Œå¯ä»¥çœç•¥ä¸€æ¬¡FFTã€‚ç”±äºå¿«é€Ÿå¹‚åˆšå¼€å§‹æ—¶æ•°å­—ä¸æ˜¯å¾ˆå¤§ï¼Œæˆ‘ä»¬é€‰æ‹©ç”¨<code>vector</code>å‚¨å­˜é«˜ç²¾åº¦è€Œä¸æ˜¯ä½¿ç”¨å®šé•¿æ•°ç»„ï¼Œè¿™æ ·åˆå¯ä»¥æé«˜ä¸€äº›å˜é‡æ‹·è´çš„æ•ˆç‡ã€‚è‡³æ­¤æˆ‘å°±æ²¡æœ‰å†æƒ³åˆ°èƒ½å¤Ÿè¿›ä¸€æ­¥ä¼˜åŒ–çš„æ–¹æ³•äº†ï¼Œä½†æ˜¯ä¹Ÿè¶³ä»¥åœ¨æ—¶é™å†…é€šè¿‡äº†ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF986D.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF986D</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// åŠ å¤§ç«è½¦</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">21</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXB = <span class="number">1000</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK = <span class="number">3</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> LOG3_10 = <span class="built_in">log</span>(<span class="number">10</span>) / <span class="built_in">log</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">namespace</span> bignum &#123;</span><br><span class="line">    <span class="keyword">using</span> comp = complex&lt;<span class="type">double</span>&gt;;</span><br><span class="line">    comp flhs[MAXN], frhs[MAXN];</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> tmp[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(comp *f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fft</span><span class="params">(comp *f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * PI / h), sin(<span class="number">2</span> * PI / h))</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                    f[k] = u + t;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                    w = w * wn;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] /= len;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt;&amp; <span class="title">polymul</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; lhs, <span class="type">int</span> rhs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lhs.<span class="built_in">size</span>(); ++i)</span><br><span class="line">            lhs[i] *= rhs;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lhs.<span class="built_in">size</span>() - <span class="number">1</span>; ++i)</span><br><span class="line">            lhs[i + <span class="number">1</span>] += lhs[i] / MAXB, lhs[i] %= MAXB;</span><br><span class="line">        <span class="type">int</span> len = lhs.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">while</span> (lhs[len - <span class="number">1</span>] &gt;= MAXB)</span><br><span class="line">            lhs.<span class="built_in">push_back</span>(lhs[len - <span class="number">1</span>] / MAXB), lhs[len - <span class="number">1</span>] %= MAXB, ++len;</span><br><span class="line">        <span class="keyword">return</span> lhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt;&amp; <span class="title">polymul</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; lhs)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt; lhs.<span class="built_in">size</span>() * <span class="number">2</span>)</span><br><span class="line">            len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lhs.<span class="built_in">size</span>(); ++i)</span><br><span class="line">            flhs[i] = lhs[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = lhs.<span class="built_in">size</span>(); i &lt; len; ++i)</span><br><span class="line">            flhs[i] = <span class="number">0</span>;</span><br><span class="line">        lhs.<span class="built_in">resize</span>(len);</span><br><span class="line">        <span class="built_in">fft</span>(flhs, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            flhs[i] = flhs[i] * flhs[i];</span><br><span class="line">        <span class="built_in">fft</span>(flhs, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            tmp[i] = (<span class="type">long</span> <span class="type">long</span>)(flhs[i].<span class="built_in">real</span>() + <span class="number">0.5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; ++i)</span><br><span class="line">            tmp[i + <span class="number">1</span>] += tmp[i] / MAXB, tmp[i] %= MAXB;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            lhs[i] = tmp[i];</span><br><span class="line">        <span class="keyword">while</span> (*lhs.<span class="built_in">rbegin</span>() == <span class="number">0</span>)</span><br><span class="line">            lhs.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="keyword">return</span> lhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt;&amp; <span class="title">polymul</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; lhs, <span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; rhs)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt; lhs.<span class="built_in">size</span>() + rhs.<span class="built_in">size</span>())</span><br><span class="line">            len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lhs.<span class="built_in">size</span>(); ++i)</span><br><span class="line">            flhs[i] = lhs[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = lhs.<span class="built_in">size</span>(); i &lt; len; ++i)</span><br><span class="line">            flhs[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; rhs.<span class="built_in">size</span>(); ++i)</span><br><span class="line">            frhs[i] = rhs[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rhs.<span class="built_in">size</span>(); i &lt; len; ++i)</span><br><span class="line">            frhs[i] = <span class="number">0</span>;</span><br><span class="line">        lhs.<span class="built_in">resize</span>(len);</span><br><span class="line">        <span class="built_in">fft</span>(flhs, len, <span class="number">1</span>), <span class="built_in">fft</span>(frhs, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            flhs[i] = flhs[i] * frhs[i];</span><br><span class="line">        <span class="built_in">fft</span>(flhs, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            tmp[i] = (<span class="type">long</span> <span class="type">long</span>)(flhs[i].<span class="built_in">real</span>() + <span class="number">0.5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; ++i)</span><br><span class="line">            tmp[i + <span class="number">1</span>] += tmp[i] / MAXB, tmp[i] %= MAXB;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            lhs[i] = tmp[i];</span><br><span class="line">        <span class="keyword">while</span> (*lhs.<span class="built_in">rbegin</span>() == <span class="number">0</span>)</span><br><span class="line">            lhs.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="keyword">return</span> lhs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">is_less</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; lhs, <span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; rhs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (lhs.<span class="built_in">size</span>() != rhs.<span class="built_in">size</span>())</span><br><span class="line">            <span class="keyword">return</span> lhs.<span class="built_in">size</span>() &lt; rhs.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = lhs.<span class="built_in">size</span>() - <span class="number">1</span>; ~i; --i)</span><br><span class="line">            <span class="keyword">if</span> (lhs[i] != rhs[i])</span><br><span class="line">                <span class="keyword">return</span> lhs[i] &lt; rhs[i];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">qpow</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; ret&#123;<span class="number">1</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, <span class="built_in">polymul</span>(x, x))</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">polymul</span>(ret, x);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> bignum;</span><br><span class="line"><span class="type">int</span> n, cur, num;</span><br><span class="line"><span class="type">char</span> buf[MAXN];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; inp, now, now2;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, vec[vec.<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = vec.<span class="built_in">size</span>() - <span class="number">2</span>; ~i; --i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02d&quot;</span>, vec[i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">6</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">is_less</span>(inp, vector&lt;<span class="type">int</span>&gt;&#123;n&#125;);</span><br><span class="line">    <span class="type">int</span> tx, ty;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">        tx = n / <span class="number">3</span> - <span class="number">1</span>, ty = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">3</span> == <span class="number">1</span>)</span><br><span class="line">        tx = n / <span class="number">3</span> - <span class="number">1</span>, ty = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">3</span> == <span class="number">2</span>)</span><br><span class="line">        tx = n / <span class="number">3</span> - <span class="number">1</span>, ty = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">while</span> (cur &lt; tx)</span><br><span class="line">        <span class="built_in">polymul</span>(now, <span class="number">3</span>), ++cur;</span><br><span class="line">    <span class="built_in">polymul</span>(now2 = now, ty);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">is_less</span>(inp, now2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">    n = <span class="built_in">strlen</span>(buf);</span><br><span class="line">    num = <span class="built_in">floor</span>(<span class="number">3</span> * LOG3_10 * (n - <span class="number">1</span>));</span><br><span class="line">    cur = <span class="built_in">max</span>((<span class="type">int</span>)<span class="number">0</span>, num / <span class="number">3</span> - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">reverse</span>(buf, buf + n);</span><br><span class="line">    <span class="keyword">while</span> (n % MAXK)</span><br><span class="line">        buf[n++] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i += MAXK) &#123;</span><br><span class="line">        inp.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>, x = <span class="number">1</span>; j &lt; MAXK; ++j, x *= <span class="number">10</span>)</span><br><span class="line">            *inp.<span class="built_in">rbegin</span>() += x * (buf[i + j] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    now = <span class="built_in">qpow</span>(vector&lt;<span class="type">int</span>&gt;&#123;<span class="number">3</span>&#125;, cur);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = num; ; ++i)</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(i))</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">write</span>(i), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>), <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜</title>
    <url>/2021/12/31/sol-p4009/</url>
    <content><![CDATA[<h2 id="P4009-æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜"><a href="#P4009-æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜" class="headerlink" title="P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜"></a>P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://www.luogu.com.cn/problem/P4009">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>åˆ†å±‚å›¾è·‘dijkstraã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4009.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4009</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> pii = pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">150</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK = <span class="number">15</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXV = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE = <span class="number">4e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> DX[<span class="number">4</span>] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> DY[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> v, cost;</span><br><span class="line">&#125; edge[MAXE];</span><br><span class="line"><span class="type">int</span> n, k, a, b, c, mp[MAXN][MAXN];</span><br><span class="line"><span class="type">int</span> s, t, num, pt[MAXN][MAXN][MAXK];</span><br><span class="line"><span class="type">int</span> tot, head[MAXV], nxt[MAXE], dis[MAXV];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">    edge[++tot] = &#123;v, cost&#125;;</span><br><span class="line">    nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dijkstra</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    priority_queue&lt;pii, vector&lt;pii&gt;, greater&lt;pii&gt;&gt; que;</span><br><span class="line">    <span class="built_in">fill</span>(dis, dis + MAXV, INF);</span><br><span class="line">    dis[s] = <span class="number">0</span>, que.<span class="built_in">push</span>(&#123;dis[s], s&#125;);</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> u = que.<span class="built_in">top</span>().second, d = que.<span class="built_in">top</span>().first;</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span> (d &gt; dis[u])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                que.<span class="built_in">push</span>(&#123;dis[v], v&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k), <span class="built_in">read</span>(a), <span class="built_in">read</span>(b), <span class="built_in">read</span>(c);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(mp[i][j]);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">0</span>; l &lt;= k; ++l)</span><br><span class="line">                pt[i][j][l] = ++num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    s = pt[<span class="number">1</span>][<span class="number">1</span>][k], t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= k; ++i)</span><br><span class="line">        <span class="built_in">addedge</span>(pt[n][n][i], t, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mp[i][j]) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">0</span>; l &lt;= k; ++l)</span><br><span class="line">                    <span class="built_in">addedge</span>(pt[i][j][l], pt[i][j][k], a);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> d = <span class="number">0</span>; d &lt; <span class="number">4</span>; ++d) &#123;</span><br><span class="line">                    <span class="type">int</span> x = i + DX[d], y = j + DY[d];</span><br><span class="line">                    <span class="keyword">if</span> (x &lt; <span class="number">1</span> || y &lt; <span class="number">1</span> || x &gt; n || y &gt; n)</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="built_in">addedge</span>(pt[i][j][k], pt[x][y][k - <span class="number">1</span>], d &gt; <span class="number">1</span> ? <span class="number">0</span> : b);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> d = <span class="number">0</span>; d &lt; <span class="number">4</span>; ++d) &#123;</span><br><span class="line">                    <span class="type">int</span> x = i + DX[d], y = j + DY[d];</span><br><span class="line">                    <span class="keyword">if</span> (x &lt; <span class="number">1</span> || y &lt; <span class="number">1</span> || x &gt; n || y &gt; n)</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= k; ++l)</span><br><span class="line">                        <span class="built_in">addedge</span>(pt[i][j][l], pt[x][y][l - <span class="number">1</span>], d &gt; <span class="number">1</span> ? <span class="number">0</span> : b);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">addedge</span>(pt[i][j][<span class="number">0</span>], pt[i][j][k], a + c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(<span class="built_in">dijkstra</span>(s, t)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4015 è¿è¾“é—®é¢˜</title>
    <url>/2021/12/30/sol-p4015/</url>
    <content><![CDATA[<h2 id="P4015-è¿è¾“é—®é¢˜"><a href="#P4015-è¿è¾“é—®é¢˜" class="headerlink" title="P4015 è¿è¾“é—®é¢˜"></a>P4015 è¿è¾“é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4015">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ€ä¹ˆä¼šæœ‰è¿™ä¹ˆsbçš„é¢˜ç›®å•Šã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4015.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4015</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MINCMF</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="type">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="type">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MAXCMF</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="type">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="type">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXV = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE = <span class="number">2e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> n, m, s, t, num, a[MAXN], b[MAXN], c[MAXN][MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">MINCMF&lt;MAXV, MAXE&gt; minnt;</span><br><span class="line">MAXCMF&lt;MAXV, MAXE&gt; maxnt;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]), pt[i][<span class="number">0</span>] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">read</span>(b[i]), pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(c[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        minnt.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], a[i], <span class="number">0</span>);</span><br><span class="line">        maxnt.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], a[i], <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        minnt.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, b[i], <span class="number">0</span>);</span><br><span class="line">        maxnt.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, b[i], <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">            minnt.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[j][<span class="number">1</span>], INF, c[i][j]);</span><br><span class="line">            maxnt.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[j][<span class="number">1</span>], INF, c[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(minnt.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">write</span>(maxnt.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4014 åˆ†é…é—®é¢˜</title>
    <url>/2021/12/30/sol-p4014/</url>
    <content><![CDATA[<h2 id="P4014-åˆ†é…é—®é¢˜"><a href="#P4014-åˆ†é…é—®é¢˜" class="headerlink" title="P4014 åˆ†é…é—®é¢˜"></a>P4014 åˆ†é…é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4014">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸å°±æ˜¯ä¸ªäºŒåˆ†å›¾æœ€å°/æœ€å¤§æƒåŒ¹é…å—ï¼Œå°±è¿™ä¹Ÿèƒ½ç´«é¢˜ï¼Ÿ</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4014.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4014</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MINCMF</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="type">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="type">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MAXCMF</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="type">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="type">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXV = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE = <span class="number">2e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> n, s, t, num, a[MAXN][MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">MINCMF&lt;MAXV, MAXE&gt; minnt;</span><br><span class="line">MAXCMF&lt;MAXV, MAXE&gt; maxnt;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num, pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        minnt.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        maxnt.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        minnt.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        maxnt.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            minnt.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[j][<span class="number">1</span>], <span class="number">1</span>, a[i][j]);</span><br><span class="line">            maxnt.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[j][<span class="number">1</span>], <span class="number">1</span>, a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(minnt.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">write</span>(maxnt.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4013 æ•°å­—æ¢¯å½¢é—®é¢˜</title>
    <url>/2021/12/30/sol-p4013/</url>
    <content><![CDATA[<h2 id="P4013-æ•°å­—æ¢¯å½¢é—®é¢˜"><a href="#P4013-æ•°å­—æ¢¯å½¢é—®é¢˜" class="headerlink" title="P4013 æ•°å­—æ¢¯å½¢é—®é¢˜"></a>P4013 æ•°å­—æ¢¯å½¢é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4013">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸‰æ¬¡è¯¢é—®åˆ†åˆ«æ‹†ç‚¹æ„å»ºç½‘ç»œæµå³å¯ã€‚</p>
<p>è´¹ç”¨æµä¸èƒ½åœ¨æ®‹ä½™ç½‘ç»œä¸ŠåŠ è¾¹é‡æ–°è·‘ï¼Œå¦åˆ™æ— æ³•ä¿è¯æœ€å¤§/æœ€å°è´¹ç”¨ã€‚</p>
<p>æ•°ç»„åº”å½“å¼€$20 \times 40$è€Œä¸æ˜¯$20 \times 20$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4013.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4013</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MCMF</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="type">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="type">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">45</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXV = <span class="number">4e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE = <span class="number">4e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> m, n, s, t, num, a[MAXN][MAXN], pt[MAXN][MAXN][<span class="number">2</span>];</span><br><span class="line">MCMF&lt;MAXV, MAXE&gt; nt[<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; m + i; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(a[i][j]);</span><br><span class="line">            pt[i][j][<span class="number">0</span>] = ++num;</span><br><span class="line">            pt[i][j][<span class="number">1</span>] = ++num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">0</span>; w &lt; <span class="number">3</span>; ++w) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            nt[w].<span class="built_in">addedge</span>(s, pt[<span class="number">1</span>][i][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; m + n; ++i)</span><br><span class="line">            nt[w].<span class="built_in">addedge</span>(pt[n][i][<span class="number">1</span>], t, INF, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; m + i; ++j)</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">0</span>], pt[i][j][<span class="number">1</span>], <span class="number">1</span>, a[i][j]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; m + i; ++j) &#123;</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i + <span class="number">1</span>][j][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>; w &lt; <span class="number">3</span>; ++w) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; m + i; ++j)</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">0</span>], pt[i][j][<span class="number">1</span>], INF, a[i][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">2</span>; w &lt; <span class="number">3</span>; ++w) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; m + i; ++j) &#123;</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i + <span class="number">1</span>][j][<span class="number">0</span>], INF, <span class="number">0</span>);</span><br><span class="line">                nt[w].<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">0</span>], INF, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">0</span>; w &lt; <span class="number">3</span>; ++w)</span><br><span class="line">        <span class="built_in">write</span>(nt[w].<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4012 æ·±æµ·æœºå™¨äººé—®é¢˜</title>
    <url>/2021/12/30/sol-p4012/</url>
    <content><![CDATA[<h2 id="P4012-æ·±æµ·æœºå™¨äººé—®é¢˜"><a href="#P4012-æ·±æµ·æœºå™¨äººé—®é¢˜" class="headerlink" title="P4012 æ·±æµ·æœºå™¨äººé—®é¢˜"></a>P4012 æ·±æµ·æœºå™¨äººé—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4012">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å›¾è›®å¥½å»ºçš„ï¼Œè·‘MCMFã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4012.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4012</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MCMF</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="type">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="type">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">50</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXV = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> a, b, p, q, s, t, num, pt[MAXN][MAXN];</span><br><span class="line">MCMF&lt;MAXV, MAXE&gt; network;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(a), <span class="built_in">read</span>(b);</span><br><span class="line">    <span class="built_in">read</span>(p), <span class="built_in">read</span>(q);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= p; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= q; ++j)</span><br><span class="line">            pt[i][j] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= p; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; q; ++j) &#123;</span><br><span class="line">            <span class="type">int</span> cost;</span><br><span class="line">            <span class="built_in">read</span>(cost);</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[i][j], pt[i][j + <span class="number">1</span>], <span class="number">1</span>, cost);</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[i][j], pt[i][j + <span class="number">1</span>], INF, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= q; ++j) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; p; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> cost;</span><br><span class="line">            <span class="built_in">read</span>(cost);</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[i][j], pt[i + <span class="number">1</span>][j], <span class="number">1</span>, cost);</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[i][j], pt[i + <span class="number">1</span>][j], INF, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= a; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> k, x, y;</span><br><span class="line">        <span class="built_in">read</span>(k), <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        network.<span class="built_in">addedge</span>(s, pt[x][y], k, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= b; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> k, x, y;</span><br><span class="line">        <span class="built_in">read</span>(k), <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[x][y], t, k, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(network.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3357 æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜</title>
    <url>/2021/12/27/sol-p3357/</url>
    <content><![CDATA[<h2 id="P3357-æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜"><a href="#P3357-æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜" class="headerlink" title="P3357 æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜"></a>P3357 æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3357">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>åœ¨<a href="/2021/12/27/sol-p3358/" title="P3358">P3358</a>çš„åŸºç¡€ä¸Šï¼Œå¤šå‡ºæ¥äº†çº¿æ®µä¸$x$è½´å‚ç›´çš„é—®é¢˜ï¼Œå¦‚æœå’Œåˆšåˆšä¸€æ ·è¿è¾¹å°±ä¼šå¯¼è‡´$i \to i$è‡ªç¯çš„é—®é¢˜ã€‚æ‰€ä»¥è¿›è¡Œæ‹†ç‚¹ï¼Œå¦‚æœ$l=r$åˆ™è¿æ¥$in(l)$å’Œ$out(r)$ï¼Œå¦åˆ™è¿æ¥$out(l)$å’Œ$in(r)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3357.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3357</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MCMF</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="type">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="type">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXV = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> n, k, m, s, t, num, a[MAXN], l[MAXN], r[MAXN], p[MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">MCMF&lt;MAXV, MAXE&gt; network;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> sx, sy, tx, ty;</span><br><span class="line">        <span class="built_in">read</span>(sx), <span class="built_in">read</span>(sy);</span><br><span class="line">        <span class="built_in">read</span>(tx), <span class="built_in">read</span>(ty);</span><br><span class="line">        <span class="keyword">if</span> (sx &gt; tx)</span><br><span class="line">            <span class="built_in">swap</span>(sx, tx);</span><br><span class="line">        l[i] = sx, r[i] = tx;</span><br><span class="line">        p[++m] = l[i], p[++m] = r[i];</span><br><span class="line">        a[i] = <span class="built_in">sqrt</span>((sx - tx) * (sx - tx) + (sy - ty) * (sy - ty));</span><br><span class="line">    &#125;</span><br><span class="line">    p[++m] = -INF, p[++m] = INF;</span><br><span class="line">    <span class="built_in">sort</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>);</span><br><span class="line">    m = <span class="built_in">unique</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>) - p - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num, pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">    s = pt[<span class="number">1</span>][<span class="number">0</span>], t = pt[m][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        l[i] = <span class="built_in">lower_bound</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>, l[i]) - p;</span><br><span class="line">        r[i] = <span class="built_in">lower_bound</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>, r[i]) - p;</span><br><span class="line">        <span class="keyword">if</span> (l[i] == r[i])</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[l[i]][<span class="number">0</span>], pt[r[i]][<span class="number">1</span>], <span class="number">1</span>, a[i]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[l[i]][<span class="number">1</span>], pt[r[i]][<span class="number">0</span>], <span class="number">1</span>, a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[i][<span class="number">1</span>], k, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; m; ++i)</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], pt[i + <span class="number">1</span>][<span class="number">0</span>], k, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">write</span>(network.<span class="built_in">mcmf</span>(s, t).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3358 æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜</title>
    <url>/2021/12/27/sol-p3358/</url>
    <content><![CDATA[<h2 id="P3358-æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜"><a href="#P3358-æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜" class="headerlink" title="P3358 æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜"></a>P3358 æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3358">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å…ˆç¦»æ•£åŒ–ï¼Œç„¶ååœ¨åæ ‡ä¸Šè¿æ¥$l_i \to r_i$ï¼ŒèŠ±è´¹ä¸º$r_i-l_i$ï¼Œå…¶ä»–è¾¹$i \to i+1$æµé‡ä¸º$k$ï¼Œæ˜¾ç„¶è¿™æ ·å¾—åˆ°çš„æœ€å¤§è´¹ç”¨æœ€å¤§æµå°±æ˜¯ç­”æ¡ˆã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3358.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3358</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MCMF</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="type">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="type">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> n, k, m, a[MAXN], l[MAXN], r[MAXN], p[MAXN];</span><br><span class="line">MCMF&lt;MAXN, MAXM&gt; network;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(l[i]), <span class="built_in">read</span>(r[i]);</span><br><span class="line">        p[++m] = l[i], p[++m] = r[i];</span><br><span class="line">        a[i] = r[i] - l[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p[++m] = -INF, p[++m] = INF;</span><br><span class="line">    <span class="built_in">sort</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>);</span><br><span class="line">    m = <span class="built_in">unique</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>) - p - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        l[i] = <span class="built_in">lower_bound</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>, l[i]) - p;</span><br><span class="line">        r[i] = <span class="built_in">lower_bound</span>(p + <span class="number">1</span>, p + m + <span class="number">1</span>, r[i]) - p;</span><br><span class="line">        network.<span class="built_in">addedge</span>(l[i], r[i], <span class="number">1</span>, a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; m; ++i)</span><br><span class="line">        network.<span class="built_in">addedge</span>(i, i + <span class="number">1</span>, k, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">write</span>(network.<span class="built_in">mcmf</span>(<span class="number">1</span>, m).second), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3356 ç«æ˜Ÿæ¢é™©é—®é¢˜</title>
    <url>/2021/12/27/sol-p3356/</url>
    <content><![CDATA[<h2 id="P3356-ç«æ˜Ÿæ¢é™©é—®é¢˜"><a href="#P3356-ç«æ˜Ÿæ¢é™©é—®é¢˜" class="headerlink" title="P3356 ç«æ˜Ÿæ¢é™©é—®é¢˜"></a>P3356 ç«æ˜Ÿæ¢é™©é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3356">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é—®é¢˜å¾ˆå®¹æ˜“è½¬åŒ–æˆæœ€å¤§è´¹ç”¨æœ€å¤§æµï¼Œæ‹†ç‚¹åˆ†åˆ«è€ƒè™‘å³å¯ã€‚</p>
<p>å¦‚ä½•è¾“å‡ºè·¯å¾„å‘¢ï¼Ÿåªéœ€è¦è·‘ä¸€æ¬¡$dfs$æˆ–$bfs$ï¼Œä»$S$åˆ°$T$èµ°åè¾¹æµé‡éé›¶çš„è¾¹å³å¯ï¼Œè®°å¾—æ¯æ¬¡èµ°å®Œå°†åè¾¹çš„æµé‡$-1$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3356.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3356</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MCMF</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="type">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="type">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, -INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">40</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXV = <span class="number">4e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE = <span class="number">8e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> n, p, q, s, t, num, mp[MAXN][MAXN];</span><br><span class="line"><span class="type">int</span> px[MAXV], py[MAXV], pt[MAXN][MAXN][<span class="number">2</span>];</span><br><span class="line">MCMF&lt;MAXV, MAXE&gt; network;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> cnt, <span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = network.head[u]; i; i = network.nxt[i]) &#123;</span><br><span class="line">        <span class="type">int</span> v = network.edge[i].v;</span><br><span class="line">        <span class="keyword">if</span> ((i &amp; <span class="number">1</span>) == <span class="number">0</span> &amp;&amp; network.edge[i ^ <span class="number">1</span>].flow) &#123;</span><br><span class="line">            <span class="keyword">if</span> (px[u] &amp;&amp; py[u] &amp;&amp; px[v] &amp;&amp; py[v] &amp;&amp; ((px[u] ^ px[v]) || (py[u] ^ py[v])))</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%lld %lld\n&quot;</span>, cnt, py[v] - py[u]);</span><br><span class="line">            --network.edge[i ^ <span class="number">1</span>].flow;</span><br><span class="line">            <span class="built_in">print</span>(cnt, v);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(p), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= p; ++j)</span><br><span class="line">            <span class="built_in">read</span>(mp[i][j]);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= p; ++j) &#123;</span><br><span class="line">            pt[i][j][<span class="number">0</span>] = ++num;</span><br><span class="line">            px[num] = i, py[num] = j;</span><br><span class="line">            pt[i][j][<span class="number">1</span>] = ++num;</span><br><span class="line">            px[num] = i, py[num] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    network.<span class="built_in">addedge</span>(s, pt[<span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], n, <span class="number">0</span>);</span><br><span class="line">    network.<span class="built_in">addedge</span>(pt[q][p][<span class="number">1</span>], t, n, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= p; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mp[i][j] != <span class="number">1</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j][<span class="number">0</span>], pt[i][j][<span class="number">1</span>], INF, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (mp[i][j] == <span class="number">2</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j][<span class="number">0</span>], pt[i][j][<span class="number">1</span>], <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (i &lt; q)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i + <span class="number">1</span>][j][<span class="number">0</span>], INF, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (j &lt; p)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j][<span class="number">1</span>], pt[i][j + <span class="number">1</span>][<span class="number">0</span>], INF, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    network.<span class="built_in">mcmf</span>(s, t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">print</span>(i, s);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3355 éª‘å£«å…±å­˜é—®é¢˜</title>
    <url>/2021/12/25/sol-p3355/</url>
    <content><![CDATA[<h2 id="P3355-éª‘å£«å…±å­˜é—®é¢˜"><a href="#P3355-éª‘å£«å…±å­˜é—®é¢˜" class="headerlink" title="P3355 éª‘å£«å…±å­˜é—®é¢˜"></a>P3355 éª‘å£«å…±å­˜é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3355">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ˜¾ç„¶æ˜¯ä¸€ä¸ªäºŒåˆ†å›¾æœ€å°å‰²é—®é¢˜ã€‚</p>
<p>å¦‚æœä¸è€ƒè™‘éšœç¢ï¼Œå¯ä»¥ç›´æ¥æºç‚¹åˆ°å·¦è¾¹ç‚¹ã€å³è¾¹ç‚¹åˆ°æ±‡ç‚¹è¿$1$çš„è¾¹ï¼Œè€Œå·¦å³ç‚¹ä¹‹é—´å†²çªçš„è¿$+\infty$ã€‚</p>
<p>ç°åœ¨è€ƒè™‘éšœç¢ç‰©ã€‚æ€è€ƒä¹‹å‰å»ºå›¾çš„æ„ä¹‰ï¼Œä¸€ä¸ªç‚¹å’Œæºç‚¹/æ±‡ç‚¹ä¹‹é—´çš„è¾¹è¢«å‰²æ‰ä»£è¡¨ä¸å–è¿™ä¸ªç‚¹ã€‚äºæ˜¯è¿™äº›éšœç¢ç‰©æ˜¾ç„¶ä¸èƒ½å–ï¼Œæ‰€ä»¥å¹²è„†ä¸å°†å®ƒä»¬è¿è¾¹ï¼Œæœ€åç­”æ¡ˆåœ¨$n \times n - mincut$çš„åŸºç¡€ä¸Šå†å‡å»$m$å°±å¯ä»¥äº†ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3355.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3355</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXV], lev[MAXV], cur[MAXV], nxt[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(lev, lev + MAXV, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">205</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXV = <span class="number">4e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> DX[<span class="number">8</span>] = &#123;<span class="number">-2</span>, <span class="number">-2</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> DY[<span class="number">8</span>] = &#123;<span class="number">-1</span>, <span class="number">1</span>, <span class="number">-2</span>, <span class="number">2</span>, <span class="number">-2</span>, <span class="number">2</span>, <span class="number">-1</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">int</span> n, m, s, t, num, mp[MAXN][MAXN], pt[MAXN][MAXN];</span><br><span class="line">Dinic&lt;MAXV, MAXE&gt; network;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> x, y;</span><br><span class="line">        <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        mp[x][y] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            pt[i][j] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mp[i][j])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> ((i ^ j) &amp; <span class="number">1</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(s, pt[i][j], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], t, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">8</span>; ++k) &#123;</span><br><span class="line">                <span class="type">int</span> x = i + DX[k];</span><br><span class="line">                <span class="type">int</span> y = j + DY[k];</span><br><span class="line">                <span class="keyword">if</span> (x &lt; <span class="number">1</span> || y &lt; <span class="number">1</span> || x &gt; n || y &gt; n)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (mp[x][y])</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> ((i ^ j) &amp; <span class="number">1</span>)</span><br><span class="line">                    network.<span class="built_in">addedge</span>(pt[i][j], pt[x][y], INF);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = n * n - m - network.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3254 åœ†æ¡Œé—®é¢˜</title>
    <url>/2021/12/25/sol-p3254/</url>
    <content><![CDATA[<h2 id="P3254-åœ†æ¡Œé—®é¢˜"><a href="#P3254-åœ†æ¡Œé—®é¢˜" class="headerlink" title="P3254 åœ†æ¡Œé—®é¢˜"></a>P3254 åœ†æ¡Œé—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3254">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è¾ƒä¸ºæ˜¾ç„¶çš„äºŒåˆ†å›¾ç½‘ç»œæµã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3254.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3254</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">550</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(lev, lev + MAXN, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXN, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, s, t, num, r[MAXN], c[MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">Dinic network;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; answ[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">read</span>(r[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(c[i]);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        network.<span class="built_in">addedge</span>(s, pt[i][<span class="number">1</span>], r[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], t, c[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[j][<span class="number">1</span>], pt[i][<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        sum += r[i];</span><br><span class="line">    <span class="keyword">if</span> (network.<span class="built_in">maxflow</span>(s, t) != sum)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>), <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = network.head[pt[i][<span class="number">0</span>]]; j; j = network.nxt[j])</span><br><span class="line">            <span class="keyword">if</span> (network.edge[j].flow &amp;&amp; network.edge[j].v &gt; n + <span class="number">2</span>)</span><br><span class="line">                answ[network.edge[j].v - n - <span class="number">2</span>].<span class="built_in">push_back</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; answ[i].<span class="built_in">size</span>(); ++j)</span><br><span class="line">            <span class="built_in">write</span>(answ[i][j]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[j == answ[i].<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2774 æ–¹æ ¼å–æ•°é—®é¢˜</title>
    <url>/2021/12/25/sol-p2774/</url>
    <content><![CDATA[<h2 id="P2774-æ–¹æ ¼å–æ•°é—®é¢˜"><a href="#P2774-æ–¹æ ¼å–æ•°é—®é¢˜" class="headerlink" title="P2774 æ–¹æ ¼å–æ•°é—®é¢˜"></a>P2774 æ–¹æ ¼å–æ•°é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2774">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä½¿ç”¨å‰²æ¨¡å‹æ¥åšã€‚ç”±äºç›¸é‚»çš„æ•°ä¸èƒ½åŒæ—¶å–ï¼Œäºæ˜¯å¾ˆå®¹æ˜“æƒ³åˆ°å»ºç«‹äºŒåˆ†å›¾ï¼ŒäºŒåˆ†å›¾ä¸¤ä¾§çš„ç‚¹ä¹‹é—´è¿$+\infty$çš„è¾¹ï¼Œå¹¶ä¸”åˆ†åˆ«å‘æºç‚¹å’Œæ±‡ç‚¹è¿è¾¹ï¼Œæµé‡ä¸ºå¯¹åº”æƒå€¼ã€‚è¿™æ ·æœ€å°å‰²ä¸€å®šåªèƒ½å‰²æ‰ä¸¤ä¾§ä¸æºç‚¹å’Œæ±‡ç‚¹çš„è¿è¾¹ï¼Œè¢«å‰²æ‰çš„è¾¹ä¸€å®šä¸å–ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2774.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2774</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(lev, lev + MAXN, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXN, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, s, t, num, a[MAXN][MAXN], pt[MAXN][MAXN];</span><br><span class="line">Dinic network;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">            <span class="built_in">read</span>(a[i][j]);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">            pt[i][j] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((i ^ j) &amp; <span class="number">1</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(s, pt[i][j], a[i][j]);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], t, a[i][j]);</span><br><span class="line">            <span class="keyword">if</span> (((i ^ j) &amp; <span class="number">1</span>) == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">1</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], pt[i - <span class="number">1</span>][j], INF);</span><br><span class="line">            <span class="keyword">if</span> (j &gt; <span class="number">1</span>)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], pt[i][j - <span class="number">1</span>], INF);</span><br><span class="line">            <span class="keyword">if</span> (i &lt; n)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], pt[i + <span class="number">1</span>][j], INF);</span><br><span class="line">            <span class="keyword">if</span> (j &lt; m)</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[i][j], pt[i][j + <span class="number">1</span>], INF);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; ++j)</span><br><span class="line">            ans += a[i][j];</span><br><span class="line">    ans -= network.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4716 ã€æ¨¡ç‰ˆã€‘æœ€å°æ ‘å½¢å›¾</title>
    <url>/2021/12/25/sol-p4716/</url>
    <content><![CDATA[<h2 id="P4716-ã€æ¨¡ç‰ˆã€‘æœ€å°æ ‘å½¢å›¾"><a href="#P4716-ã€æ¨¡ç‰ˆã€‘æœ€å°æ ‘å½¢å›¾" class="headerlink" title="P4716 ã€æ¨¡ç‰ˆã€‘æœ€å°æ ‘å½¢å›¾"></a>P4716 ã€æ¨¡ç‰ˆã€‘æœ€å°æ ‘å½¢å›¾</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4716">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ¨¡ç‰ˆé¢˜æ²¡å•¥å¥½è¯´çš„ï¼Œç”¨$zl$ç®—æ³•å³å¯ã€‚</p>
<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯¹äºæ¯ä¸ªé™¤äº†æ ¹èŠ‚ç‚¹ä¹‹å¤–çš„èŠ‚ç‚¹ï¼Œä»¤å…¶è¾¹æƒæœ€å°çš„å…¥è¾¹ä¸º$fa_u$ï¼Œè¾¹æƒä¸º$mn_u$ã€‚</li>
<li>åˆ¤æ–­æ˜¯å¦æœ‰èŠ‚ç‚¹æ²¡æœ‰å…¥è¾¹ï¼Œè‹¥æ²¡æœ‰åˆ™æ— è§£ï¼Œç›´æ¥è¿”å›$-1$ã€‚å¦åˆ™ç­”æ¡ˆåŠ ä¸Š$mn_u$ã€‚</li>
<li>å°†å›¾ä¸­è¿™äº›è¾¹å½¢æˆçš„ç¯å…¨éƒ¨ç¼©ç‚¹ï¼Œå¹¶é‡æ–°ç¼–å·ã€‚</li>
<li>è‹¥å›¾ä¸­æ— ç¯ï¼Œç»“æŸç®—æ³•ï¼Œè¿”å›å½“å‰ç­”æ¡ˆã€‚</li>
<li>å°†ä¸åœ¨ç¯ä¸­çš„ç‚¹ä¹Ÿé‡æ–°ç¼–å·ã€‚</li>
<li>å¯¹äºæ¯æ¡è¾¹$(u,v,w)$ï¼Œå°†$w$å‡å»$mn_v$ã€‚</li>
<li>æ›´æ–°å˜é‡$n$å’Œ$rt$ï¼Œæ¸…ç©ºæœ€å¤§ç¼–å·ï¼Œé‡å¤æ­¥éª¤$1$ã€‚</li>
</ol>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4716.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4716</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">150</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> u, v, w;</span><br><span class="line">&#125; e[MAXM];</span><br><span class="line"><span class="type">int</span> n, m, r;</span><br><span class="line"><span class="type">int</span> tot, head[MAXN], nxt[MAXM];</span><br><span class="line"><span class="type">int</span> mn[MAXN], fa[MAXN], tp[MAXN], lp[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">    e[++tot] = &#123;u, v, w&#125;;</span><br><span class="line">    nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">mdst</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>, tn = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="built_in">fill</span>(fa, fa + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(tp, tp + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(lp, lp + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(mn, mn + n + <span class="number">1</span>, INF);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="keyword">if</span> (e[i].u != e[i].v &amp;&amp; e[i].w &lt; mn[e[i].v])</span><br><span class="line">                mn[e[i].v] = e[i].w, fa[e[i].v] = e[i].u;</span><br><span class="line">        mn[rt] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            ret += mn[i];</span><br><span class="line">            <span class="keyword">if</span> (mn[i] == INF)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> u = <span class="number">1</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">            <span class="type">int</span> v = u;</span><br><span class="line">            <span class="keyword">while</span> (v != rt &amp;&amp; tp[v] != u &amp;&amp; !lp[v])</span><br><span class="line">                tp[v] = u, v = fa[v];</span><br><span class="line">            <span class="keyword">if</span> (v != rt &amp;&amp; !lp[v]) &#123;</span><br><span class="line">                lp[v] = ++tn;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = fa[v]; k != v; k = fa[k])</span><br><span class="line">                    lp[k] = tn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!tn)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!lp[i])</span><br><span class="line">                lp[i] = ++tn;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            e[i].w -= mn[e[i].v], e[i].u = lp[e[i].u], e[i].v = lp[e[i].v];</span><br><span class="line">        n = tn, rt = lp[rt], tn = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(r);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v, w;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v), <span class="built_in">read</span>(w);</span><br><span class="line">        <span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(<span class="built_in">mdst</span>(r)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2770 èˆªç©ºè·¯çº¿é—®é¢˜</title>
    <url>/2021/12/24/sol-p2770/</url>
    <content><![CDATA[<h2 id="P2770-èˆªç©ºè·¯çº¿é—®é¢˜"><a href="#P2770-èˆªç©ºè·¯çº¿é—®é¢˜" class="headerlink" title="P2770 èˆªç©ºè·¯çº¿é—®é¢˜"></a>P2770 èˆªç©ºè·¯çº¿é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2770">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>$O(n^3)$çš„$dp$æ˜¾ç„¶<del>ï¼ˆbushi</del></p>
<p>è€ƒè™‘ç½‘ç»œæµçš„åšæ³•ã€‚é¦–å…ˆæ¯ä¸ªç‚¹ç»è¿‡ä¸€æ¬¡å°±æƒ³åˆ°æ‹†ç‚¹ï¼Œç„¶åæŒ‰ç…§åŸå›¾è¿è¾¹ï¼Œä»$1$åˆ°$n$çš„æœ€å¤§æµ$\ge 2$å°±æœ‰è§£ã€‚</p>
<p>éœ€è¦æ³¨æ„æµ‹è¯•ç‚¹$2$æ˜¯$1$åˆ°$n$æœ‰è¿è¾¹ä¸”åªæœ‰$1 \to n \to 1$è¿™ç§èµ°æ³•çš„ï¼Œä½†å…¶å®å¯ä»¥ä¸ç”¨ç‰¹åˆ¤è§£å†³ï¼Œè¾“å‡ºè·¯å¾„æ—¶å¦‚æœå‰©ä½™æµé‡$=+\infty-2$æ—¶å¤šè·‘ä¸€æ¬¡å³å¯ï¼ˆå…·ä½“è§ä»£ç ï¼‰ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2770.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2770</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">505</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">2e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS = <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>, cost = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], dis[MAXN], cur[MAXN];</span><br><span class="line">    <span class="type">bool</span> vis[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXN, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXN, -INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>, vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>(), vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &lt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v])</span><br><span class="line">                        que.<span class="built_in">push</span>(v), vis[v] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXN, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, s, t, num, pt[MAXN][<span class="number">2</span>];</span><br><span class="line"><span class="type">char</span> buf[MAXS], str[MAXN][MAXS];</span><br><span class="line">Dinic network;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str[u]);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str[u]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = network.head[pt[u][<span class="number">1</span>]]; i; i = network.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (network.edge[i].flow == INF - <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>((network.edge[i].v - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>, on);</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str[u]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str[i]);</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num;</span><br><span class="line">        pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">    &#125;</span><br><span class="line">    network.<span class="built_in">addedge</span>(s, pt[<span class="number">1</span>][<span class="number">1</span>], <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    network.<span class="built_in">addedge</span>(pt[n][<span class="number">0</span>], t, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[i][<span class="number">1</span>], <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf, str[j]) == <span class="number">0</span>)</span><br><span class="line">                u = j;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf, str[j]) == <span class="number">0</span>)</span><br><span class="line">                v = j;</span><br><span class="line">        <span class="keyword">if</span> (u &gt; v)</span><br><span class="line">            <span class="built_in">swap</span>(u, v);</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[u][<span class="number">1</span>], pt[v][<span class="number">0</span>], INF, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (network.<span class="built_in">mcmf</span>(s, t) != <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;No Solution!&quot;</span>), <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">write</span>(network.cost), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = network.head[pt[<span class="number">1</span>][<span class="number">1</span>]], on = <span class="number">1</span>; i; i = network.nxt[i]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (network.edge[i].flow &lt; INF - <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = network.edge[i].flow; j &lt; INF; ++j, on = -on) &#123;</span><br><span class="line">            <span class="keyword">if</span> (on == <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str[<span class="number">1</span>]);</span><br><span class="line">            <span class="built_in">print</span>((network.edge[i].v - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>, on);</span><br><span class="line">            <span class="keyword">if</span> (on == <span class="number">-1</span>)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2766 æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜</title>
    <url>/2021/12/24/sol-p2766/</url>
    <content><![CDATA[<h2 id="P2766-æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜"><a href="#P2766-æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜" class="headerlink" title="P2766 æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜"></a>P2766 æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2766">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ç¬¬ä¸€é—®ç›´æ¥$O(n^2)$æ±‚ã€‚</p>
<p>ç¬¬äºŒé—®æ ¹æ®ç¬¬ä¸€é—®$dp$çš„åˆæ³•è½¬ç§»å»ºç«‹$DAG$å›¾ï¼Œæ‹†ç‚¹å¹¶æ±‚å‡ºæœ€å¤§æµã€‚å³å¯¹äº$\forall a_j \le a_i, dp_i = dp_j + 1$ï¼Œè¿æ¥$j_1 \to i_0$ï¼Œæµé‡ä¸º$1$ï¼Œä¸”è¿æ¥æ¯ä¸ª$i_0 \to i_1$ã€‚å¦‚æœ$dp_i=1$åˆ™è¿æ¥$S \to i_0$ï¼Œ$dp_i=ans_1$åˆ™è¿æ¥$i_1 \to T$ã€‚è¿™æ ·å°±ä¿è¯äº†æ¯æ¬¡å¢å¹¿éƒ½æ‰¾åˆ°ä¸€ä¸ªé•¿åº¦æœ€é•¿çš„å­åºåˆ—ï¼Œå¹¶ä¸”æ¯ä¸ªç‚¹åªèƒ½å–ä¸€æ¬¡ã€‚</p>
<p>ç¬¬ä¸‰é—®ç”±äº$1$å’Œ$n$æ— é™åˆ¶ï¼Œæ‰€ä»¥å°†$S \to 1$å’Œ$n \to T$ï¼ˆå¦‚æœæœ‰ï¼‰çš„æµé‡æ”¹ä¸º$+\infty$ï¼Œå¹¶å°†$1_0 \to 1_1$å’Œ$n_0 \to n_1$ä¹Ÿæ”¹ä¸º$+\infty$å³å¯ã€‚æ³¨æ„è¦ç‰¹åˆ¤$n=1$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2766.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2766</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in">sizeof</span>(lev));</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in">sizeof</span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, s, t, num, a[MAXN], dp[MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">Dinic network;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="type">int</span> ans1 = <span class="number">0</span>, ans2 = <span class="number">0</span>, ans3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; ++j)</span><br><span class="line">            <span class="keyword">if</span> (a[j] &lt;= a[i])</span><br><span class="line">                dp[i] = <span class="built_in">max</span>(dp[i], dp[j] + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ans1 = *<span class="built_in">max_element</span>(dp + <span class="number">1</span>, dp + n + <span class="number">1</span>);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num, pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[i][<span class="number">0</span>], pt[i][<span class="number">1</span>], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (dp[i] == <span class="number">1</span>)</span><br><span class="line">            network.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (dp[i] == ans1)</span><br><span class="line">            network.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; i; ++j)</span><br><span class="line">            <span class="keyword">if</span> (a[j] &lt;= a[i] &amp;&amp; dp[j] + <span class="number">1</span> == dp[i])</span><br><span class="line">                network.<span class="built_in">addedge</span>(pt[j][<span class="number">1</span>], pt[i][<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ans2 = network.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">    <span class="keyword">if</span> (dp[<span class="number">1</span>] == <span class="number">1</span>)</span><br><span class="line">        network.<span class="built_in">addedge</span>(s, pt[<span class="number">1</span>][<span class="number">0</span>], INF - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (dp[n] == ans1)</span><br><span class="line">        network.<span class="built_in">addedge</span>(pt[n][<span class="number">1</span>], t, INF - <span class="number">1</span>);</span><br><span class="line">    network.<span class="built_in">addedge</span>(pt[<span class="number">1</span>][<span class="number">0</span>], pt[<span class="number">1</span>][<span class="number">1</span>], INF - <span class="number">1</span>);</span><br><span class="line">    network.<span class="built_in">addedge</span>(pt[n][<span class="number">0</span>], pt[n][<span class="number">1</span>], INF - <span class="number">1</span>);</span><br><span class="line">    ans3 = (n == <span class="number">1</span>) ? <span class="number">1</span> : network.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">    <span class="built_in">write</span>(ans1), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">write</span>(ans2), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">write</span>(ans3), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2765 é­”æœ¯çƒé—®é¢˜</title>
    <url>/2021/12/24/sol-p2765/</url>
    <content><![CDATA[<h2 id="P2765-é­”æœ¯çƒé—®é¢˜"><a href="#P2765-é­”æœ¯çƒé—®é¢˜" class="headerlink" title="P2765 é­”æœ¯çƒé—®é¢˜"></a>P2765 é­”æœ¯çƒé—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2765">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><a href="/2021/12/24/sol-p2764/" title="P2764">P2764</a>å€’è¿‡æ¥ã€‚

å°†å’Œä¸ºå®Œå…¨å¹³æ–¹æ•°çš„æ•°å¯¹$(a,b)$ä¹‹é—´è¿æœ‰å‘è¾¹ï¼Œå¤§çš„è¿å‘å°çš„ï¼Œç­”æ¡ˆå°±æ˜¯æœ€é•¿è·¯å¾„è¦†ç›–ã€‚

æšä¸¾ç­”æ¡ˆåˆ¤æ–­å³å¯ã€‚

### ACä»£ç 

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2765.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2765</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in">sizeof</span>(lev));</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in">sizeof</span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, s, t, num, cnt, pre[MAXN], col[MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">Dinic maxflow;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; answ[MAXN];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">issqrt</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">sqrt</span>(x);</span><br><span class="line">    <span class="keyword">return</span> t * t == x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>; ; ++w) &#123;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fill</span>(col, col + w, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(pre, pre + w, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> u = <span class="number">1</span>; u &lt; w; ++u) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = maxflow.head[pt[u][<span class="number">0</span>]]; i; i = maxflow.nxt[i])</span><br><span class="line">                <span class="keyword">if</span> (maxflow.edge[i].flow == INF - <span class="number">1</span>)</span><br><span class="line">                    pre[(maxflow.edge[i].v - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>] = u;</span><br><span class="line">        &#125;</span><br><span class="line">        pt[w][<span class="number">0</span>] = ++num, pt[w][<span class="number">1</span>] = ++num;</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(s, pt[w][<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(pt[w][<span class="number">1</span>], t, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; w; ++i)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">issqrt</span>(i + w))</span><br><span class="line">                maxflow.<span class="built_in">addedge</span>(pt[w][<span class="number">0</span>], pt[i][<span class="number">1</span>], INF);</span><br><span class="line">        <span class="type">int</span> tmp = w - maxflow.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">        <span class="keyword">if</span> (tmp &gt; n) &#123;</span><br><span class="line">            <span class="built_in">write</span>(w - <span class="number">1</span>), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = w - <span class="number">1</span>; i; --i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!pre[i])</span><br><span class="line">                    col[i] = ++cnt;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    col[i] = col[pre[i]];</span><br><span class="line">                answ[col[i]].<span class="built_in">push_back</span>(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i) &#123;</span><br><span class="line">                <span class="built_in">reverse</span>(answ[i].<span class="built_in">begin</span>(), answ[i].<span class="built_in">end</span>());</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; answ[i].<span class="built_in">size</span>(); ++j)</span><br><span class="line">                    <span class="built_in">write</span>(answ[i][j]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[j == answ[i].<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2764 æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜</title>
    <url>/2021/12/24/sol-p2764/</url>
    <content><![CDATA[<h2 id="P2764-æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜"><a href="#P2764-æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜" class="headerlink" title="P2764 æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜"></a>P2764 æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2764">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä¸å¦¨å…ˆå‡è®¾æ¯ä¸ªç‚¹éƒ½å•ç‹¬è¢«ä¸€æ¡è·¯å¾„è¦†ç›–ï¼Œæˆ‘ä»¬æƒ³è¦è®©æœ€å¤šçš„è·¯å¾„ç›¸è¿æ¥ã€‚</p>
<p>å¯¹äºæ¯ä¸ªç‚¹åªèƒ½æœ‰æœ€å¤šä¸€æ¡å…¥è¾¹å’Œæœ€å¤šä¸€æ¡å‡ºè¾¹ï¼Œè€ŒåŸå›¾ä¸­æœ‰è¾¹çš„å¯ä»¥ç›¸è¿ï¼Œå»ºå›¾æ–¹å¼æ˜¾ç„¶ï¼Œç±»ä¼¼äºŒåˆ†å›¾ï¼Œæºç‚¹è¿å‘å·¦è¾¹çš„ç‚¹ï¼Œå³è¾¹çš„ç‚¹è¿å‘æ±‡ç‚¹ï¼Œæµé‡ä¸º$1$ï¼ŒåŸå›¾ä¸­çš„è¾¹$(u,v)$åœ¨ç½‘ç»œä¸­ä¸º$v$å³è¾¹çš„è¿å‘$u$å·¦è¾¹çš„ï¼Œä¸ºä¾¿äºè¾“å‡ºæ–¹æ¡ˆæµé‡è®¾ä¸º$+\infty$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2764.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2764</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">505</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">2e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in">sizeof</span>(lev));</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in">sizeof</span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, s, t, num, cnt, pre[MAXN], col[MAXN], pt[MAXN][<span class="number">2</span>];</span><br><span class="line">Dinic maxflow;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; answ[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        pt[i][<span class="number">0</span>] = ++num, pt[i][<span class="number">1</span>] = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(s, pt[i][<span class="number">0</span>], <span class="number">1</span>);</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(pt[i][<span class="number">1</span>], t, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(pt[u][<span class="number">0</span>], pt[v][<span class="number">1</span>], INF);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = n - maxflow.<span class="built_in">maxflow</span>(s, t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> u = <span class="number">1</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = maxflow.head[pt[u][<span class="number">0</span>]]; i; i = maxflow.nxt[i])</span><br><span class="line">            <span class="keyword">if</span> (maxflow.edge[i].flow == INF - <span class="number">1</span>)</span><br><span class="line">                pre[(maxflow.edge[i].v - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>] = u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!pre[i])</span><br><span class="line">            col[i] = ++cnt;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            col[i] = col[pre[i]];</span><br><span class="line">        answ[col[i]].<span class="built_in">push_back</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; answ[i].<span class="built_in">size</span>(); ++j)</span><br><span class="line">            <span class="built_in">write</span>(answ[i][j]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[j == answ[i].<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2763 è¯•é¢˜åº“é—®é¢˜</title>
    <url>/2021/12/23/sol-p2763/</url>
    <content><![CDATA[<h2 id="P2763-è¯•é¢˜åº“é—®é¢˜"><a href="#P2763-è¯•é¢˜åº“é—®é¢˜" class="headerlink" title="P2763 è¯•é¢˜åº“é—®é¢˜"></a>P2763 è¯•é¢˜åº“é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2763">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è¿™é“æ¯”è¾ƒå®¹æ˜“å»ºå›¾äº†ã€‚</p>
<p>æºç‚¹è¿å‘æ¯ç±»è¯•é¢˜ï¼Œæµé‡ä¸ºè¦é€‰å‡ºçš„é¢˜ç›®æ•°é‡ã€‚æ¯ç±»è¯•é¢˜å‘é¢˜åº“ä¸­çš„è¯•é¢˜è¿è¾¹ï¼Œæµé‡$+\infty$ã€‚æœ€åæ¯é“é¢˜å‘æ±‡ç‚¹è¿è¾¹ï¼Œæµé‡ä¸º$1$å³å¯ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2763.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2763</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in">sizeof</span>(lev));</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in">sizeof</span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> k, n, m, s, t, num, a[MAXN];</span><br><span class="line">Dinic maxflow;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(k), <span class="built_in">read</span>(n);</span><br><span class="line">    s = ++num, t = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">        m += a[i];</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(s, ++num, a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> p, x;</span><br><span class="line">        <span class="built_in">read</span>(p);</span><br><span class="line">        ++num;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= p; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            maxflow.<span class="built_in">addedge</span>(x + <span class="number">2</span>, num, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(num, t, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (maxflow.<span class="built_in">maxflow</span>(s, t) != m)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;No Solution!&quot;</span>), <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld: &quot;</span>, i);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = maxflow.head[i + <span class="number">2</span>], c = <span class="number">0</span>; j; j = maxflow.nxt[j])</span><br><span class="line">            <span class="keyword">if</span> (maxflow.edge[j].flow == INF - <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>, maxflow.edge[j].v - k - <span class="number">2</span>, <span class="string">&quot; \n&quot;</span>[++c == a[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2762 å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜</title>
    <url>/2021/12/22/sol-p2762/</url>
    <content><![CDATA[<h2 id="P2762-å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜"><a href="#P2762-å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜" class="headerlink" title="P2762 å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜"></a>P2762 å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2762">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å‘æ¥å‘å»æœ€åè¢«è¯»å…¥ç»™å‘åˆ°äº†ã€‚</p>
<p>ä½¿ç”¨å‰²æ¨¡å‹ï¼Œä»æºç‚¹è¿è¾¹åˆ°å®éªŒï¼Œæµé‡ä¸ºè¯¥å®éªŒå¯è·å¾—çš„é’±$p_i$ï¼Œå†ä»ä»ªå™¨è¿è¾¹é“æ±‡ç‚¹ï¼Œæµé‡ä¸ºè¯¥ä»ªå™¨çš„ä»·æ ¼$c_i$ï¼Œæœ€åå°†å®éªŒå’Œä»ªå™¨ä¹‹é—´è¿è¾¹ï¼Œæµé‡ä¸º$+\infty$ã€‚</p>
<p>æ€è€ƒè¿™ç§è¿è¾¹æ–¹å¼çš„å«ä¹‰ã€‚æœ€å°å‰²åçš„æ®‹ä½™ç½‘ç»œä¸­ï¼Œä¸æºç‚¹ç›¸è¿çš„ç‚¹éƒ½æ˜¯è¦å–çš„ï¼Œä¸æ±‡ç‚¹ç›¸è¿çš„ç‚¹éƒ½æ˜¯ä¸å–çš„ï¼Œåˆ†åˆ«å¯¹åº”$S$é›†åˆå’Œ$T$é›†åˆã€‚åŸç½‘ç»œæ‰€ä»£è¡¨çš„çŠ¶æ€æ˜¯$m$ä¸ªå®éªŒéƒ½åšï¼Œä½†è¿™æ˜¾ç„¶æ˜¯ä¸åˆæ³•çš„ï¼Œæ‰€ä»¥è·‘ä¸€éæœ€å°å‰²åï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°å®éªŒåœ¨$S$é›†åˆè€Œå¯¹åº”ä»ªå™¨åœ¨$T$é›†åˆä¸­çš„æƒ…å†µï¼ˆå› ä¸ºæ— æ³•å‰²æ–­å®éªŒå’Œä»ªå™¨ä¹‹é—´çš„è¿è¾¹ï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®éªŒåœ¨$T$é›†åˆè€Œå¯¹åº”ä»ªå™¨åœ¨$S$é›†åˆçš„æ–¹æ¡ˆæ˜¯åˆæ³•çš„ã€‚è€Œæ‰€æ±‚çš„æœ€å°å‰²å°±æ˜¯ä½¿å¾—æ–¹æ¡ˆåˆæ³•çš„æœ€å°ä»£ä»·ã€‚</p>
<p>äºæ˜¯ç­”æ¡ˆä¸º$\sum\limits_{i=1}^{m}{p_i} - mincut$ã€‚</p>
<h4 id="æ¶å¿ƒçš„è¯»å…¥"><a href="#æ¶å¿ƒçš„è¯»å…¥" class="headerlink" title="æ¶å¿ƒçš„è¯»å…¥"></a>æ¶å¿ƒçš„è¯»å…¥</h4><p>å› ä¸ºä¸å–œæ¬¢ç”¨<code>cin</code>æ‰€ä»¥ç ”ç©¶å¦‚ä½•ç”¨<code>scanf</code>ä¼˜é›…åœ°è¯»å…¥æ•´è¡Œï¼Œäºæ˜¯å‘ç°ï¼š</p>
<ul>
<li><code>scanf(&quot;%[^\n]&quot;, buf)</code>å¯ä»¥è¯»å…¥æ•´è¡Œï¼Œå…¶ä¸­<code>buf</code>æ˜¯<code>char</code>æ•°ç»„ã€‚</li>
</ul>
<p>æ‰€ä»¥ç”¨<code>buf</code>è¿›è¡Œæ‰‹å†™å¿«è¯»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»å­—ç¬¦ä¸²`s`ä¸­è¯»å…¥æ•°å­—åˆ°`x`ï¼Œå¹¶è¿”å›`s`ä¸­å½“å‰æ•°å­—ä¸‹ä¸€ä½çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span>* <span class="title">sread</span><span class="params">(<span class="type">char</span> *s, _Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = *s++;</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = *s++; <span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (sign)</span><br><span class="line">        x = -x;</span><br><span class="line">    <span class="keyword">return</span> --s; <span class="comment">// è¿”å›ä¸Šä¸€ä¸ªä½ç½®çš„åŸå› æ˜¯å¿«è¯»ä¼šåˆ¤æ–­æ•°å­—åä¸€ä½å¹¶ä¸”å°†æŒ‡é’ˆ`s`ç§»åˆ°æ•°å­—åä¸¤ä½ï¼Œè¿™æ ·æ— æ³•åˆ¤æ–­å­—ç¬¦ä¸²ç»“æŸ`&#x27;\0&#x27;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(p[i]);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%[^\n]%c&quot;</span>, buf, &amp;chr);</span><br><span class="line">        <span class="type">char</span> *pos = buf;</span><br><span class="line">        <span class="keyword">for</span> (k[i] = <span class="number">0</span>; (*pos) &amp;&amp; ++k[i];)</span><br><span class="line">            pos = <span class="built_in">sread</span>(pos, a[i][k[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(c[i]);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2762.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2762</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span>* <span class="title">sread</span><span class="params">(<span class="type">char</span> *s, _Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = *s++;</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = *s++; <span class="built_in">isdigit</span>(ch); ch = *s++)</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (sign)</span><br><span class="line">        x = -x;</span><br><span class="line">    <span class="keyword">return</span> --s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">150</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">3e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS = <span class="number">1</span> &lt;&lt; <span class="number">15</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in">sizeof</span>(lev));</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in">sizeof</span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, p[MAXN], c[MAXN], k[MAXN], a[MAXN][MAXN];</span><br><span class="line"><span class="type">char</span> chr, buf[MAXS];</span><br><span class="line"><span class="type">bool</span> use1[MAXN], use2[MAXN];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; ans1, ans2;</span><br><span class="line">Dinic mincut;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(p[i]);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%[^\n]%c&quot;</span>, buf, &amp;chr);</span><br><span class="line">        <span class="type">char</span> *pos = buf;</span><br><span class="line">        <span class="keyword">for</span> (k[i] = <span class="number">0</span>; (*pos) &amp;&amp; ++k[i];)</span><br><span class="line">            pos = <span class="built_in">sread</span>(pos, a[i][k[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(c[i]);</span><br><span class="line">    <span class="type">int</span> ss = <span class="number">1</span>, tt = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        mincut.<span class="built_in">addedge</span>(i + <span class="number">2</span>, tt, c[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        mincut.<span class="built_in">addedge</span>(ss, i + n + <span class="number">2</span>, p[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= k[i]; ++j)</span><br><span class="line">            mincut.<span class="built_in">addedge</span>(i + n + <span class="number">2</span>, a[i][j] + <span class="number">2</span>, INF);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        ans += p[i];</span><br><span class="line">    ans -= mincut.<span class="built_in">maxflow</span>(ss, tt);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="keyword">if</span> (mincut.lev[i + n + <span class="number">2</span>] != <span class="number">-1</span>)</span><br><span class="line">            ans1.<span class="built_in">push_back</span>(i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">if</span> (mincut.lev[i + <span class="number">2</span>] != <span class="number">-1</span>)</span><br><span class="line">            ans2.<span class="built_in">push_back</span>(i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ans1.<span class="built_in">size</span>(); ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans1[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == ans1.<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ans2.<span class="built_in">size</span>(); ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans2[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == ans2.<span class="built_in">size</span>() - <span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2754 æ˜Ÿé™…è½¬ç§»é—®é¢˜</title>
    <url>/2021/12/22/sol-p2754/</url>
    <content><![CDATA[<h2 id="P2754-æ˜Ÿé™…è½¬ç§»é—®é¢˜"><a href="#P2754-æ˜Ÿé™…è½¬ç§»é—®é¢˜" class="headerlink" title="P2754 æ˜Ÿé™…è½¬ç§»é—®é¢˜"></a>P2754 æ˜Ÿé™…è½¬ç§»é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2754">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¥—è·¯åœ°æ‹†ç‚¹ã€‚$pt_{u,t}$è¡¨ç¤ºèŠ‚ç‚¹$u$åœ¨æ—¶é—´ä¸º$t$æ—¶çš„çŠ¶æ€ã€‚æŒ‰ç…§å¤ªç©ºèˆ¹åœ¨$t$æ—¶çš„ä½ç½®è¿è¾¹ï¼Œè·‘æœ€å¤§æµåˆ¤æ–­æ˜¯å¦å¯è¡Œã€‚</p>
<p>ä¸€ç§æ–¹æ³•ä¸ºäºŒåˆ†ç­”æ¡ˆï¼Œä½†æ˜¯æ¯æ¬¡éœ€è¦é‡æ–°å»ºå›¾ï¼›å¦ä¸€ç§åˆ™æ˜¯ç›´æ¥æšä¸¾ç­”æ¡ˆï¼Œæ¯æ¬¡åªè¿æ–°åŠ å…¥çš„è¾¹ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ®‹ä½™ç½‘ç»œä¸Šç»§ç»­è·‘$maxflow$ã€‚æ®è¯´äºŒåˆ†åè€Œè·‘çš„æ¯”æšä¸¾æ…¢ä¸€äº›ã€‚</p>
<h4 id="G-V-E-ä¸­-V-å’Œ-E-çš„èŒƒå›´"><a href="#G-V-E-ä¸­-V-å’Œ-E-çš„èŒƒå›´" class="headerlink" title="$G(V,E)$ä¸­$|V|$å’Œ$|E|$çš„èŒƒå›´"></a>$G(V,E)$ä¸­$|V|$å’Œ$|E|$çš„èŒƒå›´</h4><p><strong>ä»¤$n=n+2$</strong>ï¼Œå…ˆè®¡ç®—æœ€é•¿å¯èƒ½çš„æ—¶é—´$T$ã€‚æœ€åçš„å¯èƒ½æ€§æ˜¯åªæœ‰ä¸€è‰˜å¤ªç©ºèˆ¹ä¸”å®¹é‡ä¸º$1$ï¼Œå¹¶ä¸”è¿™è‰˜å¤ªç©ºèˆ¹åœ¨$n$ä¸ªç‚¹ä¹‹é—´å‘¨è½¬ã€‚æ­¤æ—¶æœ€é•¿æ—¶é—´$T \le k \times n \le 750$ï¼ˆå¾ˆå¤šé¢˜è§£éƒ½è¯´æ˜¯$500$ï¼Œå…¶å®æ˜¯é”™çš„ï¼Œæ´›è°·è®¨è®ºåŒºé‡Œæœ‰$hack$ï¼‰ã€‚</p>
<p>æ¯æ¬¡æšä¸¾æ–°çš„æ—¶é—´ï¼Œæœ€å¤šå¢åŠ $n$ä¸ªç‚¹ï¼Œæ‰€ä»¥ç‚¹é›†å¤§å°$|V| \le n \times T \le 11250$ï¼Œå¼€åˆ°$2 \times 10^4$å³å¯ã€‚</p>
<p>è€Œåœ¨æ¯æ¬¡æ·»åŠ è·¯å¾„æ—¶ï¼Œ$pt<em>{u,t-1}$è¿å‘$pt</em>{u,t}$ï¼Œå¹¶ä¸”æ¯è‰˜å¤ªç©ºèˆ¹å¢åŠ ä¸€æ¡è¾¹ï¼Œè€ƒè™‘<strong>ç½‘ç»œæµå»ºåè¾¹éœ€è¦$\times 2$</strong>ï¼Œåˆ™æ¯æ¬¡æœ€å¤šæ·»åŠ $(n + m) \times 2 \le 80$æ¡è¾¹ï¼Œæ‰€ä»¥è¾¹é›†å¤§å°$|E| \le T \times 80 \le 60000$ï¼Œå¼€$10^5$ç®¡å¤Ÿã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2754.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2754</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS = <span class="number">800</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXT = <span class="number">55</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(lev, <span class="number">-1</span>, <span class="built_in">sizeof</span>(lev));</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in">sizeof</span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, k, sx, tx, ss, tt, num;</span><br><span class="line"><span class="type">int</span> h[MAXT], r[MAXT], s[MAXT][MAXT], pt[MAXT][MAXS];</span><br><span class="line">Dinic maxflow;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(k);</span><br><span class="line">    sx = n + <span class="number">1</span>, tx = n + <span class="number">2</span>;</span><br><span class="line">    ss = ++num, tt = ++num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(h[i]), <span class="built_in">read</span>(r[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; r[i]; ++j) &#123;</span><br><span class="line">            <span class="built_in">read</span>(s[i][j]);</span><br><span class="line">            <span class="keyword">if</span> (s[i][j] == <span class="number">0</span>)</span><br><span class="line">                s[i][j] = sx;</span><br><span class="line">            <span class="keyword">if</span> (s[i][j] == <span class="number">-1</span>)</span><br><span class="line">                s[i][j] = tx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">0</span>; w &lt;= <span class="number">750</span>; ++w) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n + <span class="number">2</span>; ++i)</span><br><span class="line">            pt[i][w] = ++num;</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(ss, pt[sx][w], INF);</span><br><span class="line">        maxflow.<span class="built_in">addedge</span>(pt[tx][w], tt, INF);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; w &amp;&amp; i &lt;= n + <span class="number">2</span>; ++i)</span><br><span class="line">            maxflow.<span class="built_in">addedge</span>(pt[i][w - <span class="number">1</span>], pt[i][w], INF);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; w &amp;&amp; i &lt;= m; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> u = s[i][(w - <span class="number">1</span>) % r[i]];</span><br><span class="line">            <span class="type">int</span> v = s[i][w % r[i]];</span><br><span class="line">            maxflow.<span class="built_in">addedge</span>(pt[u][w - <span class="number">1</span>], pt[v][w], h[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (maxflow.<span class="built_in">maxflow</span>(ss, tt) &gt;= k)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">write</span>(w), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>), <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P1251 é¤å·¾è®¡åˆ’é—®é¢˜</title>
    <url>/2021/12/22/sol-p1251/</url>
    <content><![CDATA[<h2 id="P1251-é¤å·¾è®¡åˆ’é—®é¢˜"><a href="#P1251-é¤å·¾è®¡åˆ’é—®é¢˜" class="headerlink" title="P1251 é¤å·¾è®¡åˆ’é—®é¢˜"></a>P1251 é¤å·¾è®¡åˆ’é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P1251">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¢˜ç›®ä¸­å·²ç»æš—ç¤ºäº†è¦ç”¨è´¹ç”¨æµã€‚</p>
<p>ä½¿ç”¨æµæ¨¡å‹ï¼Œæµè¡¨ç¤ºé¤å·¾çš„æ•°é‡ã€‚ä½†æ˜¯ä¸æ˜“å¤„ç†é¤å·¾å¹²å‡€ä¸å¦ï¼Œæ‰€ä»¥æ‹†ç‚¹ï¼Œå°†ä¸€å¤©æ‹†æˆä¸¤ä¸ªç‚¹ï¼Œåˆ†åˆ«è¡¨ç¤ºè¿™å¤©æ‹¥æœ‰çš„å¹²å‡€é¤å·¾æ•°é‡å’Œè„çš„é¤å·¾æ•°é‡ã€‚ä¸ºæ–¹ä¾¿è¡¨è¿°ï¼Œåˆ†åˆ«è®¾ä¸º$used<em>{i,0}$å’Œ$used</em>{i,1}$ã€‚</p>
<p>ç”±äºæ¯å¤©éœ€è¦ä½¿ç”¨$r<em>i$å—é¤å·¾ï¼Œæ‰€ä»¥è®©$used</em>{i,0}$è¿å‘æ±‡ç‚¹$T$ï¼Œè´¹ç”¨ä¸º$0$ï¼Œæµé‡ä¸º$r<em>i$ï¼Œè¡¨ç¤ºè¿™å¤©è‡³å°‘éœ€è¦æ‹¥æœ‰$r_i$å—å¹²å‡€é¤å·¾ã€‚åŒæ—¶è®©æºç‚¹$S$è¿å‘$used</em>{i,1}$ï¼Œè´¹ç”¨ä¸º$0$ï¼Œæµé‡ä¸º$r_i$ï¼Œè¡¨ç¤ºè¿™å¤©è¿‡åä¼šå¤šå‡º$r_i$å—è„çš„é¤å·¾ã€‚</p>
<p>æ¥ä¸‹æ¥è€ƒè™‘è´­ä¹°é¤å·¾ï¼Œæ˜¾ç„¶å¯ä»¥ç›´æ¥ä»$S$è¿å‘$used<em>{i,0}$ï¼Œè´¹ç”¨ä¸º$p$ï¼Œæµé‡ä¸º$+\infty$ã€‚è€Œä½¿ç”¨å¿«æ´—éƒ¨åˆ™ä»$used</em>{i,1}$è¿å‘$used<em>{i+m,0}$ï¼Œè´¹ç”¨ä¸º$f$ï¼Œæµé‡ä¸º$+\infty$ã€‚åŒç†ï¼Œæ…¢æ´—éƒ¨$used</em>{i,1}$è¿å‘$used<em>{i+n,0}$ï¼Œè´¹ç”¨ä¸º$s$ï¼Œæµé‡ä¸º$+\infty$ã€‚å¦ä¸€ç§ä¿ç•™é¤å·¾åˆ™$used</em>{i,1}$è¿å‘$used_{i+1,1}$ï¼Œè´¹ç”¨ä¸º$0$ï¼Œæµé‡ä¸º$+\infty$ã€‚</p>
<p>å½¢å¼åŒ–åœ°ï¼Œå®šä¹‰å‡½æ•°<code>addedge(u, v, cost, flow)</code>ï¼Œåˆ™éœ€è¦</p>
<ol>
<li><code>addedge(used[i][0], T, 0, r[i])</code></li>
<li><code>addedge(S, used[i][1], 0, r[i])</code></li>
<li><code>addedge(S, used[i][0], p, INF)</code></li>
<li><code>if (i + 1 &lt;= N) addedge(used[i][1], used[i + 1][1], 0, INF)</code></li>
<li><code>if (i + m &lt;= N) addedge(used[i][1], used[i + m][0], f, INF)</code></li>
<li><code>if (i + n &lt;= N) addedge(used[i][1], used[i + n][0], s, INF)</code></li>
</ol>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P1251.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P1251</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, cost, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, cost = <span class="number">0</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], dis[MAXN], cur[MAXN];</span><br><span class="line">    <span class="type">bool</span> vis[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> cost, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, cost, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, -cost, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="built_in">sizeof</span>(vis));</span><br><span class="line">        <span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(dis));</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>, vis[s] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>(), vis[u] = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[u] + edge[i].cost != dis[v])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            cost += edge[i].cost * tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur, head, <span class="built_in">sizeof</span>(cur));</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, qp, qm, qf, qn, qs;</span><br><span class="line"><span class="type">int</span> a[MAXN], used[MAXN][<span class="number">2</span>];</span><br><span class="line">Dinic mcmf;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="built_in">read</span>(qp), <span class="built_in">read</span>(qm), <span class="built_in">read</span>(qf), <span class="built_in">read</span>(qn), <span class="built_in">read</span>(qs);</span><br><span class="line">    <span class="type">int</span> s = <span class="number">1</span>, t = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        used[i][<span class="number">0</span>] = i * <span class="number">2</span> + <span class="number">1</span>, used[i][<span class="number">1</span>] = i * <span class="number">2</span> + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        mcmf.<span class="built_in">addedge</span>(used[i][<span class="number">0</span>], t, <span class="number">0</span>, a[i]);</span><br><span class="line">        mcmf.<span class="built_in">addedge</span>(s, used[i][<span class="number">1</span>], <span class="number">0</span>, a[i]);</span><br><span class="line">        mcmf.<span class="built_in">addedge</span>(s, used[i][<span class="number">0</span>], qp, INF);</span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span> &lt;= n)</span><br><span class="line">            mcmf.<span class="built_in">addedge</span>(used[i][<span class="number">1</span>], used[i + <span class="number">1</span>][<span class="number">1</span>], <span class="number">0</span>, INF);</span><br><span class="line">        <span class="keyword">if</span> (i + qm &lt;= n)</span><br><span class="line">            mcmf.<span class="built_in">addedge</span>(used[i][<span class="number">1</span>], used[i + qm][<span class="number">0</span>], qf, INF);</span><br><span class="line">        <span class="keyword">if</span> (i + qn &lt;= n)</span><br><span class="line">            mcmf.<span class="built_in">addedge</span>(used[i][<span class="number">1</span>], used[i + qn][<span class="number">0</span>], qs, INF);</span><br><span class="line">    &#125;</span><br><span class="line">    mcmf.<span class="built_in">mcmf</span>(s, t);</span><br><span class="line">    <span class="built_in">write</span>(mcmf.cost), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4016 è´Ÿè½½å¹³è¡¡é—®é¢˜</title>
    <url>/2021/12/21/sol-p4016/</url>
    <content><![CDATA[<h2 id="P4016-è´Ÿè½½å¹³è¡¡é—®é¢˜"><a href="#P4016-è´Ÿè½½å¹³è¡¡é—®é¢˜" class="headerlink" title="P4016 è´Ÿè½½å¹³è¡¡é—®é¢˜"></a>P4016 è´Ÿè½½å¹³è¡¡é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ˜¾ç„¶æœ‰è´ªå¿ƒè§£æ³•ï¼Œä½†ä¸ºäº†ç»ƒä¹ è´¹ç”¨æµé€‰æ‹©ä½¿ç”¨ç½‘ç»œæµè§£æ³•ã€‚</p>
<p>ç¬¬ä¸€æ¬¡å†™$spfa$å’Œè´¹ç”¨æµï¼Œæ²¡æƒ³åˆ°ä¼šå‡ºç°è¿™ä¹ˆå¤šé—®é¢˜ã€‚ã€‚ã€‚</p>
<p>æœ‰å‡ ä¸ªè¦æ³¨æ„çš„ç‚¹ï¼š</p>
<ol>
<li>è´¹ç”¨æµå»ºåè¾¹çš„$cost$æ˜¯åŸæ¥çš„$cost$çš„<strong>ç›¸åæ•°</strong>ï¼Œå³éœ€è¦<code>add(u, v, c, f), add(v, u, -c, 0);</code></li>
<li>è®¡ç®—æµé‡çš„æ–¹å¼å’Œæ™®é€šç½‘ç»œæµç›¸åŒï¼Œä½†æ˜¯è®¡ç®—æ€»$cost$æ˜¯æ¯æ¬¡åŠ ä¸Š<code>edge.cost * flow</code>ï¼Œ<strong>ä¸è¦å¿˜è®°ä¹˜ä¸Š$cost$</strong>ï¼Œç”¨å…¨å±€å˜é‡å­˜$cost$ä¼šå¥½å†™ä¸€äº›ã€‚</li>
<li>ç”±äºè´¹ç”¨æµçš„è¾¹æƒå¯èƒ½$\le 0$ï¼Œæ‰€ä»¥<strong>å¿…é¡»</strong>ç”¨$spfa$è€Œæ— æ³•ä½¿ç”¨$dijkstra$ï¼Œå¹¶ä¸”$dfs$<strong>å¢å¹¿æ—¶å¿…é¡»å¼€$vis$æ•°ç»„é˜²æ­¢æ— é™é€’å½’</strong>ã€‚</li>
<li>ï¼ˆè¿™åº”è¯¥ç®—æ˜¯ä¸ªå°$tip$ï¼‰ç½‘ç»œæµ$tot$ä¸€å¼€å§‹æ¸…ç©ºæˆ$1$å¯ä»¥ä¸éœ€è¦å†è°ƒç”¨<code>init</code>å‡½æ•°ï¼Œä¹Ÿä¸éœ€è¦å†æŠŠ$head$æ¸…ç©ºæˆ$-1$ã€‚</li>
</ol>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4016.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4016</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">150</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>, cost = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], dis[MAXN], cur[MAXN];</span><br><span class="line">    <span class="type">bool</span> vis[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXN, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXN, INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>, vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>(), vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v])</span><br><span class="line">                        que.<span class="built_in">push</span>(v), vis[v] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXN, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, a[MAXN];</span><br><span class="line">Dinic nf;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]), num += a[i];</span><br><span class="line">    num /= n;</span><br><span class="line">    <span class="type">int</span> s = n + <span class="number">1</span>, t = n + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &gt; num)</span><br><span class="line">            nf.<span class="built_in">addedge</span>(s, i, a[i] - num, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (a[i] &lt; num)</span><br><span class="line">            nf.<span class="built_in">addedge</span>(i, t, num - a[i], <span class="number">0</span>);</span><br><span class="line">        nf.<span class="built_in">addedge</span>(i, i % n + <span class="number">1</span>, INF, <span class="number">1</span>);</span><br><span class="line">        nf.<span class="built_in">addedge</span>(i % n + <span class="number">1</span>, i, INF, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    nf.<span class="built_in">mcmf</span>(s, t);</span><br><span class="line">    <span class="built_in">write</span>(nf.cost), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4011 å­¤å²›è¥æ•‘é—®é¢˜</title>
    <url>/2021/12/21/sol-p4011/</url>
    <content><![CDATA[<h2 id="P4011-å­¤å²›è¥æ•‘é—®é¢˜"><a href="#P4011-å­¤å²›è¥æ•‘é—®é¢˜" class="headerlink" title="P4011 å­¤å²›è¥æ•‘é—®é¢˜"></a>P4011 å­¤å²›è¥æ•‘é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4011">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ˜¾ç„¶çš„çŠ¶å‹åˆ†å±‚$BFS$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4011.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4011</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">15</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK = <span class="number">1</span> &lt;&lt; <span class="number">11</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> DX[<span class="number">4</span>] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> DY[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> x, y, s;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, p, k, s, a[MAXN][MAXN], dis[MAXN][MAXN][MAXK], g[MAXN][MAXN][MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(p);</span><br><span class="line">    <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> tx1, ty1, tx2, ty2, tg;</span><br><span class="line">        <span class="built_in">read</span>(tx1), <span class="built_in">read</span>(ty1), <span class="built_in">read</span>(tx2), <span class="built_in">read</span>(ty2), <span class="built_in">read</span>(tg);</span><br><span class="line">        g[tx1][ty1][tx2][ty2] |= <span class="number">1</span> &lt;&lt; tg;</span><br><span class="line">        g[tx2][ty2][tx1][ty1] |= <span class="number">1</span> &lt;&lt; tg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">read</span>(s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= s; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> tx, ty, tq;</span><br><span class="line">        <span class="built_in">read</span>(tx), <span class="built_in">read</span>(ty), <span class="built_in">read</span>(tq);</span><br><span class="line">        a[tx][ty] |= <span class="number">1</span> &lt;&lt; tq;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">-1</span>, <span class="built_in">sizeof</span>(dis));</span><br><span class="line">    queue&lt;node&gt; que;</span><br><span class="line">    que.<span class="built_in">push</span>(&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    dis[<span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> ans = INF;</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        node t = que.<span class="built_in">front</span>();</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">int</span> x = t.x, y = t.y, s = t.s;</span><br><span class="line">        <span class="keyword">if</span> (x == n &amp;&amp; y == m)</span><br><span class="line">            ans = <span class="built_in">min</span>(ans, dis[x][y][s]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> tx = x + DX[i];</span><br><span class="line">            <span class="type">int</span> ty = y + DY[i];</span><br><span class="line">            <span class="keyword">if</span> (tx &lt; <span class="number">1</span> || ty &lt; <span class="number">1</span> || tx &gt; n || ty &gt; m)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> ((g[x][y][tx][ty] &amp; s) != g[x][y][tx][ty])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> ts = s | a[tx][ty];</span><br><span class="line">            <span class="keyword">if</span> (dis[tx][ty][ts] != <span class="number">-1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            dis[tx][ty][ts] = dis[x][y][s] + <span class="number">1</span>;</span><br><span class="line">            que.<span class="built_in">push</span>(&#123;tx, ty, ts&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(ans == INF ? <span class="number">-1</span> : ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P276 è½¯ä»¶è¡¥ä¸é—®é¢˜</title>
    <url>/2021/12/20/sol-p2761/</url>
    <content><![CDATA[<h2 id="P276-è½¯ä»¶è¡¥ä¸é—®é¢˜"><a href="#P276-è½¯ä»¶è¡¥ä¸é—®é¢˜" class="headerlink" title="P276 è½¯ä»¶è¡¥ä¸é—®é¢˜"></a>P276 è½¯ä»¶è¡¥ä¸é—®é¢˜</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2761">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è¿™é¢˜<strong>ä¸æ˜¯ç½‘ç»œæµï¼</strong></p>
<p>çŠ¶å‹+æœ€çŸ­è·¯å³å¯ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2761.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2761</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">200</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> u, dis;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> node &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dis &gt; o.dis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">bugfix</span> &#123;</span><br><span class="line">    <span class="type">int</span> c, b1, b2, f1, f2;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, dis[MAXM];</span><br><span class="line">bugfix g[MAXN];</span><br><span class="line"><span class="type">char</span> buf[MAXN];</span><br><span class="line">priority_queue&lt;node&gt; que;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(g[i].c);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (buf[j] == <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">                g[i].b1 |= (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">            <span class="keyword">if</span> (buf[j] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                g[i].b2 |= (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (buf[j] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                g[i].f1 |= (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">            <span class="keyword">if</span> (buf[j] == <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">                g[i].f2 |= (<span class="number">1</span> &lt;&lt; j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(dis));</span><br><span class="line">    dis[(<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    que.<span class="built_in">push</span>(&#123;(<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>, <span class="number">0ll</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        node t = que.<span class="built_in">top</span>();</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span> (dis[t.u] &lt; t.dis)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> u = t.u, d = t.dis;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            bugfix&amp; b = g[i];</span><br><span class="line">            <span class="keyword">if</span> ((u &amp; b.b1) == b.b1 &amp;&amp; (u &amp; b.b2) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">int</span> v = (u &amp; (~b.f1)) | b.f2;</span><br><span class="line">                <span class="keyword">if</span> (dis[v] &gt; dis[u] + b.c) &#123;</span><br><span class="line">                    dis[v] = dis[u] + b.c;</span><br><span class="line">                    que.<span class="built_in">push</span>(&#123;v, dis[v]&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dis[<span class="number">0</span>] == INF)</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">write</span>(dis[<span class="number">0</span>]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2756 é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜</title>
    <url>/2021/12/20/sol-p2756/</url>
    <content><![CDATA[<h2 id="P2756-é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜"><a href="#P2756-é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜" class="headerlink" title="P2756 é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜"></a>P2756 é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜</h2><span id="more"></span>
<p>åšäº†å‡ é“è“è‰²çš„æ°´é¢˜</p>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2756">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>äºŒåˆ†å›¾ç½‘ç»œæµæ¿å­ï¼Œç”¨æ¥å¼ºè¿«è‡ªå·±æ•²ä¸€é$dinic$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2756.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2756</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">350</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">edges</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, w, next;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> n, tot, head[MAXN];</span><br><span class="line">    <span class="type">int</span> cur[MAXN], lev[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n, tot = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fill</span>(head, head + n + <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">        edge[tot] = &#123;v, w, head[u]&#125;;</span><br><span class="line">        head[u] = tot++;</span><br><span class="line">        edge[tot] = &#123;u, <span class="number">0</span>, head[v]&#125;;</span><br><span class="line">        head[v] = tot++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(lev, lev + n + <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s), lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; ~i; i = edge[i].next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].w &amp;&amp; lev[edge[i].v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[edge[i].v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(edge[i].v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; ~i; i = edge[i].next) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v, w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">dfs</span>(v, t, <span class="built_in">min</span>(mx, w));</span><br><span class="line">            edge[i].w -= tmp, edge[i ^ <span class="number">1</span>].w += tmp;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + n + <span class="number">1</span>, cur);</span><br><span class="line">            ret += <span class="built_in">dfs</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, s, t;</span><br><span class="line">dinic nf;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">    s = n + <span class="number">1</span>, t = n + <span class="number">2</span>;</span><br><span class="line">    nf.<span class="built_in">init</span>(n + <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        nf.<span class="built_in">addedge</span>(s, i, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = m + <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        nf.<span class="built_in">addedge</span>(i, t, <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> u, v;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;u, &amp;v), u != <span class="number">-1</span> &amp;&amp; v != <span class="number">-1</span>)</span><br><span class="line">        nf.<span class="built_in">addedge</span>(u, v, INF);</span><br><span class="line">    <span class="built_in">write</span>(nf.<span class="built_in">maxflow</span>(s, t)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nf.tot; i += <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> (nf.edge[i].w == INF - <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld %lld\n&quot;</span>, nf.edge[i ^ <span class="number">1</span>].v, nf.edge[i].v);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3181 [HAOI2016] æ‰¾ç›¸åŒå­—ç¬¦ä¸²</title>
    <url>/2021/12/19/sol-p3181/</url>
    <content><![CDATA[<h2 id="P3181-HAOI2016-æ‰¾ç›¸åŒå­—ç¬¦ä¸²"><a href="#P3181-HAOI2016-æ‰¾ç›¸åŒå­—ç¬¦ä¸²" class="headerlink" title="P3181 [HAOI2016] æ‰¾ç›¸åŒå­—ç¬¦ä¸²"></a>P3181 [HAOI2016] æ‰¾ç›¸åŒå­—ç¬¦ä¸²</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3181">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å‡è®¾æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•è®¡ç®—å•ä¸€ä¸²çš„ç­”æ¡ˆï¼Œä¹‹åå¯ä»¥å°†ä¸¤ä¸ªä¸²æ‹¼æ¥ï¼Œä¸­é—´é—´éš”å­—ç¬¦<code>$</code>ï¼Œç®—å‡ºæ–°ä¸²çš„ç­”æ¡ˆã€‚ä½†æ˜¯è¿™æ ·ä¼šé‡å¤è®¡ç®—ä¸¤ä¸ªå­ä¸²åœ¨åŒä¸€ä¸ªåŸä¸²ï¼Œæ‰€ä»¥è¿˜éœ€å‡å»ä¸¤ä¸ªåŸä¸²çš„ç­”æ¡ˆã€‚å³$ans=ans<em>s-ans</em>{s1}-ans_{s2}$ã€‚</p>
<p>ç°åœ¨åªéœ€è€ƒè™‘å¦‚ä½•ç®—å‡ºä¸€ä¸ªå•ä¸€ä¸²çš„ç­”æ¡ˆã€‚æ ¹æ®åç¼€æ•°ç»„çš„æ€§è´¨ï¼Œæ˜¾ç„¶ç­”æ¡ˆä¸º</p>
<script type="math/tex; mode=display">
\begin{aligned}
ans_s &= \sum_{1 \le i \lt j \le n}{|lcp(suf_i, suf_j)|} \\
&= \sum_{1 \le i \lt j \le n}{\min_{i \lt sa_k \le j}{height(k)}}
\end{aligned}</script><p>ç®—å‡ºæ¯ä¸ª$height$å¯¹$ans$çš„è´¡çŒ®$(i - pre_i) \times (nxt_i - i) \times height(i)$ï¼Œå…¶ä¸­$pre_i$è¡¨ç¤ºå‰ä¸€ä¸ª<strong>å°äº</strong>$height(i)$çš„ä½ç½®ï¼Œ$nxt_i$è¡¨ç¤ºåä¸€ä¸ª<strong>å°äºç­‰äº</strong>$height_i$çš„ä½ç½®ã€‚å•è°ƒæ ˆç»´æŠ¤ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ï¼Œä½†æ˜¾ç„¶å¯ä»¥é€šè¿‡ä½¿ç”¨æ›´é«˜çº§çš„$SA$ä¼˜åŒ–åˆ°$O(n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3181.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3181</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">suffix_array</span> &#123;</span><br><span class="line">    <span class="type">char</span> *str;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">char</span> *s, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;str = s;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">128</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>, top;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> pre[MAXN], nxt[MAXN], sta[MAXN];</span><br><span class="line">        sta[top = <span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (top &amp;&amp; ht[sa[sta[top]]] &gt;= ht[sa[i]])</span><br><span class="line">                --top;</span><br><span class="line">            pre[i] = i - sta[top];</span><br><span class="line">            sta[++top] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        sta[top = <span class="number">0</span>] = n + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (top &amp;&amp; ht[sa[sta[top]]] &gt; ht[sa[i]])</span><br><span class="line">                --top;</span><br><span class="line">            nxt[i] = sta[top] - i;</span><br><span class="line">            sta[++top] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            ret += pre[i] * nxt[i] * ht[sa[i]];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n0, n1, n2;</span><br><span class="line"><span class="type">char</span> s0[MAXN], s1[MAXN], s2[MAXN];</span><br><span class="line">suffix_array sa0, sa1, sa2;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>, s1 + <span class="number">1</span>, s2 + <span class="number">1</span>);</span><br><span class="line">    n1 = <span class="built_in">strlen</span>(s1 + <span class="number">1</span>);</span><br><span class="line">    n2 = <span class="built_in">strlen</span>(s2 + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(s1 + <span class="number">1</span>, s1 + n1 + <span class="number">1</span>, s0 + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(s2 + <span class="number">1</span>, s2 + n2 + <span class="number">1</span>, s0 + n1 + <span class="number">2</span>);</span><br><span class="line">    s0[n1 + <span class="number">1</span>] = <span class="string">&#x27;$&#x27;</span>, n0 = n1 + n2 + <span class="number">1</span>;</span><br><span class="line">    sa0.<span class="built_in">build</span>(s0, n0);</span><br><span class="line">    sa1.<span class="built_in">build</span>(s1, n1);</span><br><span class="line">    sa2.<span class="built_in">build</span>(s2, n2);</span><br><span class="line">    <span class="type">int</span> ans = sa0.<span class="built_in">calc</span>() - sa1.<span class="built_in">calc</span>() - sa2.<span class="built_in">calc</span>();</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>[AHOI2013] å·®å¼‚ é¢˜è§£</title>
    <url>/2021/12/17/sol-p4248/</url>
    <content><![CDATA[<h2 id="AHOI2013-å·®å¼‚-é¢˜è§£"><a href="#AHOI2013-å·®å¼‚-é¢˜è§£" class="headerlink" title="[AHOI2013] å·®å¼‚ é¢˜è§£"></a>[AHOI2013] å·®å¼‚ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4248">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ä½¿ç”¨åç¼€æ•°ç»„æ±‚å‡º$height$æ•°ç»„ï¼ˆç®€å†™ä¸º$ht$ï¼‰ï¼Œç­”æ¡ˆå˜æˆäº†</p>
<script type="math/tex; mode=display">ans = \sum\limits_{1 \le i \lt j \le n}{len(T_i) + len(T_j) - 2 \times \min\limits_{k=i+1}^{j}{ht_k}}</script><p>åŒ–ç®€ï¼Œå¾—</p>
<script type="math/tex; mode=display">ans = \frac{n \times (n + 1) \times (n - 1)}{2} - 2\times\sum\limits_{1 \le i \lt j \le n}{\min\limits_{k=i+1}^{j}{ht_k}}</script><p>æ±‚å’Œç¬¦å·é‡Œçš„ç”¨å•è°ƒæ ˆç»´æŠ¤ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4248.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4248</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> se second</span></span><br><span class="line"><span class="keyword">using</span> pii = pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">suffix_array</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">char</span> *s, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] - <span class="string">&#x27;a&#x27;</span> + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, top;</span><br><span class="line">pii sta[MAXN];</span><br><span class="line"><span class="type">char</span> s[MAXN];</span><br><span class="line">suffix_array sa;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">    n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">    sa.<span class="built_in">init</span>(s, n);</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>, sum = <span class="number">0</span>;</span><br><span class="line">    sta[top = <span class="number">1</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> p = sa.sa[i];</span><br><span class="line">        <span class="keyword">while</span> (top &amp;&amp; sta[top].fi &gt;= sa.ht[p])</span><br><span class="line">            sum -= sta[top].fi * (sta[top].se - sta[top - <span class="number">1</span>].se), --top;</span><br><span class="line">        sta[++top] = &#123;sa.ht[p], i&#125;, sum += sta[top].fi * (sta[top].se - sta[top - <span class="number">1</span>].se);</span><br><span class="line">        ans += sum;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = (n * (n + <span class="number">1</span>) * (n - <span class="number">1</span>)) / <span class="number">2</span> - ans * <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4051 [JSOI2007] å­—ç¬¦åŠ å¯† é¢˜è§£</title>
    <url>/2021/12/17/sol-p4051/</url>
    <content><![CDATA[<h2 id="P4051-JSOI2007-å­—ç¬¦åŠ å¯†-é¢˜è§£"><a href="#P4051-JSOI2007-å­—ç¬¦åŠ å¯†-é¢˜è§£" class="headerlink" title="P4051 [JSOI2007] å­—ç¬¦åŠ å¯† é¢˜è§£"></a>P4051 [JSOI2007] å­—ç¬¦åŠ å¯† é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4051">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ˜¾ç„¶ç›´æ¥æ±‚åç¼€æ•°ç»„çæã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4051.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4051</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">suffix_array</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">char</span> *s, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">128</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> s[MAXN];</span><br><span class="line">suffix_array sa;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">    n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        s[i + n] = s[i];</span><br><span class="line">    sa.<span class="built_in">init</span>(s, n + n);</span><br><span class="line">    <span class="type">int</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n + n; ++i)</span><br><span class="line">        <span class="keyword">if</span> (sa.sa[i] &lt;= n)</span><br><span class="line">            <span class="built_in">putchar</span>(s[sa.sa[i] + n - <span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2408 ä¸åŒå­ä¸²ä¸ªæ•° é¢˜è§£</title>
    <url>/2021/12/17/sol-p2408/</url>
    <content><![CDATA[<h2 id="P2408-ä¸åŒå­ä¸²ä¸ªæ•°-é¢˜è§£"><a href="#P2408-ä¸åŒå­ä¸²ä¸ªæ•°-é¢˜è§£" class="headerlink" title="P2408 ä¸åŒå­ä¸²ä¸ªæ•° é¢˜è§£"></a>P2408 ä¸åŒå­ä¸²ä¸ªæ•° é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2408">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ ¹æ®<a href="/2021/12/17/top-suffixarray/" title="åç¼€æ•°ç»„">åç¼€æ•°ç»„</a>çš„å®šä¹‰ï¼Œ$ans = \frac{n \times (n + 1)}{2} - \sum\limits_{i=1}^{n}{ht_i}$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2408.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2408</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">suffix_array</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">char</span> *s, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] - <span class="string">&#x27;0&#x27;</span> + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> s[MAXN];</span><br><span class="line">suffix_array sa;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">    sa.<span class="built_in">init</span>(s, n);</span><br><span class="line">    <span class="type">int</span> ans = n * (n + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ans -= sa.ht[i];</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>sol-loj6184</title>
    <url>/2021/12/17/sol-loj6184/</url>
    <content><![CDATA[<h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><span id="more"></span>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼</title>
    <url>/2021/12/17/top-poly/</url>
    <content><![CDATA[<h2 id="ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼"><a href="#ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼" class="headerlink" title="ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼"></a>ã€ä¸“é¢˜ã€‘å¤šé¡¹å¼</h2><p>ä¸»è¦ä¸º$FFT$ï¼Œ$NTT$ï¼Œå¤šé¡¹å¼æ±‚é€†ç­‰å˜æ¢ï¼Œå¯ä»¥å’Œç”Ÿæˆå‡½æ•°ç»“åˆèµ·æ¥è€ƒè®¡æ•°é¢˜ã€‚<a href="/2021/11/28/sol-p3803/" title="è¿™ç¯‡é¢˜è§£">è¿™ç¯‡é¢˜è§£</a>ä¸­æœ‰å¯¹å¤šé¡¹å¼ä¹˜æ³•çš„è¾ƒè¯¦ç»†è¯æ˜è¿‡ç¨‹ã€‚</p>
<p>å¯¹äºä½¿ç”¨ç”Ÿæˆå‡½æ•°åˆ¤æ–­æ–¹æ¡ˆæ˜¯å¦åˆæ³•ï¼ˆè€Œä¸æ˜¯ç»Ÿè®¡æ–¹æ¡ˆçš„æ•°é‡ï¼‰ï¼Œä½¿ç”¨å•æ¨¡æ•°å®¹æ˜“è¢«å¡ï¼Œå»ºè®®åœ¨$998244353$ï¼Œ$1004535809$å’Œ$469762049$ä¸­é€‰å–ä¸¤ä¸ªï¼Œå…¶åŸæ ¹éƒ½ä¸º$3$ã€‚</p>
<p>è‹¥é¢˜ç›®ä¸­è¦æ±‚å¯¹å¥‡æ€ªçš„æ•°å–æ¨¡ï¼Œä¸€å®šè®°å¾—è®¡ç®—æ¨¡æ•°çš„åŸæ ¹ï¼Œæœ‰å¯èƒ½ä¸æ˜¯$3$ï¼</p>
<span id="more"></span>
<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><a href="/2021/11/28/sol-p3803/" title="P3803 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰">P3803 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰</a> </br>

<a href="/2021/12/05/sol-p4245/" title="P4245 ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•">P4245 ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•</a> </br>

<a href="/2021/12/05/sol-p4721/" title="P4721 ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT é¢˜è§£">P4721 ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT é¢˜è§£</a> </br>

<a href="/2021/12/05/sol-p4238/" title="P4238 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€† é¢˜è§£">P4238 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€† é¢˜è§£</a> </br>

<a href="/2021/12/05/sol-cf632e/" title="CF632E Thief in a Shop é¢˜è§£">CF632E Thief in a Shop é¢˜è§£</a> </br>

<a href="/2022/01/02/sol-cf986d/" title="CF986D Perfect Encoding">CF986D Perfect Encoding</a> </br>

<a href="/2022/01/03/sol-cf1613f/" title="CF1613F Tree Coloring">CF1613F Tree Coloring</a> </br>

<a href="/2022/01/03/sol-cf755g/" title="CF755G PolandBall and Many Other Balls">CF755G PolandBall and Many Other Balls</a> </br>

<a href="/2022/01/05/sol-cf623e/" title="CF623E Transforming Sequence">CF623E Transforming Sequence</a> </br>

<a href="/2022/01/07/sol-cf773f/" title="CF773F Test Data Generation">CF773F Test Data Generation</a> </br>

<a href="/2022/01/09/sol-cf553e/" title="CF553E Kyoya and Train">CF553E Kyoya and Train</a> </br>

<a href="/2022/01/18/sol-p4725/" title="P4725 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼å¯¹æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼lnï¼‰">P4725 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼å¯¹æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼lnï¼‰</a> </br>

<a href="/2022/01/18/sol-p4726/" title="P4726 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æŒ‡æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼expï¼‰">P4726 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æŒ‡æ•°å‡½æ•°ï¼ˆå¤šé¡¹å¼expï¼‰</a> </br>

<a href="/2022/01/17/sol-p4002/" title="P4002 ç”Ÿæˆæ ‘è®¡æ•°">P4002 ç”Ÿæˆæ ‘è®¡æ•°</a> </br>

<a href="/2022/01/20/sol-p5850/" title="P5850 calc">P5850 calc</a> </br>

<a href="/2022/01/25/sol-p4491/" title="P4491 [HAOI] æŸ“è‰²">P4491 [HAOI] æŸ“è‰²</a>
<h3 id="æ¨¡ç‰ˆä»£ç "><a href="#æ¨¡ç‰ˆä»£ç " class="headerlink" title="æ¨¡ç‰ˆä»£ç "></a>æ¨¡ç‰ˆä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">long</span> <span class="type">double</span> MPI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="comment">// const int MOD = 1004535809; // å¤‡ç”¨</span></span><br><span class="line"><span class="comment">// const int MOD = 469762049; // å¤‡ç”¨</span></span><br><span class="line"><span class="keyword">namespace</span> polynomial &#123;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x -= y;</span><br><span class="line">    <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = MOD)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % p)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x % p;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(_Tp* f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> rev[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span>* f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                f[k] = <span class="built_in">add</span>(u, t), f[k + h / <span class="number">2</span>] = <span class="built_in">sub</span>(u, t);</span><br><span class="line">                g = g * gn % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] = f[i] * inv % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">polymul</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">const</span> <span class="type">int</span>* g, <span class="type">int</span> m, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tf[MAXN] = &#123;&#125;, tg[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n + m - <span class="number">1</span>)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">copy</span>(f, f + n, tf);</span><br><span class="line">    <span class="built_in">fill</span>(tf + n, tf + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">copy</span>(g, g + m, tg);</span><br><span class="line">    <span class="built_in">fill</span>(tg + m, tg + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(tf, len, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(tg, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        tf[i] = tf[i] * tg[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(tf, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">copy</span>(tf, tf + n + m - <span class="number">1</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> n + m - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">polyinv</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tmp[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">fill</span>(ans, ans + len + len, <span class="number">0</span>);</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="built_in">qpow</span>(f[<span class="number">0</span>], MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">copy</span>(f, f + h, tmp);</span><br><span class="line">        <span class="built_in">fill</span>(tmp + h, tmp + h + h, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">ntt</span>(tmp, h + h, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">ntt</span>(ans, h + h, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; h + h; ++i)</span><br><span class="line">            ans[i] = ans[i] * (<span class="number">2</span> - ans[i] * tmp[i] % MOD + MOD) % MOD;</span><br><span class="line">        <span class="built_in">ntt</span>(ans, h + h, <span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">fill</span>(ans + h, ans + h + h, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">derivation</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i)</span><br><span class="line">        ans[i] = f[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">    <span class="keyword">return</span> ans[n - <span class="number">1</span>] = <span class="number">0</span>, n - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">integral</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">        ans[i] = f[i - <span class="number">1</span>] * <span class="built_in">qpow</span>(i, MOD - <span class="number">2</span>) % MOD;</span><br><span class="line">    <span class="keyword">return</span> ans[<span class="number">0</span>] = <span class="number">0</span>, n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ln</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tf[MAXN] = &#123;&#125;, tg[MAXN] = &#123;&#125;;</span><br><span class="line">    <span class="built_in">derivation</span>(f, n, tf);</span><br><span class="line">    <span class="built_in">polyinv</span>(f, n, tg);</span><br><span class="line">    <span class="built_in">polymul</span>(tf, n - <span class="number">1</span>, tg, n, ans);</span><br><span class="line">    <span class="built_in">integral</span>(ans, n - <span class="number">1</span>, ans);</span><br><span class="line">    <span class="built_in">fill</span>(ans + n, ans + n + n, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">exp</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* f, <span class="type">int</span> n, <span class="type">int</span>* ans)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> tmp[MAXN] = &#123;&#125;;</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">1</span>, ans[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= (n &lt;&lt; <span class="number">1</span>); h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">ln</span>(ans, h, tmp);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; h; ++i)</span><br><span class="line">            tmp[i] = <span class="built_in">add</span>(i == <span class="number">0</span>, <span class="built_in">sub</span>(f[i], tmp[i]));</span><br><span class="line">        <span class="built_in">polymul</span>(ans, h, tmp, h, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;  <span class="comment">// namespace polynomial</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ä¸“é¢˜</category>
      </categories>
      <tags>
        <tag>topics</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä¸“é¢˜ã€‘è™šæ ‘</title>
    <url>/2021/12/17/top-virtualtree/</url>
    <content><![CDATA[<h2 id="ã€ä¸“é¢˜ã€‘è™šæ ‘"><a href="#ã€ä¸“é¢˜ã€‘è™šæ ‘" class="headerlink" title="ã€ä¸“é¢˜ã€‘è™šæ ‘"></a>ã€ä¸“é¢˜ã€‘è™šæ ‘</h2><p>è¿™ç§ä¸œè¥¿æƒ³åˆ°è¦ç”¨å¾ˆå®¹æ˜“ï¼Œå…³é”®æ˜¯å»ºå®Œè™šæ ‘åæ€ä¹ˆåšã€‚</p>
<p>è™šæ ‘é¢˜çš„ç‰¹å¾ä¸º<strong>å¤šæ¬¡è¯¢é—®ä¸”å‡ºç°$\sum M \le 10^5$ä¸€ç±»çš„æ•°æ®èŒƒå›´</strong>ã€‚</p>
<p>å¦‚æœé¢˜ç›®ç»™å‡ºçš„æ˜¯ä¸€å¼ å›¾è€Œä¸æ˜¯ä¸€æ£µæ ‘ï¼Œå¯ä»¥æ€è€ƒæ˜¯å¦èƒ½å¤Ÿç»“åˆåœ†æ–¹æ ‘ç­‰ç®—æ³•è½¬åŒ–ä¸ºè™šæ ‘ã€‚</p>
<p>å¯¹äºæ¯æ¬¡è¯¢é—®ï¼Œå°†è¯¢é—®çš„èŠ‚ç‚¹å’Œå…¶åœ¨åŸæ ‘ä¸Šçš„$LCA$å•ç‹¬å»ºå‡ºæ¥$dp$å³å¯ã€‚</p>
<span id="more"></span>
<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><a href="/2021/11/27/sol-p2495/" title="P2495 æ¶ˆè€—æˆ˜ é¢˜è§£">P2495 æ¶ˆè€—æˆ˜ é¢˜è§£</a> </br>

<a href="/2021/11/29/sol-p4606/" title="P4606 æˆ˜ç•¥æ¸¸æˆ é¢˜è§£">P4606 æˆ˜ç•¥æ¸¸æˆ é¢˜è§£</a> </br>

<a href="/2021/11/27/sol-p3233/" title="P3233 ä¸–ç•Œæ ‘ é¢˜è§£">P3233 ä¸–ç•Œæ ‘ é¢˜è§£</a> </br>

<a href="/2021/12/01/sol-cf1320e/" title="CF1320E Treeland and Viruses é¢˜è§£">CF1320E Treeland and Viruses é¢˜è§£</a> </br>

<a href="/2021/12/03/sol-cf639f/" title="CF639F Bear and Chemistry é¢˜è§£">CF639F Bear and Chemistry é¢˜è§£</a> </br>

<a href="/2021/12/17/sol-loj6184/" title="sol-loj6184">sol-loj6184</a>
<h3 id="æ¨¡ç‰ˆä»£ç "><a href="#æ¨¡ç‰ˆä»£ç " class="headerlink" title="æ¨¡ç‰ˆä»£ç "></a>æ¨¡ç‰ˆä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_vtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(s + <span class="number">1</span>, s + k + <span class="number">1</span>, [](<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">        <span class="keyword">return</span> id[x] &lt; id[y];</span><br><span class="line">    &#125;);</span><br><span class="line">    sta[top = <span class="number">1</span>] = <span class="number">1</span>, vtr.head[<span class="number">1</span>] = <span class="number">-1</span>, vtr.tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> l = <span class="built_in">lca</span>(sta[top], s[i]);</span><br><span class="line">        <span class="keyword">if</span> (l &lt; <span class="number">1</span> || l &gt; bcc)</span><br><span class="line">            <span class="built_in">lca</span>(sta[top], s[i]);</span><br><span class="line">        <span class="keyword">while</span> (id[l] &lt;= id[sta[top - <span class="number">1</span>]])</span><br><span class="line">            <span class="built_in">add_vedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="keyword">if</span> (sta[top] != l)</span><br><span class="line">            vtr.head[l] = <span class="number">-1</span>, <span class="built_in">add_vedge</span>(l, sta[top]), sta[top] = l;</span><br><span class="line">        vtr.head[s[i]] = <span class="number">-1</span>, sta[++top] = s[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">add_vedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ä¸“é¢˜</category>
      </categories>
      <tags>
        <tag>topics</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ</title>
    <url>/2021/12/17/top-networkflow/</url>
    <content><![CDATA[<h2 id="ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ"><a href="#ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ" class="headerlink" title="ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ"></a>ã€ä¸“é¢˜ã€‘ç½‘ç»œæµ</h2><p>ç½‘ç»œæµçš„è¯ï¼Œå…ˆå£ç³Šå¥½æ€ä¹ˆå»ºå›¾ï¼Œç„¶å<del>å¤åˆ¶</del>é»˜å†™ä¸€ä¸‹æ¿å­å°±å¥½äº†ã€‚</p>
<p>éš¾ç‚¹å…¶å®æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å¦‚ä½•å»ºå›¾ï¼Œå¦ä¸€ä¸ªæ˜¯è¾“å‡ºè·¯å¾„ã€‚</p>
<p>å¦‚æœä¸€é“é¢˜æœ‰è®¸å¤šå¥‡æ€ªçš„é™åˆ¶ï¼Œå¹¶ä¸”$n$å’Œ$m$å¾ˆå°ï¼Œå¯¼è‡´$O(n^2m)$å¯ä»¥é€šè¿‡ï¼Œå°±å¯ä»¥å¾€ç½‘ç»œæµæ–¹é¢å»æƒ³ã€‚</p>
<p><del>å…¶å®ç½‘ç»œæµ24é¢˜çš„å…¨ç§°å«ç½‘ç»œæµå’Œçº¿æ€§è§„åˆ’24é¢˜ï¼Ÿ</del></p>
<span id="more"></span>
<h3 id="è´¹ç”¨æµéœ€è¦æ³¨æ„çš„åœ°æ–¹"><a href="#è´¹ç”¨æµéœ€è¦æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="è´¹ç”¨æµéœ€è¦æ³¨æ„çš„åœ°æ–¹"></a>è´¹ç”¨æµéœ€è¦æ³¨æ„çš„åœ°æ–¹</h3><ol>
<li>è´¹ç”¨æµå»ºåè¾¹çš„$cost$æ˜¯åŸæ¥çš„$cost$çš„<strong>ç›¸åæ•°</strong>ï¼Œå³éœ€è¦<code>add(u, v, c, f), add(v, u, -c, 0);</code></li>
<li>è®¡ç®—æµé‡çš„æ–¹å¼å’Œæ™®é€šç½‘ç»œæµç›¸åŒï¼Œä½†æ˜¯è®¡ç®—æ€»$cost$æ˜¯æ¯æ¬¡åŠ ä¸Š<code>edge.cost * flow</code>ï¼Œ<strong>ä¸è¦å¿˜è®°ä¹˜ä¸Š$cost$</strong>ï¼Œç”¨å…¨å±€å˜é‡å­˜$cost$ä¼šå¥½å†™ä¸€äº›ã€‚</li>
<li>ç”±äºè´¹ç”¨æµçš„è¾¹æƒå¯èƒ½$\le 0$ï¼Œæ‰€ä»¥<strong>å¿…é¡»</strong>ç”¨$spfa$è€Œæ— æ³•ä½¿ç”¨$dijkstra$ï¼Œå¹¶ä¸”$dfs$<strong>å¢å¹¿æ—¶å¿…é¡»å¼€$vis$æ•°ç»„é˜²æ­¢æ— é™é€’å½’</strong>ã€‚</li>
<li>ï¼ˆè¿™åº”è¯¥ç®—æ˜¯ä¸ªå°$tip$ï¼‰ç½‘ç»œæµ$tot$ä¸€å¼€å§‹æ¸…ç©ºæˆ$1$å¯ä»¥ä¸éœ€è¦å†è°ƒç”¨<code>init</code>å‡½æ•°ï¼Œä¹Ÿä¸éœ€è¦å†æŠŠ$head$æ¸…ç©ºæˆ$-1$ã€‚</li>
</ol>
<h3 id="æµæ¨¡å‹"><a href="#æµæ¨¡å‹" class="headerlink" title="æµæ¨¡å‹"></a>æµæ¨¡å‹</h3><a href="/2021/12/20/sol-p2756/" title="P2756 é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜">P2756 é£è¡Œå‘˜é…å¯¹æ–¹æ¡ˆé—®é¢˜</a> </br>

<a href="/2021/12/21/sol-p4016/" title="P4016 è´Ÿè½½å¹³è¡¡é—®é¢˜">P4016 è´Ÿè½½å¹³è¡¡é—®é¢˜</a> </br>

<a href="/2021/12/22/sol-p1251/" title="P1251 é¤å·¾è®¡åˆ’é—®é¢˜">P1251 é¤å·¾è®¡åˆ’é—®é¢˜</a> </br>

<a href="/2021/12/22/sol-p2754/" title="P2754 æ˜Ÿé™…è½¬ç§»é—®é¢˜">P2754 æ˜Ÿé™…è½¬ç§»é—®é¢˜</a> </br>

<a href="/2021/12/23/sol-p2763/" title="P2763 è¯•é¢˜åº“é—®é¢˜">P2763 è¯•é¢˜åº“é—®é¢˜</a> </br>

<a href="/2021/12/24/sol-p2764/" title="P2764 æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜">P2764 æœ€å°è·¯å¾„è¦†ç›–é—®é¢˜</a> </br>

<a href="/2021/12/24/sol-p2765/" title="P2765 é­”æœ¯çƒé—®é¢˜">P2765 é­”æœ¯çƒé—®é¢˜</a> </br>

<a href="/2021/12/24/sol-p2766/" title="P2766 æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜">P2766 æœ€é•¿ä¸ä¸‹é™å­åºåˆ—é—®é¢˜</a> </br>

<a href="/2021/12/24/sol-p2770/" title="P2770 èˆªç©ºè·¯çº¿é—®é¢˜">P2770 èˆªç©ºè·¯çº¿é—®é¢˜</a> </br>

<a href="/2021/12/25/sol-p3254/" title="P3254 åœ†æ¡Œé—®é¢˜">P3254 åœ†æ¡Œé—®é¢˜</a> </br>

<a href="/2021/12/27/sol-p3356/" title="P3356 ç«æ˜Ÿæ¢é™©é—®é¢˜">P3356 ç«æ˜Ÿæ¢é™©é—®é¢˜</a> </br>

<a href="/2021/12/27/sol-p3357/" title="P3357 æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜">P3357 æœ€é•¿kå¯é‡çº¿æ®µé›†é—®é¢˜</a> </br>

<a href="/2021/12/27/sol-p3358/" title="P3358 æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜">P3358 æœ€é•¿kå¯é‡åŒºé—´é›†é—®é¢˜</a> </br>

<a href="/2021/12/30/sol-p4012/" title="P4012 æ·±æµ·æœºå™¨äººé—®é¢˜">P4012 æ·±æµ·æœºå™¨äººé—®é¢˜</a> </br>

<a href="/2021/12/30/sol-p4013/" title="P4013 æ•°å­—æ¢¯å½¢é—®é¢˜">P4013 æ•°å­—æ¢¯å½¢é—®é¢˜</a> </br>

<a href="/2021/12/30/sol-p4014/" title="P4014 åˆ†é…é—®é¢˜">P4014 åˆ†é…é—®é¢˜</a> </br>

<a href="/2021/12/30/sol-p4015/" title="P4015 è¿è¾“é—®é¢˜">P4015 è¿è¾“é—®é¢˜</a>
<h3 id="å‰²æ¨¡å‹"><a href="#å‰²æ¨¡å‹" class="headerlink" title="å‰²æ¨¡å‹"></a>å‰²æ¨¡å‹</h3><a href="/2021/12/22/sol-p2762/" title="P2762 å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜">P2762 å¤ªç©ºé£è¡Œè®¡åˆ’é—®é¢˜</a> </br>

<a href="/2021/12/25/sol-p2774/" title="P2774 æ–¹æ ¼å–æ•°é—®é¢˜">P2774 æ–¹æ ¼å–æ•°é—®é¢˜</a> </br>

<a href="/2021/12/25/sol-p3355/" title="P3355 éª‘å£«å…±å­˜é—®é¢˜">P3355 éª‘å£«å…±å­˜é—®é¢˜</a>
<h3 id="éæ¨¡å‹"><a href="#éæ¨¡å‹" class="headerlink" title="éæ¨¡å‹"></a>éæ¨¡å‹</h3><a href="/2021/12/20/sol-p2761/" title="P276 è½¯ä»¶è¡¥ä¸é—®é¢˜">P276 è½¯ä»¶è¡¥ä¸é—®é¢˜</a> </br>

<a href="/2021/12/21/sol-p4011/" title="P4011 å­¤å²›è¥æ•‘é—®é¢˜">P4011 å­¤å²›è¥æ•‘é—®é¢˜</a> </br>

<a href="/2021/12/31/sol-p4009/" title="P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜">P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶é—®é¢˜</a>
<h3 id="æ¨¡ç‰ˆä»£ç "><a href="#æ¨¡ç‰ˆä»£ç " class="headerlink" title="æ¨¡ç‰ˆä»£ç "></a>æ¨¡ç‰ˆä»£ç </h3><h4 id="ç½‘ç»œæµ-dinic"><a href="#ç½‘ç»œæµ-dinic" class="headerlink" title="ç½‘ç»œæµ(dinic)"></a>ç½‘ç»œæµ(dinic)</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], lev[MAXN], cur[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(lev, lev + MAXN, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        lev[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; lev[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    lev[v] = lev[u] + <span class="number">1</span>;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lev[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (lev[v] != lev[u] + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXN, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="ç½‘ç»œæµ-HLPP"><a href="#ç½‘ç»œæµ-HLPP" class="headerlink" title="ç½‘ç»œæµ (HLPP)"></a>ç½‘ç»œæµ (HLPP)</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">HLPP</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v; ll flow;</span><br><span class="line">    &#125; edge[MAXM * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> n, s, t, tot = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> h[MAXN], gap[MAXN * <span class="number">2</span>], inq[MAXN];</span><br><span class="line">    ll e[MAXN];</span><br><span class="line">    priority_queue&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; pq;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="keyword">this</span>-&gt;n = n; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, ll f)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, f&#125;, nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>&#125;, nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> que[MAXN];</span><br><span class="line">        <span class="type">int</span> fr = <span class="number">0</span>, bk = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fill</span>(h + <span class="number">1</span>, h + n + <span class="number">1</span>, INF);</span><br><span class="line">        h[t] = <span class="number">0</span>, que[bk++] = t;</span><br><span class="line">        <span class="keyword">while</span> (fr &lt; bk) &#123;</span><br><span class="line">            <span class="type">int</span> u = que[fr++];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i])</span><br><span class="line">                <span class="keyword">if</span> (h[edge[i].v] &gt; h[u] + <span class="number">1</span> &amp;&amp; edge[i ^ <span class="number">1</span>].flow)</span><br><span class="line">                    h[edge[i].v] = h[u] + <span class="number">1</span>, que[bk++] = edge[i].v;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> h[s] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i])</span><br><span class="line">            <span class="keyword">if</span> (h[edge[i].v] + <span class="number">1</span> == h[u] &amp;&amp; edge[i].flow) &#123;</span><br><span class="line">                ll tmp = <span class="built_in">min</span>(e[u], edge[i].flow);</span><br><span class="line">                edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">                e[u] -= tmp, e[edge[i].v] += tmp;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].v != s &amp;&amp; edge[i].v != t &amp;&amp; !inq[edge[i].v])</span><br><span class="line">                    pq.<span class="built_in">push</span>(&#123;h[edge[i].v], edge[i].v&#125;), inq[edge[i].v] = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (!e[u]) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">relabel</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">        h[u] = INF;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i])</span><br><span class="line">            <span class="keyword">if</span> (h[u] &gt; h[edge[i].v] + <span class="number">1</span> &amp;&amp; edge[i].flow)</span><br><span class="line">                h[u] = h[edge[i].v] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;s = s, <span class="keyword">this</span>-&gt;t = t;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">bfs</span>()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        h[s] = n;</span><br><span class="line">        <span class="built_in">fill</span>(gap, gap + n + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">if</span> (h[i] &lt; INF) ++gap[h[i]];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[s]; i; i = nxt[i])</span><br><span class="line">            <span class="keyword">if</span> (ll d = edge[i].flow) &#123;</span><br><span class="line">                edge[i].flow -= d, edge[i ^ <span class="number">1</span>].flow += d;</span><br><span class="line">                e[s] -= d, e[edge[i].v] += d;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].v != s &amp;&amp; edge[i].v != t &amp;&amp; !inq[edge[i].v])</span><br><span class="line">                    pq.<span class="built_in">push</span>(&#123;h[edge[i].v], edge[i].v&#125;), inq[edge[i].v] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">while</span> (!pq.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = pq.<span class="built_in">top</span>().second; pq.<span class="built_in">pop</span>();</span><br><span class="line">            inq[u] = <span class="number">0</span>, <span class="built_in">push</span>(u);</span><br><span class="line">            <span class="keyword">if</span> (e[u]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!--gap[h[u]]) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                        <span class="keyword">if</span> (i != s &amp;&amp; i != t &amp;&amp; h[u] &lt; h[i] &amp;&amp; h[i] &lt; n + <span class="number">1</span>)</span><br><span class="line">                            h[i] = n + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">relabel</span>(u), ++gap[h[u]];</span><br><span class="line">                pq.<span class="built_in">push</span>(&#123;h[u], u&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> e[t];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; network;</span><br></pre></td></tr></table></figure>
<h4 id="æœ€å°è´¹ç”¨æœ€å¤§æµ-dinic"><a href="#æœ€å°è´¹ç”¨æœ€å¤§æµ-dinic" class="headerlink" title="æœ€å°è´¹ç”¨æœ€å¤§æµ(dinic)"></a>æœ€å°è´¹ç”¨æœ€å¤§æµ(dinic)</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">const</span> <span class="type">int</span> MAXV, <span class="type">const</span> <span class="type">int</span> MAXE&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MCMF</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, flow, cost;</span><br><span class="line">    &#125; edge[MAXE * <span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>, head[MAXV], nxt[MAXE];</span><br><span class="line">    <span class="type">int</span> flow, cost, cur[MAXV], dis[MAXV];</span><br><span class="line">    <span class="type">bool</span> vis[MAXV];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> flow, <span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        edge[++tot] = &#123;v, flow, cost&#125;;</span><br><span class="line">        nxt[tot] = head[u], head[u] = tot;</span><br><span class="line">        edge[++tot] = &#123;u, <span class="number">0</span>, -cost&#125;;</span><br><span class="line">        nxt[tot] = head[v], head[v] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(vis, vis + MAXV, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(dis, dis + MAXV, INF);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        dis[s] = <span class="number">0</span>;</span><br><span class="line">        vis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            vis[u] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; i; i = nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = edge[i].v;</span><br><span class="line">                <span class="keyword">if</span> (edge[i].flow &amp;&amp; dis[v] &gt; dis[u] + edge[i].cost) &#123;</span><br><span class="line">                    dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">                        que.<span class="built_in">push</span>(v);</span><br><span class="line">                        vis[v] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">augment</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, <span class="type">int</span> mx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t || mx == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> mx;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> &amp;i = cur[u]; i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || dis[v] != dis[u] + edge[i].cost)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> tmp = <span class="built_in">augment</span>(v, t, <span class="built_in">min</span>(mx, edge[i].flow));</span><br><span class="line">            cost += tmp * edge[i].cost;</span><br><span class="line">            mx -= tmp, ret += tmp;</span><br><span class="line">            edge[i].flow -= tmp, edge[i ^ <span class="number">1</span>].flow += tmp;</span><br><span class="line">            <span class="keyword">if</span> (mx == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">mcmf</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">spfa</span>(s, t)) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(head, head + MAXV, cur);</span><br><span class="line">            flow += <span class="built_in">augment</span>(s, t, INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(flow, cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ä¸“é¢˜</category>
      </categories>
      <tags>
        <tag>topics</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„ SA</title>
    <url>/2021/12/17/top-suffixarray/</url>
    <content><![CDATA[<h2 id="ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„-SA"><a href="#ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„-SA" class="headerlink" title="ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„ SA"></a>ã€ä¸“é¢˜ã€‘åç¼€æ•°ç»„ SA</h2><p><strong>è­¦å‘Šï¼šSAå¤šæ¬¡ä½¿ç”¨ä¸€å®šè¦æ¸…ç©ºï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚</strong></p>
<p><del>è™½ç„¶æœ‰ä¸å°‘æ­¤ç±»é¢˜ç›®å¯ä»¥ç”¨å­—ç¬¦ä¸²hashçæ</del></p>
<p>è®°ä½ä»£ç ä¸­æ¯ä¸ªæ•°ç»„çš„å«ä¹‰ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">æ•°ç»„</th>
<th style="text-align:center">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$sa_i$</td>
<td style="text-align:center">æ’åä¸º$i$çš„åç¼€çš„èµ·å§‹ä½ç½®</td>
</tr>
<tr>
<td style="text-align:center">$rk_i$</td>
<td style="text-align:center">åç¼€$s_{i \cdots n}$çš„æ’å</td>
</tr>
<tr>
<td style="text-align:center">$tp_i$</td>
<td style="text-align:center">ä¸´æ—¶æ•°ç»„ï¼Œç”¨æ¥åœ¨åŸºæ•°æ’åºä¸­è®°å½•ä¸´æ—¶æ’å</td>
</tr>
<tr>
<td style="text-align:center">$ht_i$</td>
<td style="text-align:center">ç¬¬$rk<em>i$ä¸ªåç¼€å’Œç¬¬$rk</em>{i-1}$ä¸ªåç¼€çš„$LCP$</td>
</tr>
</tbody>
</table>
</div>
<span id="more"></span>
<h3 id="ä¸€äº›æ€§è´¨"><a href="#ä¸€äº›æ€§è´¨" class="headerlink" title="ä¸€äº›æ€§è´¨"></a>ä¸€äº›æ€§è´¨</h3><h4 id="å¯é‡å æœ€é•¿é‡å¤å­ä¸²"><a href="#å¯é‡å æœ€é•¿é‡å¤å­ä¸²" class="headerlink" title="å¯é‡å æœ€é•¿é‡å¤å­ä¸²"></a>å¯é‡å æœ€é•¿é‡å¤å­ä¸²</h4><p>å³$ht$æ•°ç»„çš„æœ€å¤§å€¼ã€‚</p>
<h4 id="ä¸åŒå­ä¸²ä¸ªæ•°"><a href="#ä¸åŒå­ä¸²ä¸ªæ•°" class="headerlink" title="ä¸åŒå­ä¸²ä¸ªæ•°"></a>ä¸åŒå­ä¸²ä¸ªæ•°</h4><p>å³$\frac{n \times (n + 1)}{2} - \sum\limits_{i=1}^{n}{ht_i}$ï¼ˆæ˜“è¯ï¼‰ã€‚</p>
<h4 id="ä»»æ„ä¸¤ä¸ªåç¼€çš„-LCP"><a href="#ä»»æ„ä¸¤ä¸ªåç¼€çš„-LCP" class="headerlink" title="ä»»æ„ä¸¤ä¸ªåç¼€çš„$LCP$"></a>ä»»æ„ä¸¤ä¸ªåç¼€çš„$LCP$</h4><p>è®¾åˆ†åˆ«ä¸ºåç¼€$s<em>{i \cdots n}$å’Œ$s</em>{j \cdots n}$ï¼Œå…¶ä¸­$i \lt j$ï¼Œ$LCP = \min\limits_{k=i+1}^{j}{ht_k}$ï¼Œç”¨$RMQ$è§£å†³ã€‚</p>
<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><a href="/2021/12/17/sol-p2408/" title="P2408 ä¸åŒå­ä¸²ä¸ªæ•° é¢˜è§£">P2408 ä¸åŒå­ä¸²ä¸ªæ•° é¢˜è§£</a> </br>

<a href="/2021/12/17/sol-p4051/" title="P4051 [JSOI2007] å­—ç¬¦åŠ å¯† é¢˜è§£">P4051 [JSOI2007] å­—ç¬¦åŠ å¯† é¢˜è§£</a> </br>

<a href="/2021/12/17/sol-p4248/" title="[AHOI2013] å·®å¼‚ é¢˜è§£">[AHOI2013] å·®å¼‚ é¢˜è§£</a> </br>

<a href="/2021/12/19/sol-p3181/" title="P3181 [HAOI2016] æ‰¾ç›¸åŒå­—ç¬¦ä¸²">P3181 [HAOI2016] æ‰¾ç›¸åŒå­—ç¬¦ä¸²</a> </br>

<a href="/2022/01/26/sol-uva11107/" title="UVA11107 Life Forms">UVA11107 Life Forms</a> </br>

<a href="/2022/02/02/sol-p2336/" title="P2336 [SCOI2012] å–µæ˜Ÿçƒä¸Šçš„ç‚¹å">P2336 [SCOI2012] å–µæ˜Ÿçƒä¸Šçš„ç‚¹å</a> </br>

<a href="/2022/02/03/sol-p4341/" title="P4341 [BJWC2010] å¤–æ˜Ÿè”ç»œ">P4341 [BJWC2010] å¤–æ˜Ÿè”ç»œ</a> </br>

<a href="/2022/02/03/sol-p4070/" title="P4070 [SDOI2016] ç”Ÿæˆé­”å’’">P4070 [SDOI2016] ç”Ÿæˆé­”å’’</a> </br>

<a href="/2022/02/03/sol-p5028/" title="P5028 Annihilate">P5028 Annihilate</a> </br>

<a href="/2022/02/03/sol-p4081/" title="P4081 [USACO17DEC] Standing Out from the Herd P">P4081 [USACO17DEC] Standing Out from the Herd P</a> </br>

<a href="/2022/02/04/sol-p4094/" title="P4094 [HEOI2016&#x2F;TJOI2016] å­—ç¬¦ä¸²">P4094 [HEOI2016&#x2F;TJOI2016] å­—ç¬¦ä¸²</a> </br>

<a href="/2022/02/04/sol-p1117/" title="P1117 [NOI2016] ä¼˜ç§€çš„æ‹†åˆ†">P1117 [NOI2016] ä¼˜ç§€çš„æ‹†åˆ†</a> </br>

<a href="/2022/02/05/sol-p3900/" title="P3900 [æ¹–å—é›†è®­] å›¾æ£®">P3900 [æ¹–å—é›†è®­] å›¾æ£®</a> </br>

<a href="/2022/02/05/sol-p4770/" title="P4770 [NOI2018] ä½ çš„åå­—">P4770 [NOI2018] ä½ çš„åå­—</a> </br>

<a href="/2022/02/05/sol-p6095/" title="P6095 [JSOI2015] ä¸²åˆ†å‰²">P6095 [JSOI2015] ä¸²åˆ†å‰²</a>
<h3 id="æ¨¡ç‰ˆä»£ç "><a href="#æ¨¡ç‰ˆä»£ç " class="headerlink" title="æ¨¡ç‰ˆä»£ç "></a>æ¨¡ç‰ˆä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN], he[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fill</span>(sa, sa + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(rk, rk + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(tp, tp + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(ht, ht + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">fill</span>(he, he + n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        n = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buc[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buc[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buc[i] += buc[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buc[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n, <span class="type">char</span>* s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">1</span>, p = <span class="number">0</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = he[rk[i]] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ä¸“é¢˜</category>
      </categories>
      <tags>
        <tag>topics</tag>
      </tags>
  </entry>
  <entry>
    <title>P3809 ã€æ¨¡ç‰ˆã€‘åç¼€æ’åº é¢˜è§£</title>
    <url>/2021/12/16/sol-p3809/</url>
    <content><![CDATA[<h2 id="P3809-ã€æ¨¡ç‰ˆã€‘åç¼€æ’åº-é¢˜è§£"><a href="#P3809-ã€æ¨¡ç‰ˆã€‘åç¼€æ’åº-é¢˜è§£" class="headerlink" title="P3809 ã€æ¨¡ç‰ˆã€‘åç¼€æ’åº é¢˜è§£"></a>P3809 ã€æ¨¡ç‰ˆã€‘åç¼€æ’åº é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3809">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ¨¡ç‰ˆé¢˜ä¸å¤šè¯´</p>
<p>è®°ä½ä»£ç ä¸­æ¯ä¸ªæ•°ç»„çš„å«ä¹‰ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">æ•°ç»„</th>
<th style="text-align:center">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$sa_i$</td>
<td style="text-align:center">æ’åä¸º$i$çš„åç¼€çš„èµ·å§‹ä½ç½®</td>
</tr>
<tr>
<td style="text-align:center">$rk_i$</td>
<td style="text-align:center">åç¼€$s_{i \cdots n}$çš„æ’å</td>
</tr>
<tr>
<td style="text-align:center">$tp_i$</td>
<td style="text-align:center">ä¸´æ—¶æ•°ç»„ï¼Œç”¨æ¥åœ¨åŸºæ•°æ’åºä¸­è®°å½•ä¸´æ—¶æ’å</td>
</tr>
<tr>
<td style="text-align:center">$ht_i$</td>
<td style="text-align:center">ç¬¬$rk<em>i$ä¸ªåç¼€å’Œç¬¬$rk</em>{i-1}$ä¸ªåç¼€çš„$LCP$</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">suffix_array</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">char</span> *s, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] - <span class="string">&#x27;0&#x27;</span> + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3809.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3809</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">suffix_array</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, sa[MAXN], rk[MAXN], tp[MAXN], ht[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radix_sort</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> buk[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            buk[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            buk[i] += buk[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">            sa[buk[rk[tp[i]]]--] = tp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">char</span> *s, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            rk[i] = s[i] - <span class="string">&#x27;0&#x27;</span> + <span class="number">1</span>, tp[i] = i;</span><br><span class="line">        <span class="built_in">radix_sort</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">0</span>, w = <span class="number">1</span>; p &lt; n; m = p, w &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= w; ++i)</span><br><span class="line">                tp[++p] = n - w + i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">                <span class="keyword">if</span> (sa[i] &gt; w)</span><br><span class="line">                    tp[++p] = sa[i] - w;</span><br><span class="line">            <span class="built_in">radix_sort</span>(m);</span><br><span class="line">            <span class="built_in">copy</span>(rk + <span class="number">1</span>, rk + n + <span class="number">1</span>, tp + <span class="number">1</span>);</span><br><span class="line">            rk[sa[<span class="number">1</span>]] = p = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tp[sa[i - <span class="number">1</span>]] == tp[sa[i]] &amp;&amp; tp[sa[i - <span class="number">1</span>] + w] == tp[sa[i] + w])</span><br><span class="line">                    rk[sa[i]] = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    rk[sa[i]] = ++p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, k = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k)</span><br><span class="line">                k--;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k])</span><br><span class="line">                k++;</span><br><span class="line">            ht[i] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> s[MAXN];</span><br><span class="line">suffix_array sa;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s + <span class="number">1</span>);</span><br><span class="line">    n = <span class="built_in">strlen</span>(s + <span class="number">1</span>);</span><br><span class="line">    sa.<span class="built_in">init</span>(s, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(sa.sa[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2056 [ZJOI2007] æ‰è¿·è— é¢˜è§£</title>
    <url>/2021/12/15/sol-p2056/</url>
    <content><![CDATA[<h2 id="P2056-ZJOI2007-æ‰è¿·è—-é¢˜è§£"><a href="#P2056-ZJOI2007-æ‰è¿·è—-é¢˜è§£" class="headerlink" title="P2056 [ZJOI2007] æ‰è¿·è— é¢˜è§£"></a>P2056 [ZJOI2007] æ‰è¿·è— é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2056">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æƒ³åˆ°æ˜¯ç‚¹åˆ†æ ‘å°±æ¯”è¾ƒå¥½åšäº†ã€‚</p>
<p>çœ‹åˆ°æ ‘ä¸Šè·¯å¾„æƒ³åˆ°$LCA$æˆ–ç‚¹åˆ†æ ‘ã€‚å…ˆè€ƒè™‘å•æ¬¡æŸ¥è¯¢çš„ç‚¹åˆ†æ²»åšæ³•ï¼Œ$dp1_u$è¡¨ç¤º$u$ä¸ºé‡å¿ƒçš„å—ä¸­åˆ°$fa_u$çš„æœ€é•¿è·ç¦»ï¼Œ$dp0_u$è¡¨ç¤º$u$ä¸ºé‡å¿ƒçš„å—ä¸­ç»è¿‡$u$çš„æœ€é•¿è·¯å¾„ï¼Œæ˜¾ç„¶$dp0_u$ä¸ºæ¯ä¸ªå„¿å­$v$çš„$dp1_v$æœ€å¤§å€¼ä¸æ¬¡å¤§å€¼ä¹‹å’Œã€‚</p>
<p>å°†æ­¤æ–¹æ³•æ‹“å±•åˆ°ç‚¹åˆ†æ ‘ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸¤ä¸ªå¯åˆ å †ï¼Œåˆ†åˆ«å°±è¡¨ç¤º$dp0_u$å’Œ$dp1_u$çš„å€¼ï¼Œæœ€åç»Ÿè®¡åˆ°ç­”æ¡ˆä¸­ã€‚</p>
<p>ç©ºé—´å¤æ‚åº¦$O(n \log n)$ï¼Œæ—¶é—´å¤æ‚åº¦$O(n \log^2 n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2056.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;Ofast&quot;, &quot;inline&quot;, &quot;-ffast-math&quot;)</span></span><br><span class="line"><span class="comment">// #pragma GCC target (&quot;avx,sse2,sse3,sse4,mmx&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">18</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">heap</span> &#123;</span><br><span class="line">    priority_queue&lt;<span class="type">int</span>&gt; q, p;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        q.<span class="built_in">push</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">erase</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        p.<span class="built_in">push</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (p.<span class="built_in">size</span>() &amp;&amp; q.<span class="built_in">size</span>() &amp;&amp; p.<span class="built_in">top</span>() == q.<span class="built_in">top</span>())</span><br><span class="line">            p.<span class="built_in">pop</span>(), q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> q.<span class="built_in">top</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (p.<span class="built_in">size</span>() &amp;&amp; q.<span class="built_in">size</span>() &amp;&amp; p.<span class="built_in">top</span>() == q.<span class="built_in">top</span>())</span><br><span class="line">            p.<span class="built_in">pop</span>(), q.<span class="built_in">pop</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> q.<span class="built_in">size</span>() - p.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sectop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> t = <span class="built_in">top</span>();</span><br><span class="line">        <span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">int</span> r = <span class="built_in">top</span>();</span><br><span class="line">        <span class="built_in">push</span>(t);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, q, fa[MAXN], dep[MAXN], fq[MAXN][LOGN];</span><br><span class="line"><span class="type">int</span> scnt, siz[MAXN], mxsiz[MAXN];</span><br><span class="line"><span class="type">bool</span> vis[MAXN], opn[MAXN];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[MAXN];</span><br><span class="line">heap shp, hp[MAXN][<span class="number">2</span>];</span><br><span class="line"><span class="type">char</span> buf[<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getroot</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f, <span class="type">int</span> sz)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    siz[u] = <span class="number">1</span>, mxsiz[u] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f || vis[v])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> tmp = <span class="built_in">getroot</span>(v, u, sz);</span><br><span class="line">        <span class="keyword">if</span> (mxsiz[tmp] &lt; mxsiz[ret])</span><br><span class="line">            ret = tmp;</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        mxsiz[u] = <span class="built_in">max</span>(mxsiz[u], siz[v]);</span><br><span class="line">    &#125;</span><br><span class="line">    mxsiz[u] = <span class="built_in">max</span>(mxsiz[u], sz - siz[u]);</span><br><span class="line">    <span class="keyword">if</span> (mxsiz[u] &lt; mxsiz[ret])</span><br><span class="line">        ret = u;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build1</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    fq[u][<span class="number">0</span>] = f, dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fq[u][i] = fq[fq[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u])</span><br><span class="line">        <span class="keyword">if</span> (v != f)</span><br><span class="line">            <span class="built_in">build1</span>(v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f, <span class="type">int</span> sz)</span> </span>&#123;</span><br><span class="line">    vis[u] = <span class="literal">true</span>, fa[u] = f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f || vis[v])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> ns = (siz[u] &gt; siz[v]) ? siz[v] : sz - siz[u];</span><br><span class="line">        <span class="type">int</span> rt = <span class="built_in">getroot</span>(v, u, ns);</span><br><span class="line">        <span class="built_in">build2</span>(rt, u, ns);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="type">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fq[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fq[u][i] != fq[v][i])</span><br><span class="line">            u = fq[u][i], v = fq[v][i];</span><br><span class="line">    <span class="keyword">return</span> fq[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dist</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dep[u] + dep[v] - (dep[<span class="built_in">lca</span>(u, v)] &lt;&lt; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (hp[x][<span class="number">0</span>].<span class="built_in">size</span>() &gt;= <span class="number">2</span>)</span><br><span class="line">        shp.<span class="built_in">erase</span>(hp[x][<span class="number">0</span>].<span class="built_in">top</span>() + hp[x][<span class="number">0</span>].<span class="built_in">sectop</span>());</span><br><span class="line">    <span class="keyword">if</span> (opn[x])</span><br><span class="line">        hp[x][<span class="number">0</span>].<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        hp[x][<span class="number">0</span>].<span class="built_in">erase</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (hp[x][<span class="number">0</span>].<span class="built_in">size</span>() &gt;= <span class="number">2</span>)</span><br><span class="line">        shp.<span class="built_in">push</span>(hp[x][<span class="number">0</span>].<span class="built_in">top</span>() + hp[x][<span class="number">0</span>].<span class="built_in">sectop</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> u = x; fa[u]; u = fa[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hp[fa[u]][<span class="number">0</span>].<span class="built_in">size</span>() &gt;= <span class="number">2</span>)</span><br><span class="line">            shp.<span class="built_in">erase</span>(hp[fa[u]][<span class="number">0</span>].<span class="built_in">top</span>() + hp[fa[u]][<span class="number">0</span>].<span class="built_in">sectop</span>());</span><br><span class="line">        <span class="keyword">if</span> (hp[u][<span class="number">1</span>].<span class="built_in">size</span>())</span><br><span class="line">            hp[fa[u]][<span class="number">0</span>].<span class="built_in">erase</span>(hp[u][<span class="number">1</span>].<span class="built_in">top</span>());</span><br><span class="line">        <span class="keyword">if</span> (opn[x])</span><br><span class="line">            hp[u][<span class="number">1</span>].<span class="built_in">push</span>(<span class="built_in">dist</span>(fa[u], x));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            hp[u][<span class="number">1</span>].<span class="built_in">erase</span>(<span class="built_in">dist</span>(fa[u], x));</span><br><span class="line">        <span class="keyword">if</span> (hp[u][<span class="number">1</span>].<span class="built_in">size</span>())</span><br><span class="line">            hp[fa[u]][<span class="number">0</span>].<span class="built_in">push</span>(hp[u][<span class="number">1</span>].<span class="built_in">top</span>());</span><br><span class="line">        <span class="keyword">if</span> (hp[fa[u]][<span class="number">0</span>].<span class="built_in">size</span>() &gt;= <span class="number">2</span>)</span><br><span class="line">            shp.<span class="built_in">push</span>(hp[fa[u]][<span class="number">0</span>].<span class="built_in">top</span>() + hp[fa[u]][<span class="number">0</span>].<span class="built_in">sectop</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> shp.<span class="built_in">size</span>() ? shp.<span class="built_in">top</span>() : (scnt ? <span class="number">0</span> : <span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g[u].<span class="built_in">emplace_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">emplace_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    mxsiz[<span class="number">0</span>] = INF;</span><br><span class="line">    <span class="built_in">build1</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">build2</span>(<span class="built_in">getroot</span>(<span class="number">1</span>, <span class="number">0</span>, n), <span class="number">0</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        opn[i] = <span class="literal">true</span>, <span class="built_in">update</span>(i), ++scnt;</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">if</span> (buf[<span class="number">0</span>] == <span class="string">&#x27;G&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">write</span>(<span class="built_in">query</span>()), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> x;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            opn[x] ? --scnt : ++scnt;</span><br><span class="line">            opn[x] = !opn[x];</span><br><span class="line">            <span class="built_in">update</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€äº›æœ‰è¶£çš„äº‹æƒ…</title>
    <url>/2021/12/13/interesting/</url>
    <content><![CDATA[<h2 id="ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼ˆå¯ä»¥è®©è¿™ä¸ªåšå®¢å……æ»¡æ´»è·ƒçš„æ°”æ°›ï¼‰"><a href="#ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼ˆå¯ä»¥è®©è¿™ä¸ªåšå®¢å……æ»¡æ´»è·ƒçš„æ°”æ°›ï¼‰" class="headerlink" title="ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼ˆå¯ä»¥è®©è¿™ä¸ªåšå®¢å……æ»¡æ´»è·ƒçš„æ°”æ°›ï¼‰"></a>ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼ˆå¯ä»¥è®©è¿™ä¸ªåšå®¢<del>å……æ»¡</del>æ´»è·ƒ<del>çš„æ°”æ°›</del>ï¼‰</h2><span id="more"></span>
<h3 id="2021-12-13"><a href="#2021-12-13" class="headerlink" title="2021.12.13"></a>2021.12.13</h3><p>ä¸Šå‘¨å…­æ‰å–è¿‡ $H_2CO_3$ï¼ˆæŒ‡å¯ä¹ï¼‰å¹¶ä¸”è¢«æŸå·¨ä½¬æé†’ $H_2O+CO_2=H_2CO_3$ </p>
<p>äºæ˜¯åŒ–å­¦è€ƒè¯•<strong>çŒœ</strong>å‡º $C$ å’Œ $CuO$ ï¼Œ<strong>çŒœ</strong>å‡º $H_2CO_3 $ï¼Œ<strong>çŒœ</strong>å‡º $CO_2$ å’Œ $H_2O$ çš„ä½ç½®ï¼Œ<strong>çŒœ</strong>å‡ºå’Œ $Fe_2O_3$ ååº”çš„æ˜¯ $H_2$ å¹¶ä¸”<strong>çŒœ</strong>å¯¹äº†æˆ‘ç‹¬ç«‹åšå‡ºæ¥çš„ç¬¬ä¸€é“ç‰©è´¨æ¨æ–­é¢˜ï¼ˆçœŸå°±å…¨æ˜¯çŒœå¯¹çš„ï¼‰</p>
<p>æ‰€ä»¥è¯´å‘¨å…­é›†è®­ä¸€å®šè¦ä¹°å¯ä¹ã€‚<del>å¯ä»¥è®©ä½ åŒ–å­¦è€ƒè¯•åŠ åˆ†</del></p>
]]></content>
  </entry>
  <entry>
    <title>P6329 ã€æ¨¡ç‰ˆã€‘ç‚¹åˆ†æ ‘ï½œéœ‡æ³¢</title>
    <url>/2021/12/10/sol-p6329/</url>
    <content><![CDATA[<h2 id="P6329-ã€æ¨¡ç‰ˆã€‘ç‚¹åˆ†æ ‘ï½œéœ‡æ³¢"><a href="#P6329-ã€æ¨¡ç‰ˆã€‘ç‚¹åˆ†æ ‘ï½œéœ‡æ³¢" class="headerlink" title="P6329 ã€æ¨¡ç‰ˆã€‘ç‚¹åˆ†æ ‘ï½œéœ‡æ³¢"></a>P6329 ã€æ¨¡ç‰ˆã€‘ç‚¹åˆ†æ ‘ï½œéœ‡æ³¢</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P6329">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p><del>é¢˜ç›®é‡Œéƒ½è¯´äº†æ˜¯ç‚¹åˆ†æ ‘</del></p>
<p>å‘ç°è‡ªå·±å­¦è¿‡çš„ç‚¹åˆ†æ ‘ç°åœ¨å·²ç»ä¸ä¼šå†™äº†ï¼Œ<strong>æ”¹å¤©</strong>æ¥è¡¥ä¸ªç‚¹åˆ†æ ‘çš„é¢˜è§£å§ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P6329.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P6329</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">binary_indexed_tree</span> &#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; c;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ##sb-mistakes## å¼€`vector`å½“åŠ¨æ€å¼€ç‚¹æ ‘çŠ¶æ•°ç»„`resize`æ—¶æ²¡æœ‰$+1$</span></span><br><span class="line">        <span class="comment">// c.resize(n = m);</span></span><br><span class="line">        c.<span class="built_in">resize</span>((n = m) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = x; i &lt;= n; i += (i &amp; -i))</span><br><span class="line">            c[i] += v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        x = <span class="built_in">min</span>(x, n);</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = x; i; i -= (i &amp; -i))</span><br><span class="line">            ret += c[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, q, a[MAXN], fa[MAXN], dep[MAXN], fq[MAXN][LOGN];</span><br><span class="line"><span class="type">int</span> cur[MAXN], siz[MAXN], mxsiz[MAXN];</span><br><span class="line">bitset&lt;MAXN&gt; vis;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[MAXN];</span><br><span class="line">binary_indexed_tree bit[MAXN][<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getroot</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f, <span class="type">int</span> sz)</span> </span>&#123;</span><br><span class="line">    siz[u] = <span class="number">1</span>;</span><br><span class="line">    mxsiz[u] = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f || vis[v])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> tmp = <span class="built_in">getroot</span>(v, u, sz);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        mxsiz[u] = <span class="built_in">max</span>(mxsiz[u], siz[v]);</span><br><span class="line">        <span class="keyword">if</span> (mxsiz[tmp] &lt; mxsiz[ret])</span><br><span class="line">            ret = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    mxsiz[u] = <span class="built_in">max</span>(mxsiz[u], sz - siz[u]);</span><br><span class="line">    <span class="keyword">if</span> (mxsiz[u] &lt; mxsiz[ret])</span><br><span class="line">        ret = u;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build1</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f, <span class="type">int</span> sz)</span> </span>&#123;</span><br><span class="line">    fa[u] = f, vis[u] = <span class="literal">true</span>;</span><br><span class="line">    bit[u][<span class="number">0</span>].<span class="built_in">init</span>(sz + <span class="number">2</span>);</span><br><span class="line">    bit[u][<span class="number">1</span>].<span class="built_in">init</span>(sz + <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (vis[v])</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> nsz = (siz[u] &gt; siz[v]) ? siz[v] : (sz - siz[u]);</span><br><span class="line">        <span class="type">int</span> nrt = <span class="built_in">getroot</span>(v, <span class="number">0</span>, nsz);</span><br><span class="line">        <span class="built_in">build1</span>(nrt, u, nsz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    fq[u][<span class="number">0</span>] = f, dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fq[u][i] = fq[fq[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u])</span><br><span class="line">        <span class="keyword">if</span> (v != f)</span><br><span class="line">            <span class="built_in">build2</span>(v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="type">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fq[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fq[u][i] != fq[v][i])</span><br><span class="line">            u = fq[u][i], v = fq[v][i];</span><br><span class="line">    <span class="keyword">return</span> fq[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getdis</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="built_in">lca</span>(x, y);</span><br><span class="line">    <span class="keyword">return</span> dep[x] + dep[y] - <span class="number">2</span> * dep[l];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> u = x; u; u = fa[u]) &#123;</span><br><span class="line">        bit[u][<span class="number">0</span>].<span class="built_in">add</span>(<span class="built_in">getdis</span>(u, x) + <span class="number">1</span>, v - cur[x]);</span><br><span class="line">        <span class="keyword">if</span> (fa[u])</span><br><span class="line">            bit[u][<span class="number">1</span>].<span class="built_in">add</span>(<span class="built_in">getdis</span>(fa[u], x) + <span class="number">1</span>, v - cur[x]);</span><br><span class="line">    &#125;</span><br><span class="line">    cur[x] = v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> u = x; u; u = fa[u]) &#123;</span><br><span class="line">        <span class="type">int</span> d = k - <span class="built_in">getdis</span>(u, x);</span><br><span class="line">        <span class="keyword">if</span> (d &gt;= <span class="number">0</span>)</span><br><span class="line">            ret += bit[u][<span class="number">0</span>].<span class="built_in">sum</span>(d + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (fa[u]) &#123;</span><br><span class="line">            d = k - <span class="built_in">getdis</span>(fa[u], x);</span><br><span class="line">            <span class="keyword">if</span> (d &gt;= <span class="number">0</span>)</span><br><span class="line">                ret -= bit[u][<span class="number">1</span>].<span class="built_in">sum</span>(d + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    mxsiz[<span class="number">0</span>] = INFL;</span><br><span class="line">    <span class="built_in">build1</span>(<span class="built_in">getroot</span>(<span class="number">1</span>, <span class="number">0</span>, n), <span class="number">0</span>, n);</span><br><span class="line">    <span class="built_in">build2</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> tt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">modify</span>(i, a[i]);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="type">int</span> op, x, y;</span><br><span class="line">        <span class="built_in">read</span>(op), <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        x ^= tt, y ^= tt;</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">write</span>(tt = <span class="built_in">query</span>(x, y));</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">modify</span>(x, y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2664 æ ‘ä¸Šæ¸¸æˆ é¢˜è§£</title>
    <url>/2021/12/10/sol-p2664/</url>
    <content><![CDATA[<h2 id="P2664-æ ‘ä¸Šæ¸¸æˆ-é¢˜è§£"><a href="#P2664-æ ‘ä¸Šæ¸¸æˆ-é¢˜è§£" class="headerlink" title="P2664 æ ‘ä¸Šæ¸¸æˆ é¢˜è§£"></a>P2664 æ ‘ä¸Šæ¸¸æˆ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2664">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>åˆ†åˆ«è€ƒè™‘æ¯ç§é¢œè‰²ï¼Œå¯¹äºé¢œè‰²$col$ï¼Œå°†æ‰€æœ‰$c_u=col$çš„$u$åˆ å»å°±å¾—åˆ°è‹¥å¹²è¿é€šå—ï¼Œé¢œè‰²$col$å¯¹$sum_v$çš„è´¡çŒ®æ˜¯$n-num_v$ï¼Œ$num_v$ä¸º$v$æ‰€åœ¨è¿é€šå—å¤§å°ã€‚ç‰¹åˆ«åœ°ï¼Œæˆ‘ä»¬ä»¤$c_u=col$æ—¶$num_u=0$ã€‚</p>
<p>æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ˜¯ç»™æ¯ç§é¢œè‰²åˆ†åˆ«å»ºç«‹è™šæ ‘è®¡ç®—è´¡çŒ®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(n \log n)$ã€‚</p>
<p>ä½†æ˜¯è¿™é“é¢˜æ˜¯æœ‰$O(n)$çš„åšæ³•æ»´ã€‚åšæ³•ä¸ºä¸¤é$dfs$ï¼Œç¬¬ä¸€éé¢„å¤„ç†å‡ºæ¯ä¸ª$col=c_{fa_u}$å¯¹åº”çš„$num_u$ã€‚$num_u$å°±æ˜¯$siz_u$å‡å»å­æ ‘$u$ä¸­ä¸ç»è¿‡å…¶ä»–é¢œè‰²ä¸º$c_u$çš„èŠ‚ç‚¹ç›´æ¥ä¸$u$è¿æ¥çš„é¢œè‰²ä¸º$c_u$çš„ç‚¹çš„$siz$ä¹‹å’Œã€‚$dfs$æ—¶é¡ºä¾¿é¢„å¤„ç†å‡º$col_i$è¡¨ç¤ºæ ¹èŠ‚ç‚¹å‘¨å›´çš„é¢œè‰²ä¸º$i$è¿é€šå—å¤§å°ã€‚ç¬¬äºŒéç›´æ¥ç»Ÿè®¡ç­”æ¡ˆã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2664.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2664</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> n, c[MAXN], son[MAXN], cnt[MAXN], col[MAXN], cur[MAXN];</span><br><span class="line"><span class="type">int</span> sum, len, siz[MAXN], num[MAXN], ans[MAXN];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> tmp = cur[c[u]];</span><br><span class="line">    siz[u] = <span class="number">1</span>;</span><br><span class="line">    cur[c[u]] = u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        son[u] = v;</span><br><span class="line">        <span class="built_in">dfs1</span>(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">    &#125;</span><br><span class="line">    cur[c[u]] = tmp;</span><br><span class="line">    num[u] += siz[u];</span><br><span class="line">    <span class="keyword">if</span> (son[cur[c[u]]])</span><br><span class="line">        num[son[cur[c[u]]]] -= siz[u];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        col[c[u]] -= siz[u];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (son[cur[c[u]]])</span><br><span class="line">        sum -= num[son[cur[c[u]]]];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        sum -= col[c[u]];</span><br><span class="line">    sum += num[u];</span><br><span class="line">    ans[u] = n * len - sum;</span><br><span class="line">    <span class="type">int</span> tmp = cur[c[u]];</span><br><span class="line">    cur[c[u]] = u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        son[u] = v;</span><br><span class="line">        <span class="built_in">dfs2</span>(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    cur[c[u]] = tmp;</span><br><span class="line">    sum -= num[u];</span><br><span class="line">    <span class="keyword">if</span> (son[cur[c[u]]])</span><br><span class="line">        sum += num[son[cur[c[u]]]];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        sum += col[c[u]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(c[i]), ++cnt[c[i]];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; MAXN; ++i)</span><br><span class="line">        <span class="keyword">if</span> (cnt[i])</span><br><span class="line">            ++len, col[i] = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; MAXN; ++i)</span><br><span class="line">        sum += col[i];</span><br><span class="line">    num[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans[i]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF1096G Lucky Tickets é¢˜è§£</title>
    <url>/2021/12/08/sol-cf1096g/</url>
    <content><![CDATA[<h2 id="CF1096G-Lucky-Tickets-é¢˜è§£"><a href="#CF1096G-Lucky-Tickets-é¢˜è§£" class="headerlink" title="CF1096G Lucky Tickets é¢˜è§£"></a>CF1096G Lucky Tickets é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF1096G">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p><del>ç¬¬ä¸€æ¬¡è¿™ä¹ˆè½»æ¾åœ°åšè®¡æ•°é¢˜</del></p>
<p>æœ‰äº†<a href="/2021/12/05/sol-cf632e/" title="CF632E">CF632E</a>çš„ç»éªŒï¼Œè¿™é¢˜$10$ç§’ä»¥å†…å°±èƒ½åˆ‡ã€‚</p>
<p>å…ˆæ„é€ ç”Ÿæˆå‡½æ•°$f(x) = \sum\limits_{i \in K}{x^i}$ï¼Œå–å…¶ä¸­$\frac{n}{2}$ä¸ªæ•°å­—çš„å’Œç›¸å½“äº$f^\frac{n}{2}(x)$ã€‚$NTT$è®¡ç®—å³å¯ï¼Œç­”æ¡ˆå¾ˆå¥½ç»Ÿè®¡ã€‚</p>
<p>$5$åˆ†é’Ÿå°±åšæ‰äº†ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF1096G.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF1096G</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">21</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> G0 = <span class="number">3</span>;</span><br><span class="line"><span class="type">int</span> n, k, f[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x % MOD;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">            rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">            <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">change</span>(f, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> gn = <span class="built_in">qpow</span>(G0, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">            <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                g = g * gn % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">        <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            f[i] = f[i] * inv % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n) /= <span class="number">2</span>, <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, x; i &lt;= k; ++i)</span><br><span class="line">        <span class="built_in">read</span>(x), f[x] = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt;= n * <span class="number">9</span>)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">ntt</span>(f, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        f[i] = <span class="built_in">qpow</span>(f[i], n);</span><br><span class="line">    <span class="built_in">ntt</span>(f, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        (ans += f[i] * f[i]) %= MOD;</span><br><span class="line">    <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>AT2064 Many Easy Problems é¢˜è§£</title>
    <url>/2021/12/06/sol-at2064/</url>
    <content><![CDATA[<h2 id="AT2064-Many-Easy-Problems-é¢˜è§£"><a href="#AT2064-Many-Easy-Problems-é¢˜è§£" class="headerlink" title="AT2064 Many Easy Problems é¢˜è§£"></a>AT2064 Many Easy Problems é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/AT2064">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¯¹äºæ¯ä¸ªèŠ‚ç‚¹$u$ï¼Œè€ƒè™‘å…¶å¯¹$f(i)$çš„è´¡çŒ®ã€‚</p>
<p>æ­£é¢çš„è´¡çŒ®ä¸å¥½è®¡ç®—ï¼Œè€ƒè™‘ç”¨æ€»æ–¹æ¡ˆæ•°å‡å»ä¸ç»è¿‡$u$çš„æ•°é‡ï¼Œåˆ™</p>
<script type="math/tex; mode=display">
\begin{aligned}
f(i) &= \sum\limits_{u=1}^{n}{\left(\binom{n}{i} - \binom{n-siz_u}{i} - \sum\limits_{v \in son_u}{\binom{siz_v}{i}}\right)} \\
&= n\binom{n}{i} - \sum\limits_{u=1}^{n}{\left(\binom{n-siz_u}{i} + \sum\limits_{v \in son_u}{\binom{siz_v}{i}}\right)}
\end{aligned}</script><p>è®¾$cnt_i$è¡¨ç¤ºå­æ ‘å¤§å°ä¸º$i$çš„èŠ‚ç‚¹æ•°é‡ã€‚ä¸ºäº†ä¾¿äºä¹‹åçš„è®¡ç®—ï¼Œæˆ‘ä»¬å°†ä¸åœ¨èŠ‚ç‚¹$u$å­æ ‘ä¸­çš„èŠ‚ç‚¹å®šä¹‰ä¸ºä¸€æ£µæ–°çš„å­æ ‘å¹¶åŠ å…¥$son_u$ã€‚å½¢å¼åŒ–åœ°ï¼Œå³å¯¹äºæ¯ä¸ªèŠ‚ç‚¹$u\neq 1$ï¼Œå°†$n-siz_u$åŠ å…¥$cnt$æ•°ç»„ä¸­ã€‚å¼å­ç®€åŒ–å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f(i) &= n\binom{n}{i} - \sum\limits_{u=1}^{n}{\sum\limits_{v \in son_u}{\binom{siz_v}{i}}} \\
&= n\binom{n}{i} - \sum\limits_{j=i}^{n}{cnt_j \cdot \binom{j}{i}}
\end{aligned}</script><p>å±•å¼€ç»„åˆæ•°å¾—åˆ°</p>
<script type="math/tex; mode=display">
\begin{aligned}
f(i) &= n\binom{n}{i} - \sum\limits_{j=i}^{n}{cnt_j \cdot \binom{j}{i}} \\
&= n\binom{n}{i} - \sum\limits_{j=i}^{n}{\frac{cnt_j \cdot j!}{i! (j - i)!}} \\
&= n\binom{n}{i} - \frac{1}{i!}\sum\limits_{j=i}^{n}{\frac{cnt_j \cdot j!}{(j - i)!}}
\end{aligned}</script><p>ç”±äºåé¢çš„æ±‚å’Œç¬¦å·ä¸­æ—¢æœ‰$j$åˆæœ‰$i-j$ï¼Œæƒ³åŠæ³•å°†å…¶åŒ–ä¸ºå·ç§¯çš„å½¢å¼ã€‚</p>
<script type="math/tex; mode=display">
\begin{aligned}
f(i) &= n\binom{n}{i} - \frac{1}{i!}\sum\limits_{j=i}^{n}{\frac{cnt_j \cdot j!}{(j - i)!}} \\
&= n\binom{n}{i} - \frac{1}{i!}\sum\limits_{j=0}^{n-i}{\frac{cnt_{n - j} \cdot (n - j)!}{(n - i - j)!}}
\end{aligned}</script><p>æ‰€ä»¥ä»¤$F<em>j = cnt</em>{n - j} \cdot (n - j)!$ï¼Œ$G_j = \frac{1}{j!}$ï¼Œæœ€ç»ˆå¼å­æˆäº†</p>
<script type="math/tex; mode=display">
f(i) = n\binom{n}{i} - \frac{1}{i!}\sum\limits_{j=0}^{n-i}{F_j \cdot G_{n - i - j}}</script><p>ä½¿ç”¨$NTT$ä¼˜åŒ–å³å¯ã€‚æ³¨æ„$924844033$çš„åŸæ ¹æ˜¯$5$è€Œä¸æ˜¯$3$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           AT2064.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/AT2064</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">924844033</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> G0 = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> gn = <span class="built_in">qpow</span>(G0, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n, fa[MAXN], siz[MAXN], cnt[MAXN], ans[MAXN];</span><br><span class="line"><span class="type">int</span> fac[MAXN], inv[MAXN], f[MAXN], g[MAXN], res[MAXN];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; tr[MAXN];</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    fa[u] = f, siz[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : tr[u])</span><br><span class="line">        <span class="keyword">if</span> (v != f)</span><br><span class="line">            <span class="built_in">build</span>(v, u), siz[u] += siz[v];</span><br><span class="line">    ++cnt[siz[u]], ++cnt[n - siz[u]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = fac[<span class="number">0</span>] = <span class="number">1</span>; i &lt; MAXN; ++i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">    inv[MAXN - <span class="number">1</span>] = <span class="built_in">qpow</span>(fac[MAXN - <span class="number">1</span>], MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXN - <span class="number">2</span>; ~i; --i)</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">binom</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fac[x] * inv[y] % MOD * inv[x - y] % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        tr[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        tr[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>), cnt[<span class="number">0</span>] = cnt[n] = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// ##sb-mistakes## è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬FFT/NTTåšå·ç§¯ä¸€å®šè¦å¼€ä¸¤å€é•¿åº¦</span></span><br><span class="line">    <span class="comment">// while (len &lt;= n)</span></span><br><span class="line">    <span class="keyword">while</span> (len &lt;= n + n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">        f[i] = cnt[n - i] * fac[n - i] % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">        g[i] = inv[i];</span><br><span class="line">    <span class="built_in">ntt</span>(f, len, <span class="number">1</span>), <span class="built_in">ntt</span>(g, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        res[i] = f[i] * g[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(res, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ans[i] = (n * <span class="built_in">binom</span>(n, i) % MOD - inv[i] * res[n - i] % MOD + MOD) % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans[i]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4245 ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•</title>
    <url>/2021/12/05/sol-p4245/</url>
    <content><![CDATA[<h2 id="P4245-ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•"><a href="#P4245-ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•" class="headerlink" title="P4245 ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•"></a>P4245 ã€æ¨¡ç‰ˆã€‘ä»»æ„æ¨¡æ•°å¤šé¡¹å¼ä¹˜æ³•</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4245">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¯¹äºä»»æ„æ¨¡æ•°çš„å¤šé¡¹å¼ä¹˜æ³•æ˜¾ç„¶æ— æ³•ç›´æ¥å¥—ç”¨$NTT$ã€‚è€Œç”±äºæ•°é‡çº§è¿‡å¤§ï¼Œé‡‡ç”¨<code>std::complex&lt;long double&gt;</code>çš„$FFT$ä¹Ÿä¼šäº§ç”Ÿæ¯”è¾ƒå¤šçš„ç²¾åº¦ä¸¢å¤±ã€‚</p>
<h4 id="æ–¹æ³•1-NTT-åˆå¹¶"><a href="#æ–¹æ³•1-NTT-åˆå¹¶" class="headerlink" title="æ–¹æ³•1: $NTT$åˆå¹¶"></a>æ–¹æ³•1: $NTT$åˆå¹¶</h4><p>ç”±äº$a_i,b_i \le 10^9$ä¸”$n \le 10^5$ï¼Œæ‰€ä»¥ç­”æ¡ˆçš„æ•°é‡çº§ä¸è¶…è¿‡$10^9 \times 10^9 \times 10^5 = 10^{23}$ï¼Œè¿™æ ·å°±å¯ä»¥æ‰¾$3$ä¸ª$10^8$å·¦å³çš„æ¨¡æ•°åˆ†åˆ«ç”¨$NTT$ç®—å‡ºå¯¹å…¶å–æ¨¡çš„ç­”æ¡ˆï¼Œç”¨ä¸­å›½å‰©ä½™å®šç†åˆå¹¶ã€‚</p>
<p>è¿™é‡Œæ¯”è¾ƒå¸¸ç”¨çš„$3$ä¸ªæ¨¡æ•°åˆ†åˆ«æ˜¯</p>
<script type="math/tex; mode=display">
\begin{aligned}
p_1 &= 998244353 = 7 \times 17 \times 2^{23} + 1, &g &= 3 \\
p_2 &= 1004535809 = 479 \times 2^{21} + 1, &g &= 3 \\
p_3 &= 469762049 = 7 \times 2^{26} + 1, &g &= 3
\end{aligned}</script><p>ä¸‹é¢å‡è®¾æˆ‘ä»¬æ±‚å‡ºäº†å¯¹è¿™$3$ä¸ªæ¨¡æ•°çš„ç­”æ¡ˆåˆ†åˆ«ä¸º$x_1,x_2,x_3$ï¼Œå¾—åˆ°åŒä½™æ–¹ç¨‹å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{cases}
x \equiv x_1 \pmod{p_1} \\
x \equiv x_2 \pmod{p_2} \\
x \equiv x_3 \pmod{p_3} \\
\end{cases}</script><p>ç”±äºä¹˜ç§¯è¿‡å¤§æ— æ³•ç”¨<code>long long</code>å‚¨å­˜ï¼Œæ‰€ä»¥æ­£å¸¸çš„$CRT$ä¸èƒ½åœ¨æ­¤ä½¿ç”¨ï¼ˆå½“ç„¶å¦‚æœä½ å†™é«˜ç²¾åº¦å°±å½“æˆ‘æ²¡è¯´ï¼‰ï¼Œäºæ˜¯è€ƒè™‘æ‰‹åŠ¨åˆå¹¶ã€‚å…ˆæŠŠå‰ä¸¤ä¸ªåˆå¹¶ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
x_1 + k_1 p_1 &= x_2 + k_2 p_2 \\
x_1 + k_1 p_1 &\equiv x_2 &\pmod{p_2} \\
k_1 &\equiv \frac{x_2 - x_1}{p_1} &\pmod{p_2} \\
\end{aligned}</script><p>è¿™æ ·ä¾¿æ±‚å‡ºäº†$k_1$ï¼ŒåŒæ—¶å¾—åˆ°æ–°çš„æ–¹ç¨‹$x \equiv x_1 + k_1 p_1 \pmod{p_1 p_2}$ã€‚è®°$x_4  = x_1 + k_1 p_1$ã€‚</p>
<script type="math/tex; mode=display">
\begin{aligned}
x_4 + k_4 p_1 p_2 &= x_3 + k_3 p_3 \\
x_4 + k_4 p_1 p_2 &\equiv x_3 &\pmod{p_3} \\
k_4 &\equiv \frac{x_3 - x_4}{p_1 p_2} &\pmod{p_3} \\
\end{aligned}</script><p>æ±‚å‡º$k_4$åï¼Œå¾—åˆ°$x \equiv x_4 + k_4 p_1 p_2 \pmod{p_3}$ã€‚ç”±äº$x \lt p_1 p_2 p_3$ï¼Œæ‰€ä»¥$x = x_4 + k_4 p_1 p_2$ã€‚</p>
<p>å…±éœ€è¦è·‘$3 \times 3 = 9$æ¬¡$NTT$ï¼Œå¸¸æ•°è¾ƒå¤§ã€‚</p>
<h4 id="æ–¹æ³•2-æ‹†ç³»æ•°-FFT"><a href="#æ–¹æ³•2-æ‹†ç³»æ•°-FFT" class="headerlink" title="æ–¹æ³•2: æ‹†ç³»æ•°$FFT$"></a>æ–¹æ³•2: æ‹†ç³»æ•°$FFT$</h4><p>æŠŠä¸€ä¸ªæ•°æ‹†åˆ†æˆ$a \times 2^{15} + b$çš„å½¢å¼ï¼Œåˆ™$a, b \lt 2^{15}$</p>
<p>å°†$a$å’Œ$b$åˆ†åˆ«åšå¤šé¡¹å¼ï¼Œç›¸ä¹˜çš„å€¼åŸŸæ˜¯$2^{15} \times 2^{15} \times 10^5 \approx 10^{14}$ï¼Œå¯ä»¥æ¥å—ã€‚äºæ˜¯</p>
<script type="math/tex; mode=display">
\begin{aligned}
c_1 \times c_2 &= (a_1 \times 2^{15} + b_1) \times (a_2 \times 2^{15} + b_2) \\
&= a_1 a_2 \times 2^{30} + (a_1 b_2 + a_2 b_1) \times 2^{15} + b_1 b_2
\end{aligned}</script><p>ä¹ä¸€çœ‹å¥½åƒéœ€è¦ç®—$4$æ¬¡ä¹˜æ³•ï¼Œå…±$12$æ¬¡$FFT$ï¼Œé‚£å²‚ä¸æ˜¯æ¯”æ–¹æ³•1æ›´åŠ£ï¼Ÿ</p>
<p>å¼€å§‹æ¨å¼å­å§ã€‚å‡è®¾æœ‰$4$ä¸ªå¤šé¡¹å¼$A_1,A_2,B_1,B_2$ï¼Œå¦‚ä½•æ±‚ä»–ä»¬çš„ä¸¤ä¸¤ä¹˜ç§¯ã€‚</p>
<p>ç”±äº$(a+bi) \times (c+di) = (ac-bd) + (ad+bc)i$ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¾å¤å¤šé¡¹å¼$P = A_1 + iB_1$ï¼Œ$Q = A_2 + iB_2$ï¼ˆè¿™æ˜¯å“ªä½ç¥ä»™æƒ³å‡ºæ¥çš„å•Šï¼‰ï¼Œè€Œ$FFT$æœ¬èº«å°±æ˜¯ä½¿ç”¨å¤æ•°è®¡ç®—æ‰€ä»¥ç›´æ¥ä¼ å…¥å¤æ•°ä¹Ÿæ²¡å…³ç³»ã€‚</p>
<p>è®¾$T_1 = P \times Q = A_1 A_2 - B_1 B_2 + (A_1 B_2 + A_2 B_1)i$ï¼Œ</p>
<p>åˆè®¾$Pâ€™ = A_1 - iB_1$ï¼Œ</p>
<p>é‚£$T_2 = Pâ€™ \times Q = A_1 A_2 + B_1 B_2 + (A_1 B_2 - A_2 B_1)i$ï¼Œ</p>
<p>ä¸¤è€…$T_1$å’Œ$T_2$è¿›è¡Œå’Œå·®å°±å¾—åˆ°äº†å¤šé¡¹å¼çš„ä¸¤ä¸¤ä¹˜ç§¯ï¼ˆå¦™å•Šï¼‰ã€‚</p>
<p>æ€»çš„$FFT$æ¬¡æ•°ä¸º$3$æ¬¡DFT$+2$æ¬¡IDFT$=5$æ¬¡ã€‚</p>
<p>çªç„¶å‘ç°å€¼åŸŸå…¶å®åº”è¯¥æ˜¯$10^{19}$è€Œä¸æ˜¯$10^{14}$ï¼Œå› ä¸º$IDFT$ä¹‹å‰è¿˜å¾—é™¤ä»¥$n$â€¦â€¦</p>
<p>çœ‹æ•°æ®å¼ºåº¦è·‘å§ï¼Œä»£ç å€’æ˜¯æŒºå¥½å†™çš„ã€‚</p>
<p><strong>è®¡ç®—$\pi$ä¸è¦ç”¨å¸¸é‡<code>M_PI</code>è€Œæ˜¯è¦ç”¨<code>acos(-1)</code>!!!!ä¸ç„¶è¿™é¢˜ä¸¢å¤±ç²¾åº¦åªèƒ½è¿‡å‰$10$ä¸ªç‚¹!!!!</strong></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4245.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4245</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> comp = complex&lt;<span class="type">long</span> <span class="type">double</span>&gt;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">long</span> <span class="type">double</span> MPI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="comment">// å¯¹åº”æ–¹æ³•1</span></span><br><span class="line"><span class="keyword">namespace</span> solve1 &#123;</span><br><span class="line">    <span class="type">int</span> mod;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> mod)</span> </span>&#123;</span><br><span class="line">        solve1::mod = mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">qmul</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = mod)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = (x + x) % p)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = (ret + x) % p;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> p = mod)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = <span class="built_in">qmul</span>(x, x, p))</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = <span class="built_in">qmul</span>(ret, x, p);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (mod - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % mod;</span><br><span class="line">                    f[k] = (u + t + mod) % mod;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + mod) % mod;</span><br><span class="line">                    g = g * gn % mod;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, mod - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> MODS[<span class="number">3</span>] = &#123;<span class="number">998244353</span>, <span class="number">1004535809</span>, <span class="number">469762049</span>&#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INV1 = <span class="built_in">qpow</span>(MODS[<span class="number">0</span>], MODS[<span class="number">1</span>] - <span class="number">2</span>, MODS[<span class="number">1</span>]);</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> INV2 = <span class="built_in">qpow</span>(MODS[<span class="number">0</span>] * MODS[<span class="number">1</span>] % MODS[<span class="number">2</span>], MODS[<span class="number">2</span>] - <span class="number">2</span>, MODS[<span class="number">2</span>]);</span><br><span class="line">    <span class="type">int</span> n, m, p, a[<span class="number">3</span>][MAXN], b[<span class="number">3</span>][MAXN], ans[<span class="number">3</span>][MAXN];</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">crt</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> t = (a2 - a1 + MODS[<span class="number">1</span>]) % MODS[<span class="number">1</span>] * INV1 % MODS[<span class="number">1</span>] * MODS[<span class="number">0</span>] + a1;</span><br><span class="line">        <span class="keyword">return</span> ((a3 - t % MODS[<span class="number">2</span>] + MODS[<span class="number">2</span>]) % MODS[<span class="number">2</span>] * INV2 % MODS[<span class="number">2</span>] * (MODS[<span class="number">0</span>] * MODS[<span class="number">1</span>] % p) % p + t) % p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(p);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, x; i &lt;= n; ++i)</span><br><span class="line">            <span class="built_in">read</span>(x) %= p, a[<span class="number">0</span>][i] = a[<span class="number">1</span>][i] = a[<span class="number">2</span>][i] = x;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, x; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">read</span>(x) %= p, b[<span class="number">0</span>][i] = b[<span class="number">1</span>][i] = b[<span class="number">2</span>][i] = x;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt; n + m + <span class="number">1</span>)</span><br><span class="line">            len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">3</span>; ++k) &#123;</span><br><span class="line">            <span class="built_in">init</span>(MODS[k]);</span><br><span class="line">            <span class="built_in">ntt</span>(a[k], len, <span class="number">1</span>), <span class="built_in">ntt</span>(b[k], len, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                ans[k][i] = a[k][i] * b[k][i] % mod;</span><br><span class="line">            <span class="built_in">ntt</span>(ans[k], len, <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n + m; ++i)</span><br><span class="line">            <span class="built_in">write</span>(<span class="built_in">crt</span>(ans[<span class="number">0</span>][i], ans[<span class="number">1</span>][i], ans[<span class="number">2</span>][i])), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n + m]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯¹åº”æ–¹æ³•2</span></span><br><span class="line"><span class="keyword">namespace</span> solve2 &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(comp *f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fft</span><span class="params">(comp *f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * MPI / h), sin(<span class="number">2</span> * MPI / h))</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                    f[k] = u + t;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                    w *= wn;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] /= len;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> BLOC = <span class="number">1</span> &lt;&lt; <span class="number">15</span>;</span><br><span class="line">    <span class="type">int</span> n, m, p, a[MAXN], b[MAXN], ans[MAXN];</span><br><span class="line">    comp p1[MAXN], p2[MAXN], q[MAXN], t1[MAXN], t2[MAXN];</span><br><span class="line">    <span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(p);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="built_in">read</span>(a[i]) %= p;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">read</span>(b[i]) %= p;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt; n + m + <span class="number">1</span>)</span><br><span class="line">            len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            p1[i] = <span class="built_in">comp</span>(a[i] / BLOC, a[i] % BLOC);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            p2[i] = <span class="built_in">comp</span>(a[i] / BLOC, -a[i] % BLOC);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            q[i] = <span class="built_in">comp</span>(b[i] / BLOC, b[i] % BLOC);</span><br><span class="line">        <span class="built_in">fft</span>(p1, len, <span class="number">1</span>), <span class="built_in">fft</span>(p2, len, <span class="number">1</span>), <span class="built_in">fft</span>(q, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            t1[i] = p1[i] * q[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            t2[i] = p2[i] * q[i];</span><br><span class="line">        <span class="built_in">fft</span>(t1, len, <span class="number">-1</span>), <span class="built_in">fft</span>(t2, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> a1a2 = ((<span class="type">int</span>)((t1[i].<span class="built_in">real</span>() + t2[i].<span class="built_in">real</span>()) / <span class="number">2</span> + <span class="number">0.5</span>)) % p;</span><br><span class="line">            <span class="type">int</span> a1b2 = ((<span class="type">int</span>)((t2[i].<span class="built_in">imag</span>() + t1[i].<span class="built_in">imag</span>()) / <span class="number">2</span> + <span class="number">0.5</span>)) % p;</span><br><span class="line">            <span class="type">int</span> a2b1 = ((<span class="type">int</span>)((t1[i].<span class="built_in">imag</span>() - t2[i].<span class="built_in">imag</span>()) / <span class="number">2</span> + <span class="number">0.5</span>)) % p;</span><br><span class="line">            <span class="type">int</span> b1b2 = ((<span class="type">int</span>)((t2[i].<span class="built_in">real</span>() - t1[i].<span class="built_in">real</span>()) / <span class="number">2</span> + <span class="number">0.5</span>)) % p;</span><br><span class="line">            ans[i] = (a1a2 * (<span class="number">1ll</span> &lt;&lt; <span class="number">30</span>) % p + (a1b2 + a2b1) * (<span class="number">1ll</span> &lt;&lt; <span class="number">15</span>) % p + b1b2) % p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n + m; ++i)</span><br><span class="line">            <span class="built_in">write</span>(ans[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n + m]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// return solve1::main();</span></span><br><span class="line">    <span class="keyword">return</span> solve2::<span class="built_in">main</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF632E Thief in a Shop é¢˜è§£</title>
    <url>/2021/12/05/sol-cf632e/</url>
    <content><![CDATA[<h2 id="CF632E-Thief-in-a-Shop-é¢˜è§£"><a href="#CF632E-Thief-in-a-Shop-é¢˜è§£" class="headerlink" title="CF632E Thief in a Shop é¢˜è§£"></a>CF632E Thief in a Shop é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF632E">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p><del>å…¶å®è¿™é¢˜å¯ä»¥ç›´æ¥æš´åŠ›åšçš„</del></p>
<p>è¿˜æ˜¯å­¦ä¹ ä¸€ä¸‹<a href="https://oi-wiki.org/math/gen-func/ogf/">ç”Ÿæˆå‡½æ•°</a>å§ã€‚</p>
<p>å¯¹äºæ‰€æœ‰ç‰©å“æ„é€ ç”Ÿæˆå‡½æ•°$f(x) = \sum\limits_{i\in S}{x^i}$</p>
<p>å–å‡º$k$ä¸ªç‰©å“ç›¸å½“äº$f^k(x)$ã€‚</p>
<p>ä½†æ˜¯é¢˜è§£é‡Œè¯´æ¨¡æ•°$998244353$å’Œ$1004535809$éƒ½è¢«å¡äº†ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©ä½¿ç”¨åŒæ¨¡æ•°é˜²æ­¢è¢«$hack$ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(N \log N)$ï¼Œå…¶ä¸­$N$æ˜¯$10^6$çº§åˆ«çš„ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF632E.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF632E</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="type">int</span> mod;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> mod)</span> </span>&#123;</span><br><span class="line">        maths::mod = mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % mod)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % mod;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (mod - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % mod;</span><br><span class="line">                    f[k] = (u + t + mod) % mod;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + mod) % mod;</span><br><span class="line">                    g = g * gn % mod;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, mod - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n, k, cnt, a[MAXN], b[MAXN], answ[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        <span class="built_in">read</span>(x);</span><br><span class="line">        a[x] = b[x] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line">    maths::<span class="built_in">init</span>(<span class="number">998244353</span>);</span><br><span class="line">    maths::<span class="built_in">ntt</span>(a, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        a[i] = maths::<span class="built_in">qpow</span>(a[i], k);</span><br><span class="line">    maths::<span class="built_in">ntt</span>(a, len, <span class="number">-1</span>);</span><br><span class="line">    maths::<span class="built_in">init</span>(<span class="number">1004535809</span>);</span><br><span class="line">    maths::<span class="built_in">ntt</span>(b, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        b[i] = maths::<span class="built_in">qpow</span>(b[i], k);</span><br><span class="line">    maths::<span class="built_in">ntt</span>(b, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; ++i)</span><br><span class="line">        <span class="keyword">if</span> (a[i] || b[i])</span><br><span class="line">            answ[++cnt] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i)</span><br><span class="line">        <span class="built_in">write</span>(answ[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == cnt]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4721 ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT é¢˜è§£</title>
    <url>/2021/12/05/sol-p4721/</url>
    <content><![CDATA[<h2 id="P4721-ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT-é¢˜è§£"><a href="#P4721-ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT-é¢˜è§£" class="headerlink" title="P4721 ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT é¢˜è§£"></a>P4721 ã€æ¨¡ç‰ˆã€‘åˆ†æ²»FFT é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4721">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>ç”±äº$f_i$ä¾èµ–äº$f_j(1\le j\lt i)$ï¼Œæ‰€ä»¥è€ƒè™‘åˆ†æ²»è®¡ç®—ï¼Œæ¯æ¬¡å…ˆè®¡ç®—å·¦åŠæ®µï¼Œå°†è´¡çŒ®åŠ åˆ°å³åŠæ®µåç»§ç»­é€’å½’è®¡ç®—å³åŠæ®µã€‚</p>
<p>æ€è€ƒå¦‚ä½•è®¡ç®—è´¡çŒ®ã€‚å‘ç°é¢˜ç›®ä¸­$f<em>i=\sum\limits</em>{j=1}^{i}{f_{i-j}g_j}$çš„æ–¹å¼å¾ˆåƒå¤šé¡¹å¼ä¹˜æ³•ï¼ŒåŒºé—´$[l,mid]$å¯¹$f_i(mid \lt i \le r)$çš„è´¡çŒ®å°±æ˜¯$F(x) = f(x) \times g(x)$çš„$F(i)$ï¼Œç”¨$NTT$è¿›è¡Œè®¡ç®—å³å¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log^2 n)$ï¼ˆä¼¼ä¹æ¯”å¤šé¡¹å¼æ±‚é€†è¦æ…¢ä¸å°‘ï¼‰ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4721.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4721</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">18</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> G0 = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> gn = <span class="built_in">qpow</span>(G0, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> maths::ntt;</span><br><span class="line"><span class="type">int</span> n, a[MAXN], b[MAXN], f[MAXN], g[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> len = r - l + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve</span>(l, mid);</span><br><span class="line">    <span class="built_in">copy</span>(f + l, f + mid + <span class="number">1</span>, a);</span><br><span class="line">    <span class="built_in">copy</span>(g, g + len, b);</span><br><span class="line">    <span class="built_in">fill</span>(a + len / <span class="number">2</span>, a + len, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(a, len, <span class="number">1</span>), <span class="built_in">ntt</span>(b, len, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        a[i] = a[i] * b[i] % MOD;</span><br><span class="line">    <span class="built_in">ntt</span>(a, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = mid + <span class="number">1</span>; i &lt;= r; ++i)</span><br><span class="line">        f[i] = (f[i] + a[i - l]) % MOD;</span><br><span class="line">    <span class="built_in">solve</span>(mid + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(g[i]);</span><br><span class="line">    <span class="type">int</span> len = f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">solve</span>(<span class="number">0</span>, len - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(f[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4238 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€† é¢˜è§£</title>
    <url>/2021/12/05/sol-p4238/</url>
    <content><![CDATA[<h2 id="P4238-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€†-é¢˜è§£"><a href="#P4238-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€†-é¢˜è§£" class="headerlink" title="P4238 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€† é¢˜è§£"></a>P4238 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼æ±‚é€† é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4238">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å‡è®¾æˆ‘ä»¬è¦æ±‚</p>
<script type="math/tex; mode=display">f(x) \cdot g(x) \equiv 1 \pmod{x^n}</script><p>å¦‚æœå·²ç»çŸ¥é“</p>
<script type="math/tex; mode=display">f(x) \cdot h(x) \equiv 1 \pmod{x^\frac{n}{2}}</script><p>é‚£ä¹ˆç›¸å‡å¯å¾—</p>
<script type="math/tex; mode=display">f(x) \cdot (g(x) - h(x)) \equiv 0 \pmod{x^\frac{n}{2}}</script><script type="math/tex; mode=display">g(x) - h(x) \equiv 0 \pmod{x^\frac{n}{2}}</script><p>ä¸¤è¾¹åŒæ—¶å¹³æ–¹å¾—åˆ°</p>
<script type="math/tex; mode=display">g^2(x) - 2 \cdot g(x) \cdot h(x) + h^2(x) \equiv 0 \pmod{x^n}</script><p>ä¹˜ä¸Š$f(x)$å¾—åˆ°</p>
<script type="math/tex; mode=display">g(x) - 2 \cdot h(x) + f(x) \cdot h^2(x) \equiv 0 \pmod{x^n}</script><p>ç§»é¡¹å¾—åˆ°</p>
<script type="math/tex; mode=display">g(x) \equiv h(x) \cdot (2 - f(x) \cdot h(x)) \pmod{x^n}</script><p>é€’å½’è®¡ç®—å³å¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦</p>
<script type="math/tex; mode=display">T(n) = T\left(\frac{n}{2}\right) + O(n \log n) = O(n \log n)</script><h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4238.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4238</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">18</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> maths &#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> rev[MAXN];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = rev[<span class="number">0</span>] = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">polyinv</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len, <span class="type">int</span> *g)</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> tmp[MAXN];</span><br><span class="line">        <span class="built_in">fill</span>(tmp, tmp + len + len, <span class="number">0</span>);</span><br><span class="line">        g[<span class="number">0</span>] = <span class="built_in">qpow</span>(f[<span class="number">0</span>], MOD - <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> t = <span class="number">2</span>; t &lt;= len; t &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">copy</span>(f, f + t, tmp);</span><br><span class="line">            <span class="built_in">fill</span>(tmp + t, tmp + t + t, <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">ntt</span>(g, t + t, <span class="number">1</span>), <span class="built_in">ntt</span>(tmp, t + t, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; t + t; ++i)</span><br><span class="line">                g[i] = g[i] * (<span class="number">2</span> - tmp[i] * g[i] % MOD + MOD) % MOD;</span><br><span class="line">            <span class="built_in">ntt</span>(g, t + t, <span class="number">-1</span>);</span><br><span class="line">            <span class="built_in">fill</span>(g + t, g + t + t, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> maths;</span><br><span class="line"><span class="type">int</span> n, f[MAXN], g[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(f[i]);</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; n)</span><br><span class="line">        len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">polyinv</span>(f, len, g);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">write</span>(g[i]), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == n - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF526G Spiders Evil Plan é¢˜è§£</title>
    <url>/2021/12/04/sol-cf526g/</url>
    <content><![CDATA[<h2 id="CF526G-Spiders-Evil-Plan-é¢˜è§£"><a href="#CF526G-Spiders-Evil-Plan-é¢˜è§£" class="headerlink" title="CF526G Spiders Evil Plan é¢˜è§£"></a>CF526G Spiders Evil Plan é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF526G">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æœ‰æ„æ€ï¼Œå¾ˆæœ‰æ„æ€ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬æš‚æ—¶å¿½ç•¥è·¯å¾„å¿…é¡»ç»è¿‡$x$çš„é™åˆ¶è¿›è¡Œæ€è€ƒã€‚å®¹æ˜“æƒ³åˆ°æœ€é•¿çš„ä¸€æ¡è·¯å¾„æ˜¯æ ‘çš„ç›´å¾„ï¼Œä¸”å…¶ä»–è·¯å¾„éƒ½æ˜¯ä¸€ä¸ªå¶å­åˆ°å¦ä¸€ä¸ªå¶å­çš„ç±»å‹ï¼Œæ¥ç€å‘ç°å¦‚æœè·¯å¾„å¿…é¡»ç»è¿‡$x$ä¹Ÿéœ€è¦ä¿è¯æœ€é•¿è·¯å¾„ç»è¿‡ç›´å¾„çš„å…¶ä¸­ä¸€ä¸ªç«¯ç‚¹ï¼ˆæ˜¾ç„¶æœ€ä¼˜ï¼‰ã€‚äºæ˜¯æƒ³åˆ°ä»¥ç›´å¾„ä¸¤ä¸ªç«¯ç‚¹ä¸ºæ ¹åˆ†åˆ«å»ºä¸€æ£µæ ‘ï¼Œåˆ†åˆ«æ±‚æ ¹ç»è¿‡$x$åˆ°ä¸€ä¸ªå¶å­ç»“ç‚¹çš„æœ€é•¿è·¯å¾„å$\max$ï¼Œå¯é€šè¿‡$y=1$ã€‚</p>
<p>å°†æ¯æ¡è·¯å¾„æ‹†åˆ†ä¸º$2$ä¸ªå¶å­ç»“ç‚¹çš„è·¯å¾„ã€‚å¦‚æœæ— éœ€ç»è¿‡èŠ‚ç‚¹$x$ï¼Œé‚£ä¹ˆé™¤å»åˆ°æ ¹çš„è·¯å¾„ä¹‹å¤–è¿˜éœ€è¦å–å‡º$2y-1$ä¸ªå¶å­ç»“ç‚¹è·¯å¾„ã€‚ç„¶åéœ€è¦ç”¨åˆ°ä¸€ä¸ª<strong>é•¿é“¾å‰–åˆ†</strong>å°$trick$ï¼ˆä¹Ÿæ˜¯è¿™é¢˜æœ€å¦™çš„åœ°æ–¹ï¼‰ï¼Œå¯¹äºæ¯æ¡é•¿é“¾ï¼Œå®šä¹‰å…¶å¸¦æƒé•¿åº¦ä¸º<strong>é“¾å¤´çš„çˆ¶èŠ‚ç‚¹åˆ°é“¾å°¾çš„è·ç¦»</strong>ï¼Œå³<code>sdep[u] - sdep[fa[top[u]]]</code>ï¼Œå¯ä»¥è¯æ˜<strong>æ›´é•¿çš„é“¾ä¸€å®šä¼šæ¯”æ›´çŸ­çš„é“¾å…ˆè¢«å–åˆ°ï¼Œä¸”è´¡çŒ®å³ä¸ºé“¾çš„å¸¦æƒé•¿åº¦</strong>ã€‚äºæ˜¯å–å‡ºæ ‘ä¸Šçš„æ‰€æœ‰é•¿é“¾å¹¶ä»å¤§åˆ°å°æ’åºï¼Œå–å¾—å‰$2y-1$ä¸ªå¸¦æƒé•¿åº¦ä¹‹å’Œå³ä¸ºä¸ç»è¿‡$x$çš„$y$ä¸ªæœ€é•¿è·¯å¾„é•¿åº¦ä¹‹å’Œã€‚</p>
<p><img src="sol-cf526g-tree1.png" alt=""></p>
<p>å¦‚å›¾æ‰€ç¤ºçš„ä¸€æ£µæ ‘ï¼Œé»‘è‰²è¾¹ä¸ºå…¶ç›´å¾„ï¼Œå°†å…¶<strong>æŒ‰è¾¹æƒ</strong>é•¿é“¾å‰–åˆ†åå¾—åˆ°å‡ æ¡é“¾ï¼Œæ˜¾ç„¶è¦å…ˆå–é»‘è‰²é“¾ï¼Œå†æŒ‰é¡ºåºå–è“è‰²ã€ç²‰è‰²å’Œæ©™è‰²é“¾ï¼Œè€Œæ¯åŠ å…¥ä¸€æ¡é“¾åå¯¹ç­”æ¡ˆçš„è´¡çŒ®å°±æ˜¯é“¾çš„å¸¦æƒé•¿åº¦ã€‚</p>
<p>ç°åœ¨è€ƒè™‘å¿…é¡»ç»è¿‡$x$çš„å–æ³•ã€‚åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œè‹¥å‰$2y-1$æ¡é“¾ç»è¿‡$x$ç›´æ¥å–å‰ç¼€å’Œè®¡ç®—ï¼ˆè‡³äºå¦‚ä½•åˆ¤æ–­å¯ä½¿ç”¨æ ‘ä¸Š$dp$ç»´æŠ¤å­æ ‘å†…å¶å­èŠ‚ç‚¹æ‰€åœ¨é“¾çš„æœ€é å‰æ’åï¼‰ã€‚å¦åˆ™æˆ‘ä»¬è¦æ‰¾åˆ°ç¬¬$1$åˆ°$2y-1$ä¸­çš„ä¸€æ¡é“¾ï¼ˆå‡å®šä¸º$k$ï¼‰ï¼Œå°†å…¶ç§»é™¤å¹¶åŠ å…¥ç»è¿‡$x$çš„æœ€é•¿é“¾ã€‚</p>
<p>æŸ¥æ‰¾å¹¶åˆ é™¤ä¸€æ¡é“¾æ—¶ï¼Œä»å¯ä»¥åˆ†ä¸¤ç§æƒ…å†µã€‚è‹¥ç¬¬$k$æ¡é“¾çš„$top_k$ä¸æ˜¯$x$çš„ç¥–å…ˆï¼Œåˆ™å…¶åˆ é™¤çš„ä»£ä»·ä¸º$len_k$ï¼Œæ˜¾ç„¶$k=2y-1$æ—¶æœ€ä¼˜ã€‚å¦ä¸€ç§$top_k$ä¸º$x$çš„ç¥–å…ˆï¼Œä»$u$å¾€ä¸Šå€å¢æ‰¾åˆ°ç¬¬ä¸€æ¡$k\le 2y-1$çš„é“¾ï¼Œå…¶å¶å­ç»“ç‚¹ä¸$x$çš„$lca$ä¸º$s$ï¼Œåˆ é™¤çš„ä»£ä»·ä¸º$sdep_k - dep_s$ï¼ŒäºŒè€…å–$\min$å³å¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O((n+q)\log n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF526G.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF526G</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">18</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">tree</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">edges</span> &#123;</span><br><span class="line">        <span class="type">int</span> u, v, w;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> n, rt, head[MAXN], nxt[MAXM], tot;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">(<span class="type">int</span> _n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = _n;</span><br><span class="line">        rt = tot = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="built_in">sizeof</span>(head));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">        edge[tot] = &#123;u, v, w&#125;;</span><br><span class="line">        nxt[tot] = head[u];</span><br><span class="line">        head[u] = tot++; </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="type">int</span> dis[MAXN], pre[MAXN];</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxdis</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">        dis[u] = d, pre[u] = u;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; ~i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v, w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (v != f &amp;&amp; dis[<span class="built_in">maxdis</span>(v, u, d + w)] &gt; dis[pre[u]])</span><br><span class="line">                pre[u] = pre[v];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pre[u];</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="type">int</span> dfc, sfa[MAXN], dfn[MAXN], len[MAXN], wson[MAXN];</span><br><span class="line">    <span class="type">int</span> dep[MAXN], sdep[MAXN], fa[MAXN][LOGN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build1</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">        len[u] = wson[u] = <span class="number">0</span>, fa[u][<span class="number">0</span>] = f;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">            fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; ~i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v, w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (v != f) &#123;</span><br><span class="line">                dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">                sdep[v] = sdep[u] + w;</span><br><span class="line">                <span class="built_in">build1</span>(v, u);</span><br><span class="line">                <span class="keyword">if</span> (len[v] + w &gt; len[u])</span><br><span class="line">                    len[u] = len[v] + w, wson[u] = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> sf)</span> </span>&#123;</span><br><span class="line">        sfa[u] = sf, dfn[u] = ++dfc;</span><br><span class="line">        <span class="keyword">if</span> (wson[u])</span><br><span class="line">            <span class="built_in">build2</span>(wson[u], sf);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; ~i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (v != fa[u][<span class="number">0</span>] &amp;&amp; v != wson[u])</span><br><span class="line">                <span class="built_in">build2</span>(v, v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="type">int</span> dp[MAXN], rnk[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">        dp[u] = rnk[u] ? rnk[u] : INFL;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[u]; ~i; i = nxt[i]) &#123;</span><br><span class="line">            <span class="type">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">if</span> (v != f) &#123;</span><br><span class="line">                <span class="built_in">dfs</span>(v, u);</span><br><span class="line">                dp[u] = <span class="built_in">min</span>(dp[u], dp[v]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getlca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">            <span class="keyword">if</span> (dp[fa[u][i]] &gt; k)</span><br><span class="line">                u = fa[u][i];</span><br><span class="line">        <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="type">int</span> lef, id[MAXN], sum[MAXN * <span class="number">2</span>];</span><br><span class="line">    pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; leaf[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> _rt)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;rt = _rt, lef = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">build1</span>(rt, <span class="number">0</span>), <span class="built_in">build2</span>(rt, rt);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!wson[i])</span><br><span class="line">                leaf[++lef] = &#123;sdep[i] - sdep[fa[sfa[i]][<span class="number">0</span>]], i&#125;;</span><br><span class="line">        <span class="built_in">sort</span>(leaf + <span class="number">1</span>, leaf + lef + <span class="number">1</span>, greater&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= lef; ++i)</span><br><span class="line">            rnk[leaf[i].second] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= lef; ++i)</span><br><span class="line">            id[i] = leaf[i].second;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            sum[i] = sum[i - <span class="number">1</span>] + leaf[i].first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            sum[i + n] = sum[i + n - <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">dfs</span>(rt, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> k = <span class="number">2</span> * y - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (dp[x] &lt;= k)</span><br><span class="line">            <span class="keyword">return</span> sum[k];</span><br><span class="line">        <span class="type">int</span> s = <span class="built_in">getlca</span>(x, k);</span><br><span class="line">        <span class="keyword">return</span> sum[k] + sdep[id[dp[x]]] - sdep[s] - <span class="built_in">min</span>(leaf[k].first, sdep[id[dp[s]]] - sdep[s]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; tr1, tr2;</span><br><span class="line"><span class="type">int</span> n, q;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(q);</span><br><span class="line">    tr1.<span class="built_in">clear</span>(n), tr2.<span class="built_in">clear</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v, w;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v), <span class="built_in">read</span>(w);</span><br><span class="line">        tr1.<span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">        tr1.<span class="built_in">addedge</span>(v, u, w);</span><br><span class="line">        tr2.<span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">        tr2.<span class="built_in">addedge</span>(v, u, w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> rt1 = tr1.<span class="built_in">maxdis</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> rt2 = tr1.<span class="built_in">maxdis</span>(rt1, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    tr1.<span class="built_in">init</span>(rt1), tr2.<span class="built_in">init</span>(rt2);</span><br><span class="line">    <span class="type">int</span> lastans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="type">int</span> x, y;</span><br><span class="line">        <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">        x = (x + lastans - <span class="number">1</span>) % n + <span class="number">1</span>;</span><br><span class="line">        y = (y + lastans - <span class="number">1</span>) % n + <span class="number">1</span>;</span><br><span class="line">        lastans = <span class="built_in">max</span>(tr1.<span class="built_in">solve</span>(x, y), tr2.<span class="built_in">solve</span>(x, y));</span><br><span class="line">        <span class="built_in">write</span>(lastans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF639F Bear and Chemistry é¢˜è§£</title>
    <url>/2021/12/03/sol-cf639f/</url>
    <content><![CDATA[<h2 id="CF639F-Bear-and-Chemistry-é¢˜è§£"><a href="#CF639F-Bear-and-Chemistry-é¢˜è§£" class="headerlink" title="CF639F Bear and Chemistry é¢˜è§£"></a>CF639F Bear and Chemistry é¢˜è§£</h2><span id="more"></span>
<p>åˆä¸€é“é»‘</p>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF639F">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æ€è·¯å¾ˆå¥½æƒ³ï¼Œé¢„å¤„ç†ä¸€éè¾¹åŒç¼©ç‚¹å¾—åˆ°ä¸€æ£µæ ‘ï¼Œè¯¢é—®å»ºå®Œè™šæ ‘å†ä¸€éè¾¹åŒç¼©ç‚¹è·‘å‡ºæ¥$V$é›†åˆä¸­çš„ç‚¹æ˜¯å¦å…¨åœ¨ä¸€ä¸ªè¾¹åŒä¸­ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ï¼Œå¸¸æ•°å·¨å¤§ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><p>è°ƒäº†ä¸¤å¤©åå‘ç°æ˜¯å› ä¸º<del>tarjané€€æ ˆçš„æ—¶å€™æŠŠ<code>ins</code>æ ‡è®°æ”¹æˆäº†<code>true</code></del></p>
<p><del>å†™é¢˜ä¸æ³¨æ„ï¼Œå¯¹æ‹ä¸¤å°æ—¶ï¼ˆå…³é”®è¿˜$^{TM}$æ²¡æ‹å‡ºé”™è¯¯ï¼Ÿï¼‰</del></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF639F.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF639F</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">bool</span> m_be;</span><br><span class="line"><span class="type">int</span> n, m, q, k, h, cnt, len, is[MAXN], iu[MAXN], iv[MAXN], s[MAXN], nd[MAXN];</span><br><span class="line"><span class="type">int</span> idn, top, rt[MAXN], id[MAXN], dep[MAXN], fa[MAXN][LOGN], sta[MAXN];</span><br><span class="line"><span class="type">int</span> dfc1, bcc1, top1, sta1[MAXN], sfa1[MAXN], dfn1[MAXN], low1[MAXN], col1[MAXN];</span><br><span class="line"><span class="type">int</span> dfc2, bcc2, top2, sta2[MAXN], sfa2[MAXN], dfn2[MAXN], low2[MAXN], col2[MAXN];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[MAXN], tr[MAXN], vtr[MAXN];</span><br><span class="line"><span class="type">bool</span> ins1[MAXN], ins2[MAXN];</span><br><span class="line"><span class="type">bool</span> m_ed;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan1</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    sfa1[u] = f;</span><br><span class="line">    dfn1[u] = low1[u] = ++dfc1;</span><br><span class="line">    sta1[++top1] = u, ins1[u] = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">int</span> cntf = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f) &#123;</span><br><span class="line">            ++cntf;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!dfn1[v]) &#123;</span><br><span class="line">            <span class="built_in">tarjan1</span>(v, u);</span><br><span class="line">            low1[u] = <span class="built_in">min</span>(low1[u], low1[v]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ins1[v]) &#123;</span><br><span class="line">            low1[u] = <span class="built_in">min</span>(low1[u], dfn1[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (f &amp;&amp; cntf &gt; <span class="number">1</span>)</span><br><span class="line">        low1[u] = <span class="built_in">min</span>(low1[u], dfn1[f]);</span><br><span class="line">    <span class="keyword">if</span> (dfn1[u] == low1[u]) &#123;</span><br><span class="line">        ++bcc1;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">int</span> v = sta1[top1--];</span><br><span class="line">            ins1[v] = <span class="literal">false</span>;</span><br><span class="line">            col1[v] = bcc1;</span><br><span class="line">            <span class="keyword">if</span> (u == v)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    sfa2[u] = f;</span><br><span class="line">    dfn2[u] = low2[u] = ++dfc2;</span><br><span class="line">    sta2[++top2] = u, ins2[u] = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">int</span> cntf = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : vtr[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == f) &#123;</span><br><span class="line">            ++cntf;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!dfn2[v]) &#123;</span><br><span class="line">            <span class="built_in">tarjan2</span>(v, u);</span><br><span class="line">            low2[u] = <span class="built_in">min</span>(low2[u], low2[v]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ins2[v]) &#123;</span><br><span class="line">            low2[u] = <span class="built_in">min</span>(low2[u], dfn2[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (f &amp;&amp; cntf &gt; <span class="number">1</span>)</span><br><span class="line">        low2[u] = <span class="built_in">min</span>(low2[u], dfn2[f]);</span><br><span class="line">    <span class="keyword">if</span> (dfn2[u] == low2[u]) &#123;</span><br><span class="line">        ++bcc2;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">int</span> v = sta2[top2--];</span><br><span class="line">            ins2[v] = <span class="literal">false</span>;</span><br><span class="line">            col2[v] = bcc2;</span><br><span class="line">            <span class="keyword">if</span> (u == v)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addvedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    vtr[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">    vtr[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build1</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    id[u] = ++idn, rt[u] = (f ? rt[f] : u);</span><br><span class="line">    dep[u] = dep[f] + <span class="number">1</span>, fa[u][<span class="number">0</span>] = f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : tr[u])</span><br><span class="line">        <span class="keyword">if</span> (v != f)</span><br><span class="line">            <span class="built_in">build1</span>(v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="type">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build2</span><span class="params">(<span class="type">int</span> rtx, <span class="type">int</span> cl)</span> </span>&#123;</span><br><span class="line">    sta[top = <span class="number">1</span>] = rtx, vtr[rtx].<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = cl; i &lt;= cnt &amp;&amp; rt[s[i]] == rtx; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] == rtx)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> l = <span class="built_in">lca</span>(s[i], sta[top]);</span><br><span class="line">        <span class="keyword">while</span> (id[l] &lt;= id[sta[top - <span class="number">1</span>]])</span><br><span class="line">            <span class="built_in">addvedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="keyword">if</span> (l != sta[top])</span><br><span class="line">            vtr[l].<span class="built_in">clear</span>(), <span class="built_in">addvedge</span>(l, sta[top]), sta[top] = nd[++len] = l;</span><br><span class="line">        vtr[s[i]].<span class="built_in">clear</span>(), sta[++top] = s[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">addvedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        <span class="keyword">if</span> (u == v)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">if</span> (!dfn1[i])</span><br><span class="line">            <span class="built_in">tarjan1</span>(i, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sfa1[i] &amp;&amp; col1[i] != col1[sfa1[i]]) &#123;</span><br><span class="line">            tr[col1[sfa1[i]]].<span class="built_in">push_back</span>(col1[i]);</span><br><span class="line">            tr[col1[i]].<span class="built_in">push_back</span>(col1[sfa1[i]]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= bcc1; ++i)</span><br><span class="line">        <span class="keyword">if</span> (!id[i])</span><br><span class="line">            <span class="built_in">build1</span>(i, <span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> rnd = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> tt = <span class="number">1</span>; tt &lt;= q; ++tt) &#123;</span><br><span class="line">        <span class="type">bool</span> answ = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">read</span>(k), <span class="built_in">read</span>(h), cnt = bcc2 = dfc2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            <span class="built_in">read</span>(is[i]), is[i] = (is[i] + rnd - <span class="number">1</span>) % n + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= h; ++i) &#123;</span><br><span class="line">            <span class="built_in">read</span>(iu[i]), iu[i] = (iu[i] + rnd - <span class="number">1</span>) % n + <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">read</span>(iv[i]), iv[i] = (iv[i] + rnd - <span class="number">1</span>) % n + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            s[++cnt] = col1[is[i]];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= h; ++i)</span><br><span class="line">            s[++cnt] = col1[iu[i]], s[++cnt] = col1[iv[i]];</span><br><span class="line">        <span class="built_in">sort</span>(s + <span class="number">1</span>, s + cnt + <span class="number">1</span>, [](<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">            <span class="keyword">return</span> id[x] &lt; id[y];</span><br><span class="line">        &#125;);</span><br><span class="line">        len = cnt = <span class="built_in">unique</span>(s + <span class="number">1</span>, s + cnt + <span class="number">1</span>) - s - <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">copy</span>(s + <span class="number">1</span>, s + cnt + <span class="number">1</span>, nd + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i)</span><br><span class="line">            <span class="keyword">if</span> (rt[s[i]] != rt[s[i - <span class="number">1</span>]])</span><br><span class="line">                <span class="built_in">build2</span>(rt[s[i]], i);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= h; ++i)</span><br><span class="line">            <span class="keyword">if</span> (col1[iu[i]] != col1[iv[i]])</span><br><span class="line">                <span class="built_in">addvedge</span>(col1[iu[i]], col1[iv[i]]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">            dfn2[nd[i]] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!dfn2[nd[i]])</span><br><span class="line">                <span class="built_in">tarjan2</span>(nd[i], <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            <span class="keyword">if</span> (col2[col1[is[i]]] != col2[col1[is[<span class="number">1</span>]]])</span><br><span class="line">                answ = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">puts</span>(answ ? <span class="string">&quot;YES&quot;</span> : <span class="string">&quot;NO&quot;</span>), (rnd += answ ? tt : <span class="number">0</span>) %= n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF1320E Treeland and Viruses é¢˜è§£</title>
    <url>/2021/12/01/sol-cf1320e/</url>
    <content><![CDATA[<h2 id="CF1320E-Treeland-and-Viruses-é¢˜è§£"><a href="#CF1320E-Treeland-and-Viruses-é¢˜è§£" class="headerlink" title="CF1320E Treeland and Viruses é¢˜è§£"></a>CF1320E Treeland and Viruses é¢˜è§£</h2><span id="more"></span>
<p><del>æ°´é»‘</del></p>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF1320E">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å»ºè™šæ ‘ï¼Œè·‘$dijkstra$ã€‚</p>
<p><del>æ‰€ä»¥è¿™é¢˜ä¸ºä»€ä¹ˆèƒ½è¯„é»‘</del></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><p><strong><code>nd</code>æ•°ç»„åˆ«å¼€å°äº†ï¼Œè¦å¼€$4 \times 10^5$</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF1320E.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF1320E</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFI = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">graph</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">edges</span> &#123;</span><br><span class="line">        <span class="type">int</span> u, v, w;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], tot;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        tot = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="built_in">sizeof</span>(head));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">        edge[tot] = &#123;u, v, w&#125;;</span><br><span class="line">        nxt[tot] = head[u];</span><br><span class="line">        head[u] = tot++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">distant</span> &#123;</span><br><span class="line">    <span class="type">int</span> id, fr, ve, dis; <span class="comment">// from, velocity, distance</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ##sb-mistakes## `(0 - 1) / x + 1 == 1`ï¼Œè¦ç‰¹åˆ¤æˆ–è€…å†™æˆ`(? + x - 1) / x`</span></span><br><span class="line">        <span class="keyword">return</span> (dis + ve - <span class="number">1</span>) / ve;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> distant &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="type">int</span> cx = <span class="built_in">calc</span>(), cy = o.<span class="built_in">calc</span>();</span><br><span class="line">        <span class="keyword">return</span> cx == cy ? id &lt; o.id : cx &lt; cy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&gt;(<span class="type">const</span> distant &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="type">int</span> cx = <span class="built_in">calc</span>(), cy = o.<span class="built_in">calc</span>();</span><br><span class="line">        <span class="keyword">return</span> cx == cy ? id &lt; o.id : cx &lt; cy;</span><br><span class="line">    &#125;</span><br><span class="line">    distant <span class="keyword">operator</span>+(<span class="type">int</span> x) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> distant&#123;id, fr, ve, dis + x&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, q, k, m, cnt, idn, id[MAXN], nd[MAXM];</span><br><span class="line"><span class="type">int</span> top, sta[MAXN], dep[MAXN], fa[MAXN][LOGN];</span><br><span class="line"><span class="type">int</span> iv[MAXN], iu[MAXN], is[MAXN];</span><br><span class="line"><span class="comment">// ##sb-mistakes## `std::priority_queue`é»˜è®¤æ˜¯`std::less&lt;_Tp&gt;`ï¼Œè‡ªå®šä¹‰ç±»å‹è¦ä¹ˆæŒ‰ç…§`\gt`çš„é€»è¾‘é‡è½½`operator&lt;()`ï¼Œè¦ä¹ˆæŒ‰ç…§`\gt`çš„é€»è¾‘é‡è½½`operator&gt;()`å¹¶ä¸”ä¿®æ”¹é»˜è®¤å‚æ•°</span></span><br><span class="line">priority_queue&lt;pair&lt;distant, <span class="type">int</span>&gt;, vector&lt;pair&lt;distant, <span class="type">int</span>&gt;&gt;, greater&lt;pair&lt;distant, <span class="type">int</span>&gt;&gt;&gt; que;</span><br><span class="line">distant dis[MAXN];</span><br><span class="line">graph tr, vtr;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    id[u] = ++idn, fa[u][<span class="number">0</span>] = f, dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = tr.head[u]; ~i; i = tr.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (tr.edge[i].v != f)</span><br><span class="line">            <span class="built_in">build</span>(tr.edge[i].v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="type">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_vedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> w = dep[v] - dep[u];</span><br><span class="line">    vtr.<span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">    vtr.<span class="built_in">addedge</span>(v, u, w);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_vtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(nd + <span class="number">1</span>, nd + cnt + <span class="number">1</span>, [](<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">        <span class="keyword">return</span> id[x] &lt; id[y];</span><br><span class="line">    &#125;);</span><br><span class="line">    cnt = <span class="built_in">unique</span>(nd + <span class="number">1</span>, nd + cnt + <span class="number">1</span>) - nd - <span class="number">1</span>;</span><br><span class="line">    sta[top = <span class="number">1</span>] = <span class="number">1</span>, vtr.head[<span class="number">1</span>] = <span class="number">-1</span>, vtr.tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nd[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> l = <span class="built_in">lca</span>(sta[top], nd[i]);</span><br><span class="line">        <span class="keyword">while</span> (id[l] &lt;= id[sta[top - <span class="number">1</span>]])</span><br><span class="line">            <span class="built_in">add_vedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="keyword">if</span> (sta[top] != l)</span><br><span class="line">            vtr.head[l] = <span class="number">-1</span>, <span class="built_in">add_vedge</span>(l, sta[top]), sta[top] = l;</span><br><span class="line">        vtr.head[nd[i]] = <span class="number">-1</span>, sta[++top] = nd[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">add_vedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clear_dis</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    dis[u] = &#123;INFI, INFI, <span class="number">1</span>, INFI&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = vtr.head[u]; ~i; i = vtr.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (vtr.edge[i].v != f)</span><br><span class="line">            <span class="built_in">clear_dis</span>(vtr.edge[i].v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    tr.<span class="built_in">clear</span>(), vtr.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(u, v);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="built_in">read</span>(k), <span class="built_in">read</span>(m), cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            <span class="built_in">read</span>(iv[i]), <span class="built_in">read</span>(is[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">read</span>(iu[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            nd[++cnt] = iv[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            nd[++cnt] = iu[i];</span><br><span class="line">        <span class="built_in">build_vtr</span>(), <span class="built_in">clear_dis</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>())</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">            dis[iv[i]] = &#123;i, iv[i], is[i], <span class="number">0</span>&#125;;</span><br><span class="line">            que.<span class="built_in">push</span>(&#123;dis[iv[i]], iv[i]&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            distant d = que.<span class="built_in">top</span>().first;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">top</span>().second;</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span> (dis[u] &lt; d)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = vtr.head[u]; ~i; i = vtr.nxt[i]) &#123;</span><br><span class="line">                <span class="type">int</span> v = vtr.edge[i].v, w = vtr.edge[i].w;</span><br><span class="line">                <span class="keyword">if</span> (d + w &lt; dis[v]) &#123;</span><br><span class="line">                    dis[v] = d + w;</span><br><span class="line">                    que.<span class="built_in">push</span>(&#123;dis[v], v&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">write</span>(dis[iu[i]].id), <span class="built_in">putchar</span>(<span class="string">&quot; \n&quot;</span>[i == m]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4606 æˆ˜ç•¥æ¸¸æˆ é¢˜è§£</title>
    <url>/2021/11/29/sol-p4606/</url>
    <content><![CDATA[<h2 id="P4606-æˆ˜ç•¥æ¸¸æˆ-é¢˜è§£"><a href="#P4606-æˆ˜ç•¥æ¸¸æˆ-é¢˜è§£" class="headerlink" title="P4606 æˆ˜ç•¥æ¸¸æˆ é¢˜è§£"></a>P4606 æˆ˜ç•¥æ¸¸æˆ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4606">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><blockquote>
<p>åœ†æ–¹æ ‘ä¸Šåœ†æ–¹æœ</p>
<p>åœ†æ–¹æ ‘ä¸‹ä½ å’Œæˆ‘</p>
<p>åœ†æ–¹æ ‘å‰å»ºè™šæ ‘</p>
<p>æ¬¢ä¹å¤šåˆå¤š <del>/kk</del></p>
</blockquote>
<p>çœ‹åˆ°$\sum|S|$äºæ˜¯å¼€å§‹å¥—è·¯åœ°æƒ³åˆ°è™šæ ‘ã€‚</p>
<p>ä½†æ˜¯ç»™å®šçš„æ˜¯ä¸€ä¸ªæ— å‘å›¾ä¸æ˜¯ä¸€æ£µæ ‘å•Šâ€¦â€¦</p>
<p>æ‰€ä»¥è¦æƒ³åŠæ³•æŠŠå›¾è½¬åŒ–æˆä¸€æ£µæ ‘ï¼Œè¿™æ ·çš„æ•°æ®ç»“æ„å«åš<a href="https://oi-wiki.org/graph/block-forest/">åœ†æ–¹æ ‘</a>ã€‚</p>
<p><del><strong>è¿™é‡Œå‡è®¾ä½ å·²ç»å­¦ä¼šåœ†æ–¹æ ‘äº†</strong></del></p>
<p>è€ƒè™‘åœ†æ–¹æ ‘çš„æ€§è´¨ã€‚æ˜¾ç„¶å¯¹äºä¸€å¯¹èŠ‚ç‚¹$(u, v)$ï¼Œå®ƒä»¬åœ¨åœ†æ–¹æ ‘ä¸Šçš„è·¯å¾„ä¸­çš„åœ†ç‚¹ï¼ˆä¸åŒ…æ‹¬è‡ªèº«ï¼‰å°±æ˜¯åˆ æ‰åèƒ½ä½¿å¾—$u$å’Œ$v$ä¸è¿é€šçš„ç‚¹ã€‚å› ä¸ºæ ¹æ®åœ†æ–¹æ ‘çš„æ€§è´¨ï¼Œæ‰€æœ‰å’ŒåŒä¸€ä¸ªæ–¹ç‚¹è¿è¾¹çš„åœ†ç‚¹éƒ½åœ¨åŒä¸€ä¸ªåŒè”é€šåˆ†é‡é‡Œï¼Œå»æ‰ä¸€ä¸ªæ–¹ç‚¹ä¸ä¼šæ”¹å˜å›¾çš„è¿é€šæ€§ã€‚è€Œé‚£äº›å’Œå¤šä¸ªæ–¹ç‚¹è¿è¾¹çš„åœ†ç‚¹éƒ½å¯ä»¥æˆä¸ºè¿™äº›æ–¹ç‚¹çš„å‰²ç‚¹ï¼Œå»æ‰åå›¾çš„è¿é€šæ€§å°±æ”¹å˜äº†ã€‚</p>
<p>äºæ˜¯ç­”æ¡ˆå°±æ˜¯æ‰€æœ‰ç‰¹æ®ŠèŠ‚ç‚¹ä¹‹é—´çš„è·¯å¾„å¹¶ä¸Šåœ†ç‚¹æ•°é‡å‡å»$|S|$ã€‚</p>
<p>æ€è·¯è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä¸»è¦æ˜¯ä»£ç ä¸­çš„<del>äº¿ç‚¹ç‚¹</del>ç»†èŠ‚ã€‚æ¯”å¦‚è¯´<code>MAXN</code>è¦å¼€ä¸¤å€å¤§å°ï¼ˆå› ä¸ºæœ‰åœ†æ–¹æ ‘ï¼‰ã€ç»Ÿè®¡ç­”æ¡ˆä¸è¦æŠŠè™šæ ‘çš„æ‰€æœ‰è¾¹æƒéƒ½åŠ ä¸Šï¼ˆå› ä¸ºè™šæ ‘è¦å»ºç«‹èŠ‚ç‚¹$1$è€Œæœ‰æ—¶èŠ‚ç‚¹$1$å¹¶ä¸å‡ºç°åœ¨è·¯å¾„å¹¶ä¸­ï¼‰<del>ä»¥åŠå¤šæµ‹è¦æ¸…ç©º<code>dfn</code>æ•°ç»„</del>ç­‰ç­‰ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ï¼ˆæ„Ÿè§‰å¸¸æ•°å·¨å¤§æ— æ¯”ï¼‰ã€‚è°ƒäº†ä¸¤å¤©ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4606.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4606</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">8e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> LOGN = <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v, w;</span><br><span class="line">    &#125; edge[MAXM];</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], tot;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">        edge[tot] = &#123;v, w&#125;;</span><br><span class="line">        nxt[tot] = head[u];</span><br><span class="line">        head[u] = tot++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, q, k, dfc, top, bcc, idn;</span><br><span class="line"><span class="type">int</span> s[MAXN], dfn[MAXN], low[MAXN], sta[MAXN];</span><br><span class="line"><span class="type">int</span> id[MAXN], dep[MAXN], fa[MAXN][LOGN];</span><br><span class="line"><span class="type">bool</span> tag[MAXN];</span><br><span class="line">Graph g, tr, vtr;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    g.tot = tr.tot = vtr.tot = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// ##sb-mistakes## å¤šæµ‹ä¸æ¸…ç©ºï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª/kk å¤šæµ‹`dfn`æ•°ç»„è®°å¾—æ¸…ç©ºå•Š</span></span><br><span class="line">    <span class="built_in">memset</span>(dfn, <span class="number">0</span>, <span class="built_in">sizeof</span>(dfn));</span><br><span class="line">    <span class="built_in">memset</span>(g.head, <span class="number">-1</span>, <span class="built_in">sizeof</span>(g.head));</span><br><span class="line">    <span class="built_in">memset</span>(tr.head, <span class="number">-1</span>, <span class="built_in">sizeof</span>(tr.head));</span><br><span class="line">    <span class="built_in">memset</span>(vtr.head, <span class="number">-1</span>, <span class="built_in">sizeof</span>(vtr.head));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dfn[u] = low[u] = ++dfc;</span><br><span class="line">    sta[++top] = u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = g.head[u]; ~i; i = g.nxt[i]) &#123;</span><br><span class="line">        <span class="type">int</span> v = g.edge[i].v;</span><br><span class="line">        <span class="keyword">if</span> (!dfn[v]) &#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(v);</span><br><span class="line">            low[u] = <span class="built_in">min</span>(low[u], low[v]);</span><br><span class="line">            <span class="keyword">if</span> (dfn[u] == low[v]) &#123;</span><br><span class="line">                ++bcc;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x != v; --top) &#123;</span><br><span class="line">                    x = sta[top];</span><br><span class="line">                    tr.<span class="built_in">addedge</span>(bcc, x);</span><br><span class="line">                    tr.<span class="built_in">addedge</span>(x, bcc);</span><br><span class="line">                &#125;</span><br><span class="line">                tr.<span class="built_in">addedge</span>(bcc, u);</span><br><span class="line">                tr.<span class="built_in">addedge</span>(u, bcc);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            low[u] = <span class="built_in">min</span>(low[u], dfn[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    id[u] = ++idn;</span><br><span class="line">    fa[u][<span class="number">0</span>] = f;</span><br><span class="line">    dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; LOGN; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = tr.head[u]; ~i; i = tr.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (tr.edge[i].v != f)</span><br><span class="line">            <span class="built_in">build</span>(tr.edge[i].v, u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="type">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = LOGN - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_vedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> w = ((dep[v] - dep[u]) &amp; <span class="number">1</span>) ? ((dep[v] - dep[u]) / <span class="number">2</span>) : ((dep[v] - dep[u]) / <span class="number">2</span> - (v &lt;= n));</span><br><span class="line">    vtr.<span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_vtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(s + <span class="number">1</span>, s + k + <span class="number">1</span>, [](<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">        <span class="keyword">return</span> id[x] &lt; id[y];</span><br><span class="line">    &#125;);</span><br><span class="line">    sta[top = <span class="number">1</span>] = <span class="number">1</span>, vtr.head[<span class="number">1</span>] = <span class="number">-1</span>, vtr.tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> l = <span class="built_in">lca</span>(sta[top], s[i]);</span><br><span class="line">        <span class="keyword">if</span> (l &lt; <span class="number">1</span> || l &gt; bcc)</span><br><span class="line">            <span class="built_in">lca</span>(sta[top], s[i]);</span><br><span class="line">        <span class="keyword">while</span> (id[l] &lt;= id[sta[top - <span class="number">1</span>]])</span><br><span class="line">            <span class="built_in">add_vedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="keyword">if</span> (sta[top] != l)</span><br><span class="line">            vtr.head[l] = <span class="number">-1</span>, <span class="built_in">add_vedge</span>(l, sta[top]), sta[top] = l;</span><br><span class="line">        vtr.head[s[i]] = <span class="number">-1</span>, sta[++top] = s[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">add_vedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> u, <span class="type">bool</span> tg)</span> </span>&#123;</span><br><span class="line">    tg |= tag[u];</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>, sum = (u &lt;= n), chd = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = vtr.head[u]; ~i; i = vtr.nxt[i]) &#123;</span><br><span class="line">        <span class="type">int</span> v = vtr.edge[i].v, w = vtr.edge[i].w;</span><br><span class="line">        sum += w, ret += <span class="built_in">calc</span>(v, tg), chd++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret + ((tg || chd &gt; <span class="number">1</span>) ? sum : <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">    bcc = n, dfc = idn = <span class="number">0</span>, <span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        g.<span class="built_in">addedge</span>(u, v);</span><br><span class="line">        g.<span class="built_in">addedge</span>(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    top = <span class="number">0</span>, <span class="built_in">tarjan</span>(<span class="number">1</span>), <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="built_in">read</span>(k);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            <span class="built_in">read</span>(s[i]), tag[s[i]] = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">build_vtr</span>();</span><br><span class="line">        <span class="built_in">write</span>(<span class="built_in">calc</span>(<span class="number">1</span>, <span class="literal">false</span>) - k), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            tag[s[i]] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    <span class="built_in">read</span>(t);</span><br><span class="line">    <span class="keyword">while</span> (t--)</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3803 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰</title>
    <url>/2021/11/28/sol-p3803/</url>
    <content><![CDATA[<h2 id="P3803-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰"><a href="#P3803-ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰" class="headerlink" title="P3803 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰"></a>P3803 ã€æ¨¡ç‰ˆã€‘å¤šé¡¹å¼ä¹˜æ³•ï¼ˆFFTï¼‰</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3803">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>FFT æ¨¡ç‰ˆé¢˜</p>
<p>ä¸ºäº†é˜²æ­¢è‡ªå·±å¿˜è®°å°±å†™ä¸€ä¸‹è¯æ˜å§ã€‚é¡ºä¾¿æŠŠ NTT ä¹Ÿå†™ä¸€ä¸‹ã€‚</p>
<h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><h4 id="å¤šé¡¹å¼è¡¨ç¤ºæ–¹æ³•"><a href="#å¤šé¡¹å¼è¡¨ç¤ºæ–¹æ³•" class="headerlink" title="å¤šé¡¹å¼è¡¨ç¤ºæ–¹æ³•"></a>å¤šé¡¹å¼è¡¨ç¤ºæ–¹æ³•</h4><h5 id="ç³»æ•°è¡¨ç¤ºæ³•"><a href="#ç³»æ•°è¡¨ç¤ºæ³•" class="headerlink" title="ç³»æ•°è¡¨ç¤ºæ³•"></a>ç³»æ•°è¡¨ç¤ºæ³•</h5><p>å³</p>
<script type="math/tex; mode=display">f(x) = \sum_{i=0}^{n-1}{a_ix^i}</script><h5 id="ç‚¹å€¼è¡¨ç¤ºæ³•"><a href="#ç‚¹å€¼è¡¨ç¤ºæ³•" class="headerlink" title="ç‚¹å€¼è¡¨ç¤ºæ³•"></a>ç‚¹å€¼è¡¨ç¤ºæ³•</h5><p>ä¸å¦¨å°†å¤šé¡¹å¼çœ‹æˆä¸€ä¸ª$n-1$æ¬¡å‡½æ•°ï¼Œä»ä¸Šé¢å–$n$ä¸ªç‚¹æ¥å”¯ä¸€åœ°è¡¨ç¤ºè¿™ä¸ªå‡½æ•°ã€‚</p>
<p>è®¾æƒ³ä¸€ä¸‹é«˜æ–¯æ¶ˆå…ƒæ³•ï¼Œå°±èƒ½çŸ¥é“ä¸ºä»€ä¹ˆ$n$ä¸ªä¸åŒçš„ç‚¹å°±èƒ½å”¯ä¸€ç¡®å®šè¿™ä¸ªå‡½æ•°äº†ã€‚</p>
<script type="math/tex; mode=display">f(x) = \{(x_0,y_0),(x_1,y_1),\cdots,(x_{n-1},y_{n-1})\}</script><p>è¿™æ ·çš„è¡¨ç¤ºæ³•æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯å¦‚æœè¦è®¡ç®—å¤šé¡¹å¼ä¹˜æ³•ï¼Œè®¾</p>
<script type="math/tex; mode=display">g(x) = \{(x_0,g(x_0)),(x_1,g(x_1)),\cdots,(x_{n-1},g(x_{n-1}))\}</script><script type="math/tex; mode=display">h(x) = \{(x_0,h(x_0)),(x_1,h(x_1)),\cdots,(x_{n-1},h(x_{n-1}))\}</script><p>é‚£ä¹ˆ</p>
<script type="math/tex; mode=display">
\begin{aligned}
f(x) &= g(x) \times h(x) \\
&= \{(x_0,g(x_0)h(x_0)),(x_1,g(x_1)h(x_1)),\cdots,(x_{n-1},g(x_{n-1})h(x_{n-1}))\}
\end{aligned}</script><p>å°±å¯ä»¥$O(n)$åœ°æ±‚å‡ºå¤šé¡¹å¼ä¹˜æ³•ã€‚</p>
<p>æ‰€ä»¥FFTè¦åšçš„äº‹å°±æ˜¯å°†ç³»æ•°è¡¨ç¤ºæ³•å’Œç‚¹å€¼è¡¨ç¤ºæ³•è¿›è¡Œè½¬æ¢ã€‚</p>
<h4 id="å¤æ•°ï¼ˆè¿™ä¸ªå¤§å®¶éƒ½ä¼šï¼‰"><a href="#å¤æ•°ï¼ˆè¿™ä¸ªå¤§å®¶éƒ½ä¼šï¼‰" class="headerlink" title="å¤æ•°ï¼ˆè¿™ä¸ªå¤§å®¶éƒ½ä¼šï¼‰"></a>å¤æ•°ï¼ˆè¿™ä¸ªå¤§å®¶éƒ½ä¼šï¼‰</h4><p>ä»¤$i^2 = -1$ï¼Œå¤æ•°å¯è¢«è¡¨ç¤ºä¸º$a + bi$çš„å½¢å¼</p>
<p>è€ƒè™‘åœ¨å¤å¹³é¢ä¸Šçš„ä¸¤ä¸ªå‘é‡$(a,b)$å’Œ$(c,d)$ï¼Œå°†å…¶è¡¨ç¤ºçš„å¤æ•°ç›¸ä¹˜å¾—åˆ°$(a + bi) \times (c + di) = ac - bd + (ad + bc)i$ï¼Œå³å‘é‡$(ac - bd, ad + bc)$ã€‚</p>
<p>æˆ‘ä»¬è®¡ç®—å‡ ä¸ªå‘é‡çš„æ¨¡ï¼Œåˆ†åˆ«ä¸º$\sqrt{a^2 + b^2}$ï¼Œ$\sqrt{c^2 + d^2}$å’Œ$\sqrt{a^2c^2 + b^2d^2 + a^2d^2 + b^2c^2} = \sqrt{(a^2 + b^2) \times (c^2 + d^2)}$ï¼Œå³ä¸¤ä¸ªå‘é‡æ¨¡é•¿çš„ä¹˜ç§¯ã€‚</p>
<p>æ‰€ä»¥å¦‚æœä¸¤ä¸ªåŸå‘é‡æ¨¡é•¿éƒ½ä¸º$1$ï¼Œä¹˜ç§¯çš„å‘é‡ä¹Ÿä¸º$1$ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå¤å¹³é¢ä¸Šå•ä½åœ†ä¸Šçš„å‘é‡ï¼Œè®¾å…¶è¾è§’åˆ†åˆ«ä¸º$\alpha$å’Œ$\beta$ï¼Œåˆ™è¿™ä¸¤ä¸ªå‘é‡è¡¨ç¤ºä¸º$(\cos\alpha,\sin\alpha)$å’Œ$(\cos\beta,\sin\beta)$ï¼Œå…¶ä¹˜ç§¯ä¸º$(\cos\alpha\cos\beta-\sin\alpha\sin\beta,\cos\alpha\sin\beta+\sin\alpha\cos\beta)$ã€‚æ ¹æ®äºŒè§’å’Œå·®å…¬å¼</p>
<script type="math/tex; mode=display">\cos(\alpha + \beta) = \cos\alpha\cos\beta-\sin\alpha\sin\beta</script><script type="math/tex; mode=display">\sin(\alpha + \beta) = \sin\alpha\cos\beta+\cos\alpha\sin\beta</script><p>å¯ä»¥å‘ç°è¿™ä¸ªæ–°çš„å‘é‡çš„è¾è§’å°±ç­‰äºä¸¤ä¸ªåŸå‘é‡çš„è¾è§’ç›¸åŠ ã€‚äºæ˜¯å°†å¾—åˆ°ç»“è®ºï¼šä¸¤ä¸ªæ¨¡é•¿ä¸º$1$çš„å‘é‡ç›¸ä¹˜ï¼Œå¾—åˆ°çš„ä»æ˜¯æ¨¡é•¿ä¸º$1$çš„å‘é‡ï¼Œè¾è§’ä¸ºä¸¤ä¸ªå‘é‡è¾è§’çš„å’Œã€‚</p>
<h4 id="å•ä½å¤æ ¹"><a href="#å•ä½å¤æ ¹" class="headerlink" title="å•ä½å¤æ ¹"></a>å•ä½å¤æ ¹</h4><p>ç”±äºæˆ‘ä»¬è¦å»è®¡ç®—è‹¥å¹²ä¸ª$x_i$å¯¹åº”çš„$f(x_i)$ï¼Œæœ€å¥½çš„åŠæ³•ä¾¿æ˜¯æ‰¾ä¸€äº›ç‰¹æ®Šçš„æ•°å€¼å¸¦è¿›å»è®¡ç®—ã€‚è¿™é‡Œå¼•å…¥å•ä½å¤æ ¹çš„æ¦‚å¿µã€‚</p>
<p>æˆ‘ä»¬ç§°$x^n = 1$åœ¨å¤æ•°æ„ä¹‰ä¸‹çš„è§£æ˜¯$n$æ¬¡å¤æ ¹ã€‚æ˜¾ç„¶è¿™æ ·çš„è§£æœ‰$n$ä¸ªã€‚è®¾$\omega_n = e^{\frac{2\pi i}{n}}$ï¼Œåˆ™$x^n = 1$çš„è§£é›†è¡¨ç¤ºä¸º${\omega^k_n \mid k=0,1,\cdots,n-1}$ï¼Œç§°$w_n$ä¸º$n$æ¬¡å•ä½å¤æ ¹ã€‚æ ¹æ®å¤å¹³é¢çš„çŸ¥è¯†ï¼Œ$n$æ¬¡å•ä½å¤æ ¹æ˜¯å¤å¹³é¢æŠŠå•ä½åœ†$n$ç­‰åˆ†çš„ç¬¬ä¸€ä¸ªè§’æ‰€å¯¹åº”çš„å‘é‡ï¼Œå…¶ä»–å¤æ ¹å‡å¯ä»¥ç”¨å•ä½å¤æ ¹çš„å¹‚è¡¨ç¤ºã€‚</p>
<p>æ‰€ä»¥æ˜¾ç„¶è¿˜èƒ½å¾—åˆ°$\omega_n = e^{\frac{2\pi i}{n}} = \cos(\frac{2\pi}{n}) + i \sin(\frac{2\pi}{n})$ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œ$n=4$æ—¶ï¼Œ$w_n = i$ï¼Œå¦‚å›¾æ‰€ç¤ºï¼ˆå›¾æ¥è‡ª<a href="https://oi-wiki.org/math/poly/fft/">oi-wiki</a>ï¼‰</p>
<p><img src="fft-1.png" alt="fft-1"></p>
<p>å¹¶ä¸”å•ä½å¤æ ¹è¿˜æœ‰ä¸‰ä¸ªé‡è¦çš„æ€§è´¨å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
w^n_n &= 1 \\
w^k_n &= w^{2k}_{2n} \\
w^{k+n}_{2n} &= -w^k_{2n}
\end{aligned}</script><h4 id="ç»ˆäºå¼€å§‹è®²FFTäº†"><a href="#ç»ˆäºå¼€å§‹è®²FFTäº†" class="headerlink" title="ç»ˆäºå¼€å§‹è®²FFTäº†"></a>ç»ˆäºå¼€å§‹è®²FFTäº†</h4><p>FFTå…¶æœ¬è´¨ä¸ºåˆ†æ²»ç®—æ³•ã€‚æ¯”æ–¹è¯´å¯¹äº</p>
<script type="math/tex; mode=display">f(x) = a_0 + a_1x + a_2x^2 + a_3x^3 + a_4x^4 + a_5x^5 + a_6x^6 + a_7x^7</script><p>æŒ‰ç…§æ¬¡æ•°çš„å¥‡å¶æ¥åˆ†ç»„å¾—åˆ°</p>
<script type="math/tex; mode=display">f(x) = (a_0 + a_2x^2 + a_4x^4 + a_6x^6) + (a_1x^1 + a_3x^3 + a_5x^5 + a_7x^7)</script><p>å³è¾¹æå–$x$å¾—åˆ°</p>
<script type="math/tex; mode=display">f(x) = (a_0 + a_2x^2 + a_4x^4 + a_6x^6) + x(a_1 + a_3x^2 + a_5x^4 + a_7x^6)</script><p>æŒ‰ç…§å¥‡å¶æ¬¡é¡¹å»ºç«‹æ–°çš„å‡½æ•°</p>
<script type="math/tex; mode=display">g(x) = a_0 + a_2x^1 + a_4x^2 + a_6x^3</script><script type="math/tex; mode=display">h(x) = a_1 + a_3x^1 + a_5x^2 + a_7x^3</script><p>åŸæ¥çš„$f(x)$å¯ä»¥è¢«è¡¨ç¤ºæˆ</p>
<script type="math/tex; mode=display">f(x) = g(x^2) + x \times h(x^2)</script><p>åˆ©ç”¨å•ä½å¤æ ¹çš„æ€§è´¨å¾—åˆ°</p>
<script type="math/tex; mode=display">\begin{aligned}
FFT(f(\omega^k_n)) &= FFT(g((\omega^k_n)^2)) + \omega^k_n \times FFT(h((\omega^k_n)^2)) \\
&= FFT(g(\omega^{2k}_n)) + \omega^k_n \times FFT(h(\omega^{2k}_n)) \\
&= FFT(g(\omega^k_{n/2})) + \omega^k_n \times FFT(h(\omega^k_{n/2}))
\end{aligned}</script><p>åŒç†å¯å¾—</p>
<script type="math/tex; mode=display">\begin{aligned}
FFT(f(\omega^{k+n/2}_n)) &= FFT(g(\omega^{2k+n}_n)) + \omega^{k+n/2}_n \times FFT(h(\omega^{2k+n}_n)) \\
&= FFT(g(\omega^{2k}_n)) - \omega^k_n \times FFT(h(\omega^{2k}_n)) \\
&= FFT(g(\omega^k_{n/2})) - \omega^k_n \times FFT(h(\omega^k_{n/2}))
\end{aligned}</script><p>è€Œç”±äº$n/2$éœ€è¦ä¸€ç›´ä¸ºæ•´æ•°ï¼Œæ‰€ä»¥$n$éœ€è¦æ˜¯$2^m$ï¼Œä¸å¦¨åœ¨ä¸€å¼€å§‹å°†å¤šé¡¹å¼çš„æ¬¡æ•°è¡¥åˆ°é•¿åº¦ä¸ºé•¿åº¦ä¸º$2^m$ï¼Œæ¬¡æ•°ä¸º$2^m-1$çš„å¤šé¡¹å¼å³å¯ã€‚</p>
<p>ä»£ç å®ç°æ–¹é¢ï¼ŒSTLæä¾›äº†å¤æ•°çš„æ¨¡ç‰ˆï¼ˆæˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡çŸ¥é“æœ‰è¿™ç§å¥½äº‹ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨<code>std::complex&lt;double&gt;</code>ã€‚</p>
<h4 id="NTT"><a href="#NTT" class="headerlink" title="NTT"></a>NTT</h4><p>æ¨¡ç‰ˆå’ŒFFTåŸºæœ¬ç›¸åŒï¼Œç”¨<a href="https://oi-wiki.org/math/number-theory/primitive-root/">åŸæ ¹</a>ä»£æ›¿å•ä½å¤æ ¹ï¼ˆæ€§è´¨åŸºæœ¬ç›¸åŒï¼‰ã€‚</p>
<script type="math/tex; mode=display">p = 998244353 = 7 \times 17 \times 2^{23} + 1, g = 3</script><script type="math/tex; mode=display">p = 1004535809 = 479 \times 2^{21} + 1, g = 3</script><script type="math/tex; mode=display">p = 469762049 = 7 \times 2^{26} + 1, g = 3</script><p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3803.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3803</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> comp = complex&lt;<span class="type">double</span>&gt;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1</span> &lt;&lt; <span class="number">21</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">namespace</span> fft &#123;</span><br><span class="line">    <span class="type">int</span> rev[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(comp *f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fft</span><span class="params">(comp *f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="function">comp <span class="title">wn</span><span class="params">(cos(<span class="number">2</span> * M_PI / h), sin(<span class="number">2</span> * M_PI / h))</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="function">comp <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    comp u = f[k], t = w * f[k + h / <span class="number">2</span>];</span><br><span class="line">                    f[k] = u + t;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = u - t;</span><br><span class="line">                    w = w * wn;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i].<span class="built_in">real</span>(f[i].<span class="built_in">real</span>() / len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> n, m, len;</span><br><span class="line">    comp a[MAXN], b[MAXN], ans[MAXN];</span><br><span class="line">    <span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> x;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            a[i].<span class="built_in">real</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> x;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            b[i].<span class="built_in">real</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt;= n + m)</span><br><span class="line">            len *= <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">fft</span>(a, len, <span class="number">1</span>), <span class="built_in">fft</span>(b, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            ans[i] = a[i] * b[i];</span><br><span class="line">        <span class="built_in">fft</span>(ans, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n + m; ++i)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>, (<span class="type">int</span>)(ans[i].<span class="built_in">real</span>() + <span class="number">0.5</span>), <span class="string">&quot; \n&quot;</span>[i == n + m]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> ntt &#123;</span><br><span class="line">    <span class="type">int</span> rev[MAXN];</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x % MOD)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            <span class="keyword">if</span> (i &lt; rev[i])</span><br><span class="line">                <span class="built_in">swap</span>(f[i], f[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(<span class="type">int</span> *f, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">change</span>(f, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> gn = <span class="built_in">qpow</span>(<span class="number">3</span>, (MOD - <span class="number">1</span>) / h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;</span><br><span class="line">                <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;</span><br><span class="line">                    <span class="type">int</span> u = f[k], t = g * f[k + h / <span class="number">2</span>] % MOD;</span><br><span class="line">                    f[k] = (u + t + MOD) % MOD;</span><br><span class="line">                    f[k + h / <span class="number">2</span>] = (u - t + MOD) % MOD;</span><br><span class="line">                    g = g * gn % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (on == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">reverse</span>(f + <span class="number">1</span>, f + len);</span><br><span class="line">            <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">                f[i] = f[i] * inv % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> n, m, len;</span><br><span class="line">    <span class="type">int</span> a[MAXN], b[MAXN], ans[MAXN];</span><br><span class="line">    <span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="built_in">read</span>(a[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">read</span>(b[i]);</span><br><span class="line">        len = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (len &lt;= n + m)</span><br><span class="line">            len *= <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">ntt</span>(a, len, <span class="number">1</span>), <span class="built_in">ntt</span>(b, len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            ans[i] = a[i] * b[i] % MOD;</span><br><span class="line">        <span class="built_in">ntt</span>(ans, len, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n + m; ++i)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>, ans[i], <span class="string">&quot; \n&quot;</span>[i == n + m]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// return fft::main();</span></span><br><span class="line">    <span class="keyword">return</span> ntt::<span class="built_in">main</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3233 ä¸–ç•Œæ ‘ é¢˜è§£</title>
    <url>/2021/11/27/sol-p3233/</url>
    <content><![CDATA[<h2 id="P3233-ä¸–ç•Œæ ‘-é¢˜è§£"><a href="#P3233-ä¸–ç•Œæ ‘-é¢˜è§£" class="headerlink" title="P3233 ä¸–ç•Œæ ‘ é¢˜è§£"></a>P3233 ä¸–ç•Œæ ‘ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3233">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p><strong>ä»¥ä¸‹æ‰€æœ‰çš„â€œå…³é”®ç‚¹â€éƒ½è¡¨ç¤ºé¢˜ç›®ä¸­çš„è®®äº‹å¤„</strong></p>
<p>çœ‹å®Œè¿™é¢˜é¢˜è§£åå»å­¦ä¹ äº†è™šæ ‘<del>ï¼ˆç„¶åday2ä¸Šåˆæ¨¡æ‹Ÿèµ›è€ƒäº†é“ç±»ä¼¼è™šæ ‘ä½†ä¸ç”¨å»º$lca$çš„é¢˜ç›®ï¼‰</del></p>
<p>äºæ˜¯çœ‹åˆ°$\sum m \le 3 \times 10^5$ ç›´æ¥å»ºç«‹è™šæ ‘ï¼ˆç„¶è€Œå¦‚æœæ²¡å­¦è¿‡è™šæ ‘å°±çœ‹ä¸å‡ºæ¥äº†ï¼‰ã€‚</p>
<p>ç”¨<code>pair&lt;int, int&gt;</code>å‚¨å­˜æ ‘ä¸ŠèŠ‚ç‚¹åˆ°è¾¾æœ€è¿‘å…³é”®ç‚¹çš„è·ç¦»å’Œå…³é”®ç‚¹ç¼–å·ä»¥ä¾¿äºæ¯”è¾ƒã€‚å…ˆå¯¹è™šæ ‘ä¸Šçš„èŠ‚ç‚¹åšä¸€éæ¢æ ¹$dp$ï¼Œæ–¹ç¨‹æ˜¾ç„¶æ˜¯$dp<em>u = \min\limits</em>{v,w}{dp_v + w}$å…¶ä¸­$v, w$åˆ†åˆ«ä¸ºå­èŠ‚ç‚¹å’Œåˆ°å­èŠ‚ç‚¹çš„è·ç¦»ã€‚ä¹‹åä¸ºäº†æ–¹ä¾¿è¡¨è¿°è®¾<strong>$f_u$è¡¨ç¤º<code>dp[u].first</code>ï¼Œ$g_u$è¡¨ç¤º<code>dp[u].second</code></strong>ã€‚</p>
<p>æ¥ä¸‹æ¥è€ƒè™‘ä¸åœ¨è™šæ ‘ä¸Šçš„èŠ‚ç‚¹ã€‚é¦–å…ˆå¦‚æœè™šæ ‘ä¸ŠæŸèŠ‚ç‚¹çš„ä¸€ä¸ªåŸæ ‘ä¸Šå­èŠ‚ç‚¹çš„å­æ ‘ä¸­éƒ½æ²¡æœ‰è™šæ ‘ä¸Šçš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥å­æ ‘ä¸­çš„çš„æ‰€æœ‰èŠ‚ç‚¹çš„æœ€è¿‘å…³é”®ç‚¹éƒ½åº”å½“ä¸è¯¥è™šæ ‘èŠ‚ç‚¹ç›¸åŒã€‚å½¢å¼åŒ–åœ°ï¼Œè‹¥å¯¹äºè™šæ ‘ä¸Šçš„èŠ‚ç‚¹$u$æœ‰èŠ‚ç‚¹$u \to v<em>{real}$ä½¿å¾—ä¸å­˜åœ¨$v</em>{real} \to \cdots \to x$åœ¨è™šæ ‘ä¸Šï¼Œé‚£ä¹ˆ$g<em>x = g_u$ï¼Œå³$cnt</em>{g<em>u} += siz</em>{v_{real}}$ã€‚å¦‚åœ¨ä¸‹å›¾ä¸­çš„èŠ‚ç‚¹ä¸­$v=6,v=7,v=10$éƒ½æ»¡è¶³è¯¥ç§æƒ…å†µï¼ˆåŠ ç²—èŠ‚ç‚¹è¡¨ç¤ºè™šæ ‘èŠ‚ç‚¹ï¼‰ã€‚</p>
<p><img src="sol-p3233-1.png" alt="è™šæ ‘"></p>
<p>å…¶æ¬¡æ˜¯åœ¨è™šæ ‘çš„é“¾ä¸Šçš„ç‚¹ã€‚ä¸å¦¨å°†ä¾‹å¦‚ä¸Šå›¾ä¸­çš„èŠ‚ç‚¹$9$è®¡ç®—åˆ°èŠ‚ç‚¹$4$ä¸­ï¼ˆå› ä¸º$g<em>4$ä¸€å®šç­‰äº$g_9$ï¼‰ï¼Œè€ƒè™‘ä¸€æ¡é“¾$fa \to u$ï¼Œè‹¥$g</em>{fa} = g<em>u$åˆ™é“¾ä¸ŠèŠ‚ç‚¹å…¨éƒ¨åŠ åˆ°$g_u$ä¸­ï¼ˆåŒæ ·è®¾$v</em>{real}$è¡¨ç¤º$fa$åœ¨åŸæ ‘ä¸­çš„$u$æ–¹å‘çš„å­èŠ‚ç‚¹ï¼Œç›¸å½“äº$cnt<em>{g_u} += siz</em>{v<em>{real}} - siz_u$ï¼‰ï¼Œå¦åˆ™å€å¢æ‰¾åˆ°æ·±åº¦æœ€å°çš„æ»¡è¶³å–$g_u$æ›´ä¼˜çš„ç‚¹$cur$ï¼Œæ˜¾ç„¶$cnt</em>{g<em>u} += siz</em>{cur} - siz<em>u$ï¼Œ$cnt</em>{g<em>{fa}} += siz</em>{v<em>{real}} - siz</em>{cur}$ã€‚</p>
<p>äºæ˜¯æœ¬é¢˜å°±ç»“æŸäº†ã€‚åªæ˜¯æœ‰å¤ªå¤šå¤ªå¤šç»†èŠ‚è¦æ³¨æ„äº†ï¼Œ<del>å†™é”™ä¸€ä¸ªè°ƒä¸€æ•´å¹´å•Š/kk</del></p>
<p>æ—¶é—´å¤æ‚åº¦$O(n \log n)$ç¨³è¿‡ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3233.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3233</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> pii = pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">3e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">6e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK = <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">graph</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> u, v, w;</span><br><span class="line">    &#125; e[MAXM];</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], tot;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">        e[++tot] = &#123;u, v, w&#125;;</span><br><span class="line">        nxt[tot] = head[u];</span><br><span class="line">        head[u] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, q, top, inde, h[MAXN], dfn[MAXN], dep[MAXN];</span><br><span class="line"><span class="type">int</span> fa[MAXN][MAXK], siz[MAXN], sta[MAXN], cnt[MAXN], ori[MAXN];</span><br><span class="line">pii dis[MAXN][<span class="number">2</span>], tmp[MAXN], pre[MAXN], nxt[MAXN];</span><br><span class="line"><span class="type">bool</span> tag[MAXN];</span><br><span class="line">graph tr, vtr;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_tr</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    siz[u] = <span class="number">1</span>, dfn[u] = ++inde, dep[u] = dep[f] + <span class="number">1</span>, fa[u][<span class="number">0</span>] = f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; MAXK; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = tr.head[u]; i; i = tr.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (tr.e[i].v != f)</span><br><span class="line">            <span class="built_in">build_tr</span>(tr.e[i].v, u), siz[u] += siz[tr.e[i].v];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="type">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">jump</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((d &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_vedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// debug(&quot;virtual tree: %lld -&gt; %lld, w = %lld&quot;, u, v, dep[v] - dep[u]);</span></span><br><span class="line">    vtr.<span class="built_in">addedge</span>(u, v, dep[v] - dep[u]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_vtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(h + <span class="number">1</span>, h + m + <span class="number">1</span>, [](<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">        <span class="keyword">return</span> dfn[x] &lt; dfn[y];</span><br><span class="line">    &#125;);</span><br><span class="line">    sta[top = <span class="number">1</span>] = <span class="number">1</span>, vtr.head[<span class="number">1</span>] = <span class="number">0</span>, vtr.tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (h[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> l = <span class="built_in">lca</span>(sta[top], h[i]);</span><br><span class="line">        <span class="keyword">while</span> (dfn[l] &lt;= dfn[sta[top - <span class="number">1</span>]])</span><br><span class="line">            <span class="built_in">add_vedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="keyword">if</span> (sta[top] != l)</span><br><span class="line">            vtr.head[l] = <span class="number">0</span>, <span class="built_in">add_vedge</span>(l, sta[top]), sta[top] = l;</span><br><span class="line">        vtr.head[h[i]] = <span class="number">0</span>, sta[++top] = h[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">add_vedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs0</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dis[u][<span class="number">0</span>] = tag[u] ? pii&#123;<span class="number">0</span>, u&#125; : pii&#123;INFL, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = vtr.head[u]; i; i = vtr.nxt[i]) &#123;</span><br><span class="line">        <span class="type">int</span> v = vtr.e[i].v, w = vtr.e[i].w;</span><br><span class="line">        <span class="built_in">dfs0</span>(v), dis[u][<span class="number">0</span>] = <span class="built_in">min</span>(dis[u][<span class="number">0</span>], &#123;dis[v][<span class="number">0</span>].fi + w, dis[v][<span class="number">0</span>].se&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// debug(&quot;dis of dfs0(%lld) = &#123;%lld, %lld&#125;&quot;, u, dis[u][0].fi, dis[u][0].se);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = vtr.head[u]; i; i = vtr.nxt[i]) &#123;</span><br><span class="line">        <span class="type">int</span> v = vtr.e[i].v, w = vtr.e[i].w;</span><br><span class="line">        tmp[++len] = &#123;dis[v][<span class="number">0</span>].fi + w, dis[v][<span class="number">0</span>].se&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tag[u])</span><br><span class="line">        dis[u][<span class="number">1</span>] = &#123;<span class="number">0</span>, u&#125;;</span><br><span class="line">    pre[<span class="number">0</span>] = nxt[len + <span class="number">1</span>] = dis[u][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">        pre[i] = <span class="built_in">min</span>(pre[i - <span class="number">1</span>], tmp[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = len; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">        nxt[i] = <span class="built_in">min</span>(nxt[i + <span class="number">1</span>], tmp[i]);</span><br><span class="line">    len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = vtr.head[u]; i; i = vtr.nxt[i]) &#123;</span><br><span class="line">        ++len;</span><br><span class="line">        pii t = <span class="built_in">min</span>(pre[len - <span class="number">1</span>], nxt[len + <span class="number">1</span>]);</span><br><span class="line">        <span class="comment">// ##sb-mistakes## æ¢æ ¹$dp$ä¸è¦åœ¨ç»Ÿè®¡$pre$å’Œ$nxt$æ•°ç»„æ—¶å°±å†™$dfs$!!!æ•°ç»„æ•´ä¸ªæ”¹å˜!!!ä¸ç„¶ä¼šæ­»å¾—å¾ˆæƒ¨ï¼ˆæŒ‡å¯¹ç€n=1000,m=100çš„å¤§æ ·ä¾‹è°ƒ1hï¼‰</span></span><br><span class="line">        dis[vtr.e[i].v][<span class="number">1</span>] = &#123;t.fi + vtr.e[i].w, t.se&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = vtr.head[u]; i; i = vtr.nxt[i])</span><br><span class="line">        <span class="built_in">dfs1</span>(vtr.e[i].v);</span><br><span class="line">    <span class="comment">// debug(&quot;dis of dfs1(%lld) = &#123;%lld, %lld&#125;&quot;, u, dis[u][1].fi, dis[u][1].se);</span></span><br><span class="line">    dis[u][<span class="number">1</span>] = <span class="built_in">min</span>(dis[u][<span class="number">0</span>], dis[u][<span class="number">1</span>]);</span><br><span class="line">    ++cnt[dis[u][<span class="number">1</span>].se];</span><br><span class="line">    <span class="comment">// debug(&quot;dis of dfs1(%lld) = &#123;%lld, %lld&#125;&quot;, u, dis[u][1].fi, dis[u][1].se);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = vtr.head[u]; i; i = vtr.nxt[i])</span><br><span class="line">        <span class="built_in">dfs2</span>(vtr.e[i].v, u);</span><br><span class="line">    <span class="keyword">if</span> (f) &#123;</span><br><span class="line">        <span class="comment">// debug(&quot;calculate chain %lld -&gt; %lld&quot;, f, u);</span></span><br><span class="line">        <span class="keyword">if</span> (dis[f][<span class="number">1</span>].se == dis[u][<span class="number">1</span>].se) &#123;</span><br><span class="line">            <span class="type">int</span> cx = siz[<span class="built_in">jump</span>(u, dep[u] - dep[f] - <span class="number">1</span>)] - siz[u];</span><br><span class="line">            <span class="comment">// debug(&quot;same color, add %lld to cnt[%lld]&quot;, cx, dis[u][1].se);</span></span><br><span class="line">            cnt[dis[u][<span class="number">1</span>].se] += cx;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> cur = u;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = MAXK - <span class="number">1</span>; ~i; --i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dep[fa[cur][i]] &lt;= dep[f])</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                pii up&#123;dep[fa[cur][i]] - dep[f] + dis[f][<span class="number">1</span>].fi, dis[f][<span class="number">1</span>].se&#125;;</span><br><span class="line">                pii dn&#123;dep[u] - dep[fa[cur][i]] + dis[u][<span class="number">1</span>].fi, dis[u][<span class="number">1</span>].se&#125;;</span><br><span class="line">                <span class="keyword">if</span> (dn &lt; up)</span><br><span class="line">                    cur = fa[cur][i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// debug(&quot;vertex is %lld&quot;, cur);</span></span><br><span class="line">            <span class="type">int</span> c1 = siz[cur] - siz[u];</span><br><span class="line">            <span class="type">int</span> c2 = siz[<span class="built_in">jump</span>(u, dep[u] - dep[f] - <span class="number">1</span>)] - siz[cur];</span><br><span class="line">            <span class="comment">// debug(&quot;%lld&quot;, siz[jump(u, dep[u] - dep[f] - 1)]);</span></span><br><span class="line">            <span class="comment">// debug(&quot;diff color, add %lld to cnt[%lld]&quot;, c1, dis[u][1].se);</span></span><br><span class="line">            <span class="comment">// debug(&quot;diff color, add %lld to cnt[%lld]&quot;, c2, dis[f][1].se);</span></span><br><span class="line">            cnt[dis[u][<span class="number">1</span>].se] += c1;</span><br><span class="line">            cnt[dis[f][<span class="number">1</span>].se] += c2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// debug(&quot;calculate subtree of %lld&quot;, u);</span></span><br><span class="line">    <span class="type">int</span> rem = siz[u] - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = vtr.head[u]; i; i = vtr.nxt[i])</span><br><span class="line">        rem -= siz[<span class="built_in">jump</span>(vtr.e[i].v, dep[vtr.e[i].v] - dep[u] - <span class="number">1</span>)];</span><br><span class="line">    <span class="comment">// debug(&quot;add %lld to cnt[%lld]&quot;, rem, dis[u][1].se);</span></span><br><span class="line">    cnt[dis[u][<span class="number">1</span>].se] += rem;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(u, v);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build_tr</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="built_in">read</span>(m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            ori[i] = <span class="built_in">read</span>(h[i]), tag[h[i]] = <span class="literal">true</span>, cnt[h[i]] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">build_vtr</span>();</span><br><span class="line">        dis[<span class="number">1</span>][<span class="number">0</span>] = dis[<span class="number">1</span>][<span class="number">1</span>] = &#123;INFL, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">dfs0</span>(<span class="number">1</span>), <span class="built_in">dfs1</span>(<span class="number">1</span>), <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            <span class="built_in">write</span>(cnt[ori[i]]), <span class="built_in">putchar</span>(i == m ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">            tag[h[i]] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P2495 æ¶ˆè€—æˆ˜ é¢˜è§£</title>
    <url>/2021/11/27/sol-p2495/</url>
    <content><![CDATA[<h2 id="P2495-æ¶ˆè€—æˆ˜-é¢˜è§£"><a href="#P2495-æ¶ˆè€—æˆ˜-é¢˜è§£" class="headerlink" title="P2495 æ¶ˆè€—æˆ˜ é¢˜è§£"></a>P2495 æ¶ˆè€—æˆ˜ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P2495">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è™šæ ‘æ¨¡ç‰ˆé¢˜ï¼Œä¸å¤šè¯´ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P2495.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P2495</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">3e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK = <span class="number">20</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">graph</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> u, v, w;</span><br><span class="line">    &#125; e[MAXM];</span><br><span class="line">    <span class="type">int</span> head[MAXN], nxt[MAXM], tot;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">        e[++tot] = &#123;u, v, w&#125;;</span><br><span class="line">        nxt[tot] = head[u];</span><br><span class="line">        head[u] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, k, inde, h[MAXN], dfn[MAXN], dep[MAXN];</span><br><span class="line"><span class="type">int</span> fa[MAXN][MAXK], mn[MAXN][MAXK], dp[MAXN], sta[MAXN], top;</span><br><span class="line"><span class="type">bool</span> tag[MAXN];</span><br><span class="line">graph tr, vtr;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_tr</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> f, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">    dfn[u] = ++inde, dep[u] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    fa[u][<span class="number">0</span>] = f, mn[u][<span class="number">0</span>] = w;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; MAXK; ++i)</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; MAXK; ++i)</span><br><span class="line">        mn[u][i] = <span class="built_in">min</span>(mn[u][i - <span class="number">1</span>], mn[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = tr.head[u]; i; i = tr.nxt[i])</span><br><span class="line">        <span class="keyword">if</span> (tr.e[i].v != f)</span><br><span class="line">            <span class="built_in">build_tr</span>(tr.e[i].v, u, tr.e[i].w);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v])</span><br><span class="line">        <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="type">int</span> t = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v)</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> (fa[u][i] != fa[v][i])</span><br><span class="line">            u = fa[u][i], v = fa[v][i];</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">minpath</span><span class="params">(<span class="type">int</span> f, <span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> t = dep[f] - dep[u];</span><br><span class="line">    <span class="type">int</span> ret = INFL;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = MAXK - <span class="number">1</span>; ~i; --i)</span><br><span class="line">        <span class="keyword">if</span> ((t &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">            ret = <span class="built_in">min</span>(ret, mn[u][i]), u = fa[u][i];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_vedge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    vtr.<span class="built_in">addedge</span>(u, v, <span class="built_in">minpath</span>(u, v));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_vtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(h + <span class="number">1</span>, h + k + <span class="number">1</span>, [](<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">        <span class="keyword">return</span> dfn[x] &lt; dfn[y];</span><br><span class="line">    &#125;);</span><br><span class="line">    sta[top = <span class="number">1</span>] = <span class="number">1</span>, vtr.tot = <span class="number">0</span>, vtr.head[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (h[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> l = <span class="built_in">lca</span>(sta[top], h[i]);</span><br><span class="line">        <span class="keyword">if</span> (l != sta[top]) &#123;</span><br><span class="line">            <span class="keyword">while</span> (dfn[sta[top - <span class="number">1</span>]] &gt; dfn[l])</span><br><span class="line">                <span class="built_in">add_vedge</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">            <span class="keyword">if</span> (sta[top - <span class="number">1</span>] == l)</span><br><span class="line">                <span class="built_in">add_vedge</span>(l, sta[top]), --top;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                vtr.head[l] = <span class="number">-1</span>, <span class="built_in">add_vedge</span>(l, sta[top]), sta[top] = l;</span><br><span class="line">        &#125;</span><br><span class="line">        vtr.head[h[i]] = <span class="number">0</span>, sta[++top] = h[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; top; ++i)</span><br><span class="line">        <span class="built_in">add_vedge</span>(sta[i], sta[i + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dp[u] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = vtr.head[u]; i; i = vtr.nxt[i]) &#123;</span><br><span class="line">        <span class="type">int</span> v = vtr.e[i].v, w = vtr.e[i].w;</span><br><span class="line">        <span class="built_in">dfs</span>(v);</span><br><span class="line">        <span class="keyword">if</span> (tag[v])</span><br><span class="line">            dp[u] += w;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            dp[u] += <span class="built_in">min</span>(dp[v], w);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> u, v, w;</span><br><span class="line">        <span class="built_in">read</span>(u), <span class="built_in">read</span>(v), <span class="built_in">read</span>(w);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(u, v, w);</span><br><span class="line">        tr.<span class="built_in">addedge</span>(v, u, w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fill</span>(mn[<span class="number">0</span>], mn[<span class="number">0</span>] + MAXK, INFL);</span><br><span class="line">    <span class="built_in">build_tr</span>(<span class="number">1</span>, <span class="number">0</span>, INFL);</span><br><span class="line">    <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="built_in">read</span>(k);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            <span class="built_in">read</span>(h[i]), tag[h[i]] = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">build_vtr</span>();</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">write</span>(dp[<span class="number">1</span>]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">            tag[h[i]] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P7155 Spaceship P é¢˜è§£</title>
    <url>/2021/11/26/sol-p7155/</url>
    <content><![CDATA[<h2 id="P7155-Spaceship-P-é¢˜è§£"><a href="#P7155-Spaceship-P-é¢˜è§£" class="headerlink" title="P7155 Spaceship P é¢˜è§£"></a>P7155 Spaceship P é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P7155">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>è€ƒè™‘åˆ°ä¸€ä¸ªåˆæ³•çš„æŒ‰é’®åºåˆ—ä¸­ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæœ€å¤§çš„æŒ‰é’®ç¼–å·ã€‚å› ä¸ºå¦‚æœè¯¥æœ€å¤§ç¼–å·ä¸º$mx$çš„æŒ‰é’®èƒ½è¢«æŒ‰ä¸‹å¤šæ¬¡ï¼Œåˆ™å¿…é¡»è¦æŒ‰ä¸‹å¦ä¸€ä¸ªæŒ‰é’®ç¼–å·$\gt mx$ä»¥ä½¿æŒ‰é’®$mx$å˜å¾—åˆæ³•ï¼Œä¸æ»¡è¶³$mx$ç¼–å·æœ€å¤§ï¼Œæ•…å‡è®¾ä¸æˆç«‹ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªæ€§è´¨ï¼Œå°±ç¡®å®šäº†åˆæ³•åºåˆ—æ•°é‡çš„ä¸Šç•Œï¼Œå¹¶ä¸”ç”±äºç¼–å·æœ€å¤§çš„æŒ‰é’®å°†åºåˆ—åˆ†æˆä¸¤æ®µï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥$dp$æ±‚è§£ã€‚è®¾$dp<em>{u,v,c,0/1,0/1}$è¡¨ç¤ºä»$u$èµ°åˆ°$v$çš„è·¯å¾„ä¸­æœ€å¤§æŒ‰é’®çš„ç¼–å·ä¸è¶…è¿‡$c$ï¼Œç¬¬ä¸€æ­¥æ˜¯å¦æœ‰é™åˆ¶å’Œæœ€åä¸€æ­¥æ˜¯å¦æœ‰é™åˆ¶çš„æ–¹æ¡ˆæ•°ï¼Œç­”æ¡ˆå°±æ˜¯$dp</em>{s,t,K,1,1}$ï¼Œäºæ˜¯$O(qn^5)$åšæ³•æ˜¾ç„¶ã€‚</p>
<p>è€ƒè™‘å¦‚ä½•ä¼˜åŒ–ï¼ˆå…¶å®ä¹ŸæŒºå¥½æƒ³ï¼‰ã€‚ä»¤$f<em>{u,x,c,0/1}=\sum\limits</em>{(t,u)}{dp<em>{u,t,c-1,0/1,0}}$ï¼Œ$g</em>{x,v,c,0/1}=\sum\limits<em>{(v,t)}{dp</em>{t,v,c-1,0,0/1}}$ï¼Œåˆ™$dp<em>{u,v,c,k1,k2}=\sum\limits</em>{t}{f<em>{u,t,c,k1} \times g</em>{t,v,c,k2}}$ï¼Œä¸€ä¸‹å­å°‘æšä¸¾å¾ˆå¤šä¸œè¥¿äº†ã€‚</p>
<p>å…·ä½“ç»†èŠ‚å°±çœ‹ä»£ç å§ï¼Œæ—¶é—´å¤æ‚åº¦$O(n^4 + qn^3)$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P7155.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P7155</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">65</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="type">int</span> n, k, q;</span><br><span class="line"><span class="type">char</span> buf[MAXN];</span><br><span class="line"><span class="type">bool</span> mp[MAXN][MAXN];</span><br><span class="line"><span class="type">int</span> dp[<span class="number">2</span>][<span class="number">2</span>][MAXN][MAXN][MAXN], f[<span class="number">2</span>][MAXN][MAXN][MAXN], g[<span class="number">2</span>][MAXN][MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uadd</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= MOD)</span><br><span class="line">        x -= MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> bs, <span class="type">int</span> bt)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(f[<span class="number">1</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(f[<span class="number">1</span>]));</span><br><span class="line">    <span class="built_in">memset</span>(g[<span class="number">1</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(g[<span class="number">1</span>]));</span><br><span class="line">    <span class="built_in">memset</span>(dp[<span class="number">0</span>][<span class="number">1</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(dp[<span class="number">0</span>][<span class="number">1</span>]));</span><br><span class="line">    <span class="built_in">memset</span>(dp[<span class="number">1</span>][<span class="number">0</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(dp[<span class="number">1</span>][<span class="number">0</span>]));</span><br><span class="line">    <span class="built_in">memset</span>(dp[<span class="number">1</span>][<span class="number">1</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(dp[<span class="number">1</span>][<span class="number">1</span>]));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">1</span>; c &lt;= k; ++c) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">1</span>; y &lt;= n; ++y)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">1</span>; v &lt;= n; ++v)</span><br><span class="line">                <span class="keyword">if</span> (mp[v][y]) <span class="built_in">uadd</span>(f[<span class="number">1</span>][s][y][c], dp[<span class="number">1</span>][<span class="number">0</span>][s][v][c - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x &lt;= n; ++x)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">1</span>; v &lt;= n; ++v)</span><br><span class="line">                <span class="keyword">if</span> (mp[x][v]) <span class="built_in">uadd</span>(g[<span class="number">1</span>][x][t][c], dp[<span class="number">0</span>][<span class="number">1</span>][v][t][c - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (c == bs) <span class="built_in">uadd</span>(f[<span class="number">1</span>][s][s][c], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (c == bt) <span class="built_in">uadd</span>(g[<span class="number">1</span>][t][t][c], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">1</span>; v &lt;= n; ++v) &#123;</span><br><span class="line">            dp[<span class="number">1</span>][<span class="number">0</span>][s][v][c] = dp[<span class="number">1</span>][<span class="number">0</span>][s][v][c - <span class="number">1</span>];</span><br><span class="line">            dp[<span class="number">0</span>][<span class="number">1</span>][v][t][c] = dp[<span class="number">0</span>][<span class="number">1</span>][v][t][c - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= n; ++l) &#123;</span><br><span class="line">                <span class="built_in">uadd</span>(dp[<span class="number">1</span>][<span class="number">0</span>][s][v][c], f[<span class="number">1</span>][s][l][c] * g[<span class="number">0</span>][l][v][c] % MOD);</span><br><span class="line">                <span class="built_in">uadd</span>(dp[<span class="number">0</span>][<span class="number">1</span>][v][t][c], f[<span class="number">0</span>][v][l][c] * g[<span class="number">1</span>][l][t][c] % MOD);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        dp[<span class="number">1</span>][<span class="number">1</span>][s][t][c] = dp[<span class="number">1</span>][<span class="number">1</span>][s][t][c - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">1</span>; v &lt;= n; ++v)</span><br><span class="line">            <span class="built_in">uadd</span>(dp[<span class="number">1</span>][<span class="number">1</span>][s][t][c], f[<span class="number">1</span>][s][v][c] * g[<span class="number">1</span>][v][t][c] % MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">1</span>][<span class="number">1</span>][s][t][k];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            mp[i][j] = buf[j] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">1</span>; c &lt;= k; ++c) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x &lt;= n; ++x)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">1</span>; y &lt;= n; ++y)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> t = <span class="number">1</span>; t &lt;= n; ++t)</span><br><span class="line">                    <span class="keyword">if</span> (mp[t][y]) <span class="built_in">uadd</span>(f[<span class="number">0</span>][x][y][c], dp[<span class="number">0</span>][<span class="number">0</span>][x][t][c - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x &lt;= n; ++x)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">1</span>; y &lt;= n; ++y)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> t = <span class="number">1</span>; t &lt;= n; ++t)</span><br><span class="line">                    <span class="keyword">if</span> (mp[x][t]) <span class="built_in">uadd</span>(g[<span class="number">0</span>][x][y][c], dp[<span class="number">0</span>][<span class="number">0</span>][t][y][c - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="built_in">uadd</span>(f[<span class="number">0</span>][i][i][c], <span class="number">1</span>), <span class="built_in">uadd</span>(g[<span class="number">0</span>][i][i][c], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x &lt;= n; ++x)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">1</span>; y &lt;= n; ++y)</span><br><span class="line">                <span class="built_in">uadd</span>(dp[<span class="number">0</span>][<span class="number">0</span>][x][y][c], dp[<span class="number">0</span>][<span class="number">0</span>][x][y][c - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x &lt;= n; ++x)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">1</span>; y &lt;= n; ++y)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> t = <span class="number">1</span>; t &lt;= n; ++t)</span><br><span class="line">                    <span class="built_in">uadd</span>(dp[<span class="number">0</span>][<span class="number">0</span>][x][y][c], f[<span class="number">0</span>][x][t][c] * g[<span class="number">0</span>][t][y][c] % MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="type">int</span> bs, s, bt, t;</span><br><span class="line">        <span class="built_in">read</span>(bs), <span class="built_in">read</span>(s), <span class="built_in">read</span>(bt), <span class="built_in">read</span>(t);</span><br><span class="line">        <span class="built_in">write</span>(<span class="built_in">query</span>(s, t, bs, bt)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>BZOJ2720 åˆ—é˜Ÿæ˜¥æ¸¸ é¢˜è§£</title>
    <url>/2021/11/26/sol-bzoj2720/</url>
    <content><![CDATA[<h2 id="BZOJ2720-åˆ—é˜Ÿæ˜¥æ¸¸-é¢˜è§£"><a href="#BZOJ2720-åˆ—é˜Ÿæ˜¥æ¸¸-é¢˜è§£" class="headerlink" title="BZOJ2720 åˆ—é˜Ÿæ˜¥æ¸¸ é¢˜è§£"></a>BZOJ2720 åˆ—é˜Ÿæ˜¥æ¸¸ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://darkbzoj.tk/problem/2720">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¯¹äºè¿™ç§å…¨æ’åˆ—çš„é¢˜ç›®å‘ç°ä¸å¤ªå¥½ç”¨$dp$ã€‚ä»”ç»†è§‚å¯Ÿå‘ç°å¯¹äºæ¯ä¸ªäººçš„æœŸæœ›è§†é‡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥ç›´æ¥ç›¸åŠ ï¼Œæ‰€ä»¥ç›´æ¥ç®—$E(c)$è¡¨ç¤ºæœ‰$c$ä¸ªäººçš„é«˜åº¦å°äºè¯¥åŒå­¦æ—¶è¯¥åŒå­¦çš„æœŸæœ›è§†é‡ã€‚ç­”æ¡ˆæ˜¾ç„¶$\sum\limits_{i=1}^{n}{E(c_i)}$ã€‚</p>
<p>è€ƒè™‘å¦‚ä½•æ±‚$E(c)$ã€‚æ ¹æ®æœŸæœ›å…¬å¼æ˜“å¾—$E(c) = \sum\limits_{i=1}^{c}{i \cdot P(i)}$ã€‚</p>
<p>ä½†æ˜¯$P(i)$ä¸å¥½æ±‚è€Œ$P(\ge i)$ç›¸å¯¹å¥½æ±‚ï¼Œäºæ˜¯ç»§ç»­è§‚å¯Ÿè¿™ä¸ªç­‰å¼ï¼Œå‘ç°æ¯ä¸ª$P(i)$éƒ½è¢«è®¡ç®—äº†æ°å¥½$i$æ¬¡ï¼Œæ‰€ä»¥$E(c)$å°±å¯ä»¥è¡¨ç¤ºä¸ºå¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
    E(c) = \sum_{i=1}^{c}{P(\ge i)}</script><p>è¿™æ ·å°±åªéœ€è¦è€ƒè™‘æ¦‚ç‡è€Œä¸éœ€è¦è€ƒè™‘æœŸæœ›äº†ã€‚</p>
<p>æ¥ä¸‹æ¥è€ƒè™‘$P(\ge i)$ã€‚æ—¢ç„¶è§†é‡$\ge i$ï¼Œé‚£ä¹ˆè‡³å°‘è¦æœ‰$i-1$ä¸ªé«˜åº¦$\lt h$çš„äººç«™åœ¨å‰é¢ï¼Œäºæ˜¯$P(\ge i)$è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{align}
        P(\ge i) &= \frac{n-i+1}{n} \cdot \frac{c^{\underline{i-1}}}{(n-1)^{\underline{i-1}}} \\
        &= \frac{n-i+1}{n} \cdot \frac{c!(n-i)!}{(n-1)!(c-i+1)!} \\
        &= \frac{c!}{n!} \cdot \frac{(n-i+1)!}{(c-i+1)!}
    \end{align}</script><p>äºæ˜¯å°†è¯¥å¼ä»£å…¥åˆ°$E(c)$ä¸­å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
    \begin{align}
        E(c) &= \sum_{i=1}^{c}{i \cdot P(i)} \\
        &= \sum_{i=1}^{c}{P(\ge i)} \\
        &= \sum_{i=1}^{c}{\frac{c!}{n!} \cdot \frac{(n-i+1)!}{(c-i+1)!}} \\
        &= \frac{c!}{n!}\sum_{i=1}^{c}{\frac{(n-i+1)!}{(c-i+1)!}} \\
        &= \frac{c!(n-c)!}{n!}\sum_{i=1}^{c}{\binom{n-i+1}{c-i+1}} \\
        &= \frac{c!(n-c)!}{n!}\sum_{i=0}^{c-1}{\binom{n-c+i+1}{i+1}}
    \end{align}</script><p>ç”±äº$\sum\limits_{i=0}^{k}{\binom{n+i}{m+i}} = \binom{n+k+1}{m+k}$ï¼ˆæ˜“è¯ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥è¿›ä¸€æ­¥å°†$E(c)$çš„$\Sigma$ä¼˜åŒ–æ‰ã€‚</p>
<script type="math/tex; mode=display">
    \begin{align}
        E(c) &= \frac{c!(n-c)!}{n!}\sum_{i=0}^{c-1}{\binom{n-c+i+1}{i+1}} \\
        &= \frac{c!(n-c)!}{n!} \cdot \binom{n+1}{c} \\
        &= \frac{c!(n-c)!}{n!} \cdot \frac{(n+1)!}{c!(n-c+1)!} \\
        &= \frac{n+1}{n-c+1}
    \end{align}</script><p>æ‰€ä»¥å¾—åˆ°ç»“è®º</p>
<script type="math/tex; mode=display">
    E(c) = \frac{n+1}{n-c+1}</script><p>äºæ˜¯æœ€ç»ˆçš„ç­”æ¡ˆå°±å˜æˆäº†</p>
<script type="math/tex; mode=display">
    ans = \sum_{i=1}^{n}{\frac{n+1}{n-c+1}}</script><p>$O(n)$æ±‚è§£å³å¯ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           BZOJ2720.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://darkbzoj.tk/problem/2720</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">using</span> ldb = <span class="type">long</span> <span class="type">double</span>;</span><br><span class="line"><span class="type">int</span> n, h[MAXN], cnt[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ++cnt[<span class="built_in">read</span>(h[i])];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">1000</span>; ++i)</span><br><span class="line">        cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">    ldb ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        ans += (ldb)(n + <span class="number">1</span>) / (n - cnt[h[i] - <span class="number">1</span>] + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2Lf\n&quot;</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P3715 é­”æ³•å’’è¯­ é¢˜è§£</title>
    <url>/2021/11/25/sol-p3715/</url>
    <content><![CDATA[<h2 id="P3715-é­”æ³•å’’è¯­-é¢˜è§£"><a href="#P3715-é­”æ³•å’’è¯­-é¢˜è§£" class="headerlink" title="P3715 é­”æ³•å’’è¯­ é¢˜è§£"></a>P3715 é­”æ³•å’’è¯­ é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P3715">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¤šæ¨¡å¼å­—ç¬¦ä¸²åŒ¹é…é¦–å…ˆæƒ³åˆ°ACè‡ªåŠ¨æœºï¼Œé‚£ä¹ˆå°†å¿Œè®³è¯è¯­å»ºç«‹ACè‡ªåŠ¨æœºï¼Œæ•´ä¸ª$dp$å°±æœ‰ä¸€ç»´çŠ¶æ€è®¾ä¸ºACè‡ªåŠ¨æœºçš„çŠ¶æ€ï¼Œå¦ä¸€ç»´å°±ç”¨å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¾—åˆ°$dp_{i,s}$è¡¨ç¤ºé•¿åº¦ä¸º$i$ï¼ŒåŒ¹é…åˆ°ACè‡ªåŠ¨æœºçš„çŠ¶æ€ä¸º$s$çš„å­—ç¬¦ä¸²ä¸ªæ•°ã€‚è½¬ç§»æ—¶æšä¸¾åŸºæœ¬è¯æ±‡ï¼Œåœ¨ACè‡ªåŠ¨æœºä¸Šè·‘å‡ºä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œåˆ¤æ–­æ˜¯å¦åˆæ³•ç„¶åå‘åè½¬ç§»ã€‚æ—¶é—´å¤æ‚åº¦$O(Ln \Sigma)$ï¼Œ$\Sigma$ä¸ºå¿Œè®³è¯è¯­çš„æ€»é•¿åº¦ï¼Œå¯é€šè¿‡æµ‹è¯•ç‚¹$1-6$ã€‚</p>
<p>æ¥ä¸‹æ¥åˆ†æå¦‚ä½•åšæµ‹è¯•ç‚¹$7-10$ã€‚å‘ç°æµ‹è¯•ç‚¹$7-10$æœ‰$|S<em>i| \le 2$çš„æ€§è´¨ï¼ˆ$|S_i|$ä¸ºåŸºæœ¬è¯æ±‡é•¿åº¦ï¼‰ï¼Œè€Œ$L \le 10^8$åˆç»™æˆ‘ä»¬ä¸€ä¸ªæç¤ºï¼Œå³æ­£è§£å¤æ‚åº¦å¸¦æœ‰$\log L$ï¼Œäºæ˜¯æƒ³åˆ°ç”¨çŸ©é˜µå¿«é€Ÿå¹‚æ¥ä¼˜åŒ–$dp$ã€‚è€ƒè™‘åˆ°å› ä¸ºæœ‰$|S_1| \le 2$ï¼Œæ‰€ä»¥$dp</em>{i,s}$åªä¾èµ–äº$dp_{i-2,t}$ï¼Œå°±å¯ä»¥å‚è€ƒæ–æ³¢é‚£å¥‘æ•°åˆ—çš„çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–æ¥è®¾å®šä¸€ä¸ª$(tot \times 2) \times (tot \times 2)$ï¼Œ$tot$è¡¨ç¤ºACè‡ªåŠ¨æœºçŠ¶æ€æ€»æ•°ï¼ˆæ˜¾ç„¶$tot \le \Sigma \le 100$ï¼‰çš„è½¬ç§»çŸ©é˜µå¤„ç†å³å¯ã€‚æ—¶é—´å¤æ‚åº¦$O((\Sigma)^3 \log L)$ï¼Œå¯é€šè¿‡æµ‹è¯•ç‚¹$7-10$ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(\min(Ln \Sigma, \Sigma^3 \log L))$ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P3715.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P3715</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">205</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uadd</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= MOD)</span><br><span class="line">        x -= MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">matrix</span> &#123;</span><br><span class="line">    <span class="type">int</span> a[MAXN][MAXN], n;</span><br><span class="line">    <span class="built_in">matrix</span>(<span class="type">int</span> m) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = m;</span><br><span class="line">        <span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="built_in">sizeof</span>(a));</span><br><span class="line">    &#125;</span><br><span class="line">    matrix <span class="keyword">operator</span>*(<span class="type">const</span> matrix &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="function">matrix <span class="title">ret</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; ++k)</span><br><span class="line">                    <span class="built_in">uadd</span>(ret.a[i][j], a[i][k] * o.a[k][j] % MOD);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ac_automaton</span> &#123;</span><br><span class="line">    <span class="type">int</span> nxt[MAXN][<span class="number">26</span>], fail[MAXN], cnt[MAXN], tot;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> rt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; s[i]; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!nxt[rt][s[i] - <span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">                nxt[rt][s[i] - <span class="string">&#x27;a&#x27;</span>] = ++tot;</span><br><span class="line">            rt = nxt[rt][s[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        ++cnt[rt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>())</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i)</span><br><span class="line">            <span class="keyword">if</span> (nxt[<span class="number">0</span>][i])</span><br><span class="line">                que.<span class="built_in">push</span>(nxt[<span class="number">0</span>][i]);</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nxt[u][i]) &#123;</span><br><span class="line">                    fail[nxt[u][i]] = nxt[fail[u]][i];</span><br><span class="line">                    que.<span class="built_in">push</span>(nxt[u][i]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nxt[u][i] = nxt[fail[u]][i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, k, sum, len[MAXN];</span><br><span class="line"><span class="type">int</span> dp[MAXN][MAXN];</span><br><span class="line"><span class="type">char</span> s[MAXN][MAXN], t[MAXN][MAXN];</span><br><span class="line">ac_automaton ac;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">posi</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sum * l + x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">matrix <span class="title">qpow</span><span class="params">(matrix x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="function">matrix <span class="title">ret</span><span class="params">(x.n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= x.n; ++i)</span><br><span class="line">        ret.a[i][i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x)</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>) ret = ret * x;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(m), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s[i] + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, t[i] + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        len[i] = <span class="built_in">strlen</span>(s[i] + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        ac.<span class="built_in">insert</span>(t[i] + <span class="number">1</span>);</span><br><span class="line">    ac.<span class="built_in">build</span>();</span><br><span class="line">    <span class="keyword">if</span> (k &lt;= <span class="number">100</span>) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= ac.tot; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ac.cnt[j])</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x &lt;= n; ++x) &#123;</span><br><span class="line">                    <span class="type">int</span> p = j;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= len[x]; ++l) &#123;</span><br><span class="line">                        p = ac.nxt[p][s[x][l] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                        <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> o = p; o; o = ac.fail[o]) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (ac.cnt[o]) &#123;</span><br><span class="line">                                cnt += ac.cnt[o];</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (cnt) &#123;</span><br><span class="line">                            p = <span class="number">-1</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (~p &amp;&amp; i + len[x] &lt;= k)</span><br><span class="line">                        <span class="built_in">uadd</span>(dp[i + len[x]][p], dp[i][j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= ac.tot; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!ac.cnt[i])</span><br><span class="line">                <span class="built_in">uadd</span>(ans, dp[k][i]);</span><br><span class="line">        <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        sum = ac.tot + <span class="number">1</span>;</span><br><span class="line">        <span class="function">matrix <span class="title">base</span><span class="params">(sum * <span class="number">2</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= ac.tot; ++i)</span><br><span class="line">            base.a[<span class="built_in">posi</span>(i, <span class="number">1</span>)][<span class="built_in">posi</span>(i, <span class="number">0</span>)] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= ac.tot; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ac.cnt[i])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x &lt;= n; ++x) &#123;</span><br><span class="line">                <span class="type">int</span> p = i;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= len[x]; ++l) &#123;</span><br><span class="line">                    p = ac.nxt[p][s[x][l] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">                    <span class="comment">// ##sb-mistakes## ACè‡ªåŠ¨æœºåœ¨åšå¤šæ¨¡å¼åŒ¹é…çš„æ—¶å€™**ä¸€å®šè¦è·³failæŒ‡é’ˆ**ä¸ç„¶ä¼š**æ¼éå†å¾ˆå¤šä¸œè¥¿**ï¼ˆACè‡ªåŠ¨æœºç™½å­¦äº†ï¼‰ï¼ï¼ï¼</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> o = p; o; o = ac.fail[o]) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (ac.cnt[o]) &#123;</span><br><span class="line">                            cnt += ac.cnt[o];</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (cnt) &#123;</span><br><span class="line">                        p = <span class="number">-1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (p == <span class="number">-1</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (len[x] == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="built_in">uadd</span>(base.a[<span class="built_in">posi</span>(i, <span class="number">0</span>)][<span class="built_in">posi</span>(p, <span class="number">0</span>)], <span class="number">1</span>);</span><br><span class="line">                    <span class="comment">// ##sb-mistakes## å†™çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–dpï¼ˆå°¤å…¶æ˜¯dp[i]ä¾èµ–äºdp[i-2]è¿™ç§ï¼‰çš„æ—¶å€™ä¸€å®šè¦ç®—å¥½ï¼Œä¸èƒ½é‡å¤åŠ äº†</span></span><br><span class="line">                    <span class="comment">// uadd(base.a[posi(i, 1)][posi(p, 1)], 1);</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">uadd</span>(base.a[<span class="built_in">posi</span>(i, <span class="number">0</span>)][<span class="built_in">posi</span>(p, <span class="number">1</span>)], <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">matrix <span class="title">tmp</span><span class="params">(sum * <span class="number">2</span>)</span></span>;</span><br><span class="line">        tmp.a[<span class="number">1</span>][<span class="built_in">posi</span>(<span class="number">0</span>, <span class="number">0</span>)] = <span class="number">1</span>;</span><br><span class="line">        tmp = tmp * <span class="built_in">qpow</span>(base, k);</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= ac.tot; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!ac.cnt[i])</span><br><span class="line">                <span class="built_in">uadd</span>(ans, tmp.a[<span class="number">1</span>][<span class="built_in">posi</span>(i, <span class="number">0</span>)]);</span><br><span class="line">        <span class="built_in">write</span>(ans), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P7154 Sleeping Cows P é¢˜è§£</title>
    <url>/2021/11/25/sol-p7154/</url>
    <content><![CDATA[<h2 id="P7154-Sleeping-Cows-P-é¢˜è§£"><a href="#P7154-Sleeping-Cows-P-é¢˜è§£" class="headerlink" title="P7154 Sleeping Cows P é¢˜è§£"></a>P7154 Sleeping Cows P é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P7154">é¢˜ç›®é“¾æ¥</a></p>
<h2 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>å…ˆåˆ†ææ€§è´¨ã€‚é¦–å…ˆæ’åºä¸å½±å“ç­”æ¡ˆæ‰€ä»¥å°†å…¶æ’åºã€‚è‹¥$t_i$æ‰€èƒ½åŒ¹é…åˆ°çš„æœ€å¤§$s$çš„ä¸‹æ ‡ä¸º$x$ï¼Œåˆ™å¦‚æœæ”¾å¼ƒ$t_i$å°±æ„å‘³ç€$s_1$åˆ°$s_x$éƒ½è¦è¢«åŒ¹é…ã€‚æ‰€ä»¥åœ¨æ­¤æ€è·¯ä¸Š$dp$åˆ™éœ€è¦ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘æœ€å°çš„è¿˜æ²¡è€ƒè™‘çš„$s$å’Œ$t$ï¼Œæ¯æ¬¡é€‰æ‹©è¾ƒå°çš„ä¸€è¾¹è¿›è¡Œæ›´æ–°ã€‚ä¸å¦¨å°†ä¸¤ä¸ªæ•°ç»„åˆå¹¶é¡ºåºå»åšã€‚</p>
<p>è€ƒè™‘$dp$ï¼Œè®¾$dp_{i,j,0/1}$è¡¨ç¤ºè€ƒè™‘åˆ°æ–°æ•°ç»„çš„ç¬¬$i$ä¸ªæ•°ï¼Œç›®å‰æœ‰$j$ä¸ª$s$è¢«é€‰å…¥åŒ¹é…ä½†è¿˜æ²¡ç¡®å®šåŒ¹é…è°ï¼Œ$1$åˆ°$i-1$ä¸­æ˜¯å¦éƒ½å·²ç»è¢«é€‰å…¥çš„æ–¹æ¡ˆæ•°ã€‚é‚£ä¹ˆå¾—åˆ°è½¬ç§»æ–¹ç¨‹ï¼š</p>
<p>è‹¥å…ƒç´ $i$åœ¨$s$ä¸­ï¼Œåˆ™</p>
<script type="math/tex; mode=display">
    \begin{align}
    dp_{i,j,0} &= dp_{i-1,j-1,0} + dp_{i-1,j,0} + dp_{i-1,j,1} \\
    dp_{i,j,1} &= dp_{i-1,j-1,1}
    \end{align}</script><p>è‹¥å…ƒç´ $i$åœ¨$t$ä¸­ï¼Œåˆ™</p>
<script type="math/tex; mode=display">
    \begin{align}
    dp_{i,j,0} &= (j+1)dp_{i-1,j+1,0} \\
    dp_{i,j,1} = dp_{i-1,j,1} + (j+1)dp_{i-1,j+1,1}
    \end{align}</script><p>æœ€ç»ˆç­”æ¡ˆå°±æ˜¯ $dp<em>{n,0,0} + dp</em>{n,0,1}$ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n^2)$ã€‚</p>
<h2 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P7154.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/solution/P7154</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">6e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> x, op;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> node &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x == o.x ? op &lt; o.op : x &lt; o.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, s[MAXN], t[MAXN], dp[<span class="number">2</span>][MAXN][<span class="number">2</span>];</span><br><span class="line">node a[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= MOD)</span><br><span class="line">        x -= MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(s[i]), a[++m] = &#123;s[i], <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(t[i]), a[++m] = &#123;t[i], <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + m + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">    dp[u ^ <span class="number">1</span>][<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i, u ^= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(dp[u], <span class="number">0</span>, <span class="built_in">sizeof</span>(dp[u]));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i].op == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">add</span>(dp[u][j][<span class="number">0</span>], dp[u ^ <span class="number">1</span>][j][<span class="number">0</span>]);</span><br><span class="line">                <span class="built_in">add</span>(dp[u][j][<span class="number">0</span>], dp[u ^ <span class="number">1</span>][j][<span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">if</span> (j) &#123;</span><br><span class="line">                    <span class="built_in">add</span>(dp[u][j][<span class="number">0</span>], dp[u ^ <span class="number">1</span>][j - <span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">                    <span class="built_in">add</span>(dp[u][j][<span class="number">1</span>], dp[u ^ <span class="number">1</span>][j - <span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">add</span>(dp[u][j][<span class="number">0</span>], dp[u ^ <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">0</span>] * (j + <span class="number">1</span>) % MOD);</span><br><span class="line">                <span class="built_in">add</span>(dp[u][j][<span class="number">1</span>], dp[u ^ <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">1</span>] * (j + <span class="number">1</span>) % MOD);</span><br><span class="line">                <span class="built_in">add</span>(dp[u][j][<span class="number">1</span>], dp[u ^ <span class="number">1</span>][j][<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">add</span>(sum, dp[u ^ <span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">add</span>(sum, dp[u ^ <span class="number">1</span>][<span class="number">0</span>][<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">write</span>(sum), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF575A Fibonotci é¢˜è§£</title>
    <url>/2021/11/24/sol-cf575a/</url>
    <content><![CDATA[<h2 id="CF575A-Fibonotci-é¢˜è§£"><a href="#CF575A-Fibonotci-é¢˜è§£" class="headerlink" title="CF575A Fibonotci é¢˜è§£"></a>CF575A Fibonotci é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF575A">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>$K \le 10^{18}$ æ˜¾ç„¶çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–ã€‚çŸ©é˜µè½¬ç§»æ–¹ç¨‹å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
    \begin{bmatrix}
        f_i & f_{i-1}
    \end{bmatrix}
    =
    \begin{bmatrix}
        f_{i-1} & f_{i-2}
    \end{bmatrix}
    \begin{pmatrix}
        s_{i-1} & 1 \\
        s_{i-2} & 0
    \end{pmatrix}</script><p>å¹¶å¥—è·¯åœ°è®¾</p>
<script type="math/tex; mode=display">
    M_i =
    \begin{pmatrix}
        s_{i-1} & 1 \\
        s_{i-2} & 0
    \end{pmatrix}</script><p>æœ€ç»ˆç­”æ¡ˆå³ä¸º</p>
<script type="math/tex; mode=display">
    \begin{bmatrix}
        1 & 0
    \end{bmatrix}
    \times
    \prod_{i=1}^{k}{
        \begin{pmatrix}
            s_{i-1} & 1 \\
            s_{i-2} & 0
        \end{pmatrix}
    }
    =
    \begin{bmatrix}
        1 & 0
    \end{bmatrix}
    \times
    \prod_{i=1}^{k}{M_i}</script><p>ç”±äºå‡½æ•°å¤§éƒ¨åˆ†å…·æœ‰å‘¨æœŸæ€§ï¼Œä¸å¦¨å…ˆæŒ‰ç…§åˆ†æˆè‹¥å¹²ä¸ªç±»ä¼¼$[i\cdot n, (i+1)\cdot n)$çš„åŒºé—´åˆ†åˆ«å¤„ç†ã€‚</p>
<p>å¯¹äºæœªä¿®æ”¹è¿‡çš„åŒºé—´ç›´æ¥é¢„å¤„ç†$[0,n)$çš„çŸ©é˜µä¹˜ç§¯å¹¶å¿«é€Ÿå¹‚è®¡ç®—ã€‚</p>
<p>è€ƒè™‘ä¿®æ”¹çš„åŒºé—´ã€‚ä¸ºäº†é¿å…å¯¹ä¸€ä¸ª$s<em>i$çš„ä¿®æ”¹å½±å“åˆ°ä¸¤ä¸ªä¸åŒçš„åŒºé—´ï¼Œå¯ä»¥å…ˆå°†å¯¹$s_i$çš„ä¿®æ”¹æ˜ å°„åˆ°å¯¹çŸ©é˜µ$M</em>{i+1}$å’Œ$M_{i+2}$çš„ä¿®æ”¹ã€‚ç„¶åå‘ç°å¤„ç†ä¸€ä¸ªåŒºé—´æ—¶éœ€è¦å¤šæ¬¡å•ç‚¹ä¿®æ”¹å’Œä¸€æ¬¡åŒºé—´æŸ¥è¯¢ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤å³å¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸€äº›ç‰¹åˆ¤ï¼ˆåŸºæœ¬ä¸Šæ˜¯$k \lt n$çš„æƒ…å†µï¼‰ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O((n + m) (\log{n} + \log{k}))$ã€‚</p>
<p><del>ç‰¹åˆ¤ä¸å–æ¨¡ï¼Œçˆ†é›¶ä¸¤è¡Œæ³ª/kk</del></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF575A.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF575A</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> pii = pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> t, s1, s2;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, k, p, s[MAXN];</span><br><span class="line">pii a[MAXN];</span><br><span class="line">node b[MAXN * <span class="number">2</span>];</span><br><span class="line">unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= p ? x - p : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">matrix</span> &#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">matrix</span>() &#123; a[<span class="number">0</span>][<span class="number">0</span>] = a[<span class="number">0</span>][<span class="number">1</span>] = a[<span class="number">1</span>][<span class="number">0</span>] = a[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="built_in">matrix</span>(<span class="type">int</span> x) &#123; a[<span class="number">0</span>][<span class="number">0</span>] = a[<span class="number">1</span>][<span class="number">1</span>] = x, a[<span class="number">0</span>][<span class="number">1</span>] = a[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="built_in">matrix</span>(<span class="type">int</span> s1, <span class="type">int</span> s2) &#123; a[<span class="number">0</span>][<span class="number">0</span>] = s2, a[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>, a[<span class="number">1</span>][<span class="number">0</span>] = s1, a[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>; &#125;</span><br><span class="line">    matrix <span class="keyword">operator</span>*(<span class="type">const</span> matrix &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        matrix ret;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span>; ++j)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">2</span>; ++k)</span><br><span class="line">                    ret.a[i][j] = <span class="built_in">add</span>(ret.a[i][j], a[i][k] * o.a[k][j] % p);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> matrix <span class="keyword">operator</span>^(matrix x, <span class="type">int</span> y) &#123;</span><br><span class="line">        matrix ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = x * x)</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>) ret = ret * x;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> li (i &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ri (i &lt;&lt; 1) | 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson li, l, mid</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson ri, mid + 1, r</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">segment_tree</span> &#123;</span><br><span class="line">    matrix nd[MAXN * <span class="number">4</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        nd[i] = nd[li] * nd[ri];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> p, matrix v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">void</span>(nd[i] = v);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (p &lt;= mid)</span><br><span class="line">            <span class="built_in">update</span>(lson, p, v);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">update</span>(rson, p, v);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">matrix <span class="title">query</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> nd[i];</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        matrix ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            ret = ret * <span class="built_in">query</span>(lson, ql, qr);</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            ret = ret * <span class="built_in">query</span>(rson, ql, qr);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">segment_tree tr;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(k), <span class="built_in">read</span>(p);</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(s[i]);</span><br><span class="line">    <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i].first), <span class="built_in">read</span>(a[i].second);</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + m + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">1</span> &amp;&amp; a[i].first + <span class="number">1</span> == a[i - <span class="number">1</span>].first + <span class="number">2</span>)</span><br><span class="line">            b[++cnt] = &#123;a[i].first + <span class="number">1</span>, a[i - <span class="number">1</span>].second, a[i].second&#125;;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span> || a[i].first + <span class="number">1</span> != a[i - <span class="number">1</span>].first + <span class="number">2</span>)</span><br><span class="line">            b[++cnt] = &#123;a[i].first + <span class="number">1</span>, s[(a[i].first - <span class="number">1</span>) % n], a[i].second&#125;;</span><br><span class="line">        <span class="keyword">if</span> (i == m || a[i].first + <span class="number">2</span> != a[i + <span class="number">1</span>].first + <span class="number">1</span>)</span><br><span class="line">            b[++cnt] = &#123;a[i].first + <span class="number">2</span>, a[i].second, s[(a[i].first + <span class="number">1</span>) % n]&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (cnt &amp;&amp; b[cnt].t &gt; k)</span><br><span class="line">        --cnt;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        tr.<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, i, <span class="built_in">matrix</span>(s[(i + n - <span class="number">2</span>) % n], s[(i + n - <span class="number">1</span>) % n]));</span><br><span class="line">    <span class="keyword">if</span> (k == <span class="number">0</span> || k == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">write</span>(k % p), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>), <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k &lt; n) &#123;</span><br><span class="line">        matrix ret;</span><br><span class="line">        ret.a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">write</span>((ret * tr.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, <span class="number">2</span>, k)).a[<span class="number">0</span>][<span class="number">0</span>]), <span class="built_in">putchar</span>(<span class="string">&#x27;\0&#x27;</span>), <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    matrix sum = tr.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    matrix base = tr.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, <span class="number">2</span>, n - <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> pos = <span class="number">1</span>, pre = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (pos &lt;= cnt) &#123;</span><br><span class="line">        <span class="type">int</span> cur = b[pos].t / n;</span><br><span class="line">        base = base * (sum ^ (cur - pre - <span class="number">1</span>)), pre = cur;</span><br><span class="line">        <span class="type">int</span> cl = <span class="built_in">max</span>(<span class="number">2ll</span>, cur * n), cr = <span class="built_in">min</span>(k, cur * n + n - <span class="number">1</span>), lst = pos;</span><br><span class="line">        <span class="keyword">while</span> (pos &lt;= cnt &amp;&amp; cl &lt;= b[pos].t &amp;&amp; b[pos].t &lt;= cr) &#123;</span><br><span class="line">            tr.<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, b[pos].t % n, <span class="built_in">matrix</span>(b[pos].s1, b[pos].s2));</span><br><span class="line">            ++pos;</span><br><span class="line">        &#125;</span><br><span class="line">        base = base * tr.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, cl % n, cr % n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = lst; j &lt; pos; ++j)</span><br><span class="line">            tr.<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">1</span>, b[j].t % n, <span class="built_in">matrix</span>(s[(b[j].t - <span class="number">2</span>) % n], s[(b[j].t - <span class="number">1</span>) % n]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> cur = k / n;</span><br><span class="line">    <span class="keyword">if</span> (pre &lt; cur) &#123;</span><br><span class="line">        base = base * (sum ^ (cur - pre - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = cur * n; i &lt;= k; ++i)</span><br><span class="line">            base = base * <span class="built_in">matrix</span>(s[(i - <span class="number">2</span>) % n], s[(i - <span class="number">1</span>) % n]);</span><br><span class="line">    &#125;</span><br><span class="line">    matrix ret;</span><br><span class="line">    ret.a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    ret = ret * base;</span><br><span class="line">    <span class="built_in">write</span>(ret.a[<span class="number">0</span>][<span class="number">0</span>]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P6144 Help Yourself é¢˜è§£</title>
    <url>/2021/11/23/sol-p6144/</url>
    <content><![CDATA[<h2 id="P6144-Help-Yourself-é¢˜è§£"><a href="#P6144-Help-Yourself-é¢˜è§£" class="headerlink" title="P6144 Help Yourself é¢˜è§£"></a>P6144 Help Yourself é¢˜è§£</h2><span id="more"></span>
<p><del>åº”è¯¥æ˜¯ç¬¬ä¸€æ¬¡åœ¨å­¦æ ¡åˆè‡ªä¹ æ—¶å·OIï¼ˆç„¶åsxyèµ°è¿›æ¥çœ‹äº†æˆ‘ä¸€çœ¼å•¥ä¹Ÿæ²¡è¯´ï¼‰</del></p>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P6144">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>å¯¹äºè¿™ç§è‹¥å¹²åŒºé—´æ±‚å€¼çš„é¢˜ç›®ï¼Œè‚¯å®šå…ˆæŒ‰ç…§å·¦ç«¯ç‚¹æˆ–è€…å³ç«¯ç‚¹æ’ä¸ªåºã€‚</p>
<p>ä¸å¦¨å…ˆæ¥è€ƒè™‘å¯¹äº$k=1$çš„æƒ…å†µdpçŠ¶æ€æ€ä¹ˆè®¾ã€‚å¥—è·¯åœ°è®¾$dp_i$è¡¨ç¤ºä»¥$i$ä¸ºå½“å‰è¦†ç›–çš„æœ€å³ç«¯ç‚¹çš„è”é€šå—æ•°ç›®ä¹‹å’Œï¼Œä¸‹é¢è¦åŠ å…¥ä¸€æ¡çº¿æ®µ$[l,r]$ï¼Œæ€è€ƒæ’å…¥è¿™æ¡çº¿æ®µå¯¹$dp$å€¼çš„å½±å“ã€‚å¯¹äº$i\lt r$çš„æ‰€æœ‰$dp_i$ä¸ä¼šè¢«å½±å“ï¼Œè€Œå¯¹æ¯ä¸ª$0 \le i \lt l$ï¼Œ$dp_r$çš„å€¼éœ€åŠ ä¸Š$dp_i + 1$ï¼Œå¯¹æ¯ä¸ª$l \le i \lt r$ï¼Œ$dp_r$çš„å€¼éœ€åŠ ä¸Š$dp_i$ã€‚æœ€åå¯¹äº$i \gt r$ï¼Œæ˜¾ç„¶æ’å…¥è¿™ä¹ˆä¸€æ¡çº¿æ®µä¸ä¼šå½±å“åˆ°å…¶å³æ–­ç‚¹ï¼Œä½†å–è¯¥çº¿æ®µå’Œä¸å–è¯¥çº¿æ®µå„æœ‰ä¸€ç§å¯èƒ½ï¼Œæ‰€ä»¥è¦å°†æ•´ä¸ªåŒºé—´ä¹˜ä¸Š2.</p>
<p>åˆ†æåˆ°è¿™é‡Œï¼Œå¦‚ä½•ç»´æŠ¤$dp$å°±ä¸€ç›®äº†ç„¶äº†ï¼šä½¿ç”¨çº¿æ®µæ ‘ç»´æŠ¤å•ç‚¹åŠ æ³•å’ŒåŒºé—´ä¹˜æ³•ä»¥åŠåŒºé—´æ±‚å’Œå³å¯ã€‚</p>
<p>æ¥ä¸‹æ¥è®¡ç®—$k \neq 1$çš„æƒ…å†µã€‚ä¸éš¾å‘ç°æ¯ä¸ª$dp<em>{k,i}$éƒ½å¯ä»¥è¢«è¡¨ç¤ºæˆ$\sum\limits_i{b_i^k}$çš„å½¢å¼ï¼ˆ$b_i$æ˜¯æ¯ç§å­é›†çš„è”é€šå—æ•°ç›®ï¼‰ã€‚è€ŒåŒºé—´ä¹˜ä¸Š2ç›´æ¥åšï¼Œæ±‚å’Œä¹Ÿç›´æ¥çº¿æ®µæ ‘ï¼Œæ±‚$\sum\limits</em>{i=0}^{l-1}{(dp<em>{k,i}+1)}$ç”¨äºŒé¡¹å¼å®šç†æ‹†å¼€å¾—åˆ°$\sum\limits</em>{j=0}^{k}\sum\limits<em>{i=0}^{l-1}{\binom{k}{j} \times dp</em>{j,i}}$å³å¯å¾—åˆ°ç­”æ¡ˆã€‚</p>
<p>æ‰€ä»¥æ—¶é—´å¤æ‚åº¦$O(k^2n\log{n})$éšä¾¿è¿‡ã€‚<del>è¿™æ¯”å‰é¢ä¸¤é“é»‘é¢˜å¥½äº›å¤šäº†</del></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P6144.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P6144</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK = <span class="number">11</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    x += y;</span><br><span class="line">    <span class="keyword">return</span> x &gt;= MOD ? x - MOD : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> l, r;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> node &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> l == o.l ? r &lt; o.r : l &lt; o.l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> li (i &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ri (i &lt;&lt; 1) | 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson li, l, mid</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson ri, mid + 1, r</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">segment_tree</span> &#123;</span><br><span class="line">    <span class="type">int</span> sum[MAXM * <span class="number">4</span>], tag[MAXM * <span class="number">4</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        sum[i] = <span class="built_in">add</span>(sum[li], sum[ri]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getdown</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        sum[i] = sum[i] * val % MOD;</span><br><span class="line">        tag[i] = tag[i] * val % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tag[i] != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">getdown</span>(li, tag[i]);</span><br><span class="line">            <span class="built_in">getdown</span>(ri, tag[i]);</span><br><span class="line">            tag[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        sum[i] = <span class="number">0</span>; tag[i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">void</span>(sum[i] = x);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(lson, x), <span class="built_in">build</span>(rson, x);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> q, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">void</span>(sum[i] = <span class="built_in">add</span>(sum[i], val));</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (q &lt;= mid)</span><br><span class="line">            <span class="built_in">update</span>(lson, q, val);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">update</span>(rson, q, val);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &gt; qr)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">getdown</span>(i, val);</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            <span class="built_in">modify</span>(lson, ql, qr, val);</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            <span class="built_in">modify</span>(rson, ql, qr, val);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &gt; qr)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> sum[i];</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ret = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            ret = <span class="built_in">add</span>(ret, <span class="built_in">query</span>(lson, ql, qr));</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            ret = <span class="built_in">add</span>(ret, <span class="built_in">query</span>(rson, ql, qr));</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, k, c[MAXK][MAXK];</span><br><span class="line">node a[MAXN];</span><br><span class="line">segment_tree tr[MAXK];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k), m = n * <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i].l), <span class="built_in">read</span>(a[i].r);</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + n + <span class="number">1</span>);</span><br><span class="line">    c[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        c[i][<span class="number">0</span>] = c[i][i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; i; ++j)</span><br><span class="line">            c[i][j] = <span class="built_in">add</span>(c[i - <span class="number">1</span>][j], c[i - <span class="number">1</span>][j - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= k; ++i)</span><br><span class="line">        tr[i].<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">0</span>, m, <span class="number">0</span>);</span><br><span class="line">    tr[<span class="number">0</span>].<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">0</span>, m, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = k; j &gt;= <span class="number">0</span>; --j) &#123;</span><br><span class="line">            <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">0</span>; l &lt;= j; ++l)</span><br><span class="line">                sum = <span class="built_in">add</span>(sum, c[j][l] * tr[l].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, m, <span class="number">0</span>, a[i].l - <span class="number">1</span>) % MOD);</span><br><span class="line">            sum = <span class="built_in">add</span>(sum, tr[j].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, m, a[i].l, a[i].r));</span><br><span class="line">            tr[j].<span class="built_in">update</span>(<span class="number">1</span>, <span class="number">0</span>, m, a[i].r, sum);</span><br><span class="line">            tr[j].<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">0</span>, m, a[i].r + <span class="number">1</span>, m, <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(tr[k].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">0</span>, m, <span class="number">1</span>, m)), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF710F String Set Queries é¢˜è§£</title>
    <url>/2021/11/22/sol-cf710f/</url>
    <content><![CDATA[<h2 id="CF710F-String-Set-Queries-é¢˜è§£"><a href="#CF710F-String-Set-Queries-é¢˜è§£" class="headerlink" title="CF710F String Set Queries é¢˜è§£"></a>CF710F String Set Queries é¢˜è§£</h2><span id="more"></span>
<h3 id="åˆå·å‡ºæ¥ä¸€é“é»‘é¢˜å“ˆå“ˆå“ˆ"><a href="#åˆå·å‡ºæ¥ä¸€é“é»‘é¢˜å“ˆå“ˆå“ˆ" class="headerlink" title="åˆå·å‡ºæ¥ä¸€é“é»‘é¢˜å“ˆå“ˆå“ˆ"></a><del>åˆå·å‡ºæ¥ä¸€é“é»‘é¢˜å“ˆå“ˆå“ˆ</del></h3><h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF710F">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¦–å…ˆçœ‹åˆ°å¤šæ¨¡åŒ¹é…æƒ³åˆ°ACè‡ªåŠ¨æœºã€‚</p>
<p>è¿™ä¸ªå¼ºåˆ¶åœ¨çº¿çœ‹èµ·æ¥å¾ˆéº»çƒ¦çš„æ ·å­ï¼Œå› ä¸ºACè‡ªåŠ¨æœºå¿…é¡»è¦ç¦»çº¿ä¸‹æ¥æ‰èƒ½buildã€‚æ‰€ä»¥å°±å¼•å…¥ä¸€ç§æ–°çš„ç®—æ³•å«åšâ€œäºŒè¿›åˆ¶åˆ†ç»„â€ã€‚</p>
<blockquote>
<h3 id="äºŒè¿›åˆ¶åˆ†ç»„"><a href="#äºŒè¿›åˆ¶åˆ†ç»„" class="headerlink" title="äºŒè¿›åˆ¶åˆ†ç»„"></a>äºŒè¿›åˆ¶åˆ†ç»„</h3><p><del>è¿™ä¸ªç®—æ³•ä¸€çœ‹åå­—å°±å¾ˆ$\log$</del></p>
<p>ç»´æŠ¤ä¸€ä¸ªstackï¼Œé‡Œé¢çš„å€¼éƒ½æ˜¯2çš„æ¬¡å¹‚ã€‚æ¯æ¬¡æ“ä½œåœ¨æ ˆé¡¶æ’å…¥ä¸€ä¸ª1ï¼Œå¦‚æœæ ˆé¡¶çš„ä¸¤ä¸ªæ•°ç›¸åŒå°±å°†å…¶åˆå¹¶ï¼Œå¹¶æ”¹ä¸ºä¸¤ä¸ªæ•°çš„å’Œã€‚æŸ¥è¯¢çš„æ—¶å€™éå†æ•´ä¸ªstackå¯¹æ¯ä¸ªå€¼è¿›è¡ŒæŸ¥è¯¢ã€‚</p>
<p>è¿™æ ·å‡è®¾æ¯æ¬¡åˆå¹¶å’ŒæŸ¥è¯¢stackä¸­ä¸€ä¸ªå€¼çš„å¤æ‚åº¦éƒ½æ˜¯$O(x)$çš„ï¼ˆè¿™é‡Œ$x$æŒ‡çš„æ˜¯æ ˆå†…å½“å‰å€¼çš„å¤§å°ï¼‰æ˜¾ç„¶æŸ¥è¯¢çš„å¤æ‚åº¦æ˜¯$O(x)$çš„ï¼Œç„¶åæ’å…¥çš„å¤æ‚åº¦æ˜¯$O(x\log{n})$ï¼Œå› ä¸ºæ¯ä¸ªæ’å…¥çš„æ•°åªä¼šè¢«åˆå¹¶$\log{n}$æ¬¡ã€‚æ€»å¤æ‚åº¦ä¸º$O(qx\log{n})$ã€‚</p>
</blockquote>
<p>è€Œåœ¨è¿™é“é¢˜ä¸­ï¼Œ$qx = \sum{|S|} = 3 \times 10^5$ï¼Œæ‰€ä»¥æ˜¾ç„¶æ˜¯èƒ½è¿‡çš„ã€‚</p>
<p>äºæ˜¯è¿™é“é¢˜æœ¬èº«å¹¶ä¸ç®—éš¾ï¼Œä½†æ˜¯è¯„é»‘çš„åŸå› æˆ‘è®¤ä¸ºæ˜¯å®ƒ<strong>æ¯’ç˜¤å¡ç©ºé—´ï¼ï¼ï¼</strong></p>
<p>å…³äºæˆ‘ä»£ç ä¸­å¡ç©ºé—´çš„<del>å¥‡æŠ€æ·«å·§</del>å°±æ˜¯å°†ACè‡ªåŠ¨æœºçš„èŠ‚ç‚¹å¼€æˆå†…å­˜æ± ï¼ŒåŠ¨æ€åˆ†é…ï¼ˆä»£ç ä¸­<code>node* malloc_p()</code>çš„ä½œç”¨å°±åœ¨æ­¤ï¼‰ã€‚è¿˜æœ‰å°±æ˜¯æ³¨æ„ACè‡ªåŠ¨æœºåœ¨æ„å»ºçš„æ—¶å€™æŠŠ$cnt$æ•°ç»„é¢„å¤„ç†å¥½ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡è·³$fail$æŒ‡é’ˆäº†ï¼ˆæˆ‘ä»£ç ä¸€å¼€å§‹å°±åœ¨è¿™é‡ŒTLEäº†ï¼‰ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           CF710F.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF710F</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> lli = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK = <span class="number">22</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFI = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">bool</span> m_be;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> cnt, fail, nxt[<span class="number">26</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cnt = fail = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fill</span>(nxt, nxt + <span class="number">26</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> ntot, ntop;</span><br><span class="line">node nnd[MAXN];</span><br><span class="line">node *buf[MAXN];</span><br><span class="line"><span class="function">node* <span class="title">malloc_p</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ntop ? buf[ntop--] : &amp;nnd[++ntot];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ac_automaton</span> &#123;</span><br><span class="line">    <span class="type">int</span> tot;</span><br><span class="line">    node *nd[MAXN];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        nd[tot = <span class="number">0</span>] = <span class="built_in">malloc_p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= tot; ++i)</span><br><span class="line">            nd[i]-&gt;<span class="built_in">clear</span>(), buf[++ntop] = nd[i];</span><br><span class="line">        nd[tot = <span class="number">0</span>] = <span class="built_in">malloc_p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> rt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; s[i]; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!nd[rt]-&gt;nxt[s[i] - <span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">                nd[rt]-&gt;nxt[s[i] - <span class="string">&#x27;a&#x27;</span>] = (nd[++tot] = <span class="built_in">malloc_p</span>(), tot);</span><br><span class="line">            rt = nd[rt]-&gt;nxt[s[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        ++nd[rt]-&gt;cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>())</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i)</span><br><span class="line">            <span class="keyword">if</span> (nd[<span class="number">0</span>]-&gt;nxt[i])</span><br><span class="line">                que.<span class="built_in">push</span>(nd[<span class="number">0</span>]-&gt;nxt[i]);</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            nd[u]-&gt;cnt += nd[nd[u]-&gt;fail]-&gt;cnt;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nd[u]-&gt;nxt[i]) &#123;</span><br><span class="line">                    nd[nd[u]-&gt;nxt[i]]-&gt;fail = nd[nd[u]-&gt;fail]-&gt;nxt[i];</span><br><span class="line">                    que.<span class="built_in">push</span>(nd[u]-&gt;nxt[i]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nd[u]-&gt;nxt[i] = nd[nd[u]-&gt;fail]-&gt;nxt[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">lli <span class="title">query</span><span class="params">(<span class="type">char</span> *s)</span> </span>&#123;</span><br><span class="line">        lli ret = <span class="number">0</span>, p = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; s[i]; ++i) &#123;</span><br><span class="line">            p = nd[p]-&gt;nxt[s[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">            ret += nd[p]-&gt;cnt;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">group</span> &#123;</span><br><span class="line">    string dat[MAXN];</span><br><span class="line">    ac_automaton ac[MAXK];</span><br><span class="line">    <span class="type">int</span> n, top, sl[MAXK], sr[MAXK];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; MAXK; ++i)</span><br><span class="line">            ac[i].<span class="built_in">init</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *s)</span> </span>&#123;</span><br><span class="line">        dat[++n] = s;</span><br><span class="line">        ++top, sl[top] = n, sr[top] = n;</span><br><span class="line">        ac[top].<span class="built_in">clear</span>(), ac[top].<span class="built_in">insert</span>(s), ac[top].<span class="built_in">build</span>();</span><br><span class="line">        <span class="keyword">while</span> (top &gt; <span class="number">1</span> &amp;&amp; sr[top] - sl[top] == sr[top - <span class="number">1</span>] - sl[top - <span class="number">1</span>]) &#123;</span><br><span class="line">            sr[top - <span class="number">1</span>] = sr[top], ac[top--].<span class="built_in">clear</span>();</span><br><span class="line">            ac[top].<span class="built_in">clear</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = sl[top]; i &lt;= sr[top]; ++i)</span><br><span class="line">                ac[top].<span class="built_in">insert</span>(dat[i].<span class="built_in">c_str</span>());</span><br><span class="line">            ac[top].<span class="built_in">build</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">lli <span class="title">query</span><span class="params">(<span class="type">char</span> *s)</span> </span>&#123;</span><br><span class="line">        lli ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= top; ++i)</span><br><span class="line">            ret += ac[i].<span class="built_in">query</span>(s);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> m, opt;</span><br><span class="line"><span class="type">char</span> s[MAXN];</span><br><span class="line">group add, sub;</span><br><span class="line"><span class="type">bool</span> m_ed;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">debug</span>(<span class="string">&quot;memory = %.5lfMB&quot;</span>, (&amp;m_ed - &amp;m_be) / <span class="number">1024.0</span> / <span class="number">1024.0</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    <span class="type">int</span> mm = m;</span><br><span class="line">    add.<span class="built_in">init</span>(), sub.<span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%s&quot;</span>, &amp;opt, s + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>) &#123;</span><br><span class="line">            add.<span class="built_in">insert</span>(s + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (opt == <span class="number">2</span>) &#123;</span><br><span class="line">            sub.<span class="built_in">insert</span>(s + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, add.<span class="built_in">query</span>(s + <span class="number">1</span>) - sub.<span class="built_in">query</span>(s + <span class="number">1</span>));</span><br><span class="line">            <span class="built_in">fflush</span>(stdout);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>P4632 New Home é¢˜è§£</title>
    <url>/2021/11/22/sol-p4632/</url>
    <content><![CDATA[<h2 id="P4632-New-Home-é¢˜è§£"><a href="#P4632-New-Home-é¢˜è§£" class="headerlink" title="P4632 New Home é¢˜è§£"></a>P4632 New Home é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/P4632">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>æŠŠè¯¢é—®ç¦»çº¿ä¸‹æ¥ï¼Œè€ƒè™‘3ç§æ“ä½œï¼šæ–°å¼€ä¸€å®¶å•†åº—ï¼Œå…³æ‰ä¸€å®¶å•†åº—ï¼ŒæŸ¥è¯¢ä¸€ä¸ªç‚¹çš„ä¸æ–¹ä¾¿æŒ‡æ•°ã€‚</p>
<p>å…ˆè€ƒè™‘æŸ¥è¯¢ã€‚æ˜¾ç„¶å…·æœ‰äºŒåˆ†æ€§ï¼Œè€ƒè™‘åˆ¤æ–­ä¸€ä¸ªåŒºé—´ $[l,r]$ æ˜¯å¦åŒ…å«äº†æ‰€æœ‰çš„é¢œè‰²ã€‚è¿™ç§åŒºé—´ç»Ÿè®¡é¢œè‰²çš„é¢˜ç›®æœ‰ä¸€ä¸ªå¥—è·¯çš„è§£æ³•ï¼Œå³å¯¹äºä¸€ä¸ªç‚¹$i$ï¼Œä¿å­˜ $pre<em>i$ è¡¨ç¤º $i$ çš„ä¸Šä¸€ä¸ªç›¸åŒé¢œè‰²å‡ºç°çš„ä½ç½®ï¼ŒåŒºé—´ $[l,r]$ çš„ç­”æ¡ˆå³ä¸º $\sum\limits</em>{i=l}^{r}{(pre_i \lt l)}$ ã€‚</p>
<p>ä½†æ˜¯è¿™æ ·ä¸å¤ªä¾¿äºç»´æŠ¤ï¼Œäºæ˜¯æ€è€ƒåˆ°$pre$æ•°ç»„çš„å¦ä¸€ä¸ªæ€§è´¨ï¼šè‹¥$\min\limits_{i=r+1}^{n}{pre_i} \lt l$ï¼Œåˆ™è¯´æ˜å¿…æœ‰ä¸€ç§é¢œè‰²æ²¡æœ‰å‡ºç°åœ¨$[l,r]$ä¸­ã€‚è€Œæˆ‘ä»¬äºŒåˆ†+åˆ¤æ–­å¹¶ä¸éœ€è¦ç»Ÿè®¡é¢œè‰²çš„<strong>ä¸ªæ•°</strong>ï¼Œè€Œæ˜¯åªéœ€è¦ç»Ÿè®¡<strong>æ˜¯å¦ä¸ºkä¸ª</strong>ã€‚</p>
<p>äºæ˜¯å°±å¾ˆå®¹æ˜“ç»´æŠ¤è¿™ä¸ª$pre$æ•°ç»„å¹¶ç»Ÿè®¡ç­”æ¡ˆï¼šå°†$pre$æ”¾åœ¨æœ€å°å€¼çº¿æ®µæ ‘ä¸Šå³å¯ã€‚æ³¨æ„å¦‚æœæŸä¸ªé¢œè‰²æ²¡æœ‰å‡ºç°åœ¨$[r+1,n]$çš„è¯ä¼šå°‘è¢«è€ƒè™‘åˆ°ï¼Œæ‰€ä»¥åœ¨æœ€å·¦è¾¹å’Œæœ€å³è¾¹å„å¼€ä¸€ä¸ªå¤§èŠ‚ç‚¹ï¼Œä½œä¸ºæ‰€æœ‰é¢œè‰²å…¬ç”¨ã€‚</p>
<p>ä½†æ˜¯è¿™é“é¢˜æœ‰ä¸ªå¾ˆæ¶å¿ƒçš„åœ°æ–¹ï¼Œåœ¨äºæ¯ä¸ªç‚¹å¯èƒ½æœ‰å¤šä¸ªä¸åŒé¢œè‰²çš„å•†åº—ã€‚æ‰€ä»¥ä¸€ç§åšæ³•ä¸ºåœ¨çº¿æ®µæ ‘çš„æ¯ä¸ªå¶å­èŠ‚ç‚¹å¼€ä¸€ä¸ªsetæš´åŠ›ç»´æŠ¤ã€‚</p>
<p>æœ€åå¯¹äºä¿®æ”¹æ“ä½œä¹Ÿåªéœ€è¦å¯¹æ¯ä¸ªé¢œè‰²æš´åŠ›ç»´æŠ¤ä¸€ä¸ªsetï¼Œæ‰¾åˆ°å‰é©±å’Œåç»§å¹¶åœ¨çº¿æ®µæ ‘ä¸Šä¿®æ”¹å³å¯ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n\log^3{n})$<del>ï¼ˆè·‘å¾—é£å¿«ï¼‰</del></p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           P4632.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/P4632</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">3e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">using</span> pii = pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> t, p, c, id;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> node &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t &lt; o.t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">query</span> &#123;</span><br><span class="line">    <span class="type">int</span> t, p, id;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> query &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t &lt; o.t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> li (i &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ri (i &lt;&lt; 1) | 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson li, l, mid</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson ri, mid + 1, r</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">segment_tree</span> &#123;</span><br><span class="line">    <span class="type">int</span> mn[MAXN * <span class="number">12</span>];</span><br><span class="line">    set&lt;pii&gt; st[MAXN * <span class="number">3</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        mn[i] = <span class="built_in">min</span>(mn[li], mn[ri]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        mn[i] = INFL;</span><br><span class="line">        <span class="keyword">if</span> (l == r)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(lson), <span class="built_in">build</span>(rson);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> q, <span class="type">int</span> c, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            st[l].<span class="built_in">insert</span>(&#123;p, c&#125;);</span><br><span class="line">            mn[i] = st[l].<span class="built_in">size</span>() ? st[l].<span class="built_in">begin</span>()-&gt;first : INFL;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (q &lt;= mid)</span><br><span class="line">            <span class="built_in">insert</span>(lson, q, c, p);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">insert</span>(rson, q, c, p);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">erase</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> q, <span class="type">int</span> c, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            st[l].<span class="built_in">erase</span>(&#123;p, c&#125;);</span><br><span class="line">            mn[i] = st[l].<span class="built_in">size</span>() ? st[l].<span class="built_in">begin</span>()-&gt;first : INFL;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (q &lt;= mid)</span><br><span class="line">            <span class="built_in">erase</span>(lson, q, c, p);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">erase</span>(rson, q, c, p);</span><br><span class="line">        <span class="built_in">pushup</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr)</span><br><span class="line">            <span class="keyword">return</span> mn[i];</span><br><span class="line">        <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ret = INFL;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">            ret = <span class="built_in">min</span>(ret, <span class="built_in">query</span>(lson, ql, qr));</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid)</span><br><span class="line">            ret = <span class="built_in">min</span>(ret, <span class="built_in">query</span>(rson, ql, qr));</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, k, q, sig, len;</span><br><span class="line"><span class="type">int</span> pos[MAXN * <span class="number">3</span>], answ[MAXN];</span><br><span class="line">node bd[MAXN * <span class="number">2</span>];</span><br><span class="line">query qr[MAXN];</span><br><span class="line">multiset&lt;<span class="type">int</span>&gt; col[MAXN];</span><br><span class="line">segment_tree tr;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(node x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x.id &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        col[x.c].<span class="built_in">insert</span>(x.p);</span><br><span class="line">        <span class="keyword">if</span> (col[x.c].<span class="built_in">count</span>(x.p) == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">auto</span> pre = <span class="built_in">prev</span>(col[x.c].<span class="built_in">lower_bound</span>(x.p));</span><br><span class="line">            <span class="keyword">auto</span> nxt = col[x.c].<span class="built_in">upper_bound</span>(x.p);</span><br><span class="line">            tr.<span class="built_in">erase</span>(<span class="number">1</span>, <span class="number">1</span>, sig, *nxt, x.c, *pre);</span><br><span class="line">            tr.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="number">1</span>, sig, *nxt, x.c, x.p);</span><br><span class="line">            tr.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="number">1</span>, sig, x.p, x.c, *pre);            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        col[x.c].<span class="built_in">erase</span>(col[x.c].<span class="built_in">find</span>(x.p));</span><br><span class="line">        <span class="keyword">if</span> (col[x.c].<span class="built_in">count</span>(x.p) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">auto</span> pre = <span class="built_in">prev</span>(col[x.c].<span class="built_in">lower_bound</span>(x.p));</span><br><span class="line">            <span class="keyword">auto</span> nxt = col[x.c].<span class="built_in">upper_bound</span>(x.p);</span><br><span class="line">            tr.<span class="built_in">erase</span>(<span class="number">1</span>, <span class="number">1</span>, sig, *nxt, x.c, x.p);</span><br><span class="line">            tr.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="number">1</span>, sig, *nxt, x.c, *pre);</span><br><span class="line">            tr.<span class="built_in">erase</span>(<span class="number">1</span>, <span class="number">1</span>, sig, x.p, x.c, *pre);            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> ps, <span class="type">int</span> ln)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> u = <span class="built_in">lower_bound</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>, ps - ln) - pos - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> v = <span class="built_in">upper_bound</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>, ps + ln) - pos;</span><br><span class="line">    <span class="keyword">return</span> tr.<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, sig, v, sig) &gt; u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n), <span class="built_in">read</span>(k), <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> x, t, a, b;</span><br><span class="line">        <span class="built_in">read</span>(x), <span class="built_in">read</span>(t), <span class="built_in">read</span>(a), <span class="built_in">read</span>(b);</span><br><span class="line">        bd[++len] = &#123;a, x, t, i&#125;;</span><br><span class="line">        bd[++len] = &#123;b + <span class="number">1</span>, x, t, -i&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        <span class="built_in">read</span>(qr[i].p), <span class="built_in">read</span>(qr[i].t), qr[i].id = i;</span><br><span class="line">    pos[++sig] = INFL;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">        pos[++sig] = bd[i].p;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        pos[++sig] = qr[i].p;</span><br><span class="line">    <span class="built_in">sort</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>);</span><br><span class="line">    sig = <span class="built_in">unique</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>) - pos - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">        bd[i].p = <span class="built_in">lower_bound</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>, bd[i].p) - pos;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        qr[i].p = <span class="built_in">lower_bound</span>(pos + <span class="number">1</span>, pos + sig + <span class="number">1</span>, qr[i].p) - pos;</span><br><span class="line">    <span class="built_in">sort</span>(bd + <span class="number">1</span>, bd + len + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">sort</span>(qr + <span class="number">1</span>, qr + q + <span class="number">1</span>);</span><br><span class="line">    tr.<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, sig);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">        col[i].<span class="built_in">insert</span>(<span class="number">0</span>), col[i].<span class="built_in">insert</span>(sig);</span><br><span class="line">        tr.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="number">1</span>, sig, sig, i, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> cbd = <span class="number">1</span>, cqr = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (cqr &lt;= q) &#123;</span><br><span class="line">        <span class="keyword">while</span> (cbd &lt;= len &amp;&amp; bd[cbd].t &lt;= qr[cqr].t)</span><br><span class="line">            <span class="built_in">insert</span>(bd[cbd++]);</span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">0x3f3f3f3f</span>, ans = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">check</span>(pos[qr[cqr].p], mid))</span><br><span class="line">                r = mid - <span class="number">1</span>, ans = mid;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        answ[qr[cqr++].id] = ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= q; ++i)</span><br><span class="line">        <span class="built_in">write</span>(answ[i]), <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
  <entry>
    <title>CF702F T-Shirts é¢˜è§£</title>
    <url>/2021/11/22/sol-cf702f/</url>
    <content><![CDATA[<h2 id="CF702F-T-Shirts-é¢˜è§£"><a href="#CF702F-T-Shirts-é¢˜è§£" class="headerlink" title="CF702F T-Shirts é¢˜è§£"></a>CF702F T-Shirts é¢˜è§£</h2><span id="more"></span>
<h3 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h3><p><a href="https://www.luogu.com.cn/problem/CF702F">é¢˜ç›®é“¾æ¥</a></p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><p>é¦–å…ˆä¸éš¾æƒ³åˆ°æœ´ç´ çš„åšæ³•ï¼Œå¯¹æ¯ä¸ªäººæšä¸¾æ‰€æœ‰Tæ¤ã€‚ä½†æ˜¯è¿™æ ·æ˜¾ç„¶æ— æ³•è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p>
<p>ä½†æ˜¯å‘ç°å¯ä»¥æŒ‰é¡ºåºæšä¸¾æ‰€æœ‰Tæ¤$i$ï¼Œå¯¹æ¯ä¸ªäºº$j$è‹¥$v_j \ge c_i$åˆ™å°†$v_j$å‡å»$c_i$ï¼ŒåŒæ—¶å°†$cnt_j$åŠ ä¸€ã€‚</p>
<p>ä¸‹é¢è€ƒè™‘å¦‚ä½•ç”¨æ•°æ®ç»“æ„ä¼˜åŒ–ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯ä»¥æŸ¥æ‰¾ç¬¬ä¸€ä¸ª$\ge c_i$å¹¶ä¸”èƒ½æ”¯æŒåŒºé—´å‡å»$c_i$çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªå¯ä»¥ç”¨å¹³è¡¡æ ‘åšåˆ°ã€‚ä¼¼ä¹å…¶ä»–äººç”¨çš„éƒ½æ˜¯FHQçš„åšæ³•ï¼Œä½†æˆ‘ä¸ä¼šFHQæ‰€ä»¥åªèƒ½ç”¨splayä»£æ›¿äº†ã€‚</p>
<p>æ¯æ¬¡æ“ä½œå¯ä»¥æŠŠæ•´ä¸ªåŒºé—´åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š$[0,c_i)$ï¼Œ$[c_i,2c_i)$å’Œ$[2c_i,+\infty)$ã€‚ç¬¬ä¸€ä¸ªåŒºé—´æ˜¾ç„¶ä¸éœ€è¦æ“ä½œï¼Œç¬¬äºŒä¸ªåŒºé—´æˆ‘ä»¬æš´åŠ›åˆ é™¤å¹¶é‡æ–°æ’å…¥ï¼Œç¬¬ä¸‰ä¸ªåŒºé—´ç»´æŠ¤ä¸€ä¸ªtagæ ‡è®°ã€‚</p>
<p>è¿™æ ·çœ‹èµ·æ¥ä¼šTé£ï¼Œç„¶è€Œæ¥è®¡ç®—ä¸€ä¸‹æ—¶é—´å¤æ‚åº¦å°±ä¼šå‘ç°ï¼Œå¯¹äºä¸€ä¸ªåœ¨$[c_i,2c_i)$ä¸­çš„æ•°æ¯æ¬¡å‡å»$c_i$ï¼Œç›¸å½“äºæœ€å°‘æ¯æ¬¡$\times \frac{1}{2}$ï¼Œæ‰€ä»¥ä¸€ä¸ªæ•°$v_i$æœ€å¤šä¼šè¢«æš´åŠ›ä¿®æ”¹$\log_2{v_i}$æ¬¡ï¼Œæ‰€ä»¥å¤æ‚åº¦æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<p>å†æ¥è€ƒè™‘å¦‚ä½•åœ¨splayä¸Šæ“ä½œã€‚æˆ‘ä»¬æ‰¾åˆ°$c_i$çš„å‰é©±ï¼Œè®°ä¸ºèŠ‚ç‚¹$u$ï¼Œå†æ‰¾åˆ°$2c_i-1$çš„åç»§ï¼Œè®°ä¸ºèŠ‚ç‚¹$v$ï¼Œåªéœ€è¦å°†$u$è½¬åˆ°æ ¹èŠ‚ç‚¹ï¼Œ$v$è½¬åˆ°æ ¹èŠ‚ç‚¹çš„å³å„¿å­ï¼Œè¿™æ ·$v$å’Œ$v$çš„å³å„¿å­éƒ½åœ¨åŒºé—´$[2c_i,+\infty)$ä¸­ï¼Œç»´æŠ¤tagå¹¶æ‡’æƒ°æ›´æ–°ï¼›è€Œ$v$çš„å·¦å„¿å­å…¨éƒ½åœ¨åŒºé—´$[c_i,2c_i)$ä¸­ï¼Œåªéœ€éå†ä¸€éé‡æ–°æ’å…¥å³å¯ï¼›å…¶ä»–èŠ‚ç‚¹éƒ½ä¸éœ€è¦æ”¹åŠ¨ã€‚</p>
<p>æœ€åå°±æ˜¯æ¯æ¬¡æ“ä½œæ³¨æ„é¡ºåºï¼Œä¸€å®šè¦å…ˆæ›´æ–°$[c_i,2c_i)$å†æ›´æ–°$[2c_i,+\infty)$ï¼Œä¸ç„¶ä½ ä¼šå‘ç°æ‡’æƒ°æ ‡è®°æ‰“ä¸‹å»å¹³è¡¡æ ‘ä¸æ»¡è¶³äºŒå‰æœç´¢æ ‘çš„æ€§è´¨äº†ï¼ˆåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ï¼Œæˆ‘å°±å› ä¸ºè¿™ä¸ªè°ƒäº†ä¸€ä¸‹åˆï¼‰ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n\log^2{n})$ï¼Œç©ºé—´å¤æ‚åº¦å¦‚æœèŠ‚ç‚¹é‡å¤åˆ©ç”¨çš„è¯å¯ä»¥åšåˆ°$O(n)$ï¼ˆå…·ä½“è§ä»£ç ï¼‰ã€‚</p>
<h3 id="ACä»£ç "><a href="#ACä»£ç " class="headerlink" title="ACä»£ç "></a>ACä»£ç </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file:           2021.11.21-1.cpp</span></span><br><span class="line"><span class="comment"> * @author:         yaoxi-std</span></span><br><span class="line"><span class="comment"> * @url:            https://www.luogu.com.cn/problem/CF702F</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// #pragma GCC optimize (&quot;O2&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> resetIO(x) \</span></span><br><span class="line"><span class="meta">    freopen(#x <span class="string">&quot;.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin), freopen(#x <span class="string">&quot;.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(fmt, ...) \</span></span><br><span class="line"><span class="meta">    fprintf(stderr, <span class="string">&quot;[%s:%d] &quot;</span> fmt <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, ##__VA_ARGS__)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> _Tp&amp; <span class="title">read</span><span class="params">(_Tp &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> sign = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        sign |= (ch == <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> (ch = <span class="built_in">getchar</span>(); <span class="built_in">isdigit</span>(ch); ch = <span class="built_in">getchar</span>())</span><br><span class="line">            tmp /= <span class="number">10.0</span>, x += tmp * (ch ^ <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">return</span> sign ? (x = -x) : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Tp</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(_Tp x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>)</span><br><span class="line">        <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>((x % <span class="number">10</span>) ^ <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INFL = <span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> val, id, tag, cnt, tac;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> node &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> val == o.val ? id &lt; o.id : val &lt; o.val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> node &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> val == o.val &amp;&amp; id == o.id;</span><br><span class="line">    &#125;</span><br><span class="line">    node&amp; <span class="keyword">operator</span>+=(<span class="type">int</span> x) &#123;</span><br><span class="line">        val += x, tag += x, ++cnt, ++tac;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    node&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> node &amp;o) &#123;</span><br><span class="line">        val += o.tag, tag += o.tag;</span><br><span class="line">        cnt += o.tac, tac += o.tac;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">splay_tree</span> &#123;</span><br><span class="line">    node val[MAXN];</span><br><span class="line">    <span class="type">int</span> rt, tot, top, buf[MAXN];</span><br><span class="line">    <span class="type">int</span> siz[MAXN], fa[MAXN], ch[MAXN][<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">maintain</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; siz[x] = siz[ch[x][<span class="number">0</span>]] + siz[ch[x][<span class="number">1</span>]] + <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x == ch[fa[x]][<span class="number">1</span>]; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; siz[x] = fa[x] = ch[x][<span class="number">0</span>] = ch[x][<span class="number">1</span>] = <span class="number">0</span>; val[x] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;; <span class="keyword">if</span> (x) buf[++top] = x; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">newnode</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> top ? buf[top--] : ++tot; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getdown</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> v)</span> </span>&#123; val[x] += v; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ch[x][<span class="number">0</span>]) val[ch[x][<span class="number">0</span>]] += val[x];</span><br><span class="line">        <span class="keyword">if</span> (ch[x][<span class="number">1</span>]) val[ch[x][<span class="number">1</span>]] += val[x];</span><br><span class="line">        val[x].tag = val[x].tac = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">pushdown</span>(fa[x]), <span class="built_in">pushdown</span>(x);</span><br><span class="line">        <span class="type">int</span> y = fa[x], z = fa[y], w = <span class="built_in">get</span>(x);</span><br><span class="line">        ch[y][w] = ch[x][w ^ <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (ch[x][w ^ <span class="number">1</span>]) fa[ch[x][w ^ <span class="number">1</span>]] = y;</span><br><span class="line">        ch[x][w ^ <span class="number">1</span>] = y, fa[y] = x, fa[x] = z;</span><br><span class="line">        <span class="keyword">if</span> (z) ch[z][y == ch[z][<span class="number">1</span>]] = x;</span><br><span class="line">        <span class="built_in">maintain</span>(y), <span class="built_in">maintain</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> r = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> f = fa[x]; f = fa[x], f != r; <span class="built_in">rotate</span>(x))</span><br><span class="line">            <span class="keyword">if</span> (fa[f] != r) <span class="built_in">rotate</span>(<span class="built_in">get</span>(x) == <span class="built_in">get</span>(f) ? f : x);</span><br><span class="line">        <span class="keyword">if</span> (r == <span class="number">0</span>) rt = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(node k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cur = rt, f = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (cur) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(cur);</span><br><span class="line">            f = cur;</span><br><span class="line">            cur = ch[cur][val[cur] &lt; k];</span><br><span class="line">        &#125;</span><br><span class="line">        cur = <span class="built_in">newnode</span>();</span><br><span class="line">        val[cur] = k;</span><br><span class="line">        fa[cur] = f;</span><br><span class="line">        <span class="keyword">if</span> (f) ch[f][val[f] &lt; k] = cur;</span><br><span class="line">        <span class="built_in">maintain</span>(cur), <span class="built_in">maintain</span>(f);</span><br><span class="line">        <span class="built_in">splay</span>(cur);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(node k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cur = rt;</span><br><span class="line">        <span class="keyword">while</span> (cur) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(cur);</span><br><span class="line">            <span class="keyword">if</span> (k == val[cur]) &#123;</span><br><span class="line">                <span class="built_in">splay</span>(cur);</span><br><span class="line">                <span class="keyword">return</span> cur;</span><br><span class="line">            &#125;</span><br><span class="line">            cur = ch[cur][val[cur] &lt; k];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">pre</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cur = ch[rt][<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">pushdown</span>(rt), <span class="built_in">pushdown</span>(cur);</span><br><span class="line">        <span class="keyword">while</span> (ch[cur][<span class="number">1</span>])</span><br><span class="line">            cur = ch[cur][<span class="number">1</span>], <span class="built_in">pushdown</span>(cur);</span><br><span class="line">        <span class="keyword">if</span> (cur) <span class="built_in">splay</span>(cur);</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">nxt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cur = ch[rt][<span class="number">1</span>];</span><br><span class="line">        <span class="built_in">pushdown</span>(rt), <span class="built_in">pushdown</span>(cur);</span><br><span class="line">        <span class="keyword">while</span> (ch[cur][<span class="number">0</span>])</span><br><span class="line">            cur = ch[cur][<span class="number">0</span>], <span class="built_in">pushdown</span>(cur);</span><br><span class="line">        <span class="keyword">if</span> (cur) <span class="built_in">splay</span>(cur);</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">erase</span><span class="params">(node k)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">find</span>(k);</span><br><span class="line">        <span class="keyword">if</span> (!ch[rt][<span class="number">0</span>] &amp;&amp; !ch[rt][<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="built_in">clear</span>(rt);</span><br><span class="line">            rt = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!ch[rt][<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="type">int</span> cur = rt;</span><br><span class="line">            rt = ch[cur][<span class="number">1</span>];</span><br><span class="line">            fa[rt] = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">clear</span>(cur);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!ch[rt][<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="type">int</span> cur = rt;</span><br><span class="line">            rt = ch[cur][<span class="number">0</span>];</span><br><span class="line">            fa[rt] = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">clear</span>(cur);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> cur = rt, x = <span class="built_in">pre</span>();</span><br><span class="line">            fa[ch[cur][<span class="number">1</span>]] = x;</span><br><span class="line">            ch[rt][<span class="number">1</span>] = ch[cur][<span class="number">1</span>];</span><br><span class="line">            <span class="built_in">clear</span>(cur);</span><br><span class="line">            <span class="built_in">maintain</span>(rt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">prev</span><span class="params">(node k)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">insert</span>(k);</span><br><span class="line">        <span class="type">int</span> ret = <span class="built_in">pre</span>();</span><br><span class="line">        <span class="built_in">erase</span>(k);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">next</span><span class="params">(node k)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">insert</span>(k);</span><br><span class="line">        <span class="type">int</span> ret = <span class="built_in">nxt</span>();</span><br><span class="line">        <span class="built_in">erase</span>(k);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, node *vals, <span class="type">int</span> &amp;len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(x);</span><br><span class="line">        <span class="built_in">dfs</span>(ch[x][<span class="number">0</span>], vals, len);</span><br><span class="line">        vals[++len] = val[x];</span><br><span class="line">        <span class="built_in">dfs</span>(ch[x][<span class="number">1</span>], vals, len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> cost)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="type">static</span> node vals[MAXN];</span><br><span class="line">        <span class="type">int</span> u = <span class="built_in">prev</span>(&#123;cost, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">        <span class="type">int</span> v = <span class="built_in">next</span>(&#123;cost * <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">        <span class="built_in">splay</span>(u, <span class="number">0</span>), <span class="built_in">splay</span>(v, u);</span><br><span class="line">        <span class="built_in">dfs</span>(ch[v][<span class="number">0</span>], vals, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i) &#123;</span><br><span class="line">            <span class="built_in">erase</span>(vals[i]);</span><br><span class="line">            vals[i].val -= cost;</span><br><span class="line">            vals[i].cnt++;</span><br><span class="line">            <span class="built_in">insert</span>(vals[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        val[v].val -= cost, val[v].cnt++;</span><br><span class="line">        <span class="keyword">if</span> (ch[v][<span class="number">1</span>]) <span class="built_in">getdown</span>(ch[v][<span class="number">1</span>], -cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">shirt</span> &#123;</span><br><span class="line">    <span class="type">int</span> c, q;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> shirt &amp;o) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> q == o.q ? c &lt; o.c : q &gt; o.q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> n, m, b[MAXN], ans[MAXN];</span><br><span class="line">shirt a[MAXN];</span><br><span class="line">splay_tree splay;</span><br><span class="line">node tmp[MAXN];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="built_in">read</span>(a[i].c), <span class="built_in">read</span>(a[i].q);</span><br><span class="line">    <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">read</span>(b[i]);</span><br><span class="line">    splay.<span class="built_in">insert</span>(&#123;-INFL, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    splay.<span class="built_in">insert</span>(&#123;INFL, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        splay.<span class="built_in">insert</span>(&#123;b[i], i, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="built_in">sort</span>(a + <span class="number">1</span>, a + n + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        splay.<span class="built_in">solve</span>(a[i].c);</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    splay.<span class="built_in">dfs</span>(splay.rt, tmp, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= len; ++i)</span><br><span class="line">        ans[tmp[i].id] = tmp[i].cnt;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        <span class="built_in">write</span>(ans[i]), <span class="built_in">putchar</span>(i == m ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>solutions</tag>
      </tags>
  </entry>
</search>
